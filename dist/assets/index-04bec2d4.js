function X8(t,e){for(var i=0;i<e.length;i++){const s=e[i];if(typeof s!="string"&&!Array.isArray(s)){for(const u in s)if(u!=="default"&&!(u in t)){const p=Object.getOwnPropertyDescriptor(s,u);p&&Object.defineProperty(t,u,p.get?p:{enumerable:!0,get:()=>s[u]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))s(u);new MutationObserver(u=>{for(const p of u)if(p.type==="childList")for(const v of p.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&s(v)}).observe(document,{childList:!0,subtree:!0});function i(u){const p={};return u.integrity&&(p.integrity=u.integrity),u.referrerPolicy&&(p.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?p.credentials="include":u.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function s(u){if(u.ep)return;u.ep=!0;const p=i(u);fetch(u.href,p)}})();var Y8=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ny(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var yz={exports:{}},Bx={},vz={exports:{}},Gn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ry=Symbol.for("react.element"),K8=Symbol.for("react.portal"),J8=Symbol.for("react.fragment"),Q8=Symbol.for("react.strict_mode"),e$=Symbol.for("react.profiler"),t$=Symbol.for("react.provider"),n$=Symbol.for("react.context"),r$=Symbol.for("react.forward_ref"),i$=Symbol.for("react.suspense"),o$=Symbol.for("react.memo"),s$=Symbol.for("react.lazy"),qO=Symbol.iterator;function a$(t){return t===null||typeof t!="object"?null:(t=qO&&t[qO]||t["@@iterator"],typeof t=="function"?t:null)}var xz={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bz=Object.assign,wz={};function mp(t,e,i){this.props=t,this.context=e,this.refs=wz,this.updater=i||xz}mp.prototype.isReactComponent={};mp.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};mp.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Tz(){}Tz.prototype=mp.prototype;function qI(t,e,i){this.props=t,this.context=e,this.refs=wz,this.updater=i||xz}var HI=qI.prototype=new Tz;HI.constructor=qI;bz(HI,mp.prototype);HI.isPureReactComponent=!0;var HO=Array.isArray,Ez=Object.prototype.hasOwnProperty,ZI={current:null},Sz={key:!0,ref:!0,__self:!0,__source:!0};function Iz(t,e,i){var s,u={},p=null,v=null;if(e!=null)for(s in e.ref!==void 0&&(v=e.ref),e.key!==void 0&&(p=""+e.key),e)Ez.call(e,s)&&!Sz.hasOwnProperty(s)&&(u[s]=e[s]);var a=arguments.length-2;if(a===1)u.children=i;else if(1<a){for(var A=Array(a),O=0;O<a;O++)A[O]=arguments[O+2];u.children=A}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)u[s]===void 0&&(u[s]=a[s]);return{$$typeof:ry,type:t,key:p,ref:v,props:u,_owner:ZI.current}}function l$(t,e){return{$$typeof:ry,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function XI(t){return typeof t=="object"&&t!==null&&t.$$typeof===ry}function c$(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(i){return e[i]})}var ZO=/\/+/g;function bT(t,e){return typeof t=="object"&&t!==null&&t.key!=null?c$(""+t.key):e.toString(36)}function l1(t,e,i,s,u){var p=typeof t;(p==="undefined"||p==="boolean")&&(t=null);var v=!1;if(t===null)v=!0;else switch(p){case"string":case"number":v=!0;break;case"object":switch(t.$$typeof){case ry:case K8:v=!0}}if(v)return v=t,u=u(v),t=s===""?"."+bT(v,0):s,HO(u)?(i="",t!=null&&(i=t.replace(ZO,"$&/")+"/"),l1(u,e,i,"",function(O){return O})):u!=null&&(XI(u)&&(u=l$(u,i+(!u.key||v&&v.key===u.key?"":(""+u.key).replace(ZO,"$&/")+"/")+t)),e.push(u)),1;if(v=0,s=s===""?".":s+":",HO(t))for(var a=0;a<t.length;a++){p=t[a];var A=s+bT(p,a);v+=l1(p,e,i,A,u)}else if(A=a$(t),typeof A=="function")for(t=A.call(t),a=0;!(p=t.next()).done;)p=p.value,A=s+bT(p,a++),v+=l1(p,e,i,A,u);else if(p==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return v}function kv(t,e,i){if(t==null)return t;var s=[],u=0;return l1(t,s,"","",function(p){return e.call(i,p,u++)}),s}function u$(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(i){(t._status===0||t._status===-1)&&(t._status=1,t._result=i)},function(i){(t._status===0||t._status===-1)&&(t._status=2,t._result=i)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Eo={current:null},c1={transition:null},h$={ReactCurrentDispatcher:Eo,ReactCurrentBatchConfig:c1,ReactCurrentOwner:ZI};Gn.Children={map:kv,forEach:function(t,e,i){kv(t,function(){e.apply(this,arguments)},i)},count:function(t){var e=0;return kv(t,function(){e++}),e},toArray:function(t){return kv(t,function(e){return e})||[]},only:function(t){if(!XI(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Gn.Component=mp;Gn.Fragment=J8;Gn.Profiler=e$;Gn.PureComponent=qI;Gn.StrictMode=Q8;Gn.Suspense=i$;Gn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=h$;Gn.cloneElement=function(t,e,i){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=bz({},t.props),u=t.key,p=t.ref,v=t._owner;if(e!=null){if(e.ref!==void 0&&(p=e.ref,v=ZI.current),e.key!==void 0&&(u=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(A in e)Ez.call(e,A)&&!Sz.hasOwnProperty(A)&&(s[A]=e[A]===void 0&&a!==void 0?a[A]:e[A])}var A=arguments.length-2;if(A===1)s.children=i;else if(1<A){a=Array(A);for(var O=0;O<A;O++)a[O]=arguments[O+2];s.children=a}return{$$typeof:ry,type:t.type,key:u,ref:p,props:s,_owner:v}};Gn.createContext=function(t){return t={$$typeof:n$,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:t$,_context:t},t.Consumer=t};Gn.createElement=Iz;Gn.createFactory=function(t){var e=Iz.bind(null,t);return e.type=t,e};Gn.createRef=function(){return{current:null}};Gn.forwardRef=function(t){return{$$typeof:r$,render:t}};Gn.isValidElement=XI;Gn.lazy=function(t){return{$$typeof:s$,_payload:{_status:-1,_result:t},_init:u$}};Gn.memo=function(t,e){return{$$typeof:o$,type:t,compare:e===void 0?null:e}};Gn.startTransition=function(t){var e=c1.transition;c1.transition={};try{t()}finally{c1.transition=e}};Gn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Gn.useCallback=function(t,e){return Eo.current.useCallback(t,e)};Gn.useContext=function(t){return Eo.current.useContext(t)};Gn.useDebugValue=function(){};Gn.useDeferredValue=function(t){return Eo.current.useDeferredValue(t)};Gn.useEffect=function(t,e){return Eo.current.useEffect(t,e)};Gn.useId=function(){return Eo.current.useId()};Gn.useImperativeHandle=function(t,e,i){return Eo.current.useImperativeHandle(t,e,i)};Gn.useInsertionEffect=function(t,e){return Eo.current.useInsertionEffect(t,e)};Gn.useLayoutEffect=function(t,e){return Eo.current.useLayoutEffect(t,e)};Gn.useMemo=function(t,e){return Eo.current.useMemo(t,e)};Gn.useReducer=function(t,e,i){return Eo.current.useReducer(t,e,i)};Gn.useRef=function(t){return Eo.current.useRef(t)};Gn.useState=function(t){return Eo.current.useState(t)};Gn.useSyncExternalStore=function(t,e,i){return Eo.current.useSyncExternalStore(t,e,i)};Gn.useTransition=function(){return Eo.current.useTransition()};Gn.version="18.2.0";vz.exports=Gn;var Be=vz.exports;const Re=ny(Be),d$=X8({__proto__:null,default:Re},[Be]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$=Be,p$=Symbol.for("react.element"),m$=Symbol.for("react.fragment"),g$=Object.prototype.hasOwnProperty,_$=f$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,y$={key:!0,ref:!0,__self:!0,__source:!0};function Az(t,e,i){var s,u={},p=null,v=null;i!==void 0&&(p=""+i),e.key!==void 0&&(p=""+e.key),e.ref!==void 0&&(v=e.ref);for(s in e)g$.call(e,s)&&!y$.hasOwnProperty(s)&&(u[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)u[s]===void 0&&(u[s]=e[s]);return{$$typeof:p$,type:t,key:p,ref:v,props:u,_owner:_$.current}}Bx.Fragment=m$;Bx.jsx=Az;Bx.jsxs=Az;yz.exports=Bx;var We=yz.exports,IE={},Pz={exports:{}},ms={},kz={exports:{}},Cz={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Ze,St){var Lt=Ze.length;Ze.push(St);e:for(;0<Lt;){var vn=Lt-1>>>1,Kn=Ze[vn];if(0<u(Kn,St))Ze[vn]=St,Ze[Lt]=Kn,Lt=vn;else break e}}function i(Ze){return Ze.length===0?null:Ze[0]}function s(Ze){if(Ze.length===0)return null;var St=Ze[0],Lt=Ze.pop();if(Lt!==St){Ze[0]=Lt;e:for(var vn=0,Kn=Ze.length,br=Kn>>>1;vn<br;){var Io=2*(vn+1)-1,_s=Ze[Io],Oi=Io+1,Ao=Ze[Oi];if(0>u(_s,Lt))Oi<Kn&&0>u(Ao,_s)?(Ze[vn]=Ao,Ze[Oi]=Lt,vn=Oi):(Ze[vn]=_s,Ze[Io]=Lt,vn=Io);else if(Oi<Kn&&0>u(Ao,Lt))Ze[vn]=Ao,Ze[Oi]=Lt,vn=Oi;else break e}}return St}function u(Ze,St){var Lt=Ze.sortIndex-St.sortIndex;return Lt!==0?Lt:Ze.id-St.id}if(typeof performance=="object"&&typeof performance.now=="function"){var p=performance;t.unstable_now=function(){return p.now()}}else{var v=Date,a=v.now();t.unstable_now=function(){return v.now()-a}}var A=[],O=[],B=1,$=null,Y=3,se=!1,me=!1,_e=!1,Ee=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,le=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function fe(Ze){for(var St=i(O);St!==null;){if(St.callback===null)s(O);else if(St.startTime<=Ze)s(O),St.sortIndex=St.expirationTime,e(A,St);else break;St=i(O)}}function Ce(Ze){if(_e=!1,fe(Ze),!me)if(i(A)!==null)me=!0,xr(Ge);else{var St=i(O);St!==null&&rr(Ce,St.startTime-Ze)}}function Ge(Ze,St){me=!1,_e&&(_e=!1,ae(Tt),Tt=-1),se=!0;var Lt=Y;try{for(fe(St),$=i(A);$!==null&&(!($.expirationTime>St)||Ze&&!er());){var vn=$.callback;if(typeof vn=="function"){$.callback=null,Y=$.priorityLevel;var Kn=vn($.expirationTime<=St);St=t.unstable_now(),typeof Kn=="function"?$.callback=Kn:$===i(A)&&s(A),fe(St)}else s(A);$=i(A)}if($!==null)var br=!0;else{var Io=i(O);Io!==null&&rr(Ce,Io.startTime-St),br=!1}return br}finally{$=null,Y=Lt,se=!1}}var gt=!1,It=null,Tt=-1,Oe=5,Yt=-1;function er(){return!(t.unstable_now()-Yt<Oe)}function pt(){if(It!==null){var Ze=t.unstable_now();Yt=Ze;var St=!0;try{St=It(!0,Ze)}finally{St?kn():(gt=!1,It=null)}}else gt=!1}var kn;if(typeof le=="function")kn=function(){le(pt)};else if(typeof MessageChannel<"u"){var Er=new MessageChannel,si=Er.port2;Er.port1.onmessage=pt,kn=function(){si.postMessage(null)}}else kn=function(){Ee(pt,0)};function xr(Ze){It=Ze,gt||(gt=!0,kn())}function rr(Ze,St){Tt=Ee(function(){Ze(t.unstable_now())},St)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ze){Ze.callback=null},t.unstable_continueExecution=function(){me||se||(me=!0,xr(Ge))},t.unstable_forceFrameRate=function(Ze){0>Ze||125<Ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Oe=0<Ze?Math.floor(1e3/Ze):5},t.unstable_getCurrentPriorityLevel=function(){return Y},t.unstable_getFirstCallbackNode=function(){return i(A)},t.unstable_next=function(Ze){switch(Y){case 1:case 2:case 3:var St=3;break;default:St=Y}var Lt=Y;Y=St;try{return Ze()}finally{Y=Lt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Ze,St){switch(Ze){case 1:case 2:case 3:case 4:case 5:break;default:Ze=3}var Lt=Y;Y=Ze;try{return St()}finally{Y=Lt}},t.unstable_scheduleCallback=function(Ze,St,Lt){var vn=t.unstable_now();switch(typeof Lt=="object"&&Lt!==null?(Lt=Lt.delay,Lt=typeof Lt=="number"&&0<Lt?vn+Lt:vn):Lt=vn,Ze){case 1:var Kn=-1;break;case 2:Kn=250;break;case 5:Kn=1073741823;break;case 4:Kn=1e4;break;default:Kn=5e3}return Kn=Lt+Kn,Ze={id:B++,callback:St,priorityLevel:Ze,startTime:Lt,expirationTime:Kn,sortIndex:-1},Lt>vn?(Ze.sortIndex=Lt,e(O,Ze),i(A)===null&&Ze===i(O)&&(_e?(ae(Tt),Tt=-1):_e=!0,rr(Ce,Lt-vn))):(Ze.sortIndex=Kn,e(A,Ze),me||se||(me=!0,xr(Ge))),Ze},t.unstable_shouldYield=er,t.unstable_wrapCallback=function(Ze){var St=Y;return function(){var Lt=Y;Y=St;try{return Ze.apply(this,arguments)}finally{Y=Lt}}}})(Cz);kz.exports=Cz;var v$=kz.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mz=Be,fs=v$;function Pt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Rz=new Set,o_={};function Kh(t,e){Wf(t,e),Wf(t+"Capture",e)}function Wf(t,e){for(o_[t]=e,t=0;t<e.length;t++)Rz.add(e[t])}var Gl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),AE=Object.prototype.hasOwnProperty,x$=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,XO={},YO={};function b$(t){return AE.call(YO,t)?!0:AE.call(XO,t)?!1:x$.test(t)?YO[t]=!0:(XO[t]=!0,!1)}function w$(t,e,i,s){if(i!==null&&i.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:i!==null?!i.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function T$(t,e,i,s){if(e===null||typeof e>"u"||w$(t,e,i,s))return!0;if(s)return!1;if(i!==null)switch(i.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function So(t,e,i,s,u,p,v){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=u,this.mustUseProperty=i,this.propertyName=t,this.type=e,this.sanitizeURL=p,this.removeEmptyString=v}var Yi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Yi[t]=new So(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Yi[e]=new So(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Yi[t]=new So(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Yi[t]=new So(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Yi[t]=new So(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Yi[t]=new So(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Yi[t]=new So(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Yi[t]=new So(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Yi[t]=new So(t,5,!1,t.toLowerCase(),null,!1,!1)});var YI=/[\-:]([a-z])/g;function KI(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(YI,KI);Yi[e]=new So(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(YI,KI);Yi[e]=new So(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(YI,KI);Yi[e]=new So(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Yi[t]=new So(t,1,!1,t.toLowerCase(),null,!1,!1)});Yi.xlinkHref=new So("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Yi[t]=new So(t,1,!1,t.toLowerCase(),null,!0,!0)});function JI(t,e,i,s){var u=Yi.hasOwnProperty(e)?Yi[e]:null;(u!==null?u.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(T$(e,i,u,s)&&(i=null),s||u===null?b$(e)&&(i===null?t.removeAttribute(e):t.setAttribute(e,""+i)):u.mustUseProperty?t[u.propertyName]=i===null?u.type===3?!1:"":i:(e=u.attributeName,s=u.attributeNamespace,i===null?t.removeAttribute(e):(u=u.type,i=u===3||u===4&&i===!0?"":""+i,s?t.setAttributeNS(s,e,i):t.setAttribute(e,i))))}var nc=Mz.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Cv=Symbol.for("react.element"),_f=Symbol.for("react.portal"),yf=Symbol.for("react.fragment"),QI=Symbol.for("react.strict_mode"),PE=Symbol.for("react.profiler"),Oz=Symbol.for("react.provider"),Dz=Symbol.for("react.context"),eA=Symbol.for("react.forward_ref"),kE=Symbol.for("react.suspense"),CE=Symbol.for("react.suspense_list"),tA=Symbol.for("react.memo"),Vc=Symbol.for("react.lazy"),Lz=Symbol.for("react.offscreen"),KO=Symbol.iterator;function gg(t){return t===null||typeof t!="object"?null:(t=KO&&t[KO]||t["@@iterator"],typeof t=="function"?t:null)}var Xr=Object.assign,wT;function Ag(t){if(wT===void 0)try{throw Error()}catch(i){var e=i.stack.trim().match(/\n( *(at )?)/);wT=e&&e[1]||""}return`
`+wT+t}var TT=!1;function ET(t,e){if(!t||TT)return"";TT=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(O){var s=O}Reflect.construct(t,[],e)}else{try{e.call()}catch(O){s=O}t.call(e.prototype)}else{try{throw Error()}catch(O){s=O}t()}}catch(O){if(O&&s&&typeof O.stack=="string"){for(var u=O.stack.split(`
`),p=s.stack.split(`
`),v=u.length-1,a=p.length-1;1<=v&&0<=a&&u[v]!==p[a];)a--;for(;1<=v&&0<=a;v--,a--)if(u[v]!==p[a]){if(v!==1||a!==1)do if(v--,a--,0>a||u[v]!==p[a]){var A=`
`+u[v].replace(" at new "," at ");return t.displayName&&A.includes("<anonymous>")&&(A=A.replace("<anonymous>",t.displayName)),A}while(1<=v&&0<=a);break}}}finally{TT=!1,Error.prepareStackTrace=i}return(t=t?t.displayName||t.name:"")?Ag(t):""}function E$(t){switch(t.tag){case 5:return Ag(t.type);case 16:return Ag("Lazy");case 13:return Ag("Suspense");case 19:return Ag("SuspenseList");case 0:case 2:case 15:return t=ET(t.type,!1),t;case 11:return t=ET(t.type.render,!1),t;case 1:return t=ET(t.type,!0),t;default:return""}}function ME(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case yf:return"Fragment";case _f:return"Portal";case PE:return"Profiler";case QI:return"StrictMode";case kE:return"Suspense";case CE:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Dz:return(t.displayName||"Context")+".Consumer";case Oz:return(t._context.displayName||"Context")+".Provider";case eA:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case tA:return e=t.displayName||null,e!==null?e:ME(t.type)||"Memo";case Vc:e=t._payload,t=t._init;try{return ME(t(e))}catch{}}return null}function S$(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ME(e);case 8:return e===QI?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function mu(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function zz(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function I$(t){var e=zz(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var u=i.get,p=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return u.call(this)},set:function(v){s=""+v,p.call(this,v)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return s},setValue:function(v){s=""+v},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Mv(t){t._valueTracker||(t._valueTracker=I$(t))}function Nz(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),s="";return t&&(s=zz(t)?t.checked?"true":"false":t.value),t=s,t!==i?(e.setValue(t),!0):!1}function R1(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function RE(t,e){var i=e.checked;return Xr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??t._wrapperState.initialChecked})}function JO(t,e){var i=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;i=mu(e.value!=null?e.value:i),t._wrapperState={initialChecked:s,initialValue:i,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Fz(t,e){e=e.checked,e!=null&&JI(t,"checked",e,!1)}function OE(t,e){Fz(t,e);var i=mu(e.value),s=e.type;if(i!=null)s==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+i):t.value!==""+i&&(t.value=""+i);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?DE(t,e.type,i):e.hasOwnProperty("defaultValue")&&DE(t,e.type,mu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function QO(t,e,i){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,i||e===t.value||(t.value=e),t.defaultValue=e}i=t.name,i!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,i!==""&&(t.name=i)}function DE(t,e,i){(e!=="number"||R1(t.ownerDocument)!==t)&&(i==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+i&&(t.defaultValue=""+i))}var Pg=Array.isArray;function Of(t,e,i,s){if(t=t.options,e){e={};for(var u=0;u<i.length;u++)e["$"+i[u]]=!0;for(i=0;i<t.length;i++)u=e.hasOwnProperty("$"+t[i].value),t[i].selected!==u&&(t[i].selected=u),u&&s&&(t[i].defaultSelected=!0)}else{for(i=""+mu(i),e=null,u=0;u<t.length;u++){if(t[u].value===i){t[u].selected=!0,s&&(t[u].defaultSelected=!0);return}e!==null||t[u].disabled||(e=t[u])}e!==null&&(e.selected=!0)}}function LE(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Pt(91));return Xr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function e3(t,e){var i=e.value;if(i==null){if(i=e.children,e=e.defaultValue,i!=null){if(e!=null)throw Error(Pt(92));if(Pg(i)){if(1<i.length)throw Error(Pt(93));i=i[0]}e=i}e==null&&(e=""),i=e}t._wrapperState={initialValue:mu(i)}}function Bz(t,e){var i=mu(e.value),s=mu(e.defaultValue);i!=null&&(i=""+i,i!==t.value&&(t.value=i),e.defaultValue==null&&t.defaultValue!==i&&(t.defaultValue=i)),s!=null&&(t.defaultValue=""+s)}function t3(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function jz(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function zE(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?jz(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Rv,Vz=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,i,s,u){MSApp.execUnsafeLocalFunction(function(){return t(e,i,s,u)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Rv=Rv||document.createElement("div"),Rv.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Rv.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function s_(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=e;return}}t.textContent=e}var Vg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},A$=["Webkit","ms","Moz","O"];Object.keys(Vg).forEach(function(t){A$.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Vg[e]=Vg[t]})});function Uz(t,e,i){return e==null||typeof e=="boolean"||e===""?"":i||typeof e!="number"||e===0||Vg.hasOwnProperty(t)&&Vg[t]?(""+e).trim():e+"px"}function $z(t,e){t=t.style;for(var i in e)if(e.hasOwnProperty(i)){var s=i.indexOf("--")===0,u=Uz(i,e[i],s);i==="float"&&(i="cssFloat"),s?t.setProperty(i,u):t[i]=u}}var P$=Xr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function NE(t,e){if(e){if(P$[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Pt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Pt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Pt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Pt(62))}}function FE(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var BE=null;function nA(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var jE=null,Df=null,Lf=null;function n3(t){if(t=sy(t)){if(typeof jE!="function")throw Error(Pt(280));var e=t.stateNode;e&&(e=Gx(e),jE(t.stateNode,t.type,e))}}function Gz(t){Df?Lf?Lf.push(t):Lf=[t]:Df=t}function Wz(){if(Df){var t=Df,e=Lf;if(Lf=Df=null,n3(t),e)for(t=0;t<e.length;t++)n3(e[t])}}function qz(t,e){return t(e)}function Hz(){}var ST=!1;function Zz(t,e,i){if(ST)return t(e,i);ST=!0;try{return qz(t,e,i)}finally{ST=!1,(Df!==null||Lf!==null)&&(Hz(),Wz())}}function a_(t,e){var i=t.stateNode;if(i===null)return null;var s=Gx(i);if(s===null)return null;i=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(Pt(231,e,typeof i));return i}var VE=!1;if(Gl)try{var _g={};Object.defineProperty(_g,"passive",{get:function(){VE=!0}}),window.addEventListener("test",_g,_g),window.removeEventListener("test",_g,_g)}catch{VE=!1}function k$(t,e,i,s,u,p,v,a,A){var O=Array.prototype.slice.call(arguments,3);try{e.apply(i,O)}catch(B){this.onError(B)}}var Ug=!1,O1=null,D1=!1,UE=null,C$={onError:function(t){Ug=!0,O1=t}};function M$(t,e,i,s,u,p,v,a,A){Ug=!1,O1=null,k$.apply(C$,arguments)}function R$(t,e,i,s,u,p,v,a,A){if(M$.apply(this,arguments),Ug){if(Ug){var O=O1;Ug=!1,O1=null}else throw Error(Pt(198));D1||(D1=!0,UE=O)}}function Jh(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(i=e.return),t=e.return;while(t)}return e.tag===3?i:null}function Xz(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function r3(t){if(Jh(t)!==t)throw Error(Pt(188))}function O$(t){var e=t.alternate;if(!e){if(e=Jh(t),e===null)throw Error(Pt(188));return e!==t?null:t}for(var i=t,s=e;;){var u=i.return;if(u===null)break;var p=u.alternate;if(p===null){if(s=u.return,s!==null){i=s;continue}break}if(u.child===p.child){for(p=u.child;p;){if(p===i)return r3(u),t;if(p===s)return r3(u),e;p=p.sibling}throw Error(Pt(188))}if(i.return!==s.return)i=u,s=p;else{for(var v=!1,a=u.child;a;){if(a===i){v=!0,i=u,s=p;break}if(a===s){v=!0,s=u,i=p;break}a=a.sibling}if(!v){for(a=p.child;a;){if(a===i){v=!0,i=p,s=u;break}if(a===s){v=!0,s=p,i=u;break}a=a.sibling}if(!v)throw Error(Pt(189))}}if(i.alternate!==s)throw Error(Pt(190))}if(i.tag!==3)throw Error(Pt(188));return i.stateNode.current===i?t:e}function Yz(t){return t=O$(t),t!==null?Kz(t):null}function Kz(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Kz(t);if(e!==null)return e;t=t.sibling}return null}var Jz=fs.unstable_scheduleCallback,i3=fs.unstable_cancelCallback,D$=fs.unstable_shouldYield,L$=fs.unstable_requestPaint,ii=fs.unstable_now,z$=fs.unstable_getCurrentPriorityLevel,rA=fs.unstable_ImmediatePriority,Qz=fs.unstable_UserBlockingPriority,L1=fs.unstable_NormalPriority,N$=fs.unstable_LowPriority,e4=fs.unstable_IdlePriority,jx=null,qa=null;function F$(t){if(qa&&typeof qa.onCommitFiberRoot=="function")try{qa.onCommitFiberRoot(jx,t,void 0,(t.current.flags&128)===128)}catch{}}var la=Math.clz32?Math.clz32:V$,B$=Math.log,j$=Math.LN2;function V$(t){return t>>>=0,t===0?32:31-(B$(t)/j$|0)|0}var Ov=64,Dv=4194304;function kg(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function z1(t,e){var i=t.pendingLanes;if(i===0)return 0;var s=0,u=t.suspendedLanes,p=t.pingedLanes,v=i&268435455;if(v!==0){var a=v&~u;a!==0?s=kg(a):(p&=v,p!==0&&(s=kg(p)))}else v=i&~u,v!==0?s=kg(v):p!==0&&(s=kg(p));if(s===0)return 0;if(e!==0&&e!==s&&!(e&u)&&(u=s&-s,p=e&-e,u>=p||u===16&&(p&4194240)!==0))return e;if(s&4&&(s|=i&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)i=31-la(e),u=1<<i,s|=t[i],e&=~u;return s}function U$(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $$(t,e){for(var i=t.suspendedLanes,s=t.pingedLanes,u=t.expirationTimes,p=t.pendingLanes;0<p;){var v=31-la(p),a=1<<v,A=u[v];A===-1?(!(a&i)||a&s)&&(u[v]=U$(a,e)):A<=e&&(t.expiredLanes|=a),p&=~a}}function $E(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function t4(){var t=Ov;return Ov<<=1,!(Ov&4194240)&&(Ov=64),t}function IT(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function iy(t,e,i){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-la(e),t[e]=i}function G$(t,e){var i=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<i;){var u=31-la(i),p=1<<u;e[u]=0,s[u]=-1,t[u]=-1,i&=~p}}function iA(t,e){var i=t.entangledLanes|=e;for(t=t.entanglements;i;){var s=31-la(i),u=1<<s;u&e|t[s]&e&&(t[s]|=e),i&=~u}}var yr=0;function n4(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var r4,oA,i4,o4,s4,GE=!1,Lv=[],tu=null,nu=null,ru=null,l_=new Map,c_=new Map,$c=[],W$="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function o3(t,e){switch(t){case"focusin":case"focusout":tu=null;break;case"dragenter":case"dragleave":nu=null;break;case"mouseover":case"mouseout":ru=null;break;case"pointerover":case"pointerout":l_.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":c_.delete(e.pointerId)}}function yg(t,e,i,s,u,p){return t===null||t.nativeEvent!==p?(t={blockedOn:e,domEventName:i,eventSystemFlags:s,nativeEvent:p,targetContainers:[u]},e!==null&&(e=sy(e),e!==null&&oA(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,u!==null&&e.indexOf(u)===-1&&e.push(u),t)}function q$(t,e,i,s,u){switch(e){case"focusin":return tu=yg(tu,t,e,i,s,u),!0;case"dragenter":return nu=yg(nu,t,e,i,s,u),!0;case"mouseover":return ru=yg(ru,t,e,i,s,u),!0;case"pointerover":var p=u.pointerId;return l_.set(p,yg(l_.get(p)||null,t,e,i,s,u)),!0;case"gotpointercapture":return p=u.pointerId,c_.set(p,yg(c_.get(p)||null,t,e,i,s,u)),!0}return!1}function a4(t){var e=Eh(t.target);if(e!==null){var i=Jh(e);if(i!==null){if(e=i.tag,e===13){if(e=Xz(i),e!==null){t.blockedOn=e,s4(t.priority,function(){i4(i)});return}}else if(e===3&&i.stateNode.current.memoizedState.isDehydrated){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function u1(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var i=WE(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(i===null){i=t.nativeEvent;var s=new i.constructor(i.type,i);BE=s,i.target.dispatchEvent(s),BE=null}else return e=sy(i),e!==null&&oA(e),t.blockedOn=i,!1;e.shift()}return!0}function s3(t,e,i){u1(t)&&i.delete(e)}function H$(){GE=!1,tu!==null&&u1(tu)&&(tu=null),nu!==null&&u1(nu)&&(nu=null),ru!==null&&u1(ru)&&(ru=null),l_.forEach(s3),c_.forEach(s3)}function vg(t,e){t.blockedOn===e&&(t.blockedOn=null,GE||(GE=!0,fs.unstable_scheduleCallback(fs.unstable_NormalPriority,H$)))}function u_(t){function e(u){return vg(u,t)}if(0<Lv.length){vg(Lv[0],t);for(var i=1;i<Lv.length;i++){var s=Lv[i];s.blockedOn===t&&(s.blockedOn=null)}}for(tu!==null&&vg(tu,t),nu!==null&&vg(nu,t),ru!==null&&vg(ru,t),l_.forEach(e),c_.forEach(e),i=0;i<$c.length;i++)s=$c[i],s.blockedOn===t&&(s.blockedOn=null);for(;0<$c.length&&(i=$c[0],i.blockedOn===null);)a4(i),i.blockedOn===null&&$c.shift()}var zf=nc.ReactCurrentBatchConfig,N1=!0;function Z$(t,e,i,s){var u=yr,p=zf.transition;zf.transition=null;try{yr=1,sA(t,e,i,s)}finally{yr=u,zf.transition=p}}function X$(t,e,i,s){var u=yr,p=zf.transition;zf.transition=null;try{yr=4,sA(t,e,i,s)}finally{yr=u,zf.transition=p}}function sA(t,e,i,s){if(N1){var u=WE(t,e,i,s);if(u===null)zT(t,e,s,F1,i),o3(t,s);else if(q$(u,t,e,i,s))s.stopPropagation();else if(o3(t,s),e&4&&-1<W$.indexOf(t)){for(;u!==null;){var p=sy(u);if(p!==null&&r4(p),p=WE(t,e,i,s),p===null&&zT(t,e,s,F1,i),p===u)break;u=p}u!==null&&s.stopPropagation()}else zT(t,e,s,null,i)}}var F1=null;function WE(t,e,i,s){if(F1=null,t=nA(s),t=Eh(t),t!==null)if(e=Jh(t),e===null)t=null;else if(i=e.tag,i===13){if(t=Xz(e),t!==null)return t;t=null}else if(i===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return F1=t,null}function l4(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(z$()){case rA:return 1;case Qz:return 4;case L1:case N$:return 16;case e4:return 536870912;default:return 16}default:return 16}}var Zc=null,aA=null,h1=null;function c4(){if(h1)return h1;var t,e=aA,i=e.length,s,u="value"in Zc?Zc.value:Zc.textContent,p=u.length;for(t=0;t<i&&e[t]===u[t];t++);var v=i-t;for(s=1;s<=v&&e[i-s]===u[p-s];s++);return h1=u.slice(t,1<s?1-s:void 0)}function d1(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function zv(){return!0}function a3(){return!1}function gs(t){function e(i,s,u,p,v){this._reactName=i,this._targetInst=u,this.type=s,this.nativeEvent=p,this.target=v,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(i=t[a],this[a]=i?i(p):p[a]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?zv:a3,this.isPropagationStopped=a3,this}return Xr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=zv)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=zv)},persist:function(){},isPersistent:zv}),e}var gp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lA=gs(gp),oy=Xr({},gp,{view:0,detail:0}),Y$=gs(oy),AT,PT,xg,Vx=Xr({},oy,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cA,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==xg&&(xg&&t.type==="mousemove"?(AT=t.screenX-xg.screenX,PT=t.screenY-xg.screenY):PT=AT=0,xg=t),AT)},movementY:function(t){return"movementY"in t?t.movementY:PT}}),l3=gs(Vx),K$=Xr({},Vx,{dataTransfer:0}),J$=gs(K$),Q$=Xr({},oy,{relatedTarget:0}),kT=gs(Q$),e9=Xr({},gp,{animationName:0,elapsedTime:0,pseudoElement:0}),t9=gs(e9),n9=Xr({},gp,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),r9=gs(n9),i9=Xr({},gp,{data:0}),c3=gs(i9),o9={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},s9={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},a9={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function l9(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=a9[t])?!!e[t]:!1}function cA(){return l9}var c9=Xr({},oy,{key:function(t){if(t.key){var e=o9[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=d1(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?s9[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cA,charCode:function(t){return t.type==="keypress"?d1(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?d1(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),u9=gs(c9),h9=Xr({},Vx,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),u3=gs(h9),d9=Xr({},oy,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cA}),f9=gs(d9),p9=Xr({},gp,{propertyName:0,elapsedTime:0,pseudoElement:0}),m9=gs(p9),g9=Xr({},Vx,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),_9=gs(g9),y9=[9,13,27,32],uA=Gl&&"CompositionEvent"in window,$g=null;Gl&&"documentMode"in document&&($g=document.documentMode);var v9=Gl&&"TextEvent"in window&&!$g,u4=Gl&&(!uA||$g&&8<$g&&11>=$g),h3=String.fromCharCode(32),d3=!1;function h4(t,e){switch(t){case"keyup":return y9.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function d4(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var vf=!1;function x9(t,e){switch(t){case"compositionend":return d4(e);case"keypress":return e.which!==32?null:(d3=!0,h3);case"textInput":return t=e.data,t===h3&&d3?null:t;default:return null}}function b9(t,e){if(vf)return t==="compositionend"||!uA&&h4(t,e)?(t=c4(),h1=aA=Zc=null,vf=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return u4&&e.locale!=="ko"?null:e.data;default:return null}}var w9={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function f3(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!w9[t.type]:e==="textarea"}function f4(t,e,i,s){Gz(s),e=B1(e,"onChange"),0<e.length&&(i=new lA("onChange","change",null,i,s),t.push({event:i,listeners:e}))}var Gg=null,h_=null;function T9(t){E4(t,0)}function Ux(t){var e=wf(t);if(Nz(e))return t}function E9(t,e){if(t==="change")return e}var p4=!1;if(Gl){var CT;if(Gl){var MT="oninput"in document;if(!MT){var p3=document.createElement("div");p3.setAttribute("oninput","return;"),MT=typeof p3.oninput=="function"}CT=MT}else CT=!1;p4=CT&&(!document.documentMode||9<document.documentMode)}function m3(){Gg&&(Gg.detachEvent("onpropertychange",m4),h_=Gg=null)}function m4(t){if(t.propertyName==="value"&&Ux(h_)){var e=[];f4(e,h_,t,nA(t)),Zz(T9,e)}}function S9(t,e,i){t==="focusin"?(m3(),Gg=e,h_=i,Gg.attachEvent("onpropertychange",m4)):t==="focusout"&&m3()}function I9(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ux(h_)}function A9(t,e){if(t==="click")return Ux(e)}function P9(t,e){if(t==="input"||t==="change")return Ux(e)}function k9(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ua=typeof Object.is=="function"?Object.is:k9;function d_(t,e){if(ua(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var i=Object.keys(t),s=Object.keys(e);if(i.length!==s.length)return!1;for(s=0;s<i.length;s++){var u=i[s];if(!AE.call(e,u)||!ua(t[u],e[u]))return!1}return!0}function g3(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function _3(t,e){var i=g3(t);t=0;for(var s;i;){if(i.nodeType===3){if(s=t+i.textContent.length,t<=e&&s>=e)return{node:i,offset:e-t};t=s}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=g3(i)}}function g4(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?g4(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function _4(){for(var t=window,e=R1();e instanceof t.HTMLIFrameElement;){try{var i=typeof e.contentWindow.location.href=="string"}catch{i=!1}if(i)t=e.contentWindow;else break;e=R1(t.document)}return e}function hA(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function C9(t){var e=_4(),i=t.focusedElem,s=t.selectionRange;if(e!==i&&i&&i.ownerDocument&&g4(i.ownerDocument.documentElement,i)){if(s!==null&&hA(i)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in i)i.selectionStart=e,i.selectionEnd=Math.min(t,i.value.length);else if(t=(e=i.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var u=i.textContent.length,p=Math.min(s.start,u);s=s.end===void 0?p:Math.min(s.end,u),!t.extend&&p>s&&(u=s,s=p,p=u),u=_3(i,p);var v=_3(i,s);u&&v&&(t.rangeCount!==1||t.anchorNode!==u.node||t.anchorOffset!==u.offset||t.focusNode!==v.node||t.focusOffset!==v.offset)&&(e=e.createRange(),e.setStart(u.node,u.offset),t.removeAllRanges(),p>s?(t.addRange(e),t.extend(v.node,v.offset)):(e.setEnd(v.node,v.offset),t.addRange(e)))}}for(e=[],t=i;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<e.length;i++)t=e[i],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var M9=Gl&&"documentMode"in document&&11>=document.documentMode,xf=null,qE=null,Wg=null,HE=!1;function y3(t,e,i){var s=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;HE||xf==null||xf!==R1(s)||(s=xf,"selectionStart"in s&&hA(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Wg&&d_(Wg,s)||(Wg=s,s=B1(qE,"onSelect"),0<s.length&&(e=new lA("onSelect","select",null,e,i),t.push({event:e,listeners:s}),e.target=xf)))}function Nv(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var bf={animationend:Nv("Animation","AnimationEnd"),animationiteration:Nv("Animation","AnimationIteration"),animationstart:Nv("Animation","AnimationStart"),transitionend:Nv("Transition","TransitionEnd")},RT={},y4={};Gl&&(y4=document.createElement("div").style,"AnimationEvent"in window||(delete bf.animationend.animation,delete bf.animationiteration.animation,delete bf.animationstart.animation),"TransitionEvent"in window||delete bf.transitionend.transition);function $x(t){if(RT[t])return RT[t];if(!bf[t])return t;var e=bf[t],i;for(i in e)if(e.hasOwnProperty(i)&&i in y4)return RT[t]=e[i];return t}var v4=$x("animationend"),x4=$x("animationiteration"),b4=$x("animationstart"),w4=$x("transitionend"),T4=new Map,v3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function bu(t,e){T4.set(t,e),Kh(e,[t])}for(var OT=0;OT<v3.length;OT++){var DT=v3[OT],R9=DT.toLowerCase(),O9=DT[0].toUpperCase()+DT.slice(1);bu(R9,"on"+O9)}bu(v4,"onAnimationEnd");bu(x4,"onAnimationIteration");bu(b4,"onAnimationStart");bu("dblclick","onDoubleClick");bu("focusin","onFocus");bu("focusout","onBlur");bu(w4,"onTransitionEnd");Wf("onMouseEnter",["mouseout","mouseover"]);Wf("onMouseLeave",["mouseout","mouseover"]);Wf("onPointerEnter",["pointerout","pointerover"]);Wf("onPointerLeave",["pointerout","pointerover"]);Kh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Kh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Kh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Kh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Kh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Kh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),D9=new Set("cancel close invalid load scroll toggle".split(" ").concat(Cg));function x3(t,e,i){var s=t.type||"unknown-event";t.currentTarget=i,R$(s,e,void 0,t),t.currentTarget=null}function E4(t,e){e=(e&4)!==0;for(var i=0;i<t.length;i++){var s=t[i],u=s.event;s=s.listeners;e:{var p=void 0;if(e)for(var v=s.length-1;0<=v;v--){var a=s[v],A=a.instance,O=a.currentTarget;if(a=a.listener,A!==p&&u.isPropagationStopped())break e;x3(u,a,O),p=A}else for(v=0;v<s.length;v++){if(a=s[v],A=a.instance,O=a.currentTarget,a=a.listener,A!==p&&u.isPropagationStopped())break e;x3(u,a,O),p=A}}}if(D1)throw t=UE,D1=!1,UE=null,t}function zr(t,e){var i=e[JE];i===void 0&&(i=e[JE]=new Set);var s=t+"__bubble";i.has(s)||(S4(e,t,2,!1),i.add(s))}function LT(t,e,i){var s=0;e&&(s|=4),S4(i,t,s,e)}var Fv="_reactListening"+Math.random().toString(36).slice(2);function f_(t){if(!t[Fv]){t[Fv]=!0,Rz.forEach(function(i){i!=="selectionchange"&&(D9.has(i)||LT(i,!1,t),LT(i,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Fv]||(e[Fv]=!0,LT("selectionchange",!1,e))}}function S4(t,e,i,s){switch(l4(e)){case 1:var u=Z$;break;case 4:u=X$;break;default:u=sA}i=u.bind(null,e,i,t),u=void 0,!VE||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(u=!0),s?u!==void 0?t.addEventListener(e,i,{capture:!0,passive:u}):t.addEventListener(e,i,!0):u!==void 0?t.addEventListener(e,i,{passive:u}):t.addEventListener(e,i,!1)}function zT(t,e,i,s,u){var p=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var v=s.tag;if(v===3||v===4){var a=s.stateNode.containerInfo;if(a===u||a.nodeType===8&&a.parentNode===u)break;if(v===4)for(v=s.return;v!==null;){var A=v.tag;if((A===3||A===4)&&(A=v.stateNode.containerInfo,A===u||A.nodeType===8&&A.parentNode===u))return;v=v.return}for(;a!==null;){if(v=Eh(a),v===null)return;if(A=v.tag,A===5||A===6){s=p=v;continue e}a=a.parentNode}}s=s.return}Zz(function(){var O=p,B=nA(i),$=[];e:{var Y=T4.get(t);if(Y!==void 0){var se=lA,me=t;switch(t){case"keypress":if(d1(i)===0)break e;case"keydown":case"keyup":se=u9;break;case"focusin":me="focus",se=kT;break;case"focusout":me="blur",se=kT;break;case"beforeblur":case"afterblur":se=kT;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":se=l3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":se=J$;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":se=f9;break;case v4:case x4:case b4:se=t9;break;case w4:se=m9;break;case"scroll":se=Y$;break;case"wheel":se=_9;break;case"copy":case"cut":case"paste":se=r9;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":se=u3}var _e=(e&4)!==0,Ee=!_e&&t==="scroll",ae=_e?Y!==null?Y+"Capture":null:Y;_e=[];for(var le=O,fe;le!==null;){fe=le;var Ce=fe.stateNode;if(fe.tag===5&&Ce!==null&&(fe=Ce,ae!==null&&(Ce=a_(le,ae),Ce!=null&&_e.push(p_(le,Ce,fe)))),Ee)break;le=le.return}0<_e.length&&(Y=new se(Y,me,null,i,B),$.push({event:Y,listeners:_e}))}}if(!(e&7)){e:{if(Y=t==="mouseover"||t==="pointerover",se=t==="mouseout"||t==="pointerout",Y&&i!==BE&&(me=i.relatedTarget||i.fromElement)&&(Eh(me)||me[Wl]))break e;if((se||Y)&&(Y=B.window===B?B:(Y=B.ownerDocument)?Y.defaultView||Y.parentWindow:window,se?(me=i.relatedTarget||i.toElement,se=O,me=me?Eh(me):null,me!==null&&(Ee=Jh(me),me!==Ee||me.tag!==5&&me.tag!==6)&&(me=null)):(se=null,me=O),se!==me)){if(_e=l3,Ce="onMouseLeave",ae="onMouseEnter",le="mouse",(t==="pointerout"||t==="pointerover")&&(_e=u3,Ce="onPointerLeave",ae="onPointerEnter",le="pointer"),Ee=se==null?Y:wf(se),fe=me==null?Y:wf(me),Y=new _e(Ce,le+"leave",se,i,B),Y.target=Ee,Y.relatedTarget=fe,Ce=null,Eh(B)===O&&(_e=new _e(ae,le+"enter",me,i,B),_e.target=fe,_e.relatedTarget=Ee,Ce=_e),Ee=Ce,se&&me)t:{for(_e=se,ae=me,le=0,fe=_e;fe;fe=hf(fe))le++;for(fe=0,Ce=ae;Ce;Ce=hf(Ce))fe++;for(;0<le-fe;)_e=hf(_e),le--;for(;0<fe-le;)ae=hf(ae),fe--;for(;le--;){if(_e===ae||ae!==null&&_e===ae.alternate)break t;_e=hf(_e),ae=hf(ae)}_e=null}else _e=null;se!==null&&b3($,Y,se,_e,!1),me!==null&&Ee!==null&&b3($,Ee,me,_e,!0)}}e:{if(Y=O?wf(O):window,se=Y.nodeName&&Y.nodeName.toLowerCase(),se==="select"||se==="input"&&Y.type==="file")var Ge=E9;else if(f3(Y))if(p4)Ge=P9;else{Ge=I9;var gt=S9}else(se=Y.nodeName)&&se.toLowerCase()==="input"&&(Y.type==="checkbox"||Y.type==="radio")&&(Ge=A9);if(Ge&&(Ge=Ge(t,O))){f4($,Ge,i,B);break e}gt&&gt(t,Y,O),t==="focusout"&&(gt=Y._wrapperState)&&gt.controlled&&Y.type==="number"&&DE(Y,"number",Y.value)}switch(gt=O?wf(O):window,t){case"focusin":(f3(gt)||gt.contentEditable==="true")&&(xf=gt,qE=O,Wg=null);break;case"focusout":Wg=qE=xf=null;break;case"mousedown":HE=!0;break;case"contextmenu":case"mouseup":case"dragend":HE=!1,y3($,i,B);break;case"selectionchange":if(M9)break;case"keydown":case"keyup":y3($,i,B)}var It;if(uA)e:{switch(t){case"compositionstart":var Tt="onCompositionStart";break e;case"compositionend":Tt="onCompositionEnd";break e;case"compositionupdate":Tt="onCompositionUpdate";break e}Tt=void 0}else vf?h4(t,i)&&(Tt="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(Tt="onCompositionStart");Tt&&(u4&&i.locale!=="ko"&&(vf||Tt!=="onCompositionStart"?Tt==="onCompositionEnd"&&vf&&(It=c4()):(Zc=B,aA="value"in Zc?Zc.value:Zc.textContent,vf=!0)),gt=B1(O,Tt),0<gt.length&&(Tt=new c3(Tt,t,null,i,B),$.push({event:Tt,listeners:gt}),It?Tt.data=It:(It=d4(i),It!==null&&(Tt.data=It)))),(It=v9?x9(t,i):b9(t,i))&&(O=B1(O,"onBeforeInput"),0<O.length&&(B=new c3("onBeforeInput","beforeinput",null,i,B),$.push({event:B,listeners:O}),B.data=It))}E4($,e)})}function p_(t,e,i){return{instance:t,listener:e,currentTarget:i}}function B1(t,e){for(var i=e+"Capture",s=[];t!==null;){var u=t,p=u.stateNode;u.tag===5&&p!==null&&(u=p,p=a_(t,i),p!=null&&s.unshift(p_(t,p,u)),p=a_(t,e),p!=null&&s.push(p_(t,p,u))),t=t.return}return s}function hf(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function b3(t,e,i,s,u){for(var p=e._reactName,v=[];i!==null&&i!==s;){var a=i,A=a.alternate,O=a.stateNode;if(A!==null&&A===s)break;a.tag===5&&O!==null&&(a=O,u?(A=a_(i,p),A!=null&&v.unshift(p_(i,A,a))):u||(A=a_(i,p),A!=null&&v.push(p_(i,A,a)))),i=i.return}v.length!==0&&t.push({event:e,listeners:v})}var L9=/\r\n?/g,z9=/\u0000|\uFFFD/g;function w3(t){return(typeof t=="string"?t:""+t).replace(L9,`
`).replace(z9,"")}function Bv(t,e,i){if(e=w3(e),w3(t)!==e&&i)throw Error(Pt(425))}function j1(){}var ZE=null,XE=null;function YE(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var KE=typeof setTimeout=="function"?setTimeout:void 0,N9=typeof clearTimeout=="function"?clearTimeout:void 0,T3=typeof Promise=="function"?Promise:void 0,F9=typeof queueMicrotask=="function"?queueMicrotask:typeof T3<"u"?function(t){return T3.resolve(null).then(t).catch(B9)}:KE;function B9(t){setTimeout(function(){throw t})}function NT(t,e){var i=e,s=0;do{var u=i.nextSibling;if(t.removeChild(i),u&&u.nodeType===8)if(i=u.data,i==="/$"){if(s===0){t.removeChild(u),u_(e);return}s--}else i!=="$"&&i!=="$?"&&i!=="$!"||s++;i=u}while(i);u_(e)}function iu(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function E3(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(e===0)return t;e--}else i==="/$"&&e++}t=t.previousSibling}return null}var _p=Math.random().toString(36).slice(2),ja="__reactFiber$"+_p,m_="__reactProps$"+_p,Wl="__reactContainer$"+_p,JE="__reactEvents$"+_p,j9="__reactListeners$"+_p,V9="__reactHandles$"+_p;function Eh(t){var e=t[ja];if(e)return e;for(var i=t.parentNode;i;){if(e=i[Wl]||i[ja]){if(i=e.alternate,e.child!==null||i!==null&&i.child!==null)for(t=E3(t);t!==null;){if(i=t[ja])return i;t=E3(t)}return e}t=i,i=t.parentNode}return null}function sy(t){return t=t[ja]||t[Wl],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function wf(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Pt(33))}function Gx(t){return t[m_]||null}var QE=[],Tf=-1;function wu(t){return{current:t}}function Br(t){0>Tf||(t.current=QE[Tf],QE[Tf]=null,Tf--)}function Cr(t,e){Tf++,QE[Tf]=t.current,t.current=e}var gu={},fo=wu(gu),Go=wu(!1),zh=gu;function qf(t,e){var i=t.type.contextTypes;if(!i)return gu;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var u={},p;for(p in i)u[p]=e[p];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=u),u}function Wo(t){return t=t.childContextTypes,t!=null}function V1(){Br(Go),Br(fo)}function S3(t,e,i){if(fo.current!==gu)throw Error(Pt(168));Cr(fo,e),Cr(Go,i)}function I4(t,e,i){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return i;s=s.getChildContext();for(var u in s)if(!(u in e))throw Error(Pt(108,S$(t)||"Unknown",u));return Xr({},i,s)}function U1(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||gu,zh=fo.current,Cr(fo,t),Cr(Go,Go.current),!0}function I3(t,e,i){var s=t.stateNode;if(!s)throw Error(Pt(169));i?(t=I4(t,e,zh),s.__reactInternalMemoizedMergedChildContext=t,Br(Go),Br(fo),Cr(fo,t)):Br(Go),Cr(Go,i)}var Rl=null,Wx=!1,FT=!1;function A4(t){Rl===null?Rl=[t]:Rl.push(t)}function U9(t){Wx=!0,A4(t)}function Tu(){if(!FT&&Rl!==null){FT=!0;var t=0,e=yr;try{var i=Rl;for(yr=1;t<i.length;t++){var s=i[t];do s=s(!0);while(s!==null)}Rl=null,Wx=!1}catch(u){throw Rl!==null&&(Rl=Rl.slice(t+1)),Jz(rA,Tu),u}finally{yr=e,FT=!1}}return null}var Ef=[],Sf=0,$1=null,G1=0,Cs=[],Ms=0,Nh=null,Dl=1,Ll="";function vh(t,e){Ef[Sf++]=G1,Ef[Sf++]=$1,$1=t,G1=e}function P4(t,e,i){Cs[Ms++]=Dl,Cs[Ms++]=Ll,Cs[Ms++]=Nh,Nh=t;var s=Dl;t=Ll;var u=32-la(s)-1;s&=~(1<<u),i+=1;var p=32-la(e)+u;if(30<p){var v=u-u%5;p=(s&(1<<v)-1).toString(32),s>>=v,u-=v,Dl=1<<32-la(e)+u|i<<u|s,Ll=p+t}else Dl=1<<p|i<<u|s,Ll=t}function dA(t){t.return!==null&&(vh(t,1),P4(t,1,0))}function fA(t){for(;t===$1;)$1=Ef[--Sf],Ef[Sf]=null,G1=Ef[--Sf],Ef[Sf]=null;for(;t===Nh;)Nh=Cs[--Ms],Cs[Ms]=null,Ll=Cs[--Ms],Cs[Ms]=null,Dl=Cs[--Ms],Cs[Ms]=null}var hs=null,us=null,Ur=!1,sa=null;function k4(t,e){var i=Ds(5,null,null,0);i.elementType="DELETED",i.stateNode=e,i.return=t,e=t.deletions,e===null?(t.deletions=[i],t.flags|=16):e.push(i)}function A3(t,e){switch(t.tag){case 5:var i=t.type;return e=e.nodeType!==1||i.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,hs=t,us=iu(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,hs=t,us=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(i=Nh!==null?{id:Dl,overflow:Ll}:null,t.memoizedState={dehydrated:e,treeContext:i,retryLane:1073741824},i=Ds(18,null,null,0),i.stateNode=e,i.return=t,t.child=i,hs=t,us=null,!0):!1;default:return!1}}function eS(t){return(t.mode&1)!==0&&(t.flags&128)===0}function tS(t){if(Ur){var e=us;if(e){var i=e;if(!A3(t,e)){if(eS(t))throw Error(Pt(418));e=iu(i.nextSibling);var s=hs;e&&A3(t,e)?k4(s,i):(t.flags=t.flags&-4097|2,Ur=!1,hs=t)}}else{if(eS(t))throw Error(Pt(418));t.flags=t.flags&-4097|2,Ur=!1,hs=t}}}function P3(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;hs=t}function jv(t){if(t!==hs)return!1;if(!Ur)return P3(t),Ur=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!YE(t.type,t.memoizedProps)),e&&(e=us)){if(eS(t))throw C4(),Error(Pt(418));for(;e;)k4(t,e),e=iu(e.nextSibling)}if(P3(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Pt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="/$"){if(e===0){us=iu(t.nextSibling);break e}e--}else i!=="$"&&i!=="$!"&&i!=="$?"||e++}t=t.nextSibling}us=null}}else us=hs?iu(t.stateNode.nextSibling):null;return!0}function C4(){for(var t=us;t;)t=iu(t.nextSibling)}function Hf(){us=hs=null,Ur=!1}function pA(t){sa===null?sa=[t]:sa.push(t)}var $9=nc.ReactCurrentBatchConfig;function ia(t,e){if(t&&t.defaultProps){e=Xr({},e),t=t.defaultProps;for(var i in t)e[i]===void 0&&(e[i]=t[i]);return e}return e}var W1=wu(null),q1=null,If=null,mA=null;function gA(){mA=If=q1=null}function _A(t){var e=W1.current;Br(W1),t._currentValue=e}function nS(t,e,i){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===i)break;t=t.return}}function Nf(t,e){q1=t,mA=If=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Uo=!0),t.firstContext=null)}function Ns(t){var e=t._currentValue;if(mA!==t)if(t={context:t,memoizedValue:e,next:null},If===null){if(q1===null)throw Error(Pt(308));If=t,q1.dependencies={lanes:0,firstContext:t}}else If=If.next=t;return e}var Sh=null;function yA(t){Sh===null?Sh=[t]:Sh.push(t)}function M4(t,e,i,s){var u=e.interleaved;return u===null?(i.next=i,yA(e)):(i.next=u.next,u.next=i),e.interleaved=i,ql(t,s)}function ql(t,e){t.lanes|=e;var i=t.alternate;for(i!==null&&(i.lanes|=e),i=t,t=t.return;t!==null;)t.childLanes|=e,i=t.alternate,i!==null&&(i.childLanes|=e),i=t,t=t.return;return i.tag===3?i.stateNode:null}var Uc=!1;function vA(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function R4(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function jl(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ou(t,e,i){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,Qn&2){var u=s.pending;return u===null?e.next=e:(e.next=u.next,u.next=e),s.pending=e,ql(t,i)}return u=s.interleaved,u===null?(e.next=e,yA(s)):(e.next=u.next,u.next=e),s.interleaved=e,ql(t,i)}function f1(t,e,i){if(e=e.updateQueue,e!==null&&(e=e.shared,(i&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,i|=s,e.lanes=i,iA(t,i)}}function k3(t,e){var i=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,i===s)){var u=null,p=null;if(i=i.firstBaseUpdate,i!==null){do{var v={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};p===null?u=p=v:p=p.next=v,i=i.next}while(i!==null);p===null?u=p=e:p=p.next=e}else u=p=e;i={baseState:s.baseState,firstBaseUpdate:u,lastBaseUpdate:p,shared:s.shared,effects:s.effects},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}function H1(t,e,i,s){var u=t.updateQueue;Uc=!1;var p=u.firstBaseUpdate,v=u.lastBaseUpdate,a=u.shared.pending;if(a!==null){u.shared.pending=null;var A=a,O=A.next;A.next=null,v===null?p=O:v.next=O,v=A;var B=t.alternate;B!==null&&(B=B.updateQueue,a=B.lastBaseUpdate,a!==v&&(a===null?B.firstBaseUpdate=O:a.next=O,B.lastBaseUpdate=A))}if(p!==null){var $=u.baseState;v=0,B=O=A=null,a=p;do{var Y=a.lane,se=a.eventTime;if((s&Y)===Y){B!==null&&(B=B.next={eventTime:se,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var me=t,_e=a;switch(Y=e,se=i,_e.tag){case 1:if(me=_e.payload,typeof me=="function"){$=me.call(se,$,Y);break e}$=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=_e.payload,Y=typeof me=="function"?me.call(se,$,Y):me,Y==null)break e;$=Xr({},$,Y);break e;case 2:Uc=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,Y=u.effects,Y===null?u.effects=[a]:Y.push(a))}else se={eventTime:se,lane:Y,tag:a.tag,payload:a.payload,callback:a.callback,next:null},B===null?(O=B=se,A=$):B=B.next=se,v|=Y;if(a=a.next,a===null){if(a=u.shared.pending,a===null)break;Y=a,a=Y.next,Y.next=null,u.lastBaseUpdate=Y,u.shared.pending=null}}while(1);if(B===null&&(A=$),u.baseState=A,u.firstBaseUpdate=O,u.lastBaseUpdate=B,e=u.shared.interleaved,e!==null){u=e;do v|=u.lane,u=u.next;while(u!==e)}else p===null&&(u.shared.lanes=0);Bh|=v,t.lanes=v,t.memoizedState=$}}function C3(t,e,i){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],u=s.callback;if(u!==null){if(s.callback=null,s=i,typeof u!="function")throw Error(Pt(191,u));u.call(s)}}}var O4=new Mz.Component().refs;function rS(t,e,i,s){e=t.memoizedState,i=i(s,e),i=i==null?e:Xr({},e,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var qx={isMounted:function(t){return(t=t._reactInternals)?Jh(t)===t:!1},enqueueSetState:function(t,e,i){t=t._reactInternals;var s=To(),u=au(t),p=jl(s,u);p.payload=e,i!=null&&(p.callback=i),e=ou(t,p,u),e!==null&&(ca(e,t,u,s),f1(e,t,u))},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var s=To(),u=au(t),p=jl(s,u);p.tag=1,p.payload=e,i!=null&&(p.callback=i),e=ou(t,p,u),e!==null&&(ca(e,t,u,s),f1(e,t,u))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=To(),s=au(t),u=jl(i,s);u.tag=2,e!=null&&(u.callback=e),e=ou(t,u,s),e!==null&&(ca(e,t,s,i),f1(e,t,s))}};function M3(t,e,i,s,u,p,v){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,p,v):e.prototype&&e.prototype.isPureReactComponent?!d_(i,s)||!d_(u,p):!0}function D4(t,e,i){var s=!1,u=gu,p=e.contextType;return typeof p=="object"&&p!==null?p=Ns(p):(u=Wo(e)?zh:fo.current,s=e.contextTypes,p=(s=s!=null)?qf(t,u):gu),e=new e(i,p),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=qx,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=u,t.__reactInternalMemoizedMaskedChildContext=p),e}function R3(t,e,i,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(i,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(i,s),e.state!==t&&qx.enqueueReplaceState(e,e.state,null)}function iS(t,e,i,s){var u=t.stateNode;u.props=i,u.state=t.memoizedState,u.refs=O4,vA(t);var p=e.contextType;typeof p=="object"&&p!==null?u.context=Ns(p):(p=Wo(e)?zh:fo.current,u.context=qf(t,p)),u.state=t.memoizedState,p=e.getDerivedStateFromProps,typeof p=="function"&&(rS(t,e,p,i),u.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(e=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),e!==u.state&&qx.enqueueReplaceState(u,u.state,null),H1(t,i,u,s),u.state=t.memoizedState),typeof u.componentDidMount=="function"&&(t.flags|=4194308)}function bg(t,e,i){if(t=i.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(Pt(309));var s=i.stateNode}if(!s)throw Error(Pt(147,t));var u=s,p=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===p?e.ref:(e=function(v){var a=u.refs;a===O4&&(a=u.refs={}),v===null?delete a[p]:a[p]=v},e._stringRef=p,e)}if(typeof t!="string")throw Error(Pt(284));if(!i._owner)throw Error(Pt(290,t))}return t}function Vv(t,e){throw t=Object.prototype.toString.call(e),Error(Pt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function O3(t){var e=t._init;return e(t._payload)}function L4(t){function e(ae,le){if(t){var fe=ae.deletions;fe===null?(ae.deletions=[le],ae.flags|=16):fe.push(le)}}function i(ae,le){if(!t)return null;for(;le!==null;)e(ae,le),le=le.sibling;return null}function s(ae,le){for(ae=new Map;le!==null;)le.key!==null?ae.set(le.key,le):ae.set(le.index,le),le=le.sibling;return ae}function u(ae,le){return ae=lu(ae,le),ae.index=0,ae.sibling=null,ae}function p(ae,le,fe){return ae.index=fe,t?(fe=ae.alternate,fe!==null?(fe=fe.index,fe<le?(ae.flags|=2,le):fe):(ae.flags|=2,le)):(ae.flags|=1048576,le)}function v(ae){return t&&ae.alternate===null&&(ae.flags|=2),ae}function a(ae,le,fe,Ce){return le===null||le.tag!==6?(le=WT(fe,ae.mode,Ce),le.return=ae,le):(le=u(le,fe),le.return=ae,le)}function A(ae,le,fe,Ce){var Ge=fe.type;return Ge===yf?B(ae,le,fe.props.children,Ce,fe.key):le!==null&&(le.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===Vc&&O3(Ge)===le.type)?(Ce=u(le,fe.props),Ce.ref=bg(ae,le,fe),Ce.return=ae,Ce):(Ce=v1(fe.type,fe.key,fe.props,null,ae.mode,Ce),Ce.ref=bg(ae,le,fe),Ce.return=ae,Ce)}function O(ae,le,fe,Ce){return le===null||le.tag!==4||le.stateNode.containerInfo!==fe.containerInfo||le.stateNode.implementation!==fe.implementation?(le=qT(fe,ae.mode,Ce),le.return=ae,le):(le=u(le,fe.children||[]),le.return=ae,le)}function B(ae,le,fe,Ce,Ge){return le===null||le.tag!==7?(le=Rh(fe,ae.mode,Ce,Ge),le.return=ae,le):(le=u(le,fe),le.return=ae,le)}function $(ae,le,fe){if(typeof le=="string"&&le!==""||typeof le=="number")return le=WT(""+le,ae.mode,fe),le.return=ae,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case Cv:return fe=v1(le.type,le.key,le.props,null,ae.mode,fe),fe.ref=bg(ae,null,le),fe.return=ae,fe;case _f:return le=qT(le,ae.mode,fe),le.return=ae,le;case Vc:var Ce=le._init;return $(ae,Ce(le._payload),fe)}if(Pg(le)||gg(le))return le=Rh(le,ae.mode,fe,null),le.return=ae,le;Vv(ae,le)}return null}function Y(ae,le,fe,Ce){var Ge=le!==null?le.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number")return Ge!==null?null:a(ae,le,""+fe,Ce);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case Cv:return fe.key===Ge?A(ae,le,fe,Ce):null;case _f:return fe.key===Ge?O(ae,le,fe,Ce):null;case Vc:return Ge=fe._init,Y(ae,le,Ge(fe._payload),Ce)}if(Pg(fe)||gg(fe))return Ge!==null?null:B(ae,le,fe,Ce,null);Vv(ae,fe)}return null}function se(ae,le,fe,Ce,Ge){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number")return ae=ae.get(fe)||null,a(le,ae,""+Ce,Ge);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case Cv:return ae=ae.get(Ce.key===null?fe:Ce.key)||null,A(le,ae,Ce,Ge);case _f:return ae=ae.get(Ce.key===null?fe:Ce.key)||null,O(le,ae,Ce,Ge);case Vc:var gt=Ce._init;return se(ae,le,fe,gt(Ce._payload),Ge)}if(Pg(Ce)||gg(Ce))return ae=ae.get(fe)||null,B(le,ae,Ce,Ge,null);Vv(le,Ce)}return null}function me(ae,le,fe,Ce){for(var Ge=null,gt=null,It=le,Tt=le=0,Oe=null;It!==null&&Tt<fe.length;Tt++){It.index>Tt?(Oe=It,It=null):Oe=It.sibling;var Yt=Y(ae,It,fe[Tt],Ce);if(Yt===null){It===null&&(It=Oe);break}t&&It&&Yt.alternate===null&&e(ae,It),le=p(Yt,le,Tt),gt===null?Ge=Yt:gt.sibling=Yt,gt=Yt,It=Oe}if(Tt===fe.length)return i(ae,It),Ur&&vh(ae,Tt),Ge;if(It===null){for(;Tt<fe.length;Tt++)It=$(ae,fe[Tt],Ce),It!==null&&(le=p(It,le,Tt),gt===null?Ge=It:gt.sibling=It,gt=It);return Ur&&vh(ae,Tt),Ge}for(It=s(ae,It);Tt<fe.length;Tt++)Oe=se(It,ae,Tt,fe[Tt],Ce),Oe!==null&&(t&&Oe.alternate!==null&&It.delete(Oe.key===null?Tt:Oe.key),le=p(Oe,le,Tt),gt===null?Ge=Oe:gt.sibling=Oe,gt=Oe);return t&&It.forEach(function(er){return e(ae,er)}),Ur&&vh(ae,Tt),Ge}function _e(ae,le,fe,Ce){var Ge=gg(fe);if(typeof Ge!="function")throw Error(Pt(150));if(fe=Ge.call(fe),fe==null)throw Error(Pt(151));for(var gt=Ge=null,It=le,Tt=le=0,Oe=null,Yt=fe.next();It!==null&&!Yt.done;Tt++,Yt=fe.next()){It.index>Tt?(Oe=It,It=null):Oe=It.sibling;var er=Y(ae,It,Yt.value,Ce);if(er===null){It===null&&(It=Oe);break}t&&It&&er.alternate===null&&e(ae,It),le=p(er,le,Tt),gt===null?Ge=er:gt.sibling=er,gt=er,It=Oe}if(Yt.done)return i(ae,It),Ur&&vh(ae,Tt),Ge;if(It===null){for(;!Yt.done;Tt++,Yt=fe.next())Yt=$(ae,Yt.value,Ce),Yt!==null&&(le=p(Yt,le,Tt),gt===null?Ge=Yt:gt.sibling=Yt,gt=Yt);return Ur&&vh(ae,Tt),Ge}for(It=s(ae,It);!Yt.done;Tt++,Yt=fe.next())Yt=se(It,ae,Tt,Yt.value,Ce),Yt!==null&&(t&&Yt.alternate!==null&&It.delete(Yt.key===null?Tt:Yt.key),le=p(Yt,le,Tt),gt===null?Ge=Yt:gt.sibling=Yt,gt=Yt);return t&&It.forEach(function(pt){return e(ae,pt)}),Ur&&vh(ae,Tt),Ge}function Ee(ae,le,fe,Ce){if(typeof fe=="object"&&fe!==null&&fe.type===yf&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case Cv:e:{for(var Ge=fe.key,gt=le;gt!==null;){if(gt.key===Ge){if(Ge=fe.type,Ge===yf){if(gt.tag===7){i(ae,gt.sibling),le=u(gt,fe.props.children),le.return=ae,ae=le;break e}}else if(gt.elementType===Ge||typeof Ge=="object"&&Ge!==null&&Ge.$$typeof===Vc&&O3(Ge)===gt.type){i(ae,gt.sibling),le=u(gt,fe.props),le.ref=bg(ae,gt,fe),le.return=ae,ae=le;break e}i(ae,gt);break}else e(ae,gt);gt=gt.sibling}fe.type===yf?(le=Rh(fe.props.children,ae.mode,Ce,fe.key),le.return=ae,ae=le):(Ce=v1(fe.type,fe.key,fe.props,null,ae.mode,Ce),Ce.ref=bg(ae,le,fe),Ce.return=ae,ae=Ce)}return v(ae);case _f:e:{for(gt=fe.key;le!==null;){if(le.key===gt)if(le.tag===4&&le.stateNode.containerInfo===fe.containerInfo&&le.stateNode.implementation===fe.implementation){i(ae,le.sibling),le=u(le,fe.children||[]),le.return=ae,ae=le;break e}else{i(ae,le);break}else e(ae,le);le=le.sibling}le=qT(fe,ae.mode,Ce),le.return=ae,ae=le}return v(ae);case Vc:return gt=fe._init,Ee(ae,le,gt(fe._payload),Ce)}if(Pg(fe))return me(ae,le,fe,Ce);if(gg(fe))return _e(ae,le,fe,Ce);Vv(ae,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"?(fe=""+fe,le!==null&&le.tag===6?(i(ae,le.sibling),le=u(le,fe),le.return=ae,ae=le):(i(ae,le),le=WT(fe,ae.mode,Ce),le.return=ae,ae=le),v(ae)):i(ae,le)}return Ee}var Zf=L4(!0),z4=L4(!1),ay={},Ha=wu(ay),g_=wu(ay),__=wu(ay);function Ih(t){if(t===ay)throw Error(Pt(174));return t}function xA(t,e){switch(Cr(__,e),Cr(g_,t),Cr(Ha,ay),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:zE(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=zE(e,t)}Br(Ha),Cr(Ha,e)}function Xf(){Br(Ha),Br(g_),Br(__)}function N4(t){Ih(__.current);var e=Ih(Ha.current),i=zE(e,t.type);e!==i&&(Cr(g_,t),Cr(Ha,i))}function bA(t){g_.current===t&&(Br(Ha),Br(g_))}var Hr=wu(0);function Z1(t){for(var e=t;e!==null;){if(e.tag===13){var i=e.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var BT=[];function wA(){for(var t=0;t<BT.length;t++)BT[t]._workInProgressVersionPrimary=null;BT.length=0}var p1=nc.ReactCurrentDispatcher,jT=nc.ReactCurrentBatchConfig,Fh=0,Zr=null,Ei=null,ki=null,X1=!1,qg=!1,y_=0,G9=0;function io(){throw Error(Pt(321))}function TA(t,e){if(e===null)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!ua(t[i],e[i]))return!1;return!0}function EA(t,e,i,s,u,p){if(Fh=p,Zr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,p1.current=t===null||t.memoizedState===null?Z9:X9,t=i(s,u),qg){p=0;do{if(qg=!1,y_=0,25<=p)throw Error(Pt(301));p+=1,ki=Ei=null,e.updateQueue=null,p1.current=Y9,t=i(s,u)}while(qg)}if(p1.current=Y1,e=Ei!==null&&Ei.next!==null,Fh=0,ki=Ei=Zr=null,X1=!1,e)throw Error(Pt(300));return t}function SA(){var t=y_!==0;return y_=0,t}function Ba(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ki===null?Zr.memoizedState=ki=t:ki=ki.next=t,ki}function Fs(){if(Ei===null){var t=Zr.alternate;t=t!==null?t.memoizedState:null}else t=Ei.next;var e=ki===null?Zr.memoizedState:ki.next;if(e!==null)ki=e,Ei=t;else{if(t===null)throw Error(Pt(310));Ei=t,t={memoizedState:Ei.memoizedState,baseState:Ei.baseState,baseQueue:Ei.baseQueue,queue:Ei.queue,next:null},ki===null?Zr.memoizedState=ki=t:ki=ki.next=t}return ki}function v_(t,e){return typeof e=="function"?e(t):e}function VT(t){var e=Fs(),i=e.queue;if(i===null)throw Error(Pt(311));i.lastRenderedReducer=t;var s=Ei,u=s.baseQueue,p=i.pending;if(p!==null){if(u!==null){var v=u.next;u.next=p.next,p.next=v}s.baseQueue=u=p,i.pending=null}if(u!==null){p=u.next,s=s.baseState;var a=v=null,A=null,O=p;do{var B=O.lane;if((Fh&B)===B)A!==null&&(A=A.next={lane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),s=O.hasEagerState?O.eagerState:t(s,O.action);else{var $={lane:B,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null};A===null?(a=A=$,v=s):A=A.next=$,Zr.lanes|=B,Bh|=B}O=O.next}while(O!==null&&O!==p);A===null?v=s:A.next=a,ua(s,e.memoizedState)||(Uo=!0),e.memoizedState=s,e.baseState=v,e.baseQueue=A,i.lastRenderedState=s}if(t=i.interleaved,t!==null){u=t;do p=u.lane,Zr.lanes|=p,Bh|=p,u=u.next;while(u!==t)}else u===null&&(i.lanes=0);return[e.memoizedState,i.dispatch]}function UT(t){var e=Fs(),i=e.queue;if(i===null)throw Error(Pt(311));i.lastRenderedReducer=t;var s=i.dispatch,u=i.pending,p=e.memoizedState;if(u!==null){i.pending=null;var v=u=u.next;do p=t(p,v.action),v=v.next;while(v!==u);ua(p,e.memoizedState)||(Uo=!0),e.memoizedState=p,e.baseQueue===null&&(e.baseState=p),i.lastRenderedState=p}return[p,s]}function F4(){}function B4(t,e){var i=Zr,s=Fs(),u=e(),p=!ua(s.memoizedState,u);if(p&&(s.memoizedState=u,Uo=!0),s=s.queue,IA(U4.bind(null,i,s,t),[t]),s.getSnapshot!==e||p||ki!==null&&ki.memoizedState.tag&1){if(i.flags|=2048,x_(9,V4.bind(null,i,s,u,e),void 0,null),Ci===null)throw Error(Pt(349));Fh&30||j4(i,e,u)}return u}function j4(t,e,i){t.flags|=16384,t={getSnapshot:e,value:i},e=Zr.updateQueue,e===null?(e={lastEffect:null,stores:null},Zr.updateQueue=e,e.stores=[t]):(i=e.stores,i===null?e.stores=[t]:i.push(t))}function V4(t,e,i,s){e.value=i,e.getSnapshot=s,$4(e)&&G4(t)}function U4(t,e,i){return i(function(){$4(e)&&G4(t)})}function $4(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!ua(t,i)}catch{return!0}}function G4(t){var e=ql(t,1);e!==null&&ca(e,t,1,-1)}function D3(t){var e=Ba();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:v_,lastRenderedState:t},e.queue=t,t=t.dispatch=H9.bind(null,Zr,t),[e.memoizedState,t]}function x_(t,e,i,s){return t={tag:t,create:e,destroy:i,deps:s,next:null},e=Zr.updateQueue,e===null?(e={lastEffect:null,stores:null},Zr.updateQueue=e,e.lastEffect=t.next=t):(i=e.lastEffect,i===null?e.lastEffect=t.next=t:(s=i.next,i.next=t,t.next=s,e.lastEffect=t)),t}function W4(){return Fs().memoizedState}function m1(t,e,i,s){var u=Ba();Zr.flags|=t,u.memoizedState=x_(1|e,i,void 0,s===void 0?null:s)}function Hx(t,e,i,s){var u=Fs();s=s===void 0?null:s;var p=void 0;if(Ei!==null){var v=Ei.memoizedState;if(p=v.destroy,s!==null&&TA(s,v.deps)){u.memoizedState=x_(e,i,p,s);return}}Zr.flags|=t,u.memoizedState=x_(1|e,i,p,s)}function L3(t,e){return m1(8390656,8,t,e)}function IA(t,e){return Hx(2048,8,t,e)}function q4(t,e){return Hx(4,2,t,e)}function H4(t,e){return Hx(4,4,t,e)}function Z4(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function X4(t,e,i){return i=i!=null?i.concat([t]):null,Hx(4,4,Z4.bind(null,e,t),i)}function AA(){}function Y4(t,e){var i=Fs();e=e===void 0?null:e;var s=i.memoizedState;return s!==null&&e!==null&&TA(e,s[1])?s[0]:(i.memoizedState=[t,e],t)}function K4(t,e){var i=Fs();e=e===void 0?null:e;var s=i.memoizedState;return s!==null&&e!==null&&TA(e,s[1])?s[0]:(t=t(),i.memoizedState=[t,e],t)}function J4(t,e,i){return Fh&21?(ua(i,e)||(i=t4(),Zr.lanes|=i,Bh|=i,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Uo=!0),t.memoizedState=i)}function W9(t,e){var i=yr;yr=i!==0&&4>i?i:4,t(!0);var s=jT.transition;jT.transition={};try{t(!1),e()}finally{yr=i,jT.transition=s}}function Q4(){return Fs().memoizedState}function q9(t,e,i){var s=au(t);if(i={lane:s,action:i,hasEagerState:!1,eagerState:null,next:null},eN(t))tN(e,i);else if(i=M4(t,e,i,s),i!==null){var u=To();ca(i,t,s,u),nN(i,e,s)}}function H9(t,e,i){var s=au(t),u={lane:s,action:i,hasEagerState:!1,eagerState:null,next:null};if(eN(t))tN(e,u);else{var p=t.alternate;if(t.lanes===0&&(p===null||p.lanes===0)&&(p=e.lastRenderedReducer,p!==null))try{var v=e.lastRenderedState,a=p(v,i);if(u.hasEagerState=!0,u.eagerState=a,ua(a,v)){var A=e.interleaved;A===null?(u.next=u,yA(e)):(u.next=A.next,A.next=u),e.interleaved=u;return}}catch{}finally{}i=M4(t,e,u,s),i!==null&&(u=To(),ca(i,t,s,u),nN(i,e,s))}}function eN(t){var e=t.alternate;return t===Zr||e!==null&&e===Zr}function tN(t,e){qg=X1=!0;var i=t.pending;i===null?e.next=e:(e.next=i.next,i.next=e),t.pending=e}function nN(t,e,i){if(i&4194240){var s=e.lanes;s&=t.pendingLanes,i|=s,e.lanes=i,iA(t,i)}}var Y1={readContext:Ns,useCallback:io,useContext:io,useEffect:io,useImperativeHandle:io,useInsertionEffect:io,useLayoutEffect:io,useMemo:io,useReducer:io,useRef:io,useState:io,useDebugValue:io,useDeferredValue:io,useTransition:io,useMutableSource:io,useSyncExternalStore:io,useId:io,unstable_isNewReconciler:!1},Z9={readContext:Ns,useCallback:function(t,e){return Ba().memoizedState=[t,e===void 0?null:e],t},useContext:Ns,useEffect:L3,useImperativeHandle:function(t,e,i){return i=i!=null?i.concat([t]):null,m1(4194308,4,Z4.bind(null,e,t),i)},useLayoutEffect:function(t,e){return m1(4194308,4,t,e)},useInsertionEffect:function(t,e){return m1(4,2,t,e)},useMemo:function(t,e){var i=Ba();return e=e===void 0?null:e,t=t(),i.memoizedState=[t,e],t},useReducer:function(t,e,i){var s=Ba();return e=i!==void 0?i(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=q9.bind(null,Zr,t),[s.memoizedState,t]},useRef:function(t){var e=Ba();return t={current:t},e.memoizedState=t},useState:D3,useDebugValue:AA,useDeferredValue:function(t){return Ba().memoizedState=t},useTransition:function(){var t=D3(!1),e=t[0];return t=W9.bind(null,t[1]),Ba().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,i){var s=Zr,u=Ba();if(Ur){if(i===void 0)throw Error(Pt(407));i=i()}else{if(i=e(),Ci===null)throw Error(Pt(349));Fh&30||j4(s,e,i)}u.memoizedState=i;var p={value:i,getSnapshot:e};return u.queue=p,L3(U4.bind(null,s,p,t),[t]),s.flags|=2048,x_(9,V4.bind(null,s,p,i,e),void 0,null),i},useId:function(){var t=Ba(),e=Ci.identifierPrefix;if(Ur){var i=Ll,s=Dl;i=(s&~(1<<32-la(s)-1)).toString(32)+i,e=":"+e+"R"+i,i=y_++,0<i&&(e+="H"+i.toString(32)),e+=":"}else i=G9++,e=":"+e+"r"+i.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},X9={readContext:Ns,useCallback:Y4,useContext:Ns,useEffect:IA,useImperativeHandle:X4,useInsertionEffect:q4,useLayoutEffect:H4,useMemo:K4,useReducer:VT,useRef:W4,useState:function(){return VT(v_)},useDebugValue:AA,useDeferredValue:function(t){var e=Fs();return J4(e,Ei.memoizedState,t)},useTransition:function(){var t=VT(v_)[0],e=Fs().memoizedState;return[t,e]},useMutableSource:F4,useSyncExternalStore:B4,useId:Q4,unstable_isNewReconciler:!1},Y9={readContext:Ns,useCallback:Y4,useContext:Ns,useEffect:IA,useImperativeHandle:X4,useInsertionEffect:q4,useLayoutEffect:H4,useMemo:K4,useReducer:UT,useRef:W4,useState:function(){return UT(v_)},useDebugValue:AA,useDeferredValue:function(t){var e=Fs();return Ei===null?e.memoizedState=t:J4(e,Ei.memoizedState,t)},useTransition:function(){var t=UT(v_)[0],e=Fs().memoizedState;return[t,e]},useMutableSource:F4,useSyncExternalStore:B4,useId:Q4,unstable_isNewReconciler:!1};function Yf(t,e){try{var i="",s=e;do i+=E$(s),s=s.return;while(s);var u=i}catch(p){u=`
Error generating stack: `+p.message+`
`+p.stack}return{value:t,source:e,stack:u,digest:null}}function $T(t,e,i){return{value:t,source:null,stack:i??null,digest:e??null}}function oS(t,e){try{console.error(e.value)}catch(i){setTimeout(function(){throw i})}}var K9=typeof WeakMap=="function"?WeakMap:Map;function rN(t,e,i){i=jl(-1,i),i.tag=3,i.payload={element:null};var s=e.value;return i.callback=function(){J1||(J1=!0,mS=s),oS(t,e)},i}function iN(t,e,i){i=jl(-1,i),i.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var u=e.value;i.payload=function(){return s(u)},i.callback=function(){oS(t,e)}}var p=t.stateNode;return p!==null&&typeof p.componentDidCatch=="function"&&(i.callback=function(){oS(t,e),typeof s!="function"&&(su===null?su=new Set([this]):su.add(this));var v=e.stack;this.componentDidCatch(e.value,{componentStack:v!==null?v:""})}),i}function z3(t,e,i){var s=t.pingCache;if(s===null){s=t.pingCache=new K9;var u=new Set;s.set(e,u)}else u=s.get(e),u===void 0&&(u=new Set,s.set(e,u));u.has(i)||(u.add(i),t=h7.bind(null,t,e,i),e.then(t,t))}function N3(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function F3(t,e,i,s,u){return t.mode&1?(t.flags|=65536,t.lanes=u,t):(t===e?t.flags|=65536:(t.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(e=jl(-1,1),e.tag=2,ou(i,e,1))),i.lanes|=1),t)}var J9=nc.ReactCurrentOwner,Uo=!1;function xo(t,e,i,s){e.child=t===null?z4(e,null,i,s):Zf(e,t.child,i,s)}function B3(t,e,i,s,u){i=i.render;var p=e.ref;return Nf(e,u),s=EA(t,e,i,s,p,u),i=SA(),t!==null&&!Uo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~u,Hl(t,e,u)):(Ur&&i&&dA(e),e.flags|=1,xo(t,e,s,u),e.child)}function j3(t,e,i,s,u){if(t===null){var p=i.type;return typeof p=="function"&&!LA(p)&&p.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(e.tag=15,e.type=p,oN(t,e,p,s,u)):(t=v1(i.type,null,s,e,e.mode,u),t.ref=e.ref,t.return=e,e.child=t)}if(p=t.child,!(t.lanes&u)){var v=p.memoizedProps;if(i=i.compare,i=i!==null?i:d_,i(v,s)&&t.ref===e.ref)return Hl(t,e,u)}return e.flags|=1,t=lu(p,s),t.ref=e.ref,t.return=e,e.child=t}function oN(t,e,i,s,u){if(t!==null){var p=t.memoizedProps;if(d_(p,s)&&t.ref===e.ref)if(Uo=!1,e.pendingProps=s=p,(t.lanes&u)!==0)t.flags&131072&&(Uo=!0);else return e.lanes=t.lanes,Hl(t,e,u)}return sS(t,e,i,s,u)}function sN(t,e,i){var s=e.pendingProps,u=s.children,p=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cr(Pf,cs),cs|=i;else{if(!(i&1073741824))return t=p!==null?p.baseLanes|i:i,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Cr(Pf,cs),cs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=p!==null?p.baseLanes:i,Cr(Pf,cs),cs|=s}else p!==null?(s=p.baseLanes|i,e.memoizedState=null):s=i,Cr(Pf,cs),cs|=s;return xo(t,e,u,i),e.child}function aN(t,e){var i=e.ref;(t===null&&i!==null||t!==null&&t.ref!==i)&&(e.flags|=512,e.flags|=2097152)}function sS(t,e,i,s,u){var p=Wo(i)?zh:fo.current;return p=qf(e,p),Nf(e,u),i=EA(t,e,i,s,p,u),s=SA(),t!==null&&!Uo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~u,Hl(t,e,u)):(Ur&&s&&dA(e),e.flags|=1,xo(t,e,i,u),e.child)}function V3(t,e,i,s,u){if(Wo(i)){var p=!0;U1(e)}else p=!1;if(Nf(e,u),e.stateNode===null)g1(t,e),D4(e,i,s),iS(e,i,s,u),s=!0;else if(t===null){var v=e.stateNode,a=e.memoizedProps;v.props=a;var A=v.context,O=i.contextType;typeof O=="object"&&O!==null?O=Ns(O):(O=Wo(i)?zh:fo.current,O=qf(e,O));var B=i.getDerivedStateFromProps,$=typeof B=="function"||typeof v.getSnapshotBeforeUpdate=="function";$||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(a!==s||A!==O)&&R3(e,v,s,O),Uc=!1;var Y=e.memoizedState;v.state=Y,H1(e,s,v,u),A=e.memoizedState,a!==s||Y!==A||Go.current||Uc?(typeof B=="function"&&(rS(e,i,B,s),A=e.memoizedState),(a=Uc||M3(e,i,a,s,Y,A,O))?($||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(e.flags|=4194308)):(typeof v.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=A),v.props=s,v.state=A,v.context=O,s=a):(typeof v.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{v=e.stateNode,R4(t,e),a=e.memoizedProps,O=e.type===e.elementType?a:ia(e.type,a),v.props=O,$=e.pendingProps,Y=v.context,A=i.contextType,typeof A=="object"&&A!==null?A=Ns(A):(A=Wo(i)?zh:fo.current,A=qf(e,A));var se=i.getDerivedStateFromProps;(B=typeof se=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(a!==$||Y!==A)&&R3(e,v,s,A),Uc=!1,Y=e.memoizedState,v.state=Y,H1(e,s,v,u);var me=e.memoizedState;a!==$||Y!==me||Go.current||Uc?(typeof se=="function"&&(rS(e,i,se,s),me=e.memoizedState),(O=Uc||M3(e,i,O,s,Y,me,A)||!1)?(B||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(s,me,A),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(s,me,A)),typeof v.componentDidUpdate=="function"&&(e.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof v.componentDidUpdate!="function"||a===t.memoizedProps&&Y===t.memoizedState||(e.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&Y===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=me),v.props=s,v.state=me,v.context=A,s=O):(typeof v.componentDidUpdate!="function"||a===t.memoizedProps&&Y===t.memoizedState||(e.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&Y===t.memoizedState||(e.flags|=1024),s=!1)}return aS(t,e,i,s,p,u)}function aS(t,e,i,s,u,p){aN(t,e);var v=(e.flags&128)!==0;if(!s&&!v)return u&&I3(e,i,!1),Hl(t,e,p);s=e.stateNode,J9.current=e;var a=v&&typeof i.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&v?(e.child=Zf(e,t.child,null,p),e.child=Zf(e,null,a,p)):xo(t,e,a,p),e.memoizedState=s.state,u&&I3(e,i,!0),e.child}function lN(t){var e=t.stateNode;e.pendingContext?S3(t,e.pendingContext,e.pendingContext!==e.context):e.context&&S3(t,e.context,!1),xA(t,e.containerInfo)}function U3(t,e,i,s,u){return Hf(),pA(u),e.flags|=256,xo(t,e,i,s),e.child}var lS={dehydrated:null,treeContext:null,retryLane:0};function cS(t){return{baseLanes:t,cachePool:null,transitions:null}}function cN(t,e,i){var s=e.pendingProps,u=Hr.current,p=!1,v=(e.flags&128)!==0,a;if((a=v)||(a=t!==null&&t.memoizedState===null?!1:(u&2)!==0),a?(p=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(u|=1),Cr(Hr,u&1),t===null)return tS(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(v=s.children,t=s.fallback,p?(s=e.mode,p=e.child,v={mode:"hidden",children:v},!(s&1)&&p!==null?(p.childLanes=0,p.pendingProps=v):p=Yx(v,s,0,null),t=Rh(t,s,i,null),p.return=e,t.return=e,p.sibling=t,e.child=p,e.child.memoizedState=cS(i),e.memoizedState=lS,t):PA(e,v));if(u=t.memoizedState,u!==null&&(a=u.dehydrated,a!==null))return Q9(t,e,v,s,a,u,i);if(p){p=s.fallback,v=e.mode,u=t.child,a=u.sibling;var A={mode:"hidden",children:s.children};return!(v&1)&&e.child!==u?(s=e.child,s.childLanes=0,s.pendingProps=A,e.deletions=null):(s=lu(u,A),s.subtreeFlags=u.subtreeFlags&14680064),a!==null?p=lu(a,p):(p=Rh(p,v,i,null),p.flags|=2),p.return=e,s.return=e,s.sibling=p,e.child=s,s=p,p=e.child,v=t.child.memoizedState,v=v===null?cS(i):{baseLanes:v.baseLanes|i,cachePool:null,transitions:v.transitions},p.memoizedState=v,p.childLanes=t.childLanes&~i,e.memoizedState=lS,s}return p=t.child,t=p.sibling,s=lu(p,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=i),s.return=e,s.sibling=null,t!==null&&(i=e.deletions,i===null?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=s,e.memoizedState=null,s}function PA(t,e){return e=Yx({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Uv(t,e,i,s){return s!==null&&pA(s),Zf(e,t.child,null,i),t=PA(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Q9(t,e,i,s,u,p,v){if(i)return e.flags&256?(e.flags&=-257,s=$T(Error(Pt(422))),Uv(t,e,v,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(p=s.fallback,u=e.mode,s=Yx({mode:"visible",children:s.children},u,0,null),p=Rh(p,u,v,null),p.flags|=2,s.return=e,p.return=e,s.sibling=p,e.child=s,e.mode&1&&Zf(e,t.child,null,v),e.child.memoizedState=cS(v),e.memoizedState=lS,p);if(!(e.mode&1))return Uv(t,e,v,null);if(u.data==="$!"){if(s=u.nextSibling&&u.nextSibling.dataset,s)var a=s.dgst;return s=a,p=Error(Pt(419)),s=$T(p,s,void 0),Uv(t,e,v,s)}if(a=(v&t.childLanes)!==0,Uo||a){if(s=Ci,s!==null){switch(v&-v){case 4:u=2;break;case 16:u=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:u=32;break;case 536870912:u=268435456;break;default:u=0}u=u&(s.suspendedLanes|v)?0:u,u!==0&&u!==p.retryLane&&(p.retryLane=u,ql(t,u),ca(s,t,u,-1))}return DA(),s=$T(Error(Pt(421))),Uv(t,e,v,s)}return u.data==="$?"?(e.flags|=128,e.child=t.child,e=d7.bind(null,t),u._reactRetry=e,null):(t=p.treeContext,us=iu(u.nextSibling),hs=e,Ur=!0,sa=null,t!==null&&(Cs[Ms++]=Dl,Cs[Ms++]=Ll,Cs[Ms++]=Nh,Dl=t.id,Ll=t.overflow,Nh=e),e=PA(e,s.children),e.flags|=4096,e)}function $3(t,e,i){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),nS(t.return,e,i)}function GT(t,e,i,s,u){var p=t.memoizedState;p===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:i,tailMode:u}:(p.isBackwards=e,p.rendering=null,p.renderingStartTime=0,p.last=s,p.tail=i,p.tailMode=u)}function uN(t,e,i){var s=e.pendingProps,u=s.revealOrder,p=s.tail;if(xo(t,e,s.children,i),s=Hr.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&$3(t,i,e);else if(t.tag===19)$3(t,i,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(Cr(Hr,s),!(e.mode&1))e.memoizedState=null;else switch(u){case"forwards":for(i=e.child,u=null;i!==null;)t=i.alternate,t!==null&&Z1(t)===null&&(u=i),i=i.sibling;i=u,i===null?(u=e.child,e.child=null):(u=i.sibling,i.sibling=null),GT(e,!1,u,i,p);break;case"backwards":for(i=null,u=e.child,e.child=null;u!==null;){if(t=u.alternate,t!==null&&Z1(t)===null){e.child=u;break}t=u.sibling,u.sibling=i,i=u,u=t}GT(e,!0,i,null,p);break;case"together":GT(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function g1(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Hl(t,e,i){if(t!==null&&(e.dependencies=t.dependencies),Bh|=e.lanes,!(i&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Pt(153));if(e.child!==null){for(t=e.child,i=lu(t,t.pendingProps),e.child=i,i.return=e;t.sibling!==null;)t=t.sibling,i=i.sibling=lu(t,t.pendingProps),i.return=e;i.sibling=null}return e.child}function e7(t,e,i){switch(e.tag){case 3:lN(e),Hf();break;case 5:N4(e);break;case 1:Wo(e.type)&&U1(e);break;case 4:xA(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,u=e.memoizedProps.value;Cr(W1,s._currentValue),s._currentValue=u;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(Cr(Hr,Hr.current&1),e.flags|=128,null):i&e.child.childLanes?cN(t,e,i):(Cr(Hr,Hr.current&1),t=Hl(t,e,i),t!==null?t.sibling:null);Cr(Hr,Hr.current&1);break;case 19:if(s=(i&e.childLanes)!==0,t.flags&128){if(s)return uN(t,e,i);e.flags|=128}if(u=e.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),Cr(Hr,Hr.current),s)break;return null;case 22:case 23:return e.lanes=0,sN(t,e,i)}return Hl(t,e,i)}var hN,uS,dN,fN;hN=function(t,e){for(var i=e.child;i!==null;){if(i.tag===5||i.tag===6)t.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};uS=function(){};dN=function(t,e,i,s){var u=t.memoizedProps;if(u!==s){t=e.stateNode,Ih(Ha.current);var p=null;switch(i){case"input":u=RE(t,u),s=RE(t,s),p=[];break;case"select":u=Xr({},u,{value:void 0}),s=Xr({},s,{value:void 0}),p=[];break;case"textarea":u=LE(t,u),s=LE(t,s),p=[];break;default:typeof u.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=j1)}NE(i,s);var v;i=null;for(O in u)if(!s.hasOwnProperty(O)&&u.hasOwnProperty(O)&&u[O]!=null)if(O==="style"){var a=u[O];for(v in a)a.hasOwnProperty(v)&&(i||(i={}),i[v]="")}else O!=="dangerouslySetInnerHTML"&&O!=="children"&&O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(o_.hasOwnProperty(O)?p||(p=[]):(p=p||[]).push(O,null));for(O in s){var A=s[O];if(a=u!=null?u[O]:void 0,s.hasOwnProperty(O)&&A!==a&&(A!=null||a!=null))if(O==="style")if(a){for(v in a)!a.hasOwnProperty(v)||A&&A.hasOwnProperty(v)||(i||(i={}),i[v]="");for(v in A)A.hasOwnProperty(v)&&a[v]!==A[v]&&(i||(i={}),i[v]=A[v])}else i||(p||(p=[]),p.push(O,i)),i=A;else O==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,a=a?a.__html:void 0,A!=null&&a!==A&&(p=p||[]).push(O,A)):O==="children"?typeof A!="string"&&typeof A!="number"||(p=p||[]).push(O,""+A):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&(o_.hasOwnProperty(O)?(A!=null&&O==="onScroll"&&zr("scroll",t),p||a===A||(p=[])):(p=p||[]).push(O,A))}i&&(p=p||[]).push("style",i);var O=p;(e.updateQueue=O)&&(e.flags|=4)}};fN=function(t,e,i,s){i!==s&&(e.flags|=4)};function wg(t,e){if(!Ur)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;e!==null;)e.alternate!==null&&(i=e),e=e.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var s=null;i!==null;)i.alternate!==null&&(s=i),i=i.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function oo(t){var e=t.alternate!==null&&t.alternate.child===t.child,i=0,s=0;if(e)for(var u=t.child;u!==null;)i|=u.lanes|u.childLanes,s|=u.subtreeFlags&14680064,s|=u.flags&14680064,u.return=t,u=u.sibling;else for(u=t.child;u!==null;)i|=u.lanes|u.childLanes,s|=u.subtreeFlags,s|=u.flags,u.return=t,u=u.sibling;return t.subtreeFlags|=s,t.childLanes=i,e}function t7(t,e,i){var s=e.pendingProps;switch(fA(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return oo(e),null;case 1:return Wo(e.type)&&V1(),oo(e),null;case 3:return s=e.stateNode,Xf(),Br(Go),Br(fo),wA(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(jv(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,sa!==null&&(yS(sa),sa=null))),uS(t,e),oo(e),null;case 5:bA(e);var u=Ih(__.current);if(i=e.type,t!==null&&e.stateNode!=null)dN(t,e,i,s,u),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(Pt(166));return oo(e),null}if(t=Ih(Ha.current),jv(e)){s=e.stateNode,i=e.type;var p=e.memoizedProps;switch(s[ja]=e,s[m_]=p,t=(e.mode&1)!==0,i){case"dialog":zr("cancel",s),zr("close",s);break;case"iframe":case"object":case"embed":zr("load",s);break;case"video":case"audio":for(u=0;u<Cg.length;u++)zr(Cg[u],s);break;case"source":zr("error",s);break;case"img":case"image":case"link":zr("error",s),zr("load",s);break;case"details":zr("toggle",s);break;case"input":JO(s,p),zr("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!p.multiple},zr("invalid",s);break;case"textarea":e3(s,p),zr("invalid",s)}NE(i,p),u=null;for(var v in p)if(p.hasOwnProperty(v)){var a=p[v];v==="children"?typeof a=="string"?s.textContent!==a&&(p.suppressHydrationWarning!==!0&&Bv(s.textContent,a,t),u=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(p.suppressHydrationWarning!==!0&&Bv(s.textContent,a,t),u=["children",""+a]):o_.hasOwnProperty(v)&&a!=null&&v==="onScroll"&&zr("scroll",s)}switch(i){case"input":Mv(s),QO(s,p,!0);break;case"textarea":Mv(s),t3(s);break;case"select":case"option":break;default:typeof p.onClick=="function"&&(s.onclick=j1)}s=u,e.updateQueue=s,s!==null&&(e.flags|=4)}else{v=u.nodeType===9?u:u.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=jz(i)),t==="http://www.w3.org/1999/xhtml"?i==="script"?(t=v.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=v.createElement(i,{is:s.is}):(t=v.createElement(i),i==="select"&&(v=t,s.multiple?v.multiple=!0:s.size&&(v.size=s.size))):t=v.createElementNS(t,i),t[ja]=e,t[m_]=s,hN(t,e,!1,!1),e.stateNode=t;e:{switch(v=FE(i,s),i){case"dialog":zr("cancel",t),zr("close",t),u=s;break;case"iframe":case"object":case"embed":zr("load",t),u=s;break;case"video":case"audio":for(u=0;u<Cg.length;u++)zr(Cg[u],t);u=s;break;case"source":zr("error",t),u=s;break;case"img":case"image":case"link":zr("error",t),zr("load",t),u=s;break;case"details":zr("toggle",t),u=s;break;case"input":JO(t,s),u=RE(t,s),zr("invalid",t);break;case"option":u=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},u=Xr({},s,{value:void 0}),zr("invalid",t);break;case"textarea":e3(t,s),u=LE(t,s),zr("invalid",t);break;default:u=s}NE(i,u),a=u;for(p in a)if(a.hasOwnProperty(p)){var A=a[p];p==="style"?$z(t,A):p==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,A!=null&&Vz(t,A)):p==="children"?typeof A=="string"?(i!=="textarea"||A!=="")&&s_(t,A):typeof A=="number"&&s_(t,""+A):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&(o_.hasOwnProperty(p)?A!=null&&p==="onScroll"&&zr("scroll",t):A!=null&&JI(t,p,A,v))}switch(i){case"input":Mv(t),QO(t,s,!1);break;case"textarea":Mv(t),t3(t);break;case"option":s.value!=null&&t.setAttribute("value",""+mu(s.value));break;case"select":t.multiple=!!s.multiple,p=s.value,p!=null?Of(t,!!s.multiple,p,!1):s.defaultValue!=null&&Of(t,!!s.multiple,s.defaultValue,!0);break;default:typeof u.onClick=="function"&&(t.onclick=j1)}switch(i){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return oo(e),null;case 6:if(t&&e.stateNode!=null)fN(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(Pt(166));if(i=Ih(__.current),Ih(Ha.current),jv(e)){if(s=e.stateNode,i=e.memoizedProps,s[ja]=e,(p=s.nodeValue!==i)&&(t=hs,t!==null))switch(t.tag){case 3:Bv(s.nodeValue,i,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Bv(s.nodeValue,i,(t.mode&1)!==0)}p&&(e.flags|=4)}else s=(i.nodeType===9?i:i.ownerDocument).createTextNode(s),s[ja]=e,e.stateNode=s}return oo(e),null;case 13:if(Br(Hr),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ur&&us!==null&&e.mode&1&&!(e.flags&128))C4(),Hf(),e.flags|=98560,p=!1;else if(p=jv(e),s!==null&&s.dehydrated!==null){if(t===null){if(!p)throw Error(Pt(318));if(p=e.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(Pt(317));p[ja]=e}else Hf(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;oo(e),p=!1}else sa!==null&&(yS(sa),sa=null),p=!0;if(!p)return e.flags&65536?e:null}return e.flags&128?(e.lanes=i,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||Hr.current&1?Si===0&&(Si=3):DA())),e.updateQueue!==null&&(e.flags|=4),oo(e),null);case 4:return Xf(),uS(t,e),t===null&&f_(e.stateNode.containerInfo),oo(e),null;case 10:return _A(e.type._context),oo(e),null;case 17:return Wo(e.type)&&V1(),oo(e),null;case 19:if(Br(Hr),p=e.memoizedState,p===null)return oo(e),null;if(s=(e.flags&128)!==0,v=p.rendering,v===null)if(s)wg(p,!1);else{if(Si!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(v=Z1(t),v!==null){for(e.flags|=128,wg(p,!1),s=v.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=i,i=e.child;i!==null;)p=i,t=s,p.flags&=14680066,v=p.alternate,v===null?(p.childLanes=0,p.lanes=t,p.child=null,p.subtreeFlags=0,p.memoizedProps=null,p.memoizedState=null,p.updateQueue=null,p.dependencies=null,p.stateNode=null):(p.childLanes=v.childLanes,p.lanes=v.lanes,p.child=v.child,p.subtreeFlags=0,p.deletions=null,p.memoizedProps=v.memoizedProps,p.memoizedState=v.memoizedState,p.updateQueue=v.updateQueue,p.type=v.type,t=v.dependencies,p.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),i=i.sibling;return Cr(Hr,Hr.current&1|2),e.child}t=t.sibling}p.tail!==null&&ii()>Kf&&(e.flags|=128,s=!0,wg(p,!1),e.lanes=4194304)}else{if(!s)if(t=Z1(v),t!==null){if(e.flags|=128,s=!0,i=t.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),wg(p,!0),p.tail===null&&p.tailMode==="hidden"&&!v.alternate&&!Ur)return oo(e),null}else 2*ii()-p.renderingStartTime>Kf&&i!==1073741824&&(e.flags|=128,s=!0,wg(p,!1),e.lanes=4194304);p.isBackwards?(v.sibling=e.child,e.child=v):(i=p.last,i!==null?i.sibling=v:e.child=v,p.last=v)}return p.tail!==null?(e=p.tail,p.rendering=e,p.tail=e.sibling,p.renderingStartTime=ii(),e.sibling=null,i=Hr.current,Cr(Hr,s?i&1|2:i&1),e):(oo(e),null);case 22:case 23:return OA(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?cs&1073741824&&(oo(e),e.subtreeFlags&6&&(e.flags|=8192)):oo(e),null;case 24:return null;case 25:return null}throw Error(Pt(156,e.tag))}function n7(t,e){switch(fA(e),e.tag){case 1:return Wo(e.type)&&V1(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Xf(),Br(Go),Br(fo),wA(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return bA(e),null;case 13:if(Br(Hr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Pt(340));Hf()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Br(Hr),null;case 4:return Xf(),null;case 10:return _A(e.type._context),null;case 22:case 23:return OA(),null;case 24:return null;default:return null}}var $v=!1,lo=!1,r7=typeof WeakSet=="function"?WeakSet:Set,qt=null;function Af(t,e){var i=t.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(s){Kr(t,e,s)}else i.current=null}function hS(t,e,i){try{i()}catch(s){Kr(t,e,s)}}var G3=!1;function i7(t,e){if(ZE=N1,t=_4(),hA(t)){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else e:{i=(i=t.ownerDocument)&&i.defaultView||window;var s=i.getSelection&&i.getSelection();if(s&&s.rangeCount!==0){i=s.anchorNode;var u=s.anchorOffset,p=s.focusNode;s=s.focusOffset;try{i.nodeType,p.nodeType}catch{i=null;break e}var v=0,a=-1,A=-1,O=0,B=0,$=t,Y=null;t:for(;;){for(var se;$!==i||u!==0&&$.nodeType!==3||(a=v+u),$!==p||s!==0&&$.nodeType!==3||(A=v+s),$.nodeType===3&&(v+=$.nodeValue.length),(se=$.firstChild)!==null;)Y=$,$=se;for(;;){if($===t)break t;if(Y===i&&++O===u&&(a=v),Y===p&&++B===s&&(A=v),(se=$.nextSibling)!==null)break;$=Y,Y=$.parentNode}$=se}i=a===-1||A===-1?null:{start:a,end:A}}else i=null}i=i||{start:0,end:0}}else i=null;for(XE={focusedElem:t,selectionRange:i},N1=!1,qt=e;qt!==null;)if(e=qt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,qt=t;else for(;qt!==null;){e=qt;try{var me=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(me!==null){var _e=me.memoizedProps,Ee=me.memoizedState,ae=e.stateNode,le=ae.getSnapshotBeforeUpdate(e.elementType===e.type?_e:ia(e.type,_e),Ee);ae.__reactInternalSnapshotBeforeUpdate=le}break;case 3:var fe=e.stateNode.containerInfo;fe.nodeType===1?fe.textContent="":fe.nodeType===9&&fe.documentElement&&fe.removeChild(fe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Pt(163))}}catch(Ce){Kr(e,e.return,Ce)}if(t=e.sibling,t!==null){t.return=e.return,qt=t;break}qt=e.return}return me=G3,G3=!1,me}function Hg(t,e,i){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var u=s=s.next;do{if((u.tag&t)===t){var p=u.destroy;u.destroy=void 0,p!==void 0&&hS(e,i,p)}u=u.next}while(u!==s)}}function Zx(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var i=e=e.next;do{if((i.tag&t)===t){var s=i.create;i.destroy=s()}i=i.next}while(i!==e)}}function dS(t){var e=t.ref;if(e!==null){var i=t.stateNode;switch(t.tag){case 5:t=i;break;default:t=i}typeof e=="function"?e(t):e.current=t}}function pN(t){var e=t.alternate;e!==null&&(t.alternate=null,pN(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ja],delete e[m_],delete e[JE],delete e[j9],delete e[V9])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function mN(t){return t.tag===5||t.tag===3||t.tag===4}function W3(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||mN(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function fS(t,e,i){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?i.nodeType===8?i.parentNode.insertBefore(t,e):i.insertBefore(t,e):(i.nodeType===8?(e=i.parentNode,e.insertBefore(t,i)):(e=i,e.appendChild(t)),i=i._reactRootContainer,i!=null||e.onclick!==null||(e.onclick=j1));else if(s!==4&&(t=t.child,t!==null))for(fS(t,e,i),t=t.sibling;t!==null;)fS(t,e,i),t=t.sibling}function pS(t,e,i){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?i.insertBefore(t,e):i.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(pS(t,e,i),t=t.sibling;t!==null;)pS(t,e,i),t=t.sibling}var $i=null,oa=!1;function Bc(t,e,i){for(i=i.child;i!==null;)gN(t,e,i),i=i.sibling}function gN(t,e,i){if(qa&&typeof qa.onCommitFiberUnmount=="function")try{qa.onCommitFiberUnmount(jx,i)}catch{}switch(i.tag){case 5:lo||Af(i,e);case 6:var s=$i,u=oa;$i=null,Bc(t,e,i),$i=s,oa=u,$i!==null&&(oa?(t=$i,i=i.stateNode,t.nodeType===8?t.parentNode.removeChild(i):t.removeChild(i)):$i.removeChild(i.stateNode));break;case 18:$i!==null&&(oa?(t=$i,i=i.stateNode,t.nodeType===8?NT(t.parentNode,i):t.nodeType===1&&NT(t,i),u_(t)):NT($i,i.stateNode));break;case 4:s=$i,u=oa,$i=i.stateNode.containerInfo,oa=!0,Bc(t,e,i),$i=s,oa=u;break;case 0:case 11:case 14:case 15:if(!lo&&(s=i.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){u=s=s.next;do{var p=u,v=p.destroy;p=p.tag,v!==void 0&&(p&2||p&4)&&hS(i,e,v),u=u.next}while(u!==s)}Bc(t,e,i);break;case 1:if(!lo&&(Af(i,e),s=i.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=i.memoizedProps,s.state=i.memoizedState,s.componentWillUnmount()}catch(a){Kr(i,e,a)}Bc(t,e,i);break;case 21:Bc(t,e,i);break;case 22:i.mode&1?(lo=(s=lo)||i.memoizedState!==null,Bc(t,e,i),lo=s):Bc(t,e,i);break;default:Bc(t,e,i)}}function q3(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var i=t.stateNode;i===null&&(i=t.stateNode=new r7),e.forEach(function(s){var u=f7.bind(null,t,s);i.has(s)||(i.add(s),s.then(u,u))})}}function na(t,e){var i=e.deletions;if(i!==null)for(var s=0;s<i.length;s++){var u=i[s];try{var p=t,v=e,a=v;e:for(;a!==null;){switch(a.tag){case 5:$i=a.stateNode,oa=!1;break e;case 3:$i=a.stateNode.containerInfo,oa=!0;break e;case 4:$i=a.stateNode.containerInfo,oa=!0;break e}a=a.return}if($i===null)throw Error(Pt(160));gN(p,v,u),$i=null,oa=!1;var A=u.alternate;A!==null&&(A.return=null),u.return=null}catch(O){Kr(u,e,O)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)_N(e,t),e=e.sibling}function _N(t,e){var i=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(na(e,t),Fa(t),s&4){try{Hg(3,t,t.return),Zx(3,t)}catch(_e){Kr(t,t.return,_e)}try{Hg(5,t,t.return)}catch(_e){Kr(t,t.return,_e)}}break;case 1:na(e,t),Fa(t),s&512&&i!==null&&Af(i,i.return);break;case 5:if(na(e,t),Fa(t),s&512&&i!==null&&Af(i,i.return),t.flags&32){var u=t.stateNode;try{s_(u,"")}catch(_e){Kr(t,t.return,_e)}}if(s&4&&(u=t.stateNode,u!=null)){var p=t.memoizedProps,v=i!==null?i.memoizedProps:p,a=t.type,A=t.updateQueue;if(t.updateQueue=null,A!==null)try{a==="input"&&p.type==="radio"&&p.name!=null&&Fz(u,p),FE(a,v);var O=FE(a,p);for(v=0;v<A.length;v+=2){var B=A[v],$=A[v+1];B==="style"?$z(u,$):B==="dangerouslySetInnerHTML"?Vz(u,$):B==="children"?s_(u,$):JI(u,B,$,O)}switch(a){case"input":OE(u,p);break;case"textarea":Bz(u,p);break;case"select":var Y=u._wrapperState.wasMultiple;u._wrapperState.wasMultiple=!!p.multiple;var se=p.value;se!=null?Of(u,!!p.multiple,se,!1):Y!==!!p.multiple&&(p.defaultValue!=null?Of(u,!!p.multiple,p.defaultValue,!0):Of(u,!!p.multiple,p.multiple?[]:"",!1))}u[m_]=p}catch(_e){Kr(t,t.return,_e)}}break;case 6:if(na(e,t),Fa(t),s&4){if(t.stateNode===null)throw Error(Pt(162));u=t.stateNode,p=t.memoizedProps;try{u.nodeValue=p}catch(_e){Kr(t,t.return,_e)}}break;case 3:if(na(e,t),Fa(t),s&4&&i!==null&&i.memoizedState.isDehydrated)try{u_(e.containerInfo)}catch(_e){Kr(t,t.return,_e)}break;case 4:na(e,t),Fa(t);break;case 13:na(e,t),Fa(t),u=t.child,u.flags&8192&&(p=u.memoizedState!==null,u.stateNode.isHidden=p,!p||u.alternate!==null&&u.alternate.memoizedState!==null||(MA=ii())),s&4&&q3(t);break;case 22:if(B=i!==null&&i.memoizedState!==null,t.mode&1?(lo=(O=lo)||B,na(e,t),lo=O):na(e,t),Fa(t),s&8192){if(O=t.memoizedState!==null,(t.stateNode.isHidden=O)&&!B&&t.mode&1)for(qt=t,B=t.child;B!==null;){for($=qt=B;qt!==null;){switch(Y=qt,se=Y.child,Y.tag){case 0:case 11:case 14:case 15:Hg(4,Y,Y.return);break;case 1:Af(Y,Y.return);var me=Y.stateNode;if(typeof me.componentWillUnmount=="function"){s=Y,i=Y.return;try{e=s,me.props=e.memoizedProps,me.state=e.memoizedState,me.componentWillUnmount()}catch(_e){Kr(s,i,_e)}}break;case 5:Af(Y,Y.return);break;case 22:if(Y.memoizedState!==null){Z3($);continue}}se!==null?(se.return=Y,qt=se):Z3($)}B=B.sibling}e:for(B=null,$=t;;){if($.tag===5){if(B===null){B=$;try{u=$.stateNode,O?(p=u.style,typeof p.setProperty=="function"?p.setProperty("display","none","important"):p.display="none"):(a=$.stateNode,A=$.memoizedProps.style,v=A!=null&&A.hasOwnProperty("display")?A.display:null,a.style.display=Uz("display",v))}catch(_e){Kr(t,t.return,_e)}}}else if($.tag===6){if(B===null)try{$.stateNode.nodeValue=O?"":$.memoizedProps}catch(_e){Kr(t,t.return,_e)}}else if(($.tag!==22&&$.tag!==23||$.memoizedState===null||$===t)&&$.child!==null){$.child.return=$,$=$.child;continue}if($===t)break e;for(;$.sibling===null;){if($.return===null||$.return===t)break e;B===$&&(B=null),$=$.return}B===$&&(B=null),$.sibling.return=$.return,$=$.sibling}}break;case 19:na(e,t),Fa(t),s&4&&q3(t);break;case 21:break;default:na(e,t),Fa(t)}}function Fa(t){var e=t.flags;if(e&2){try{e:{for(var i=t.return;i!==null;){if(mN(i)){var s=i;break e}i=i.return}throw Error(Pt(160))}switch(s.tag){case 5:var u=s.stateNode;s.flags&32&&(s_(u,""),s.flags&=-33);var p=W3(t);pS(t,p,u);break;case 3:case 4:var v=s.stateNode.containerInfo,a=W3(t);fS(t,a,v);break;default:throw Error(Pt(161))}}catch(A){Kr(t,t.return,A)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function o7(t,e,i){qt=t,yN(t)}function yN(t,e,i){for(var s=(t.mode&1)!==0;qt!==null;){var u=qt,p=u.child;if(u.tag===22&&s){var v=u.memoizedState!==null||$v;if(!v){var a=u.alternate,A=a!==null&&a.memoizedState!==null||lo;a=$v;var O=lo;if($v=v,(lo=A)&&!O)for(qt=u;qt!==null;)v=qt,A=v.child,v.tag===22&&v.memoizedState!==null?X3(u):A!==null?(A.return=v,qt=A):X3(u);for(;p!==null;)qt=p,yN(p),p=p.sibling;qt=u,$v=a,lo=O}H3(t)}else u.subtreeFlags&8772&&p!==null?(p.return=u,qt=p):H3(t)}}function H3(t){for(;qt!==null;){var e=qt;if(e.flags&8772){var i=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:lo||Zx(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!lo)if(i===null)s.componentDidMount();else{var u=e.elementType===e.type?i.memoizedProps:ia(e.type,i.memoizedProps);s.componentDidUpdate(u,i.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var p=e.updateQueue;p!==null&&C3(e,p,s);break;case 3:var v=e.updateQueue;if(v!==null){if(i=null,e.child!==null)switch(e.child.tag){case 5:i=e.child.stateNode;break;case 1:i=e.child.stateNode}C3(e,v,i)}break;case 5:var a=e.stateNode;if(i===null&&e.flags&4){i=a;var A=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":A.autoFocus&&i.focus();break;case"img":A.src&&(i.src=A.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var O=e.alternate;if(O!==null){var B=O.memoizedState;if(B!==null){var $=B.dehydrated;$!==null&&u_($)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Pt(163))}lo||e.flags&512&&dS(e)}catch(Y){Kr(e,e.return,Y)}}if(e===t){qt=null;break}if(i=e.sibling,i!==null){i.return=e.return,qt=i;break}qt=e.return}}function Z3(t){for(;qt!==null;){var e=qt;if(e===t){qt=null;break}var i=e.sibling;if(i!==null){i.return=e.return,qt=i;break}qt=e.return}}function X3(t){for(;qt!==null;){var e=qt;try{switch(e.tag){case 0:case 11:case 15:var i=e.return;try{Zx(4,e)}catch(A){Kr(e,i,A)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var u=e.return;try{s.componentDidMount()}catch(A){Kr(e,u,A)}}var p=e.return;try{dS(e)}catch(A){Kr(e,p,A)}break;case 5:var v=e.return;try{dS(e)}catch(A){Kr(e,v,A)}}}catch(A){Kr(e,e.return,A)}if(e===t){qt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,qt=a;break}qt=e.return}}var s7=Math.ceil,K1=nc.ReactCurrentDispatcher,kA=nc.ReactCurrentOwner,Ls=nc.ReactCurrentBatchConfig,Qn=0,Ci=null,mi=null,Hi=0,cs=0,Pf=wu(0),Si=0,b_=null,Bh=0,Xx=0,CA=0,Zg=null,jo=null,MA=0,Kf=1/0,Ml=null,J1=!1,mS=null,su=null,Gv=!1,Xc=null,Q1=0,Xg=0,gS=null,_1=-1,y1=0;function To(){return Qn&6?ii():_1!==-1?_1:_1=ii()}function au(t){return t.mode&1?Qn&2&&Hi!==0?Hi&-Hi:$9.transition!==null?(y1===0&&(y1=t4()),y1):(t=yr,t!==0||(t=window.event,t=t===void 0?16:l4(t.type)),t):1}function ca(t,e,i,s){if(50<Xg)throw Xg=0,gS=null,Error(Pt(185));iy(t,i,s),(!(Qn&2)||t!==Ci)&&(t===Ci&&(!(Qn&2)&&(Xx|=i),Si===4&&Gc(t,Hi)),qo(t,s),i===1&&Qn===0&&!(e.mode&1)&&(Kf=ii()+500,Wx&&Tu()))}function qo(t,e){var i=t.callbackNode;$$(t,e);var s=z1(t,t===Ci?Hi:0);if(s===0)i!==null&&i3(i),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(i!=null&&i3(i),e===1)t.tag===0?U9(Y3.bind(null,t)):A4(Y3.bind(null,t)),F9(function(){!(Qn&6)&&Tu()}),i=null;else{switch(n4(s)){case 1:i=rA;break;case 4:i=Qz;break;case 16:i=L1;break;case 536870912:i=e4;break;default:i=L1}i=IN(i,vN.bind(null,t))}t.callbackPriority=e,t.callbackNode=i}}function vN(t,e){if(_1=-1,y1=0,Qn&6)throw Error(Pt(327));var i=t.callbackNode;if(Ff()&&t.callbackNode!==i)return null;var s=z1(t,t===Ci?Hi:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=ex(t,s);else{e=s;var u=Qn;Qn|=2;var p=bN();(Ci!==t||Hi!==e)&&(Ml=null,Kf=ii()+500,Mh(t,e));do try{c7();break}catch(a){xN(t,a)}while(1);gA(),K1.current=p,Qn=u,mi!==null?e=0:(Ci=null,Hi=0,e=Si)}if(e!==0){if(e===2&&(u=$E(t),u!==0&&(s=u,e=_S(t,u))),e===1)throw i=b_,Mh(t,0),Gc(t,s),qo(t,ii()),i;if(e===6)Gc(t,s);else{if(u=t.current.alternate,!(s&30)&&!a7(u)&&(e=ex(t,s),e===2&&(p=$E(t),p!==0&&(s=p,e=_S(t,p))),e===1))throw i=b_,Mh(t,0),Gc(t,s),qo(t,ii()),i;switch(t.finishedWork=u,t.finishedLanes=s,e){case 0:case 1:throw Error(Pt(345));case 2:xh(t,jo,Ml);break;case 3:if(Gc(t,s),(s&130023424)===s&&(e=MA+500-ii(),10<e)){if(z1(t,0)!==0)break;if(u=t.suspendedLanes,(u&s)!==s){To(),t.pingedLanes|=t.suspendedLanes&u;break}t.timeoutHandle=KE(xh.bind(null,t,jo,Ml),e);break}xh(t,jo,Ml);break;case 4:if(Gc(t,s),(s&4194240)===s)break;for(e=t.eventTimes,u=-1;0<s;){var v=31-la(s);p=1<<v,v=e[v],v>u&&(u=v),s&=~p}if(s=u,s=ii()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*s7(s/1960))-s,10<s){t.timeoutHandle=KE(xh.bind(null,t,jo,Ml),s);break}xh(t,jo,Ml);break;case 5:xh(t,jo,Ml);break;default:throw Error(Pt(329))}}}return qo(t,ii()),t.callbackNode===i?vN.bind(null,t):null}function _S(t,e){var i=Zg;return t.current.memoizedState.isDehydrated&&(Mh(t,e).flags|=256),t=ex(t,e),t!==2&&(e=jo,jo=i,e!==null&&yS(e)),t}function yS(t){jo===null?jo=t:jo.push.apply(jo,t)}function a7(t){for(var e=t;;){if(e.flags&16384){var i=e.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var s=0;s<i.length;s++){var u=i[s],p=u.getSnapshot;u=u.value;try{if(!ua(p(),u))return!1}catch{return!1}}}if(i=e.child,e.subtreeFlags&16384&&i!==null)i.return=e,e=i;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Gc(t,e){for(e&=~CA,e&=~Xx,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var i=31-la(e),s=1<<i;t[i]=-1,e&=~s}}function Y3(t){if(Qn&6)throw Error(Pt(327));Ff();var e=z1(t,0);if(!(e&1))return qo(t,ii()),null;var i=ex(t,e);if(t.tag!==0&&i===2){var s=$E(t);s!==0&&(e=s,i=_S(t,s))}if(i===1)throw i=b_,Mh(t,0),Gc(t,e),qo(t,ii()),i;if(i===6)throw Error(Pt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,xh(t,jo,Ml),qo(t,ii()),null}function RA(t,e){var i=Qn;Qn|=1;try{return t(e)}finally{Qn=i,Qn===0&&(Kf=ii()+500,Wx&&Tu())}}function jh(t){Xc!==null&&Xc.tag===0&&!(Qn&6)&&Ff();var e=Qn;Qn|=1;var i=Ls.transition,s=yr;try{if(Ls.transition=null,yr=1,t)return t()}finally{yr=s,Ls.transition=i,Qn=e,!(Qn&6)&&Tu()}}function OA(){cs=Pf.current,Br(Pf)}function Mh(t,e){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;if(i!==-1&&(t.timeoutHandle=-1,N9(i)),mi!==null)for(i=mi.return;i!==null;){var s=i;switch(fA(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&V1();break;case 3:Xf(),Br(Go),Br(fo),wA();break;case 5:bA(s);break;case 4:Xf();break;case 13:Br(Hr);break;case 19:Br(Hr);break;case 10:_A(s.type._context);break;case 22:case 23:OA()}i=i.return}if(Ci=t,mi=t=lu(t.current,null),Hi=cs=e,Si=0,b_=null,CA=Xx=Bh=0,jo=Zg=null,Sh!==null){for(e=0;e<Sh.length;e++)if(i=Sh[e],s=i.interleaved,s!==null){i.interleaved=null;var u=s.next,p=i.pending;if(p!==null){var v=p.next;p.next=u,s.next=v}i.pending=s}Sh=null}return t}function xN(t,e){do{var i=mi;try{if(gA(),p1.current=Y1,X1){for(var s=Zr.memoizedState;s!==null;){var u=s.queue;u!==null&&(u.pending=null),s=s.next}X1=!1}if(Fh=0,ki=Ei=Zr=null,qg=!1,y_=0,kA.current=null,i===null||i.return===null){Si=1,b_=e,mi=null;break}e:{var p=t,v=i.return,a=i,A=e;if(e=Hi,a.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){var O=A,B=a,$=B.tag;if(!(B.mode&1)&&($===0||$===11||$===15)){var Y=B.alternate;Y?(B.updateQueue=Y.updateQueue,B.memoizedState=Y.memoizedState,B.lanes=Y.lanes):(B.updateQueue=null,B.memoizedState=null)}var se=N3(v);if(se!==null){se.flags&=-257,F3(se,v,a,p,e),se.mode&1&&z3(p,O,e),e=se,A=O;var me=e.updateQueue;if(me===null){var _e=new Set;_e.add(A),e.updateQueue=_e}else me.add(A);break e}else{if(!(e&1)){z3(p,O,e),DA();break e}A=Error(Pt(426))}}else if(Ur&&a.mode&1){var Ee=N3(v);if(Ee!==null){!(Ee.flags&65536)&&(Ee.flags|=256),F3(Ee,v,a,p,e),pA(Yf(A,a));break e}}p=A=Yf(A,a),Si!==4&&(Si=2),Zg===null?Zg=[p]:Zg.push(p),p=v;do{switch(p.tag){case 3:p.flags|=65536,e&=-e,p.lanes|=e;var ae=rN(p,A,e);k3(p,ae);break e;case 1:a=A;var le=p.type,fe=p.stateNode;if(!(p.flags&128)&&(typeof le.getDerivedStateFromError=="function"||fe!==null&&typeof fe.componentDidCatch=="function"&&(su===null||!su.has(fe)))){p.flags|=65536,e&=-e,p.lanes|=e;var Ce=iN(p,a,e);k3(p,Ce);break e}}p=p.return}while(p!==null)}TN(i)}catch(Ge){e=Ge,mi===i&&i!==null&&(mi=i=i.return);continue}break}while(1)}function bN(){var t=K1.current;return K1.current=Y1,t===null?Y1:t}function DA(){(Si===0||Si===3||Si===2)&&(Si=4),Ci===null||!(Bh&268435455)&&!(Xx&268435455)||Gc(Ci,Hi)}function ex(t,e){var i=Qn;Qn|=2;var s=bN();(Ci!==t||Hi!==e)&&(Ml=null,Mh(t,e));do try{l7();break}catch(u){xN(t,u)}while(1);if(gA(),Qn=i,K1.current=s,mi!==null)throw Error(Pt(261));return Ci=null,Hi=0,Si}function l7(){for(;mi!==null;)wN(mi)}function c7(){for(;mi!==null&&!D$();)wN(mi)}function wN(t){var e=SN(t.alternate,t,cs);t.memoizedProps=t.pendingProps,e===null?TN(t):mi=e,kA.current=null}function TN(t){var e=t;do{var i=e.alternate;if(t=e.return,e.flags&32768){if(i=n7(i,e),i!==null){i.flags&=32767,mi=i;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Si=6,mi=null;return}}else if(i=t7(i,e,cs),i!==null){mi=i;return}if(e=e.sibling,e!==null){mi=e;return}mi=e=t}while(e!==null);Si===0&&(Si=5)}function xh(t,e,i){var s=yr,u=Ls.transition;try{Ls.transition=null,yr=1,u7(t,e,i,s)}finally{Ls.transition=u,yr=s}return null}function u7(t,e,i,s){do Ff();while(Xc!==null);if(Qn&6)throw Error(Pt(327));i=t.finishedWork;var u=t.finishedLanes;if(i===null)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(Pt(177));t.callbackNode=null,t.callbackPriority=0;var p=i.lanes|i.childLanes;if(G$(t,p),t===Ci&&(mi=Ci=null,Hi=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||Gv||(Gv=!0,IN(L1,function(){return Ff(),null})),p=(i.flags&15990)!==0,i.subtreeFlags&15990||p){p=Ls.transition,Ls.transition=null;var v=yr;yr=1;var a=Qn;Qn|=4,kA.current=null,i7(t,i),_N(i,t),C9(XE),N1=!!ZE,XE=ZE=null,t.current=i,o7(i),L$(),Qn=a,yr=v,Ls.transition=p}else t.current=i;if(Gv&&(Gv=!1,Xc=t,Q1=u),p=t.pendingLanes,p===0&&(su=null),F$(i.stateNode),qo(t,ii()),e!==null)for(s=t.onRecoverableError,i=0;i<e.length;i++)u=e[i],s(u.value,{componentStack:u.stack,digest:u.digest});if(J1)throw J1=!1,t=mS,mS=null,t;return Q1&1&&t.tag!==0&&Ff(),p=t.pendingLanes,p&1?t===gS?Xg++:(Xg=0,gS=t):Xg=0,Tu(),null}function Ff(){if(Xc!==null){var t=n4(Q1),e=Ls.transition,i=yr;try{if(Ls.transition=null,yr=16>t?16:t,Xc===null)var s=!1;else{if(t=Xc,Xc=null,Q1=0,Qn&6)throw Error(Pt(331));var u=Qn;for(Qn|=4,qt=t.current;qt!==null;){var p=qt,v=p.child;if(qt.flags&16){var a=p.deletions;if(a!==null){for(var A=0;A<a.length;A++){var O=a[A];for(qt=O;qt!==null;){var B=qt;switch(B.tag){case 0:case 11:case 15:Hg(8,B,p)}var $=B.child;if($!==null)$.return=B,qt=$;else for(;qt!==null;){B=qt;var Y=B.sibling,se=B.return;if(pN(B),B===O){qt=null;break}if(Y!==null){Y.return=se,qt=Y;break}qt=se}}}var me=p.alternate;if(me!==null){var _e=me.child;if(_e!==null){me.child=null;do{var Ee=_e.sibling;_e.sibling=null,_e=Ee}while(_e!==null)}}qt=p}}if(p.subtreeFlags&2064&&v!==null)v.return=p,qt=v;else e:for(;qt!==null;){if(p=qt,p.flags&2048)switch(p.tag){case 0:case 11:case 15:Hg(9,p,p.return)}var ae=p.sibling;if(ae!==null){ae.return=p.return,qt=ae;break e}qt=p.return}}var le=t.current;for(qt=le;qt!==null;){v=qt;var fe=v.child;if(v.subtreeFlags&2064&&fe!==null)fe.return=v,qt=fe;else e:for(v=le;qt!==null;){if(a=qt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Zx(9,a)}}catch(Ge){Kr(a,a.return,Ge)}if(a===v){qt=null;break e}var Ce=a.sibling;if(Ce!==null){Ce.return=a.return,qt=Ce;break e}qt=a.return}}if(Qn=u,Tu(),qa&&typeof qa.onPostCommitFiberRoot=="function")try{qa.onPostCommitFiberRoot(jx,t)}catch{}s=!0}return s}finally{yr=i,Ls.transition=e}}return!1}function K3(t,e,i){e=Yf(i,e),e=rN(t,e,1),t=ou(t,e,1),e=To(),t!==null&&(iy(t,1,e),qo(t,e))}function Kr(t,e,i){if(t.tag===3)K3(t,t,i);else for(;e!==null;){if(e.tag===3){K3(e,t,i);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(su===null||!su.has(s))){t=Yf(i,t),t=iN(e,t,1),e=ou(e,t,1),t=To(),e!==null&&(iy(e,1,t),qo(e,t));break}}e=e.return}}function h7(t,e,i){var s=t.pingCache;s!==null&&s.delete(e),e=To(),t.pingedLanes|=t.suspendedLanes&i,Ci===t&&(Hi&i)===i&&(Si===4||Si===3&&(Hi&130023424)===Hi&&500>ii()-MA?Mh(t,0):CA|=i),qo(t,e)}function EN(t,e){e===0&&(t.mode&1?(e=Dv,Dv<<=1,!(Dv&130023424)&&(Dv=4194304)):e=1);var i=To();t=ql(t,e),t!==null&&(iy(t,e,i),qo(t,i))}function d7(t){var e=t.memoizedState,i=0;e!==null&&(i=e.retryLane),EN(t,i)}function f7(t,e){var i=0;switch(t.tag){case 13:var s=t.stateNode,u=t.memoizedState;u!==null&&(i=u.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(Pt(314))}s!==null&&s.delete(e),EN(t,i)}var SN;SN=function(t,e,i){if(t!==null)if(t.memoizedProps!==e.pendingProps||Go.current)Uo=!0;else{if(!(t.lanes&i)&&!(e.flags&128))return Uo=!1,e7(t,e,i);Uo=!!(t.flags&131072)}else Uo=!1,Ur&&e.flags&1048576&&P4(e,G1,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;g1(t,e),t=e.pendingProps;var u=qf(e,fo.current);Nf(e,i),u=EA(null,e,s,t,u,i);var p=SA();return e.flags|=1,typeof u=="object"&&u!==null&&typeof u.render=="function"&&u.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Wo(s)?(p=!0,U1(e)):p=!1,e.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,vA(e),u.updater=qx,e.stateNode=u,u._reactInternals=e,iS(e,s,t,i),e=aS(null,e,s,!0,p,i)):(e.tag=0,Ur&&p&&dA(e),xo(null,e,u,i),e=e.child),e;case 16:s=e.elementType;e:{switch(g1(t,e),t=e.pendingProps,u=s._init,s=u(s._payload),e.type=s,u=e.tag=m7(s),t=ia(s,t),u){case 0:e=sS(null,e,s,t,i);break e;case 1:e=V3(null,e,s,t,i);break e;case 11:e=B3(null,e,s,t,i);break e;case 14:e=j3(null,e,s,ia(s.type,t),i);break e}throw Error(Pt(306,s,""))}return e;case 0:return s=e.type,u=e.pendingProps,u=e.elementType===s?u:ia(s,u),sS(t,e,s,u,i);case 1:return s=e.type,u=e.pendingProps,u=e.elementType===s?u:ia(s,u),V3(t,e,s,u,i);case 3:e:{if(lN(e),t===null)throw Error(Pt(387));s=e.pendingProps,p=e.memoizedState,u=p.element,R4(t,e),H1(e,s,null,i);var v=e.memoizedState;if(s=v.element,p.isDehydrated)if(p={element:s,isDehydrated:!1,cache:v.cache,pendingSuspenseBoundaries:v.pendingSuspenseBoundaries,transitions:v.transitions},e.updateQueue.baseState=p,e.memoizedState=p,e.flags&256){u=Yf(Error(Pt(423)),e),e=U3(t,e,s,i,u);break e}else if(s!==u){u=Yf(Error(Pt(424)),e),e=U3(t,e,s,i,u);break e}else for(us=iu(e.stateNode.containerInfo.firstChild),hs=e,Ur=!0,sa=null,i=z4(e,null,s,i),e.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(Hf(),s===u){e=Hl(t,e,i);break e}xo(t,e,s,i)}e=e.child}return e;case 5:return N4(e),t===null&&tS(e),s=e.type,u=e.pendingProps,p=t!==null?t.memoizedProps:null,v=u.children,YE(s,u)?v=null:p!==null&&YE(s,p)&&(e.flags|=32),aN(t,e),xo(t,e,v,i),e.child;case 6:return t===null&&tS(e),null;case 13:return cN(t,e,i);case 4:return xA(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=Zf(e,null,s,i):xo(t,e,s,i),e.child;case 11:return s=e.type,u=e.pendingProps,u=e.elementType===s?u:ia(s,u),B3(t,e,s,u,i);case 7:return xo(t,e,e.pendingProps,i),e.child;case 8:return xo(t,e,e.pendingProps.children,i),e.child;case 12:return xo(t,e,e.pendingProps.children,i),e.child;case 10:e:{if(s=e.type._context,u=e.pendingProps,p=e.memoizedProps,v=u.value,Cr(W1,s._currentValue),s._currentValue=v,p!==null)if(ua(p.value,v)){if(p.children===u.children&&!Go.current){e=Hl(t,e,i);break e}}else for(p=e.child,p!==null&&(p.return=e);p!==null;){var a=p.dependencies;if(a!==null){v=p.child;for(var A=a.firstContext;A!==null;){if(A.context===s){if(p.tag===1){A=jl(-1,i&-i),A.tag=2;var O=p.updateQueue;if(O!==null){O=O.shared;var B=O.pending;B===null?A.next=A:(A.next=B.next,B.next=A),O.pending=A}}p.lanes|=i,A=p.alternate,A!==null&&(A.lanes|=i),nS(p.return,i,e),a.lanes|=i;break}A=A.next}}else if(p.tag===10)v=p.type===e.type?null:p.child;else if(p.tag===18){if(v=p.return,v===null)throw Error(Pt(341));v.lanes|=i,a=v.alternate,a!==null&&(a.lanes|=i),nS(v,i,e),v=p.sibling}else v=p.child;if(v!==null)v.return=p;else for(v=p;v!==null;){if(v===e){v=null;break}if(p=v.sibling,p!==null){p.return=v.return,v=p;break}v=v.return}p=v}xo(t,e,u.children,i),e=e.child}return e;case 9:return u=e.type,s=e.pendingProps.children,Nf(e,i),u=Ns(u),s=s(u),e.flags|=1,xo(t,e,s,i),e.child;case 14:return s=e.type,u=ia(s,e.pendingProps),u=ia(s.type,u),j3(t,e,s,u,i);case 15:return oN(t,e,e.type,e.pendingProps,i);case 17:return s=e.type,u=e.pendingProps,u=e.elementType===s?u:ia(s,u),g1(t,e),e.tag=1,Wo(s)?(t=!0,U1(e)):t=!1,Nf(e,i),D4(e,s,u),iS(e,s,u,i),aS(null,e,s,!0,t,i);case 19:return uN(t,e,i);case 22:return sN(t,e,i)}throw Error(Pt(156,e.tag))};function IN(t,e){return Jz(t,e)}function p7(t,e,i,s){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ds(t,e,i,s){return new p7(t,e,i,s)}function LA(t){return t=t.prototype,!(!t||!t.isReactComponent)}function m7(t){if(typeof t=="function")return LA(t)?1:0;if(t!=null){if(t=t.$$typeof,t===eA)return 11;if(t===tA)return 14}return 2}function lu(t,e){var i=t.alternate;return i===null?(i=Ds(t.tag,e,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=t.flags&14680064,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i}function v1(t,e,i,s,u,p){var v=2;if(s=t,typeof t=="function")LA(t)&&(v=1);else if(typeof t=="string")v=5;else e:switch(t){case yf:return Rh(i.children,u,p,e);case QI:v=8,u|=8;break;case PE:return t=Ds(12,i,e,u|2),t.elementType=PE,t.lanes=p,t;case kE:return t=Ds(13,i,e,u),t.elementType=kE,t.lanes=p,t;case CE:return t=Ds(19,i,e,u),t.elementType=CE,t.lanes=p,t;case Lz:return Yx(i,u,p,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Oz:v=10;break e;case Dz:v=9;break e;case eA:v=11;break e;case tA:v=14;break e;case Vc:v=16,s=null;break e}throw Error(Pt(130,t==null?t:typeof t,""))}return e=Ds(v,i,e,u),e.elementType=t,e.type=s,e.lanes=p,e}function Rh(t,e,i,s){return t=Ds(7,t,s,e),t.lanes=i,t}function Yx(t,e,i,s){return t=Ds(22,t,s,e),t.elementType=Lz,t.lanes=i,t.stateNode={isHidden:!1},t}function WT(t,e,i){return t=Ds(6,t,null,e),t.lanes=i,t}function qT(t,e,i){return e=Ds(4,t.children!==null?t.children:[],t.key,e),e.lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function g7(t,e,i,s,u){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=IT(0),this.expirationTimes=IT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=IT(0),this.identifierPrefix=s,this.onRecoverableError=u,this.mutableSourceEagerHydrationData=null}function zA(t,e,i,s,u,p,v,a,A){return t=new g7(t,e,i,a,A),e===1?(e=1,p===!0&&(e|=8)):e=0,p=Ds(3,null,null,e),t.current=p,p.stateNode=t,p.memoizedState={element:s,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},vA(p),t}function _7(t,e,i){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_f,key:s==null?null:""+s,children:t,containerInfo:e,implementation:i}}function AN(t){if(!t)return gu;t=t._reactInternals;e:{if(Jh(t)!==t||t.tag!==1)throw Error(Pt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Wo(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Pt(171))}if(t.tag===1){var i=t.type;if(Wo(i))return I4(t,i,e)}return e}function PN(t,e,i,s,u,p,v,a,A){return t=zA(i,s,!0,t,u,p,v,a,A),t.context=AN(null),i=t.current,s=To(),u=au(i),p=jl(s,u),p.callback=e??null,ou(i,p,u),t.current.lanes=u,iy(t,u,s),qo(t,s),t}function Kx(t,e,i,s){var u=e.current,p=To(),v=au(u);return i=AN(i),e.context===null?e.context=i:e.pendingContext=i,e=jl(p,v),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=ou(u,e,v),t!==null&&(ca(t,u,v,p),f1(t,u,v)),v}function tx(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function J3(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<e?i:e}}function NA(t,e){J3(t,e),(t=t.alternate)&&J3(t,e)}function y7(){return null}var kN=typeof reportError=="function"?reportError:function(t){console.error(t)};function FA(t){this._internalRoot=t}Jx.prototype.render=FA.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Pt(409));Kx(t,e,null,null)};Jx.prototype.unmount=FA.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;jh(function(){Kx(null,t,null,null)}),e[Wl]=null}};function Jx(t){this._internalRoot=t}Jx.prototype.unstable_scheduleHydration=function(t){if(t){var e=o4();t={blockedOn:null,target:t,priority:e};for(var i=0;i<$c.length&&e!==0&&e<$c[i].priority;i++);$c.splice(i,0,t),i===0&&a4(t)}};function BA(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Qx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Q3(){}function v7(t,e,i,s,u){if(u){if(typeof s=="function"){var p=s;s=function(){var O=tx(v);p.call(O)}}var v=PN(e,s,t,0,null,!1,!1,"",Q3);return t._reactRootContainer=v,t[Wl]=v.current,f_(t.nodeType===8?t.parentNode:t),jh(),v}for(;u=t.lastChild;)t.removeChild(u);if(typeof s=="function"){var a=s;s=function(){var O=tx(A);a.call(O)}}var A=zA(t,0,!1,null,null,!1,!1,"",Q3);return t._reactRootContainer=A,t[Wl]=A.current,f_(t.nodeType===8?t.parentNode:t),jh(function(){Kx(e,A,i,s)}),A}function eb(t,e,i,s,u){var p=i._reactRootContainer;if(p){var v=p;if(typeof u=="function"){var a=u;u=function(){var A=tx(v);a.call(A)}}Kx(e,v,t,u)}else v=v7(i,e,t,u,s);return tx(v)}r4=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var i=kg(e.pendingLanes);i!==0&&(iA(e,i|1),qo(e,ii()),!(Qn&6)&&(Kf=ii()+500,Tu()))}break;case 13:jh(function(){var s=ql(t,1);if(s!==null){var u=To();ca(s,t,1,u)}}),NA(t,1)}};oA=function(t){if(t.tag===13){var e=ql(t,134217728);if(e!==null){var i=To();ca(e,t,134217728,i)}NA(t,134217728)}};i4=function(t){if(t.tag===13){var e=au(t),i=ql(t,e);if(i!==null){var s=To();ca(i,t,e,s)}NA(t,e)}};o4=function(){return yr};s4=function(t,e){var i=yr;try{return yr=t,e()}finally{yr=i}};jE=function(t,e,i){switch(e){case"input":if(OE(t,i),e=i.name,i.type==="radio"&&e!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<i.length;e++){var s=i[e];if(s!==t&&s.form===t.form){var u=Gx(s);if(!u)throw Error(Pt(90));Nz(s),OE(s,u)}}}break;case"textarea":Bz(t,i);break;case"select":e=i.value,e!=null&&Of(t,!!i.multiple,e,!1)}};qz=RA;Hz=jh;var x7={usingClientEntryPoint:!1,Events:[sy,wf,Gx,Gz,Wz,RA]},Tg={findFiberByHostInstance:Eh,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},b7={bundleType:Tg.bundleType,version:Tg.version,rendererPackageName:Tg.rendererPackageName,rendererConfig:Tg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:nc.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Yz(t),t===null?null:t.stateNode},findFiberByHostInstance:Tg.findFiberByHostInstance||y7,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wv.isDisabled&&Wv.supportsFiber)try{jx=Wv.inject(b7),qa=Wv}catch{}}ms.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=x7;ms.createPortal=function(t,e){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!BA(e))throw Error(Pt(200));return _7(t,e,null,i)};ms.createRoot=function(t,e){if(!BA(t))throw Error(Pt(299));var i=!1,s="",u=kN;return e!=null&&(e.unstable_strictMode===!0&&(i=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(u=e.onRecoverableError)),e=zA(t,1,!1,null,null,i,!1,s,u),t[Wl]=e.current,f_(t.nodeType===8?t.parentNode:t),new FA(e)};ms.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Pt(188)):(t=Object.keys(t).join(","),Error(Pt(268,t)));return t=Yz(e),t=t===null?null:t.stateNode,t};ms.flushSync=function(t){return jh(t)};ms.hydrate=function(t,e,i){if(!Qx(e))throw Error(Pt(200));return eb(null,t,e,!0,i)};ms.hydrateRoot=function(t,e,i){if(!BA(t))throw Error(Pt(405));var s=i!=null&&i.hydratedSources||null,u=!1,p="",v=kN;if(i!=null&&(i.unstable_strictMode===!0&&(u=!0),i.identifierPrefix!==void 0&&(p=i.identifierPrefix),i.onRecoverableError!==void 0&&(v=i.onRecoverableError)),e=PN(e,null,t,1,i??null,u,!1,p,v),t[Wl]=e.current,f_(t),s)for(t=0;t<s.length;t++)i=s[t],u=i._getVersion,u=u(i._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[i,u]:e.mutableSourceEagerHydrationData.push(i,u);return new Jx(e)};ms.render=function(t,e,i){if(!Qx(e))throw Error(Pt(200));return eb(null,t,e,!1,i)};ms.unmountComponentAtNode=function(t){if(!Qx(t))throw Error(Pt(40));return t._reactRootContainer?(jh(function(){eb(null,null,t,!1,function(){t._reactRootContainer=null,t[Wl]=null})}),!0):!1};ms.unstable_batchedUpdates=RA;ms.unstable_renderSubtreeIntoContainer=function(t,e,i,s){if(!Qx(i))throw Error(Pt(200));if(t==null||t._reactInternals===void 0)throw Error(Pt(38));return eb(t,e,i,!1,s)};ms.version="18.2.0-next-9e3b772b8-20220608";function CN(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(CN)}catch(t){console.error(t)}}CN(),Pz.exports=ms;var w7=Pz.exports,eD=w7;IE.createRoot=eD.createRoot,IE.hydrateRoot=eD.hydrateRoot;/**
 * @remix-run/router v1.10.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function w_(){return w_=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},w_.apply(this,arguments)}var Yc;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Yc||(Yc={}));const tD="popstate";function T7(t){t===void 0&&(t={});function e(s,u){let{pathname:p,search:v,hash:a}=s.location;return vS("",{pathname:p,search:v,hash:a},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function i(s,u){return typeof u=="string"?u:nx(u)}return S7(e,i,null,t)}function oi(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function jA(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function E7(){return Math.random().toString(36).substr(2,8)}function nD(t,e){return{usr:t.state,key:t.key,idx:e}}function vS(t,e,i,s){return i===void 0&&(i=null),w_({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?yp(e):e,{state:i,key:e&&e.key||s||E7()})}function nx(t){let{pathname:e="/",search:i="",hash:s=""}=t;return i&&i!=="?"&&(e+=i.charAt(0)==="?"?i:"?"+i),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function yp(t){let e={};if(t){let i=t.indexOf("#");i>=0&&(e.hash=t.substr(i),t=t.substr(0,i));let s=t.indexOf("?");s>=0&&(e.search=t.substr(s),t=t.substr(0,s)),t&&(e.pathname=t)}return e}function S7(t,e,i,s){s===void 0&&(s={});let{window:u=document.defaultView,v5Compat:p=!1}=s,v=u.history,a=Yc.Pop,A=null,O=B();O==null&&(O=0,v.replaceState(w_({},v.state,{idx:O}),""));function B(){return(v.state||{idx:null}).idx}function $(){a=Yc.Pop;let Ee=B(),ae=Ee==null?null:Ee-O;O=Ee,A&&A({action:a,location:_e.location,delta:ae})}function Y(Ee,ae){a=Yc.Push;let le=vS(_e.location,Ee,ae);i&&i(le,Ee),O=B()+1;let fe=nD(le,O),Ce=_e.createHref(le);try{v.pushState(fe,"",Ce)}catch(Ge){if(Ge instanceof DOMException&&Ge.name==="DataCloneError")throw Ge;u.location.assign(Ce)}p&&A&&A({action:a,location:_e.location,delta:1})}function se(Ee,ae){a=Yc.Replace;let le=vS(_e.location,Ee,ae);i&&i(le,Ee),O=B();let fe=nD(le,O),Ce=_e.createHref(le);v.replaceState(fe,"",Ce),p&&A&&A({action:a,location:_e.location,delta:0})}function me(Ee){let ae=u.location.origin!=="null"?u.location.origin:u.location.href,le=typeof Ee=="string"?Ee:nx(Ee);return oi(ae,"No window.location.(origin|href) available to create URL for href: "+le),new URL(le,ae)}let _e={get action(){return a},get location(){return t(u,v)},listen(Ee){if(A)throw new Error("A history only accepts one active listener");return u.addEventListener(tD,$),A=Ee,()=>{u.removeEventListener(tD,$),A=null}},createHref(Ee){return e(u,Ee)},createURL:me,encodeLocation(Ee){let ae=me(Ee);return{pathname:ae.pathname,search:ae.search,hash:ae.hash}},push:Y,replace:se,go(Ee){return v.go(Ee)}};return _e}var rD;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(rD||(rD={}));function I7(t,e,i){i===void 0&&(i="/");let s=typeof e=="string"?yp(e):e,u=VA(s.pathname||"/",i);if(u==null)return null;let p=MN(t);A7(p);let v=null;for(let a=0;v==null&&a<p.length;++a)v=z7(p[a],B7(u));return v}function MN(t,e,i,s){e===void 0&&(e=[]),i===void 0&&(i=[]),s===void 0&&(s="");let u=(p,v,a)=>{let A={relativePath:a===void 0?p.path||"":a,caseSensitive:p.caseSensitive===!0,childrenIndex:v,route:p};A.relativePath.startsWith("/")&&(oi(A.relativePath.startsWith(s),'Absolute route path "'+A.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),A.relativePath=A.relativePath.slice(s.length));let O=cu([s,A.relativePath]),B=i.concat(A);p.children&&p.children.length>0&&(oi(p.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+O+'".')),MN(p.children,e,B,O)),!(p.path==null&&!p.index)&&e.push({path:O,score:D7(O,p.index),routesMeta:B})};return t.forEach((p,v)=>{var a;if(p.path===""||!((a=p.path)!=null&&a.includes("?")))u(p,v);else for(let A of RN(p.path))u(p,v,A)}),e}function RN(t){let e=t.split("/");if(e.length===0)return[];let[i,...s]=e,u=i.endsWith("?"),p=i.replace(/\?$/,"");if(s.length===0)return u?[p,""]:[p];let v=RN(s.join("/")),a=[];return a.push(...v.map(A=>A===""?p:[p,A].join("/"))),u&&a.push(...v),a.map(A=>t.startsWith("/")&&A===""?"/":A)}function A7(t){t.sort((e,i)=>e.score!==i.score?i.score-e.score:L7(e.routesMeta.map(s=>s.childrenIndex),i.routesMeta.map(s=>s.childrenIndex)))}const P7=/^:\w+$/,k7=3,C7=2,M7=1,R7=10,O7=-2,iD=t=>t==="*";function D7(t,e){let i=t.split("/"),s=i.length;return i.some(iD)&&(s+=O7),e&&(s+=C7),i.filter(u=>!iD(u)).reduce((u,p)=>u+(P7.test(p)?k7:p===""?M7:R7),s)}function L7(t,e){return t.length===e.length&&t.slice(0,-1).every((s,u)=>s===e[u])?t[t.length-1]-e[e.length-1]:0}function z7(t,e){let{routesMeta:i}=t,s={},u="/",p=[];for(let v=0;v<i.length;++v){let a=i[v],A=v===i.length-1,O=u==="/"?e:e.slice(u.length)||"/",B=N7({path:a.relativePath,caseSensitive:a.caseSensitive,end:A},O);if(!B)return null;Object.assign(s,B.params);let $=a.route;p.push({params:s,pathname:cu([u,B.pathname]),pathnameBase:$7(cu([u,B.pathnameBase])),route:$}),B.pathnameBase!=="/"&&(u=cu([u,B.pathnameBase]))}return p}function N7(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[i,s]=F7(t.path,t.caseSensitive,t.end),u=e.match(i);if(!u)return null;let p=u[0],v=p.replace(/(.)\/+$/,"$1"),a=u.slice(1);return{params:s.reduce((O,B,$)=>{if(B==="*"){let Y=a[$]||"";v=p.slice(0,p.length-Y.length).replace(/(.)\/+$/,"$1")}return O[B]=j7(a[$]||"",B),O},{}),pathname:p,pathnameBase:v,pattern:t}}function F7(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!0),jA(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let s=[],u="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(v,a)=>(s.push(a),"/([^\\/]+)"));return t.endsWith("*")?(s.push("*"),u+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?u+="\\/*$":t!==""&&t!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,e?void 0:"i"),s]}function B7(t){try{return decodeURI(t)}catch(e){return jA(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function j7(t,e){try{return decodeURIComponent(t)}catch(i){return jA(!1,'The value for the URL param "'+e+'" will not be decoded because'+(' the string "'+t+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+i+").")),t}}function VA(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let i=e.endsWith("/")?e.length-1:e.length,s=t.charAt(i);return s&&s!=="/"?null:t.slice(i)||"/"}function V7(t,e){e===void 0&&(e="/");let{pathname:i,search:s="",hash:u=""}=typeof t=="string"?yp(t):t;return{pathname:i?i.startsWith("/")?i:U7(i,e):e,search:G7(s),hash:W7(u)}}function U7(t,e){let i=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(u=>{u===".."?i.length>1&&i.pop():u!=="."&&i.push(u)}),i.length>1?i.join("/"):"/"}function HT(t,e,i,s){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function UA(t){return t.filter((e,i)=>i===0||e.route.path&&e.route.path.length>0)}function $A(t,e,i,s){s===void 0&&(s=!1);let u;typeof t=="string"?u=yp(t):(u=w_({},t),oi(!u.pathname||!u.pathname.includes("?"),HT("?","pathname","search",u)),oi(!u.pathname||!u.pathname.includes("#"),HT("#","pathname","hash",u)),oi(!u.search||!u.search.includes("#"),HT("#","search","hash",u)));let p=t===""||u.pathname==="",v=p?"/":u.pathname,a;if(s||v==null)a=i;else{let $=e.length-1;if(v.startsWith("..")){let Y=v.split("/");for(;Y[0]==="..";)Y.shift(),$-=1;u.pathname=Y.join("/")}a=$>=0?e[$]:"/"}let A=V7(u,a),O=v&&v!=="/"&&v.endsWith("/"),B=(p||v===".")&&i.endsWith("/");return!A.pathname.endsWith("/")&&(O||B)&&(A.pathname+="/"),A}const cu=t=>t.join("/").replace(/\/\/+/g,"/"),$7=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),G7=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,W7=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function q7(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const ON=["post","put","patch","delete"];new Set(ON);const H7=["get",...ON];new Set(H7);/**
 * React Router v6.17.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rx(){return rx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},rx.apply(this,arguments)}const GA=Be.createContext(null),Z7=Be.createContext(null),vp=Be.createContext(null),tb=Be.createContext(null),rc=Be.createContext({outlet:null,matches:[],isDataRoute:!1}),DN=Be.createContext(null);function X7(t,e){let{relative:i}=e===void 0?{}:e;xp()||oi(!1);let{basename:s,navigator:u}=Be.useContext(vp),{hash:p,pathname:v,search:a}=zN(t,{relative:i}),A=v;return s!=="/"&&(A=v==="/"?s:cu([s,v])),u.createHref({pathname:A,search:a,hash:p})}function xp(){return Be.useContext(tb)!=null}function ly(){return xp()||oi(!1),Be.useContext(tb).location}function LN(t){Be.useContext(vp).static||Be.useLayoutEffect(t)}function Qh(){let{isDataRoute:t}=Be.useContext(rc);return t?cG():Y7()}function Y7(){xp()||oi(!1);let t=Be.useContext(GA),{basename:e,navigator:i}=Be.useContext(vp),{matches:s}=Be.useContext(rc),{pathname:u}=ly(),p=JSON.stringify(UA(s).map(A=>A.pathnameBase)),v=Be.useRef(!1);return LN(()=>{v.current=!0}),Be.useCallback(function(A,O){if(O===void 0&&(O={}),!v.current)return;if(typeof A=="number"){i.go(A);return}let B=$A(A,JSON.parse(p),u,O.relative==="path");t==null&&e!=="/"&&(B.pathname=B.pathname==="/"?e:cu([e,B.pathname])),(O.replace?i.replace:i.push)(B,O.state,O)},[e,i,p,u,t])}function K7(){let{matches:t}=Be.useContext(rc),e=t[t.length-1];return e?e.params:{}}function zN(t,e){let{relative:i}=e===void 0?{}:e,{matches:s}=Be.useContext(rc),{pathname:u}=ly(),p=JSON.stringify(UA(s).map(v=>v.pathnameBase));return Be.useMemo(()=>$A(t,JSON.parse(p),u,i==="path"),[t,p,u,i])}function J7(t,e){return Q7(t,e)}function Q7(t,e,i){xp()||oi(!1);let{navigator:s}=Be.useContext(vp),{matches:u}=Be.useContext(rc),p=u[u.length-1],v=p?p.params:{};p&&p.pathname;let a=p?p.pathnameBase:"/";p&&p.route;let A=ly(),O;if(e){var B;let _e=typeof e=="string"?yp(e):e;a==="/"||(B=_e.pathname)!=null&&B.startsWith(a)||oi(!1),O=_e}else O=A;let $=O.pathname||"/",Y=a==="/"?$:$.slice(a.length)||"/",se=I7(t,{pathname:Y}),me=iG(se&&se.map(_e=>Object.assign({},_e,{params:Object.assign({},v,_e.params),pathname:cu([a,s.encodeLocation?s.encodeLocation(_e.pathname).pathname:_e.pathname]),pathnameBase:_e.pathnameBase==="/"?a:cu([a,s.encodeLocation?s.encodeLocation(_e.pathnameBase).pathname:_e.pathnameBase])})),u,i);return e&&me?Be.createElement(tb.Provider,{value:{location:rx({pathname:"/",search:"",hash:"",state:null,key:"default"},O),navigationType:Yc.Pop}},me):me}function eG(){let t=lG(),e=q7(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),i=t instanceof Error?t.stack:null,u={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},p=null;return Be.createElement(Be.Fragment,null,Be.createElement("h2",null,"Unexpected Application Error!"),Be.createElement("h3",{style:{fontStyle:"italic"}},e),i?Be.createElement("pre",{style:u},i):null,p)}const tG=Be.createElement(eG,null);class nG extends Be.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,i){return i.location!==e.location||i.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error||i.error,location:i.location,revalidation:e.revalidation||i.revalidation}}componentDidCatch(e,i){console.error("React Router caught the following error during render",e,i)}render(){return this.state.error?Be.createElement(rc.Provider,{value:this.props.routeContext},Be.createElement(DN.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function rG(t){let{routeContext:e,match:i,children:s}=t,u=Be.useContext(GA);return u&&u.static&&u.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(u.staticContext._deepestRenderedBoundaryId=i.route.id),Be.createElement(rc.Provider,{value:e},s)}function iG(t,e,i){var s;if(e===void 0&&(e=[]),i===void 0&&(i=null),t==null){var u;if((u=i)!=null&&u.errors)t=i.matches;else return null}let p=t,v=(s=i)==null?void 0:s.errors;if(v!=null){let a=p.findIndex(A=>A.route.id&&(v==null?void 0:v[A.route.id]));a>=0||oi(!1),p=p.slice(0,Math.min(p.length,a+1))}return p.reduceRight((a,A,O)=>{let B=A.route.id?v==null?void 0:v[A.route.id]:null,$=null;i&&($=A.route.errorElement||tG);let Y=e.concat(p.slice(0,O+1)),se=()=>{let me;return B?me=$:A.route.Component?me=Be.createElement(A.route.Component,null):A.route.element?me=A.route.element:me=a,Be.createElement(rG,{match:A,routeContext:{outlet:a,matches:Y,isDataRoute:i!=null},children:me})};return i&&(A.route.ErrorBoundary||A.route.errorElement||O===0)?Be.createElement(nG,{location:i.location,revalidation:i.revalidation,component:$,error:B,children:se(),routeContext:{outlet:null,matches:Y,isDataRoute:!0}}):se()},null)}var NN=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(NN||{}),ix=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(ix||{});function oG(t){let e=Be.useContext(GA);return e||oi(!1),e}function sG(t){let e=Be.useContext(Z7);return e||oi(!1),e}function aG(t){let e=Be.useContext(rc);return e||oi(!1),e}function FN(t){let e=aG(),i=e.matches[e.matches.length-1];return i.route.id||oi(!1),i.route.id}function lG(){var t;let e=Be.useContext(DN),i=sG(ix.UseRouteError),s=FN(ix.UseRouteError);return e||((t=i.errors)==null?void 0:t[s])}function cG(){let{router:t}=oG(NN.UseNavigateStable),e=FN(ix.UseNavigateStable),i=Be.useRef(!1);return LN(()=>{i.current=!0}),Be.useCallback(function(u,p){p===void 0&&(p={}),i.current&&(typeof u=="number"?t.navigate(u):t.navigate(u,rx({fromRouteId:e},p)))},[t,e])}function oD(t){let{to:e,replace:i,state:s,relative:u}=t;xp()||oi(!1);let{matches:p}=Be.useContext(rc),{pathname:v}=ly(),a=Qh(),A=$A(e,UA(p).map(B=>B.pathnameBase),v,u==="path"),O=JSON.stringify(A);return Be.useEffect(()=>a(JSON.parse(O),{replace:i,state:s,relative:u}),[a,O,u,i,s]),null}function ra(t){oi(!1)}function uG(t){let{basename:e="/",children:i=null,location:s,navigationType:u=Yc.Pop,navigator:p,static:v=!1}=t;xp()&&oi(!1);let a=e.replace(/^\/*/,"/"),A=Be.useMemo(()=>({basename:a,navigator:p,static:v}),[a,p,v]);typeof s=="string"&&(s=yp(s));let{pathname:O="/",search:B="",hash:$="",state:Y=null,key:se="default"}=s,me=Be.useMemo(()=>{let _e=VA(O,a);return _e==null?null:{location:{pathname:_e,search:B,hash:$,state:Y,key:se},navigationType:u}},[a,O,B,$,Y,se,u]);return me==null?null:Be.createElement(vp.Provider,{value:A},Be.createElement(tb.Provider,{children:i,value:me}))}function hG(t){let{children:e,location:i}=t;return J7(xS(e),i)}new Promise(()=>{});function xS(t,e){e===void 0&&(e=[]);let i=[];return Be.Children.forEach(t,(s,u)=>{if(!Be.isValidElement(s))return;let p=[...e,u];if(s.type===Be.Fragment){i.push.apply(i,xS(s.props.children,p));return}s.type!==ra&&oi(!1),!s.props.index||!s.props.children||oi(!1);let v={id:s.props.id||p.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(v.children=xS(s.props.children,p)),i.push(v)}),i}/**
 * React Router DOM v6.17.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bS(){return bS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},bS.apply(this,arguments)}function dG(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}function fG(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function pG(t,e){return t.button===0&&(!e||e==="_self")&&!fG(t)}const mG=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],gG="startTransition",sD=d$[gG];function _G(t){let{basename:e,children:i,future:s,window:u}=t,p=Be.useRef();p.current==null&&(p.current=T7({window:u,v5Compat:!0}));let v=p.current,[a,A]=Be.useState({action:v.action,location:v.location}),{v7_startTransition:O}=s||{},B=Be.useCallback($=>{O&&sD?sD(()=>A($)):A($)},[A,O]);return Be.useLayoutEffect(()=>v.listen(B),[v,B]),Be.createElement(uG,{basename:e,children:i,location:a.location,navigationType:a.action,navigator:v})}const yG=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",vG=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,zl=Be.forwardRef(function(e,i){let{onClick:s,relative:u,reloadDocument:p,replace:v,state:a,target:A,to:O,preventScrollReset:B,unstable_viewTransition:$}=e,Y=dG(e,mG),{basename:se}=Be.useContext(vp),me,_e=!1;if(typeof O=="string"&&vG.test(O)&&(me=O,yG))try{let fe=new URL(window.location.href),Ce=O.startsWith("//")?new URL(fe.protocol+O):new URL(O),Ge=VA(Ce.pathname,se);Ce.origin===fe.origin&&Ge!=null?O=Ge+Ce.search+Ce.hash:_e=!0}catch{}let Ee=X7(O,{relative:u}),ae=xG(O,{replace:v,state:a,target:A,preventScrollReset:B,relative:u,unstable_viewTransition:$});function le(fe){s&&s(fe),fe.defaultPrevented||ae(fe)}return Be.createElement("a",bS({},Y,{href:me||Ee,onClick:_e||p?s:le,ref:i,target:A}))});var aD;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(aD||(aD={}));var lD;(function(t){t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(lD||(lD={}));function xG(t,e){let{target:i,replace:s,state:u,preventScrollReset:p,relative:v,unstable_viewTransition:a}=e===void 0?{}:e,A=Qh(),O=ly(),B=zN(t,{relative:v});return Be.useCallback($=>{if(pG($,i)){$.preventDefault();let Y=s!==void 0?s:nx(O)===nx(B);A(t,{replace:Y,state:u,preventScrollReset:p,relative:v,unstable_viewTransition:a})}},[O,A,B,s,u,i,t,p,v,a])}const bG=()=>{const{user:t}=Be.useContext(ku);return t?We.jsxs("div",{id:"room-btns",children:[We.jsx(zl,{to:"/createroom",children:We.jsx("button",{className:"red",children:"Create Room"})}),We.jsx(zl,{to:"/joinroom",children:We.jsx("button",{className:"red",children:"Join Room"})})]}):We.jsxs("div",{id:"login",children:[We.jsx(zl,{to:"/login",children:We.jsx("button",{className:"red",children:"Login"})}),We.jsx(zl,{to:"/register",children:We.jsx("button",{className:"red",children:"Signup"})})]})};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BN=function(t){const e=[];let i=0;for(let s=0;s<t.length;s++){let u=t.charCodeAt(s);u<128?e[i++]=u:u<2048?(e[i++]=u>>6|192,e[i++]=u&63|128):(u&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(u=65536+((u&1023)<<10)+(t.charCodeAt(++s)&1023),e[i++]=u>>18|240,e[i++]=u>>12&63|128,e[i++]=u>>6&63|128,e[i++]=u&63|128):(e[i++]=u>>12|224,e[i++]=u>>6&63|128,e[i++]=u&63|128)}return e},wG=function(t){const e=[];let i=0,s=0;for(;i<t.length;){const u=t[i++];if(u<128)e[s++]=String.fromCharCode(u);else if(u>191&&u<224){const p=t[i++];e[s++]=String.fromCharCode((u&31)<<6|p&63)}else if(u>239&&u<365){const p=t[i++],v=t[i++],a=t[i++],A=((u&7)<<18|(p&63)<<12|(v&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(A>>10)),e[s++]=String.fromCharCode(56320+(A&1023))}else{const p=t[i++],v=t[i++];e[s++]=String.fromCharCode((u&15)<<12|(p&63)<<6|v&63)}}return e.join("")},jN={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let u=0;u<t.length;u+=3){const p=t[u],v=u+1<t.length,a=v?t[u+1]:0,A=u+2<t.length,O=A?t[u+2]:0,B=p>>2,$=(p&3)<<4|a>>4;let Y=(a&15)<<2|O>>6,se=O&63;A||(se=64,v||(Y=64)),s.push(i[B],i[$],i[Y],i[se])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(BN(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):wG(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let u=0;u<t.length;){const p=i[t.charAt(u++)],a=u<t.length?i[t.charAt(u)]:0;++u;const O=u<t.length?i[t.charAt(u)]:64;++u;const $=u<t.length?i[t.charAt(u)]:64;if(++u,p==null||a==null||O==null||$==null)throw new TG;const Y=p<<2|a>>4;if(s.push(Y),O!==64){const se=a<<4&240|O>>2;if(s.push(se),$!==64){const me=O<<6&192|$;s.push(me)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class TG extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const EG=function(t){const e=BN(t);return jN.encodeByteArray(e,!0)},ox=function(t){return EG(t).replace(/\./g,"")},VN=function(t){try{return jN.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SG(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IG=()=>SG().__FIREBASE_DEFAULTS__,AG=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},PG=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&VN(t[1]);return e&&JSON.parse(e)},WA=()=>{try{return IG()||AG()||PG()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},UN=t=>{var e,i;return(i=(e=WA())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[t]},kG=t=>{const e=UN(t);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),s]:[e.substring(0,i),s]},$N=()=>{var t;return(t=WA())===null||t===void 0?void 0:t.config},GN=t=>{var e;return(e=WA())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CG{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,s)=>{i?this.reject(i):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MG(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},s=e||"demo-project",u=t.iat||0,p=t.sub||t.user_id;if(!p)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const v=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:u,exp:u+3600,auth_time:u,sub:p,user_id:p,firebase:{sign_in_provider:"custom",identities:{}}},t),a="";return[ox(JSON.stringify(i)),ox(JSON.stringify(v)),a].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function po(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function RG(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(po())}function OG(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function DG(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function LG(){const t=po();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function zG(){try{return typeof indexedDB=="object"}catch{return!1}}function NG(){return new Promise((t,e)=>{try{let i=!0;const s="validate-browser-context-for-indexeddb-analytics-module",u=self.indexedDB.open(s);u.onsuccess=()=>{u.result.close(),i||self.indexedDB.deleteDatabase(s),t(!0)},u.onupgradeneeded=()=>{i=!1},u.onerror=()=>{var p;e(((p=u.error)===null||p===void 0?void 0:p.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FG="FirebaseError";class ic extends Error{constructor(e,i,s){super(i),this.code=e,this.customData=s,this.name=FG,Object.setPrototypeOf(this,ic.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,cy.prototype.create)}}class cy{constructor(e,i,s){this.service=e,this.serviceName=i,this.errors=s}create(e,...i){const s=i[0]||{},u=`${this.service}/${e}`,p=this.errors[e],v=p?BG(p,s):"Error",a=`${this.serviceName}: ${v} (${u}).`;return new ic(u,a,s)}}function BG(t,e){return t.replace(jG,(i,s)=>{const u=e[s];return u!=null?String(u):`<${s}?>`})}const jG=/\{\$([^}]+)}/g;function VG(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function sx(t,e){if(t===e)return!0;const i=Object.keys(t),s=Object.keys(e);for(const u of i){if(!s.includes(u))return!1;const p=t[u],v=e[u];if(cD(p)&&cD(v)){if(!sx(p,v))return!1}else if(p!==v)return!1}for(const u of s)if(!i.includes(u))return!1;return!0}function cD(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uy(t){const e=[];for(const[i,s]of Object.entries(t))Array.isArray(s)?s.forEach(u=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(u))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function Mg(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[u,p]=s.split("=");e[decodeURIComponent(u)]=decodeURIComponent(p)}}),e}function Rg(t){const e=t.indexOf("?");if(!e)return"";const i=t.indexOf("#",e);return t.substring(e,i>0?i:void 0)}function UG(t,e){const i=new $G(t,e);return i.subscribe.bind(i)}class $G{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,s){let u;if(e===void 0&&i===void 0&&s===void 0)throw new Error("Missing Observer.");GG(e,["next","error","complete"])?u=e:u={next:e,error:i,complete:s},u.next===void 0&&(u.next=ZT),u.error===void 0&&(u.error=ZT),u.complete===void 0&&(u.complete=ZT);const p=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?u.error(this.finalError):u.complete()}catch{}}),this.observers.push(u),p}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function GG(t,e){if(typeof t!="object"||t===null)return!1;for(const i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}function ZT(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ii(t){return t&&t._delegate?t._delegate:t}class Vh{constructor(e,i,s){this.name=e,this.instanceFactory=i,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bh="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WG{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const s=new CG;if(this.instancesDeferred.set(i,s),this.isInitialized(i)||this.shouldAutoInitialize())try{const u=this.getOrInitializeService({instanceIdentifier:i});u&&s.resolve(u)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),u=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(p){if(u)return null;throw p}else{if(u)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(HG(e))try{this.getOrInitializeService({instanceIdentifier:bh})}catch{}for(const[i,s]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(i);try{const p=this.getOrInitializeService({instanceIdentifier:u});s.resolve(p)}catch{}}}}clearInstance(e=bh){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=bh){return this.instances.has(e)}getOptions(e=bh){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const u=this.getOrInitializeService({instanceIdentifier:s,options:i});for(const[p,v]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(p);s===a&&v.resolve(u)}return u}onInit(e,i){var s;const u=this.normalizeInstanceIdentifier(i),p=(s=this.onInitCallbacks.get(u))!==null&&s!==void 0?s:new Set;p.add(e),this.onInitCallbacks.set(u,p);const v=this.instances.get(u);return v&&e(v,u),()=>{p.delete(e)}}invokeOnInitCallbacks(e,i){const s=this.onInitCallbacks.get(i);if(s)for(const u of s)try{u(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:qG(e),options:i}),this.instances.set(e,s),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=bh){return this.component?this.component.multipleInstances?e:bh:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function qG(t){return t===bh?void 0:t}function HG(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZG{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new WG(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qn;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(qn||(qn={}));const XG={debug:qn.DEBUG,verbose:qn.VERBOSE,info:qn.INFO,warn:qn.WARN,error:qn.ERROR,silent:qn.SILENT},YG=qn.INFO,KG={[qn.DEBUG]:"log",[qn.VERBOSE]:"log",[qn.INFO]:"info",[qn.WARN]:"warn",[qn.ERROR]:"error"},JG=(t,e,...i)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),u=KG[e];if(u)console[u](`[${s}]  ${t.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class qA{constructor(e){this.name=e,this._logLevel=YG,this._logHandler=JG,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in qn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?XG[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,qn.DEBUG,...e),this._logHandler(this,qn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,qn.VERBOSE,...e),this._logHandler(this,qn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,qn.INFO,...e),this._logHandler(this,qn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,qn.WARN,...e),this._logHandler(this,qn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,qn.ERROR,...e),this._logHandler(this,qn.ERROR,...e)}}const QG=(t,e)=>e.some(i=>t instanceof i);let uD,hD;function eW(){return uD||(uD=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tW(){return hD||(hD=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const WN=new WeakMap,wS=new WeakMap,qN=new WeakMap,XT=new WeakMap,HA=new WeakMap;function nW(t){const e=new Promise((i,s)=>{const u=()=>{t.removeEventListener("success",p),t.removeEventListener("error",v)},p=()=>{i(uu(t.result)),u()},v=()=>{s(t.error),u()};t.addEventListener("success",p),t.addEventListener("error",v)});return e.then(i=>{i instanceof IDBCursor&&WN.set(i,t)}).catch(()=>{}),HA.set(e,t),e}function rW(t){if(wS.has(t))return;const e=new Promise((i,s)=>{const u=()=>{t.removeEventListener("complete",p),t.removeEventListener("error",v),t.removeEventListener("abort",v)},p=()=>{i(),u()},v=()=>{s(t.error||new DOMException("AbortError","AbortError")),u()};t.addEventListener("complete",p),t.addEventListener("error",v),t.addEventListener("abort",v)});wS.set(t,e)}let TS={get(t,e,i){if(t instanceof IDBTransaction){if(e==="done")return wS.get(t);if(e==="objectStoreNames")return t.objectStoreNames||qN.get(t);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return uu(t[e])},set(t,e,i){return t[e]=i,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function iW(t){TS=t(TS)}function oW(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const s=t.call(YT(this),e,...i);return qN.set(s,e.sort?e.sort():[e]),uu(s)}:tW().includes(t)?function(...e){return t.apply(YT(this),e),uu(WN.get(this))}:function(...e){return uu(t.apply(YT(this),e))}}function sW(t){return typeof t=="function"?oW(t):(t instanceof IDBTransaction&&rW(t),QG(t,eW())?new Proxy(t,TS):t)}function uu(t){if(t instanceof IDBRequest)return nW(t);if(XT.has(t))return XT.get(t);const e=sW(t);return e!==t&&(XT.set(t,e),HA.set(e,t)),e}const YT=t=>HA.get(t);function aW(t,e,{blocked:i,upgrade:s,blocking:u,terminated:p}={}){const v=indexedDB.open(t,e),a=uu(v);return s&&v.addEventListener("upgradeneeded",A=>{s(uu(v.result),A.oldVersion,A.newVersion,uu(v.transaction),A)}),i&&v.addEventListener("blocked",A=>i(A.oldVersion,A.newVersion,A)),a.then(A=>{p&&A.addEventListener("close",()=>p()),u&&A.addEventListener("versionchange",O=>u(O.oldVersion,O.newVersion,O))}).catch(()=>{}),a}const lW=["get","getKey","getAll","getAllKeys","count"],cW=["put","add","delete","clear"],KT=new Map;function dD(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(KT.get(e))return KT.get(e);const i=e.replace(/FromIndex$/,""),s=e!==i,u=cW.includes(i);if(!(i in(s?IDBIndex:IDBObjectStore).prototype)||!(u||lW.includes(i)))return;const p=async function(v,...a){const A=this.transaction(v,u?"readwrite":"readonly");let O=A.store;return s&&(O=O.index(a.shift())),(await Promise.all([O[i](...a),u&&A.done]))[0]};return KT.set(e,p),p}iW(t=>({...t,get:(e,i,s)=>dD(e,i)||t.get(e,i,s),has:(e,i)=>!!dD(e,i)||t.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uW{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(hW(i)){const s=i.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(i=>i).join(" ")}}function hW(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ES="@firebase/app",fD="0.9.20";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uh=new qA("@firebase/app"),dW="@firebase/app-compat",fW="@firebase/analytics-compat",pW="@firebase/analytics",mW="@firebase/app-check-compat",gW="@firebase/app-check",_W="@firebase/auth",yW="@firebase/auth-compat",vW="@firebase/database",xW="@firebase/database-compat",bW="@firebase/functions",wW="@firebase/functions-compat",TW="@firebase/installations",EW="@firebase/installations-compat",SW="@firebase/messaging",IW="@firebase/messaging-compat",AW="@firebase/performance",PW="@firebase/performance-compat",kW="@firebase/remote-config",CW="@firebase/remote-config-compat",MW="@firebase/storage",RW="@firebase/storage-compat",OW="@firebase/firestore",DW="@firebase/firestore-compat",LW="firebase",zW="10.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SS="[DEFAULT]",NW={[ES]:"fire-core",[dW]:"fire-core-compat",[pW]:"fire-analytics",[fW]:"fire-analytics-compat",[gW]:"fire-app-check",[mW]:"fire-app-check-compat",[_W]:"fire-auth",[yW]:"fire-auth-compat",[vW]:"fire-rtdb",[xW]:"fire-rtdb-compat",[bW]:"fire-fn",[wW]:"fire-fn-compat",[TW]:"fire-iid",[EW]:"fire-iid-compat",[SW]:"fire-fcm",[IW]:"fire-fcm-compat",[AW]:"fire-perf",[PW]:"fire-perf-compat",[kW]:"fire-rc",[CW]:"fire-rc-compat",[MW]:"fire-gcs",[RW]:"fire-gcs-compat",[OW]:"fire-fst",[DW]:"fire-fst-compat","fire-js":"fire-js",[LW]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ax=new Map,IS=new Map;function FW(t,e){try{t.container.addComponent(e)}catch(i){Uh.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,i)}}function Jf(t){const e=t.name;if(IS.has(e))return Uh.debug(`There were multiple attempts to register component ${e}.`),!1;IS.set(e,t);for(const i of ax.values())FW(i,t);return!0}function ZA(t,e){const i=t.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BW={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},hu=new cy("app","Firebase",BW);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jW{constructor(e,i,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Vh("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw hu.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bp=zW;function HN(t,e={}){let i=t;typeof e!="object"&&(e={name:e});const s=Object.assign({name:SS,automaticDataCollectionEnabled:!1},e),u=s.name;if(typeof u!="string"||!u)throw hu.create("bad-app-name",{appName:String(u)});if(i||(i=$N()),!i)throw hu.create("no-options");const p=ax.get(u);if(p){if(sx(i,p.options)&&sx(s,p.config))return p;throw hu.create("duplicate-app",{appName:u})}const v=new ZG(u);for(const A of IS.values())v.addComponent(A);const a=new jW(i,s,v);return ax.set(u,a),a}function ZN(t=SS){const e=ax.get(t);if(!e&&t===SS&&$N())return HN();if(!e)throw hu.create("no-app",{appName:t});return e}function du(t,e,i){var s;let u=(s=NW[t])!==null&&s!==void 0?s:t;i&&(u+=`-${i}`);const p=u.match(/\s|\//),v=e.match(/\s|\//);if(p||v){const a=[`Unable to register library "${u}" with version "${e}":`];p&&a.push(`library name "${u}" contains illegal characters (whitespace or "/")`),p&&v&&a.push("and"),v&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Uh.warn(a.join(" "));return}Jf(new Vh(`${u}-version`,()=>({library:u,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VW="firebase-heartbeat-database",UW=1,T_="firebase-heartbeat-store";let JT=null;function XN(){return JT||(JT=aW(VW,UW,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(T_)}}}).catch(t=>{throw hu.create("idb-open",{originalErrorMessage:t.message})})),JT}async function $W(t){try{return await(await XN()).transaction(T_).objectStore(T_).get(YN(t))}catch(e){if(e instanceof ic)Uh.warn(e.message);else{const i=hu.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Uh.warn(i.message)}}}async function pD(t,e){try{const s=(await XN()).transaction(T_,"readwrite");await s.objectStore(T_).put(e,YN(t)),await s.done}catch(i){if(i instanceof ic)Uh.warn(i.message);else{const s=hu.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});Uh.warn(s.message)}}}function YN(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GW=1024,WW=30*24*60*60*1e3;class qW{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new ZW(i),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=mD();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(u=>u.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(u=>{const p=new Date(u.date).valueOf();return Date.now()-p<=WW}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=mD(),{heartbeatsToSend:i,unsentEntries:s}=HW(this._heartbeatsCache.heartbeats),u=ox(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}}function mD(){return new Date().toISOString().substring(0,10)}function HW(t,e=GW){const i=[];let s=t.slice();for(const u of t){const p=i.find(v=>v.agent===u.agent);if(p){if(p.dates.push(u.date),gD(i)>e){p.dates.pop();break}}else if(i.push({agent:u.agent,dates:[u.date]}),gD(i)>e){i.pop();break}s=s.slice(1)}return{heartbeatsToSend:i,unsentEntries:s}}class ZW{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return zG()?NG().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await $W(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const u=await this.read();return pD(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:u.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const u=await this.read();return pD(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:u.lastSentHeartbeatDate,heartbeats:[...u.heartbeats,...e.heartbeats]})}else return}}function gD(t){return ox(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XW(t){Jf(new Vh("platform-logger",e=>new uW(e),"PRIVATE")),Jf(new Vh("heartbeat",e=>new qW(e),"PRIVATE")),du(ES,fD,t),du(ES,fD,"esm2017"),du("fire-js","")}XW("");var YW="firebase",KW="10.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */du(YW,KW,"app");function XA(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,s=Object.getOwnPropertySymbols(t);u<s.length;u++)e.indexOf(s[u])<0&&Object.prototype.propertyIsEnumerable.call(t,s[u])&&(i[s[u]]=t[s[u]]);return i}function _D(t){return t!==void 0&&t.enterprise!==void 0}class JW{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(i=>i.provider==="EMAIL_PASSWORD_PROVIDER"&&i.enforcementState!=="OFF")}}function KN(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const QW=KN,JN=new cy("auth","Firebase",KN());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lx=new qA("@firebase/auth");function eq(t,...e){lx.logLevel<=qn.WARN&&lx.warn(`Auth (${bp}): ${t}`,...e)}function x1(t,...e){lx.logLevel<=qn.ERROR&&lx.error(`Auth (${bp}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bs(t,...e){throw YA(t,...e)}function Za(t,...e){return YA(t,...e)}function QN(t,e,i){const s=Object.assign(Object.assign({},QW()),{[e]:i});return new cy("auth","Firebase",s).create(e,{appName:t.name})}function tq(t,e,i){const s=i;if(!(e instanceof s))throw s.name!==e.constructor.name&&Bs(t,"argument-error"),QN(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function YA(t,...e){if(typeof t!="string"){const i=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(i,...s)}return JN.create(t,...e)}function fn(t,e,...i){if(!t)throw YA(e,...i)}function Nl(t){const e="INTERNAL ASSERTION FAILED: "+t;throw x1(e),new Error(e)}function Zl(t,e){t||Nl(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AS(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function nq(){return yD()==="http:"||yD()==="https:"}function yD(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rq(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(nq()||OG()||"connection"in navigator)?navigator.onLine:!0}function iq(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(e,i){this.shortDelay=e,this.longDelay=i,Zl(i>e,"Short delay should be less than long delay!"),this.isMobile=RG()||DG()}get(){return rq()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KA(t,e){Zl(t.emulator,"Emulator should always be set here");const{url:i}=t.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e5{static initialize(e,i,s){this.fetchImpl=e,i&&(this.headersImpl=i),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;Nl("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;Nl("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;Nl("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oq={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sq=new hy(3e4,6e4);function Eu(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function oc(t,e,i,s,u={}){return t5(t,u,async()=>{let p={},v={};s&&(e==="GET"?v=s:p={body:JSON.stringify(s)});const a=uy(Object.assign({key:t.config.apiKey},v)).slice(1),A=await t._getAdditionalHeaders();return A["Content-Type"]="application/json",t.languageCode&&(A["X-Firebase-Locale"]=t.languageCode),e5.fetch()(n5(t,t.config.apiHost,i,a),Object.assign({method:e,headers:A,referrerPolicy:"no-referrer"},p))})}async function t5(t,e,i){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},oq),e);try{const u=new aq(t),p=await Promise.race([i(),u.promise]);u.clearNetworkTimeout();const v=await p.json();if("needConfirmation"in v)throw qv(t,"account-exists-with-different-credential",v);if(p.ok&&!("errorMessage"in v))return v;{const a=p.ok?v.errorMessage:v.error.message,[A,O]=a.split(" : ");if(A==="FEDERATED_USER_ID_ALREADY_LINKED")throw qv(t,"credential-already-in-use",v);if(A==="EMAIL_EXISTS")throw qv(t,"email-already-in-use",v);if(A==="USER_DISABLED")throw qv(t,"user-disabled",v);const B=s[A]||A.toLowerCase().replace(/[_\s]+/g,"-");if(O)throw QN(t,B,O);Bs(t,B)}}catch(u){if(u instanceof ic)throw u;Bs(t,"network-request-failed",{message:String(u)})}}async function dy(t,e,i,s,u={}){const p=await oc(t,e,i,s,u);return"mfaPendingCredential"in p&&Bs(t,"multi-factor-auth-required",{_serverResponse:p}),p}function n5(t,e,i,s){const u=`${e}${i}?${s}`;return t.config.emulator?KA(t.config,u):`${t.config.apiScheme}://${u}`}class aq{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,s)=>{this.timer=setTimeout(()=>s(Za(this.auth,"network-request-failed")),sq.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function qv(t,e,i){const s={appName:t.name};i.email&&(s.email=i.email),i.phoneNumber&&(s.phoneNumber=i.phoneNumber);const u=Za(t,e,s);return u.customData._tokenResponse=i,u}async function lq(t,e){return oc(t,"GET","/v2/recaptchaConfig",Eu(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cq(t,e){return oc(t,"POST","/v1/accounts:delete",e)}async function uq(t,e){return oc(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yg(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function hq(t,e=!1){const i=Ii(t),s=await i.getIdToken(e),u=JA(s);fn(u&&u.exp&&u.auth_time&&u.iat,i.auth,"internal-error");const p=typeof u.firebase=="object"?u.firebase:void 0,v=p==null?void 0:p.sign_in_provider;return{claims:u,token:s,authTime:Yg(QT(u.auth_time)),issuedAtTime:Yg(QT(u.iat)),expirationTime:Yg(QT(u.exp)),signInProvider:v||null,signInSecondFactor:(p==null?void 0:p.sign_in_second_factor)||null}}function QT(t){return Number(t)*1e3}function JA(t){const[e,i,s]=t.split(".");if(e===void 0||i===void 0||s===void 0)return x1("JWT malformed, contained fewer than 3 sections"),null;try{const u=VN(i);return u?JSON.parse(u):(x1("Failed to decode base64 JWT payload"),null)}catch(u){return x1("Caught error parsing JWT payload as JSON",u==null?void 0:u.toString()),null}}function dq(t){const e=JA(t);return fn(e,"internal-error"),fn(typeof e.exp<"u","internal-error"),fn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $h(t,e,i=!1){if(i)return e;try{return await e}catch(s){throw s instanceof ic&&fq(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function fq({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pq{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const u=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,u)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r5{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=Yg(this.lastLoginAt),this.creationTime=Yg(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cx(t){var e;const i=t.auth,s=await t.getIdToken(),u=await $h(t,uq(i,{idToken:s}));fn(u==null?void 0:u.users.length,i,"internal-error");const p=u.users[0];t._notifyReloadListener(p);const v=!((e=p.providerUserInfo)===null||e===void 0)&&e.length?_q(p.providerUserInfo):[],a=gq(t.providerData,v),A=t.isAnonymous,O=!(t.email&&p.passwordHash)&&!(a!=null&&a.length),B=A?O:!1,$={uid:p.localId,displayName:p.displayName||null,photoURL:p.photoUrl||null,email:p.email||null,emailVerified:p.emailVerified||!1,phoneNumber:p.phoneNumber||null,tenantId:p.tenantId||null,providerData:a,metadata:new r5(p.createdAt,p.lastLoginAt),isAnonymous:B};Object.assign(t,$)}async function mq(t){const e=Ii(t);await cx(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function gq(t,e){return[...t.filter(s=>!e.some(u=>u.providerId===s.providerId)),...e]}function _q(t){return t.map(e=>{var{providerId:i}=e,s=XA(e,["providerId"]);return{providerId:i,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yq(t,e){const i=await t5(t,{},async()=>{const s=uy({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:u,apiKey:p}=t.config,v=n5(t,u,"/v1/token",`key=${p}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",e5.fetch()(v,{method:"POST",headers:a,body:s})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E_{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){fn(e.idToken,"internal-error"),fn(typeof e.idToken<"u","internal-error"),fn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):dq(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}async getToken(e,i=!1){return fn(!this.accessToken||this.refreshToken,e,"user-token-expired"),!i&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:s,refreshToken:u,expiresIn:p}=await yq(e,i);this.updateTokensAndExpiration(s,u,Number(p))}updateTokensAndExpiration(e,i,s){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,i){const{refreshToken:s,accessToken:u,expirationTime:p}=i,v=new E_;return s&&(fn(typeof s=="string","internal-error",{appName:e}),v.refreshToken=s),u&&(fn(typeof u=="string","internal-error",{appName:e}),v.accessToken=u),p&&(fn(typeof p=="number","internal-error",{appName:e}),v.expirationTime=p),v}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new E_,this.toJSON())}_performRefresh(){return Nl("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jc(t,e){fn(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Oh{constructor(e){var{uid:i,auth:s,stsTokenManager:u}=e,p=XA(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new pq(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=s,this.stsTokenManager=u,this.accessToken=u.accessToken,this.displayName=p.displayName||null,this.email=p.email||null,this.emailVerified=p.emailVerified||!1,this.phoneNumber=p.phoneNumber||null,this.photoURL=p.photoURL||null,this.isAnonymous=p.isAnonymous||!1,this.tenantId=p.tenantId||null,this.providerData=p.providerData?[...p.providerData]:[],this.metadata=new r5(p.createdAt||void 0,p.lastLoginAt||void 0)}async getIdToken(e){const i=await $h(this,this.stsTokenManager.getToken(this.auth,e));return fn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return hq(this,e)}reload(){return mq(this)}_assign(e){this!==e&&(fn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new Oh(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){fn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),i&&await cx(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await $h(this,cq(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var s,u,p,v,a,A,O,B;const $=(s=i.displayName)!==null&&s!==void 0?s:void 0,Y=(u=i.email)!==null&&u!==void 0?u:void 0,se=(p=i.phoneNumber)!==null&&p!==void 0?p:void 0,me=(v=i.photoURL)!==null&&v!==void 0?v:void 0,_e=(a=i.tenantId)!==null&&a!==void 0?a:void 0,Ee=(A=i._redirectEventId)!==null&&A!==void 0?A:void 0,ae=(O=i.createdAt)!==null&&O!==void 0?O:void 0,le=(B=i.lastLoginAt)!==null&&B!==void 0?B:void 0,{uid:fe,emailVerified:Ce,isAnonymous:Ge,providerData:gt,stsTokenManager:It}=i;fn(fe&&It,e,"internal-error");const Tt=E_.fromJSON(this.name,It);fn(typeof fe=="string",e,"internal-error"),jc($,e.name),jc(Y,e.name),fn(typeof Ce=="boolean",e,"internal-error"),fn(typeof Ge=="boolean",e,"internal-error"),jc(se,e.name),jc(me,e.name),jc(_e,e.name),jc(Ee,e.name),jc(ae,e.name),jc(le,e.name);const Oe=new Oh({uid:fe,auth:e,email:Y,emailVerified:Ce,displayName:$,isAnonymous:Ge,photoURL:me,phoneNumber:se,tenantId:_e,stsTokenManager:Tt,createdAt:ae,lastLoginAt:le});return gt&&Array.isArray(gt)&&(Oe.providerData=gt.map(Yt=>Object.assign({},Yt))),Ee&&(Oe._redirectEventId=Ee),Oe}static async _fromIdTokenResponse(e,i,s=!1){const u=new E_;u.updateFromServerResponse(i);const p=new Oh({uid:i.localId,auth:e,stsTokenManager:u,isAnonymous:s});return await cx(p),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vD=new Map;function Fl(t){Zl(t instanceof Function,"Expected a class definition");let e=vD.get(t);return e?(Zl(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,vD.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i5{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}i5.type="NONE";const xD=i5;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b1(t,e,i){return`firebase:${t}:${e}:${i}`}class Bf{constructor(e,i,s){this.persistence=e,this.auth=i,this.userKey=s;const{config:u,name:p}=this.auth;this.fullUserKey=b1(this.userKey,u.apiKey,p),this.fullPersistenceKey=b1("persistence",u.apiKey,p),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Oh._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,s="authUser"){if(!i.length)return new Bf(Fl(xD),e,s);const u=(await Promise.all(i.map(async O=>{if(await O._isAvailable())return O}))).filter(O=>O);let p=u[0]||Fl(xD);const v=b1(s,e.config.apiKey,e.name);let a=null;for(const O of i)try{const B=await O._get(v);if(B){const $=Oh._fromJSON(e,B);O!==p&&(a=$),p=O;break}}catch{}const A=u.filter(O=>O._shouldAllowMigration);return!p._shouldAllowMigration||!A.length?new Bf(p,e,s):(p=A[0],a&&await p._set(v,a.toJSON()),await Promise.all(i.map(async O=>{if(O!==p)try{await O._remove(v)}catch{}})),new Bf(p,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bD(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(a5(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(o5(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(c5(e))return"Blackberry";if(u5(e))return"Webos";if(QA(e))return"Safari";if((e.includes("chrome/")||s5(e))&&!e.includes("edge/"))return"Chrome";if(l5(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(i);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function o5(t=po()){return/firefox\//i.test(t)}function QA(t=po()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function s5(t=po()){return/crios\//i.test(t)}function a5(t=po()){return/iemobile/i.test(t)}function l5(t=po()){return/android/i.test(t)}function c5(t=po()){return/blackberry/i.test(t)}function u5(t=po()){return/webos/i.test(t)}function nb(t=po()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function vq(t=po()){var e;return nb(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function xq(){return LG()&&document.documentMode===10}function h5(t=po()){return nb(t)||l5(t)||u5(t)||c5(t)||/windows phone/i.test(t)||a5(t)}function bq(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d5(t,e=[]){let i;switch(t){case"Browser":i=bD(po());break;case"Worker":i=`${bD(po())}-${t}`;break;default:i=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${bp}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wq{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const s=p=>new Promise((v,a)=>{try{const A=e(p);v(A)}catch(A){a(A)}});s.onAbort=i,this.queue.push(s);const u=this.queue.length-1;return()=>{this.queue[u]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const s of this.queue)await s(e),s.onAbort&&i.push(s.onAbort)}catch(s){i.reverse();for(const u of i)try{u()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tq(t,e={}){return oc(t,"GET","/v2/passwordPolicy",Eu(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eq=6;class Sq{constructor(e){var i,s,u,p;const v=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=v.minPasswordLength)!==null&&i!==void 0?i:Eq,v.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=v.maxPasswordLength),v.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=v.containsLowercaseCharacter),v.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=v.containsUppercaseCharacter),v.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=v.containsNumericCharacter),v.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=v.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(u=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&u!==void 0?u:"",this.forceUpgradeOnSignin=(p=e.forceUpgradeOnSignin)!==null&&p!==void 0?p:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,s,u,p,v,a;const A={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,A),this.validatePasswordCharacterOptions(e,A),A.isValid&&(A.isValid=(i=A.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),A.isValid&&(A.isValid=(s=A.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),A.isValid&&(A.isValid=(u=A.containsLowercaseLetter)!==null&&u!==void 0?u:!0),A.isValid&&(A.isValid=(p=A.containsUppercaseLetter)!==null&&p!==void 0?p:!0),A.isValid&&(A.isValid=(v=A.containsNumericCharacter)!==null&&v!==void 0?v:!0),A.isValid&&(A.isValid=(a=A.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),A}validatePasswordLengthOptions(e,i){const s=this.customStrengthOptions.minPasswordLength,u=this.customStrengthOptions.maxPasswordLength;s&&(i.meetsMinPasswordLength=e.length>=s),u&&(i.meetsMaxPasswordLength=e.length<=u)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let s;for(let u=0;u<e.length;u++)s=e.charAt(u),this.updatePasswordCharacterOptionsStatuses(i,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,i,s,u,p){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=u)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iq{constructor(e,i,s,u){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=s,this.config=u,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new wD(this),this.idTokenSubscription=new wD(this),this.beforeStateQueue=new wq(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=JN,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=u.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Fl(i)),this._initializationPromise=this.queue(async()=>{var s,u;if(!this._deleted&&(this.persistenceManager=await Bf.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((u=this.currentUser)===null||u===void 0?void 0:u.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var i;const s=await this.assertedPersistence.getCurrentUser();let u=s,p=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const v=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,a=u==null?void 0:u._redirectEventId,A=await this.tryRedirectSignIn(e);(!v||v===a)&&(A!=null&&A.user)&&(u=A.user,p=!0)}if(!u)return this.directlySetCurrentUser(null);if(!u._redirectEventId){if(p)try{await this.beforeStateQueue.runMiddleware(u)}catch(v){u=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(v))}return u?this.reloadAndSetCurrentUserOrClear(u):this.directlySetCurrentUser(null)}return fn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===u._redirectEventId?this.directlySetCurrentUser(u):this.reloadAndSetCurrentUserOrClear(u)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await cx(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=iq()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const i=e?Ii(e):null;return i&&fn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&fn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Fl(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Tq(this),i=new Sq(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new cy("auth","Firebase",e())}onAuthStateChanged(e,i,s){return this.registerStateListener(this.authStateSubscription,e,i,s)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,s){return this.registerStateListener(this.idTokenSubscription,e,i,s)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},i)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const s=await this.getOrInitRedirectPersistenceManager(i);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Fl(e)||this._popupRedirectResolver;fn(i,this,"argument-error"),this.redirectPersistenceManager=await Bf.create(this,[Fl(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,s;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,s,u){if(this._deleted)return()=>{};const p=typeof i=="function"?i:i.next.bind(i);let v=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(fn(a,this,"internal-error"),a.then(()=>{v||p(this.currentUser)}),typeof i=="function"){const A=e.addObserver(i,s,u);return()=>{v=!0,A()}}else{const A=e.addObserver(i);return()=>{v=!0,A()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return fn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=d5(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(i["X-Firebase-Client"]=s);const u=await this._getAppCheckToken();return u&&(i["X-Firebase-AppCheck"]=u),i}async _getAppCheckToken(){var e;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&eq(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function sc(t){return Ii(t)}class wD{constructor(e){this.auth=e,this.observer=null,this.addObserver=UG(i=>this.observer=i)}get next(){return fn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aq(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}function f5(t){return new Promise((e,i)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=u=>{const p=Za("internal-error");p.customData=u,i(p)},s.type="text/javascript",s.charset="UTF-8",Aq().appendChild(s)})}function Pq(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const kq="https://www.google.com/recaptcha/enterprise.js?render=",Cq="recaptcha-enterprise",Mq="NO_RECAPTCHA";class Rq{constructor(e){this.type=Cq,this.auth=sc(e)}async verify(e="verify",i=!1){async function s(p){if(!i){if(p.tenantId==null&&p._agentRecaptchaConfig!=null)return p._agentRecaptchaConfig.siteKey;if(p.tenantId!=null&&p._tenantRecaptchaConfigs[p.tenantId]!==void 0)return p._tenantRecaptchaConfigs[p.tenantId].siteKey}return new Promise(async(v,a)=>{lq(p,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(A=>{if(A.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const O=new JW(A);return p.tenantId==null?p._agentRecaptchaConfig=O:p._tenantRecaptchaConfigs[p.tenantId]=O,v(O.siteKey)}}).catch(A=>{a(A)})})}function u(p,v,a){const A=window.grecaptcha;_D(A)?A.enterprise.ready(()=>{A.enterprise.execute(p,{action:e}).then(O=>{v(O)}).catch(()=>{v(Mq)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((p,v)=>{s(this.auth).then(a=>{if(!i&&_D(window.grecaptcha))u(a,p,v);else{if(typeof window>"u"){v(new Error("RecaptchaVerifier is only supported in browser"));return}f5(kq+a).then(()=>{u(a,p,v)}).catch(A=>{v(A)})}}).catch(a=>{v(a)})})}}async function Qf(t,e,i,s=!1){const u=new Rq(t);let p;try{p=await u.verify(i)}catch{p=await u.verify(i,!0)}const v=Object.assign({},e);return s?Object.assign(v,{captchaResp:p}):Object.assign(v,{captchaResponse:p}),Object.assign(v,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(v,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),v}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oq(t,e){const i=ZA(t,"auth");if(i.isInitialized()){const u=i.getImmediate(),p=i.getOptions();if(sx(p,e??{}))return u;Bs(u,"already-initialized")}return i.initialize({options:e})}function Dq(t,e){const i=(e==null?void 0:e.persistence)||[],s=(Array.isArray(i)?i:[i]).map(Fl);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function Lq(t,e,i){const s=sc(t);fn(s._canInitEmulator,s,"emulator-config-failed"),fn(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const u=!!(i!=null&&i.disableWarnings),p=p5(e),{host:v,port:a}=zq(e),A=a===null?"":`:${a}`;s.config.emulator={url:`${p}//${v}${A}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:v,port:a,protocol:p.replace(":",""),options:Object.freeze({disableWarnings:u})}),u||Nq()}function p5(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function zq(t){const e=p5(t),i=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!i)return{host:"",port:null};const s=i[2].split("@").pop()||"",u=/^(\[[^\]]+\])(:|$)/.exec(s);if(u){const p=u[1];return{host:p,port:TD(s.substr(p.length+1))}}else{const[p,v]=s.split(":");return{host:p,port:TD(v)}}}function TD(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Nq(){function t(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eP{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return Nl("not implemented")}_getIdTokenResponse(e){return Nl("not implemented")}_linkToIdToken(e,i){return Nl("not implemented")}_getReauthenticationResolver(e){return Nl("not implemented")}}async function m5(t,e){return oc(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eE(t,e){return dy(t,"POST","/v1/accounts:signInWithPassword",Eu(t,e))}async function Fq(t,e){return oc(t,"POST","/v1/accounts:sendOobCode",Eu(t,e))}async function tE(t,e){return Fq(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bq(t,e){return dy(t,"POST","/v1/accounts:signInWithEmailLink",Eu(t,e))}async function jq(t,e){return dy(t,"POST","/v1/accounts:signInWithEmailLink",Eu(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_ extends eP{constructor(e,i,s,u=null){super("password",s),this._email=e,this._password=i,this._tenantId=u}static _fromEmailAndPassword(e,i){return new S_(e,i,"password")}static _fromEmailAndCode(e,i,s=null){return new S_(e,i,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){var i;switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(!((i=e._getRecaptchaConfig())===null||i===void 0)&&i.emailPasswordEnabled){const u=await Qf(e,s,"signInWithPassword");return eE(e,u)}else return eE(e,s).catch(async u=>{if(u.code==="auth/missing-recaptcha-token"){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const p=await Qf(e,s,"signInWithPassword");return eE(e,p)}else return Promise.reject(u)});case"emailLink":return Bq(e,{email:this._email,oobCode:this._password});default:Bs(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":return m5(e,{idToken:i,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return jq(e,{idToken:i,email:this._email,oobCode:this._password});default:Bs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jf(t,e){return dy(t,"POST","/v1/accounts:signInWithIdp",Eu(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vq="http://localhost";class Gh extends eP{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new Gh(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):Bs("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:u}=i,p=XA(i,["providerId","signInMethod"]);if(!s||!u)return null;const v=new Gh(s,u);return v.idToken=p.idToken||void 0,v.accessToken=p.accessToken||void 0,v.secret=p.secret,v.nonce=p.nonce,v.pendingToken=p.pendingToken||null,v}_getIdTokenResponse(e){const i=this.buildRequest();return jf(e,i)}_linkToIdToken(e,i){const s=this.buildRequest();return s.idToken=i,jf(e,s)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,jf(e,i)}buildRequest(){const e={requestUri:Vq,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=uy(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uq(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function $q(t){const e=Mg(Rg(t)).link,i=e?Mg(Rg(e)).deep_link_id:null,s=Mg(Rg(t)).deep_link_id;return(s?Mg(Rg(s)).link:null)||s||i||e||t}class tP{constructor(e){var i,s,u,p,v,a;const A=Mg(Rg(e)),O=(i=A.apiKey)!==null&&i!==void 0?i:null,B=(s=A.oobCode)!==null&&s!==void 0?s:null,$=Uq((u=A.mode)!==null&&u!==void 0?u:null);fn(O&&B&&$,"argument-error"),this.apiKey=O,this.operation=$,this.code=B,this.continueUrl=(p=A.continueUrl)!==null&&p!==void 0?p:null,this.languageCode=(v=A.languageCode)!==null&&v!==void 0?v:null,this.tenantId=(a=A.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const i=$q(e);try{return new tP(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wp{constructor(){this.providerId=wp.PROVIDER_ID}static credential(e,i){return S_._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const s=tP.parseLink(i);return fn(s,"argument-error"),S_._fromEmailAndCode(e,s.code,s.tenantId)}}wp.PROVIDER_ID="password";wp.EMAIL_PASSWORD_SIGN_IN_METHOD="password";wp.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nP{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fy extends nP{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc extends fy{constructor(){super("facebook.com")}static credential(e){return Gh._fromParams({providerId:Wc.PROVIDER_ID,signInMethod:Wc.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Wc.credentialFromTaggedObject(e)}static credentialFromError(e){return Wc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Wc.credential(e.oauthAccessToken)}catch{return null}}}Wc.FACEBOOK_SIGN_IN_METHOD="facebook.com";Wc.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ol extends fy{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return Gh._fromParams({providerId:Ol.PROVIDER_ID,signInMethod:Ol.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return Ol.credentialFromTaggedObject(e)}static credentialFromError(e){return Ol.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:s}=e;if(!i&&!s)return null;try{return Ol.credential(i,s)}catch{return null}}}Ol.GOOGLE_SIGN_IN_METHOD="google.com";Ol.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qc extends fy{constructor(){super("github.com")}static credential(e){return Gh._fromParams({providerId:qc.PROVIDER_ID,signInMethod:qc.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qc.credentialFromTaggedObject(e)}static credentialFromError(e){return qc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return qc.credential(e.oauthAccessToken)}catch{return null}}}qc.GITHUB_SIGN_IN_METHOD="github.com";qc.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hc extends fy{constructor(){super("twitter.com")}static credential(e,i){return Gh._fromParams({providerId:Hc.PROVIDER_ID,signInMethod:Hc.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return Hc.credentialFromTaggedObject(e)}static credentialFromError(e){return Hc.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:s}=e;if(!i||!s)return null;try{return Hc.credential(i,s)}catch{return null}}}Hc.TWITTER_SIGN_IN_METHOD="twitter.com";Hc.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nE(t,e){return dy(t,"POST","/v1/accounts:signUp",Eu(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wh{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,s,u=!1){const p=await Oh._fromIdTokenResponse(e,s,u),v=ED(s);return new Wh({user:p,providerId:v,_tokenResponse:s,operationType:i})}static async _forOperation(e,i,s){await e._updateTokensIfNecessary(s,!0);const u=ED(s);return new Wh({user:e,providerId:u,_tokenResponse:s,operationType:i})}}function ED(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ux extends ic{constructor(e,i,s,u){var p;super(i.code,i.message),this.operationType=s,this.user=u,Object.setPrototypeOf(this,ux.prototype),this.customData={appName:e.name,tenantId:(p=e.tenantId)!==null&&p!==void 0?p:void 0,_serverResponse:i.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,i,s,u){return new ux(e,i,s,u)}}function g5(t,e,i,s){return(e==="reauthenticate"?i._getReauthenticationResolver(t):i._getIdTokenResponse(t)).catch(p=>{throw p.code==="auth/multi-factor-auth-required"?ux._fromErrorAndOperation(t,p,e,s):p})}async function Gq(t,e,i=!1){const s=await $h(t,e._linkToIdToken(t.auth,await t.getIdToken()),i);return Wh._forOperation(t,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wq(t,e,i=!1){const{auth:s}=t,u="reauthenticate";try{const p=await $h(t,g5(s,u,e,t),i);fn(p.idToken,s,"internal-error");const v=JA(p.idToken);fn(v,s,"internal-error");const{sub:a}=v;return fn(t.uid===a,s,"user-mismatch"),Wh._forOperation(t,u,p)}catch(p){throw(p==null?void 0:p.code)==="auth/user-not-found"&&Bs(s,"user-mismatch"),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _5(t,e,i=!1){const s="signIn",u=await g5(t,s,e),p=await Wh._fromIdTokenResponse(t,s,u);return i||await t._updateCurrentUser(p.user),p}async function qq(t,e){return _5(sc(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rE(t,e,i){var s;fn(((s=i.url)===null||s===void 0?void 0:s.length)>0,t,"invalid-continue-uri"),fn(typeof i.dynamicLinkDomain>"u"||i.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain"),e.continueUrl=i.url,e.dynamicLinkDomain=i.dynamicLinkDomain,e.canHandleCodeInApp=i.handleCodeInApp,i.iOS&&(fn(i.iOS.bundleId.length>0,t,"missing-ios-bundle-id"),e.iOSBundleId=i.iOS.bundleId),i.android&&(fn(i.android.packageName.length>0,t,"missing-android-pkg-name"),e.androidInstallApp=i.android.installApp,e.androidMinimumVersionCode=i.android.minimumVersion,e.androidPackageName=i.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y5(t){const e=sc(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Hq(t,e,i){var s;const u=sc(t),p={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};if(!((s=u._getRecaptchaConfig())===null||s===void 0)&&s.emailPasswordEnabled){const v=await Qf(u,p,"getOobCode",!0);i&&rE(u,v,i),await tE(u,v)}else i&&rE(u,p,i),await tE(u,p).catch(async v=>{if(v.code==="auth/missing-recaptcha-token"){console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const a=await Qf(u,p,"getOobCode",!0);i&&rE(u,a,i),await tE(u,a)}else return Promise.reject(v)})}async function Zq(t,e,i){var s;const u=sc(t),p={returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"};let v;if(!((s=u._getRecaptchaConfig())===null||s===void 0)&&s.emailPasswordEnabled){const O=await Qf(u,p,"signUpPassword");v=nE(u,O)}else v=nE(u,p).catch(async O=>{if(O.code==="auth/missing-recaptcha-token"){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const B=await Qf(u,p,"signUpPassword");return nE(u,B)}throw O});const a=await v.catch(O=>{throw O.code==="auth/password-does-not-meet-requirements"&&y5(t),O}),A=await Wh._fromIdTokenResponse(u,"signIn",a);return await u._updateCurrentUser(A.user),A}function Xq(t,e,i){return qq(Ii(t),wp.credential(e,i)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&y5(t),s})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yq(t,e){return oc(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PS(t,{displayName:e,photoURL:i}){if(e===void 0&&i===void 0)return;const s=Ii(t),p={idToken:await s.getIdToken(),displayName:e,photoUrl:i,returnSecureToken:!0},v=await $h(s,Yq(s.auth,p));s.displayName=v.displayName||null,s.photoURL=v.photoUrl||null;const a=s.providerData.find(({providerId:A})=>A==="password");a&&(a.displayName=s.displayName,a.photoURL=s.photoURL),await s._updateTokensIfNecessary(v)}function Kq(t,e){return v5(Ii(t),e,null)}function Jq(t,e){return v5(Ii(t),null,e)}async function v5(t,e,i){const{auth:s}=t,p={idToken:await t.getIdToken(),returnSecureToken:!0};e&&(p.email=e),i&&(p.password=i);const v=await $h(t,m5(s,p));await t._updateTokensIfNecessary(v,!0)}function Qq(t,e,i,s){return Ii(t).onIdTokenChanged(e,i,s)}function eH(t,e,i){return Ii(t).beforeAuthStateChanged(e,i)}function tH(t,e,i,s){return Ii(t).onAuthStateChanged(e,i,s)}function nH(t){return Ii(t).signOut()}const hx="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x5{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(hx,"1"),this.storage.removeItem(hx),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rH(){const t=po();return QA(t)||nb(t)}const iH=1e3,oH=10;class b5 extends x5{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=rH()&&bq(),this.fallbackToPolling=h5(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const s=this.storage.getItem(i),u=this.localCache[i];s!==u&&e(i,u,s)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((v,a,A)=>{this.notifyListeners(v,A)});return}const s=e.key;if(i?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const v=this.storage.getItem(s);if(e.newValue!==v)e.newValue!==null?this.storage.setItem(s,e.newValue):this.storage.removeItem(s);else if(this.localCache[s]===e.newValue&&!i)return}const u=()=>{const v=this.storage.getItem(s);!i&&this.localCache[s]===v||this.notifyListeners(s,v)},p=this.storage.getItem(s);xq()&&p!==e.newValue&&e.newValue!==e.oldValue?setTimeout(u,oH):u()}notifyListeners(e,i){this.localCache[e]=i;const s=this.listeners[e];if(s)for(const u of Array.from(s))u(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:s}),!0)})},iH)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}b5.type="LOCAL";const sH=b5;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w5 extends x5{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}w5.type="SESSION";const T5=w5;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aH(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rb{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(u=>u.isListeningto(e));if(i)return i;const s=new rb(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:s,eventType:u,data:p}=i.data,v=this.handlersMap[u];if(!(v!=null&&v.size))return;i.ports[0].postMessage({status:"ack",eventId:s,eventType:u});const a=Array.from(v).map(async O=>O(i.origin,p)),A=await aH(a);i.ports[0].postMessage({status:"done",eventId:s,eventType:u,response:A})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}rb.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rP(t="",e=10){let i="";for(let s=0;s<e;s++)i+=Math.floor(Math.random()*10);return t+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lH{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,s=50){const u=typeof MessageChannel<"u"?new MessageChannel:null;if(!u)throw new Error("connection_unavailable");let p,v;return new Promise((a,A)=>{const O=rP("",20);u.port1.start();const B=setTimeout(()=>{A(new Error("unsupported_event"))},s);v={messageChannel:u,onMessage($){const Y=$;if(Y.data.eventId===O)switch(Y.data.status){case"ack":clearTimeout(B),p=setTimeout(()=>{A(new Error("timeout"))},3e3);break;case"done":clearTimeout(p),a(Y.data.response);break;default:clearTimeout(B),clearTimeout(p),A(new Error("invalid_response"));break}}},this.handlers.add(v),u.port1.addEventListener("message",v.onMessage),this.target.postMessage({eventType:e,eventId:O,data:i},[u.port2])}).finally(()=>{v&&this.removeMessageHandler(v)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xa(){return window}function cH(t){Xa().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E5(){return typeof Xa().WorkerGlobalScope<"u"&&typeof Xa().importScripts=="function"}async function uH(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function hH(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function dH(){return E5()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S5="firebaseLocalStorageDb",fH=1,dx="firebaseLocalStorage",I5="fbase_key";class py{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function ib(t,e){return t.transaction([dx],e?"readwrite":"readonly").objectStore(dx)}function pH(){const t=indexedDB.deleteDatabase(S5);return new py(t).toPromise()}function kS(){const t=indexedDB.open(S5,fH);return new Promise((e,i)=>{t.addEventListener("error",()=>{i(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore(dx,{keyPath:I5})}catch(u){i(u)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains(dx)?e(s):(s.close(),await pH(),e(await kS()))})})}async function SD(t,e,i){const s=ib(t,!0).put({[I5]:e,value:i});return new py(s).toPromise()}async function mH(t,e){const i=ib(t,!1).get(e),s=await new py(i).toPromise();return s===void 0?null:s.value}function ID(t,e){const i=ib(t,!0).delete(e);return new py(i).toPromise()}const gH=800,_H=3;class A5{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await kS(),this.db)}async _withRetries(e){let i=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(i++>_H)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return E5()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=rb._getInstance(dH()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await uH(),!this.activeServiceWorker)return;this.sender=new lH(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((i=s[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||hH()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await kS();return await SD(e,hx,"1"),await ID(e,hx),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(s=>SD(s,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(s=>mH(s,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>ID(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(u=>{const p=ib(u,!1).getAll();return new py(p).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],s=new Set;for(const{fbase_key:u,value:p}of e)s.add(u),JSON.stringify(this.localCache[u])!==JSON.stringify(p)&&(this.notifyListeners(u,p),i.push(u));for(const u of Object.keys(this.localCache))this.localCache[u]&&!s.has(u)&&(this.notifyListeners(u,null),i.push(u));return i}notifyListeners(e,i){this.localCache[e]=i;const s=this.listeners[e];if(s)for(const u of Array.from(s))u(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),gH)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}A5.type="LOCAL";const yH=A5;new hy(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P5(t,e){return e?Fl(e):(fn(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iP extends eP{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return jf(e,this._buildIdpRequest())}_linkToIdToken(e,i){return jf(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return jf(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function vH(t){return _5(t.auth,new iP(t),t.bypassAuthState)}function xH(t){const{auth:e,user:i}=t;return fn(i,e,"internal-error"),Wq(i,new iP(t),t.bypassAuthState)}async function bH(t){const{auth:e,user:i}=t;return fn(i,e,"internal-error"),Gq(i,new iP(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k5{constructor(e,i,s,u,p=!1){this.auth=e,this.resolver=s,this.user=u,this.bypassAuthState=p,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:s,postBody:u,tenantId:p,error:v,type:a}=e;if(v){this.reject(v);return}const A={auth:this.auth,requestUri:i,sessionId:s,tenantId:p||void 0,postBody:u||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(A))}catch(O){this.reject(O)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return vH;case"linkViaPopup":case"linkViaRedirect":return bH;case"reauthViaPopup":case"reauthViaRedirect":return xH;default:Bs(this.auth,"internal-error")}}resolve(e){Zl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Zl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wH=new hy(2e3,1e4);async function TH(t,e,i){const s=sc(t);tq(t,e,nP);const u=P5(s,i);return new Ah(s,"signInViaPopup",e,u).executeNotNull()}class Ah extends k5{constructor(e,i,s,u,p){super(e,i,u,p),this.provider=s,this.authWindow=null,this.pollId=null,Ah.currentPopupAction&&Ah.currentPopupAction.cancel(),Ah.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return fn(e,this.auth,"internal-error"),e}async onExecution(){Zl(this.filter.length===1,"Popup operations only handle one event");const e=rP();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(Za(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Za(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ah.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,s;if(!((s=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Za(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,wH.get())};e()}}Ah.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EH="pendingRedirect",w1=new Map;class SH extends k5{constructor(e,i,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,s),this.eventId=null}async execute(){let e=w1.get(this.auth._key());if(!e){try{const s=await IH(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(i){e=()=>Promise.reject(i)}w1.set(this.auth._key(),e)}return this.bypassAuthState||w1.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function IH(t,e){const i=kH(e),s=PH(t);if(!await s._isAvailable())return!1;const u=await s._get(i)==="true";return await s._remove(i),u}function AH(t,e){w1.set(t._key(),e)}function PH(t){return Fl(t._redirectPersistence)}function kH(t){return b1(EH,t.config.apiKey,t.name)}async function CH(t,e,i=!1){const s=sc(t),u=P5(s,e),v=await new SH(s,u,i).execute();return v&&!i&&(delete v.user._redirectEventId,await s._persistUserIfCurrent(v.user),await s._setRedirectUser(null,e)),v}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MH=10*60*1e3;class RH{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(i=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!OH(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var s;if(e.error&&!C5(e)){const u=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";i.onError(Za(this.auth,u))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const s=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=MH&&this.cachedEventUids.clear(),this.cachedEventUids.has(AD(e))}saveEventToCache(e){this.cachedEventUids.add(AD(e)),this.lastProcessedEventTime=Date.now()}}function AD(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function C5({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function OH(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return C5(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DH(t,e={}){return oc(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LH=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,zH=/^https?/;async function NH(t){if(t.config.emulator)return;const{authorizedDomains:e}=await DH(t);for(const i of e)try{if(FH(i))return}catch{}Bs(t,"unauthorized-domain")}function FH(t){const e=AS(),{protocol:i,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const v=new URL(t);return v.hostname===""&&s===""?i==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&v.hostname===s}if(!zH.test(i))return!1;if(LH.test(t))return s===t;const u=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+u+"|"+u+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BH=new hy(3e4,6e4);function PD(){const t=Xa().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let i=0;i<t.CP.length;i++)t.CP[i]=null}}function jH(t){return new Promise((e,i)=>{var s,u,p;function v(){PD(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{PD(),i(Za(t,"network-request-failed"))},timeout:BH.get()})}if(!((u=(s=Xa().gapi)===null||s===void 0?void 0:s.iframes)===null||u===void 0)&&u.Iframe)e(gapi.iframes.getContext());else if(!((p=Xa().gapi)===null||p===void 0)&&p.load)v();else{const a=Pq("iframefcb");return Xa()[a]=()=>{gapi.load?v():i(Za(t,"network-request-failed"))},f5(`https://apis.google.com/js/api.js?onload=${a}`).catch(A=>i(A))}}).catch(e=>{throw T1=null,e})}let T1=null;function VH(t){return T1=T1||jH(t),T1}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UH=new hy(5e3,15e3),$H="__/auth/iframe",GH="emulator/auth/iframe",WH={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},qH=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function HH(t){const e=t.config;fn(e.authDomain,t,"auth-domain-config-required");const i=e.emulator?KA(e,GH):`https://${t.config.authDomain}/${$H}`,s={apiKey:e.apiKey,appName:t.name,v:bp},u=qH.get(t.config.apiHost);u&&(s.eid=u);const p=t._getFrameworks();return p.length&&(s.fw=p.join(",")),`${i}?${uy(s).slice(1)}`}async function ZH(t){const e=await VH(t),i=Xa().gapi;return fn(i,t,"internal-error"),e.open({where:document.body,url:HH(t),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:WH,dontclear:!0},s=>new Promise(async(u,p)=>{await s.restyle({setHideOnLeave:!1});const v=Za(t,"network-request-failed"),a=Xa().setTimeout(()=>{p(v)},UH.get());function A(){Xa().clearTimeout(a),u(s)}s.ping(A).then(A,()=>{p(v)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XH={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},YH=500,KH=600,JH="_blank",QH="http://localhost";class kD{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function eZ(t,e,i,s=YH,u=KH){const p=Math.max((window.screen.availHeight-u)/2,0).toString(),v=Math.max((window.screen.availWidth-s)/2,0).toString();let a="";const A=Object.assign(Object.assign({},XH),{width:s.toString(),height:u.toString(),top:p,left:v}),O=po().toLowerCase();i&&(a=s5(O)?JH:i),o5(O)&&(e=e||QH,A.scrollbars="yes");const B=Object.entries(A).reduce((Y,[se,me])=>`${Y}${se}=${me},`,"");if(vq(O)&&a!=="_self")return tZ(e||"",a),new kD(null);const $=window.open(e||"",a,B);fn($,t,"popup-blocked");try{$.focus()}catch{}return new kD($)}function tZ(t,e){const i=document.createElement("a");i.href=t,i.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nZ="__/auth/handler",rZ="emulator/auth/handler",iZ=encodeURIComponent("fac");async function CD(t,e,i,s,u,p){fn(t.config.authDomain,t,"auth-domain-config-required"),fn(t.config.apiKey,t,"invalid-api-key");const v={apiKey:t.config.apiKey,appName:t.name,authType:i,redirectUrl:s,v:bp,eventId:u};if(e instanceof nP){e.setDefaultLanguage(t.languageCode),v.providerId=e.providerId||"",VG(e.getCustomParameters())||(v.customParameters=JSON.stringify(e.getCustomParameters()));for(const[B,$]of Object.entries(p||{}))v[B]=$}if(e instanceof fy){const B=e.getScopes().filter($=>$!=="");B.length>0&&(v.scopes=B.join(","))}t.tenantId&&(v.tid=t.tenantId);const a=v;for(const B of Object.keys(a))a[B]===void 0&&delete a[B];const A=await t._getAppCheckToken(),O=A?`#${iZ}=${encodeURIComponent(A)}`:"";return`${oZ(t)}?${uy(a).slice(1)}${O}`}function oZ({config:t}){return t.emulator?KA(t,rZ):`https://${t.authDomain}/${nZ}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE="webStorageSupport";class sZ{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=T5,this._completeRedirectFn=CH,this._overrideRedirectResult=AH}async _openPopup(e,i,s,u){var p;Zl((p=this.eventManagers[e._key()])===null||p===void 0?void 0:p.manager,"_initialize() not called before _openPopup()");const v=await CD(e,i,s,AS(),u);return eZ(e,v,rP())}async _openRedirect(e,i,s,u){await this._originValidation(e);const p=await CD(e,i,s,AS(),u);return cH(p),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:u,promise:p}=this.eventManagers[i];return u?Promise.resolve(u):(Zl(p,"If manager is not set, promise should be"),p)}const s=this.initAndGetManager(e);return this.eventManagers[i]={promise:s},s.catch(()=>{delete this.eventManagers[i]}),s}async initAndGetManager(e){const i=await ZH(e),s=new RH(e);return i.register("authEvent",u=>(fn(u==null?void 0:u.authEvent,e,"invalid-auth-event"),{status:s.onEvent(u.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=i,s}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(iE,{type:iE},u=>{var p;const v=(p=u==null?void 0:u[0])===null||p===void 0?void 0:p[iE];v!==void 0&&i(!!v),Bs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=NH(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return h5()||QA()||nb()}}const aZ=sZ;var MD="@firebase/auth",RD="1.3.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lZ{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){fn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cZ(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function uZ(t){Jf(new Vh("auth",(e,{options:i})=>{const s=e.getProvider("app").getImmediate(),u=e.getProvider("heartbeat"),p=e.getProvider("app-check-internal"),{apiKey:v,authDomain:a}=s.options;fn(v&&!v.includes(":"),"invalid-api-key",{appName:s.name});const A={apiKey:v,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:d5(t)},O=new Iq(s,u,p,A);return Dq(O,i),O},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,s)=>{e.getProvider("auth-internal").initialize()})),Jf(new Vh("auth-internal",e=>{const i=sc(e.getProvider("auth").getImmediate());return(s=>new lZ(s))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),du(MD,RD,cZ(t)),du(MD,RD,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hZ=5*60,dZ=GN("authIdTokenMaxAge")||hZ;let OD=null;const fZ=t=>async e=>{const i=e&&await e.getIdTokenResult(),s=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(s&&s>dZ)return;const u=i==null?void 0:i.token;OD!==u&&(OD=u,await fetch(t,{method:u?"POST":"DELETE",headers:u?{Authorization:`Bearer ${u}`}:{}}))};function M5(t=ZN()){const e=ZA(t,"auth");if(e.isInitialized())return e.getImmediate();const i=Oq(t,{popupRedirectResolver:aZ,persistence:[yH,sH,T5]}),s=GN("authTokenSyncURL");if(s){const p=fZ(s);eH(i,p,()=>p(i.currentUser)),Qq(i,v=>p(v))}const u=UN("auth");return u&&Lq(i,`http://${u}`),i}uZ("Browser");var pZ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Gt,oP=oP||{},Tn=pZ||self;function ob(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function my(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function mZ(t){return Object.prototype.hasOwnProperty.call(t,oE)&&t[oE]||(t[oE]=++gZ)}var oE="closure_uid_"+(1e9*Math.random()>>>0),gZ=0;function _Z(t,e,i){return t.call.apply(t.bind,arguments)}function yZ(t,e,i){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var u=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(u,s),t.apply(e,u)}}return function(){return t.apply(e,arguments)}}function uo(t,e,i){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?uo=_Z:uo=yZ,uo.apply(null,arguments)}function Hv(t,e){var i=Array.prototype.slice.call(arguments,1);return function(){var s=i.slice();return s.push.apply(s,arguments),t.apply(this,s)}}function Ri(t,e){function i(){}i.prototype=e.prototype,t.$=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.ac=function(s,u,p){for(var v=Array(arguments.length-2),a=2;a<arguments.length;a++)v[a-2]=arguments[a];return e.prototype[u].apply(s,v)}}function Su(){this.s=this.s,this.o=this.o}var vZ=0;Su.prototype.s=!1;Su.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),vZ!=0)&&mZ(this)};Su.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const R5=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let i=0;i<t.length;i++)if(i in t&&t[i]===e)return i;return-1};function sP(t){const e=t.length;if(0<e){const i=Array(e);for(let s=0;s<e;s++)i[s]=t[s];return i}return[]}function DD(t,e){for(let i=1;i<arguments.length;i++){const s=arguments[i];if(ob(s)){const u=t.length||0,p=s.length||0;t.length=u+p;for(let v=0;v<p;v++)t[u+v]=s[v]}else t.push(s)}}function ho(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}ho.prototype.h=function(){this.defaultPrevented=!0};var xZ=function(){if(!Tn.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Tn.addEventListener("test",()=>{},e),Tn.removeEventListener("test",()=>{},e)}catch{}return t}();function I_(t){return/^[\s\xa0]*$/.test(t)}function sb(){var t=Tn.navigator;return t&&(t=t.userAgent)?t:""}function Va(t){return sb().indexOf(t)!=-1}function aP(t){return aP[" "](t),t}aP[" "]=function(){};function bZ(t,e){var i=fX;return Object.prototype.hasOwnProperty.call(i,t)?i[t]:i[t]=e(t)}var wZ=Va("Opera"),ep=Va("Trident")||Va("MSIE"),O5=Va("Edge"),CS=O5||ep,D5=Va("Gecko")&&!(sb().toLowerCase().indexOf("webkit")!=-1&&!Va("Edge"))&&!(Va("Trident")||Va("MSIE"))&&!Va("Edge"),TZ=sb().toLowerCase().indexOf("webkit")!=-1&&!Va("Edge");function L5(){var t=Tn.document;return t?t.documentMode:void 0}var MS;e:{var sE="",aE=function(){var t=sb();if(D5)return/rv:([^\);]+)(\)|;)/.exec(t);if(O5)return/Edge\/([\d\.]+)/.exec(t);if(ep)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(TZ)return/WebKit\/(\S+)/.exec(t);if(wZ)return/(?:Version)[ \/]?(\S+)/.exec(t)}();if(aE&&(sE=aE?aE[1]:""),ep){var lE=L5();if(lE!=null&&lE>parseFloat(sE)){MS=String(lE);break e}}MS=sE}var RS;if(Tn.document&&ep){var LD=L5();RS=LD||parseInt(MS,10)||void 0}else RS=void 0;var EZ=RS;function A_(t,e){if(ho.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var i=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(D5){e:{try{aP(e.nodeName);var u=!0;break e}catch{}u=!1}u||(e=null)}}else i=="mouseover"?e=t.fromElement:i=="mouseout"&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:SZ[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&A_.$.h.call(this)}}Ri(A_,ho);var SZ={2:"touch",3:"pen",4:"mouse"};A_.prototype.h=function(){A_.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var gy="closure_listenable_"+(1e6*Math.random()|0),IZ=0;function AZ(t,e,i,s,u){this.listener=t,this.proxy=null,this.src=e,this.type=i,this.capture=!!s,this.la=u,this.key=++IZ,this.fa=this.ia=!1}function ab(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function lP(t,e,i){for(const s in t)e.call(i,t[s],s,t)}function PZ(t,e){for(const i in t)e.call(void 0,t[i],i,t)}function z5(t){const e={};for(const i in t)e[i]=t[i];return e}const zD="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N5(t,e){let i,s;for(let u=1;u<arguments.length;u++){s=arguments[u];for(i in s)t[i]=s[i];for(let p=0;p<zD.length;p++)i=zD[p],Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}}function lb(t){this.src=t,this.g={},this.h=0}lb.prototype.add=function(t,e,i,s,u){var p=t.toString();t=this.g[p],t||(t=this.g[p]=[],this.h++);var v=DS(t,e,s,u);return-1<v?(e=t[v],i||(e.ia=!1)):(e=new AZ(e,this.src,p,!!s,u),e.ia=i,t.push(e)),e};function OS(t,e){var i=e.type;if(i in t.g){var s=t.g[i],u=R5(s,e),p;(p=0<=u)&&Array.prototype.splice.call(s,u,1),p&&(ab(e),t.g[i].length==0&&(delete t.g[i],t.h--))}}function DS(t,e,i,s){for(var u=0;u<t.length;++u){var p=t[u];if(!p.fa&&p.listener==e&&p.capture==!!i&&p.la==s)return u}return-1}var cP="closure_lm_"+(1e6*Math.random()|0),cE={};function F5(t,e,i,s,u){if(s&&s.once)return j5(t,e,i,s,u);if(Array.isArray(e)){for(var p=0;p<e.length;p++)F5(t,e[p],i,s,u);return null}return i=dP(i),t&&t[gy]?t.O(e,i,my(s)?!!s.capture:!!s,u):B5(t,e,i,!1,s,u)}function B5(t,e,i,s,u,p){if(!e)throw Error("Invalid event type");var v=my(u)?!!u.capture:!!u,a=hP(t);if(a||(t[cP]=a=new lb(t)),i=a.add(e,i,s,v,p),i.proxy)return i;if(s=kZ(),i.proxy=s,s.src=t,s.listener=i,t.addEventListener)xZ||(u=v),u===void 0&&(u=!1),t.addEventListener(e.toString(),s,u);else if(t.attachEvent)t.attachEvent(U5(e.toString()),s);else if(t.addListener&&t.removeListener)t.addListener(s);else throw Error("addEventListener and attachEvent are unavailable.");return i}function kZ(){function t(i){return e.call(t.src,t.listener,i)}const e=CZ;return t}function j5(t,e,i,s,u){if(Array.isArray(e)){for(var p=0;p<e.length;p++)j5(t,e[p],i,s,u);return null}return i=dP(i),t&&t[gy]?t.P(e,i,my(s)?!!s.capture:!!s,u):B5(t,e,i,!0,s,u)}function V5(t,e,i,s,u){if(Array.isArray(e))for(var p=0;p<e.length;p++)V5(t,e[p],i,s,u);else s=my(s)?!!s.capture:!!s,i=dP(i),t&&t[gy]?(t=t.i,e=String(e).toString(),e in t.g&&(p=t.g[e],i=DS(p,i,s,u),-1<i&&(ab(p[i]),Array.prototype.splice.call(p,i,1),p.length==0&&(delete t.g[e],t.h--)))):t&&(t=hP(t))&&(e=t.g[e.toString()],t=-1,e&&(t=DS(e,i,s,u)),(i=-1<t?e[t]:null)&&uP(i))}function uP(t){if(typeof t!="number"&&t&&!t.fa){var e=t.src;if(e&&e[gy])OS(e.i,t);else{var i=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(i,s,t.capture):e.detachEvent?e.detachEvent(U5(i),s):e.addListener&&e.removeListener&&e.removeListener(s),(i=hP(e))?(OS(i,t),i.h==0&&(i.src=null,e[cP]=null)):ab(t)}}}function U5(t){return t in cE?cE[t]:cE[t]="on"+t}function CZ(t,e){if(t.fa)t=!0;else{e=new A_(e,this);var i=t.listener,s=t.la||t.src;t.ia&&uP(t),t=i.call(s,e)}return t}function hP(t){return t=t[cP],t instanceof lb?t:null}var uE="__closure_events_fn_"+(1e9*Math.random()>>>0);function dP(t){return typeof t=="function"?t:(t[uE]||(t[uE]=function(e){return t.handleEvent(e)}),t[uE])}function Mi(){Su.call(this),this.i=new lb(this),this.S=this,this.J=null}Ri(Mi,Su);Mi.prototype[gy]=!0;Mi.prototype.removeEventListener=function(t,e,i,s){V5(this,t,e,i,s)};function Zi(t,e){var i,s=t.J;if(s)for(i=[];s;s=s.J)i.push(s);if(t=t.S,s=e.type||e,typeof e=="string")e=new ho(e,t);else if(e instanceof ho)e.target=e.target||t;else{var u=e;e=new ho(s,t),N5(e,u)}if(u=!0,i)for(var p=i.length-1;0<=p;p--){var v=e.g=i[p];u=Zv(v,s,!0,e)&&u}if(v=e.g=t,u=Zv(v,s,!0,e)&&u,u=Zv(v,s,!1,e)&&u,i)for(p=0;p<i.length;p++)v=e.g=i[p],u=Zv(v,s,!1,e)&&u}Mi.prototype.N=function(){if(Mi.$.N.call(this),this.i){var t=this.i,e;for(e in t.g){for(var i=t.g[e],s=0;s<i.length;s++)ab(i[s]);delete t.g[e],t.h--}}this.J=null};Mi.prototype.O=function(t,e,i,s){return this.i.add(String(t),e,!1,i,s)};Mi.prototype.P=function(t,e,i,s){return this.i.add(String(t),e,!0,i,s)};function Zv(t,e,i,s){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var u=!0,p=0;p<e.length;++p){var v=e[p];if(v&&!v.fa&&v.capture==i){var a=v.listener,A=v.la||v.src;v.ia&&OS(t.i,v),u=a.call(A,s)!==!1&&u}}return u&&!s.defaultPrevented}var fP=Tn.JSON.stringify;class MZ{constructor(e,i){this.i=e,this.j=i,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function RZ(){var t=pP;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class OZ{constructor(){this.h=this.g=null}add(e,i){const s=$5.get();s.set(e,i),this.h?this.h.next=s:this.g=s,this.h=s}}var $5=new MZ(()=>new DZ,t=>t.reset());class DZ{constructor(){this.next=this.g=this.h=null}set(e,i){this.h=e,this.g=i,this.next=null}reset(){this.next=this.g=this.h=null}}function LZ(t){var e=1;t=t.split(":");const i=[];for(;0<e&&t.length;)i.push(t.shift()),e--;return t.length&&i.push(t.join(":")),i}function zZ(t){Tn.setTimeout(()=>{throw t},0)}let P_,k_=!1,pP=new OZ,G5=()=>{const t=Tn.Promise.resolve(void 0);P_=()=>{t.then(NZ)}};var NZ=()=>{for(var t;t=RZ();){try{t.h.call(t.g)}catch(i){zZ(i)}var e=$5;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}k_=!1};function cb(t,e){Mi.call(this),this.h=t||1,this.g=e||Tn,this.j=uo(this.qb,this),this.l=Date.now()}Ri(cb,Mi);Gt=cb.prototype;Gt.ga=!1;Gt.T=null;Gt.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Zi(this,"tick"),this.ga&&(mP(this),this.start()))}};Gt.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function mP(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}Gt.N=function(){cb.$.N.call(this),mP(this),delete this.g};function gP(t,e,i){if(typeof t=="function")i&&(t=uo(t,i));else if(t&&typeof t.handleEvent=="function")t=uo(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:Tn.setTimeout(t,e||0)}function W5(t){t.g=gP(()=>{t.g=null,t.i&&(t.i=!1,W5(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}class FZ extends Su{constructor(e,i){super(),this.m=e,this.j=i,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:W5(this)}N(){super.N(),this.g&&(Tn.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function C_(t){Su.call(this),this.h=t,this.g={}}Ri(C_,Su);var ND=[];function q5(t,e,i,s){Array.isArray(i)||(i&&(ND[0]=i.toString()),i=ND);for(var u=0;u<i.length;u++){var p=F5(e,i[u],s||t.handleEvent,!1,t.h||t);if(!p)break;t.g[p.key]=p}}function H5(t){lP(t.g,function(e,i){this.g.hasOwnProperty(i)&&uP(e)},t),t.g={}}C_.prototype.N=function(){C_.$.N.call(this),H5(this)};C_.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function ub(){this.g=!0}ub.prototype.Ea=function(){this.g=!1};function BZ(t,e,i,s,u,p){t.info(function(){if(t.g)if(p)for(var v="",a=p.split("&"),A=0;A<a.length;A++){var O=a[A].split("=");if(1<O.length){var B=O[0];O=O[1];var $=B.split("_");v=2<=$.length&&$[1]=="type"?v+(B+"="+O+"&"):v+(B+"=redacted&")}}else v=null;else v=p;return"XMLHTTP REQ ("+s+") [attempt "+u+"]: "+e+`
`+i+`
`+v})}function jZ(t,e,i,s,u,p,v){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+u+"]: "+e+`
`+i+`
`+p+" "+v})}function kf(t,e,i,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+UZ(t,i)+(s?" "+s:"")})}function VZ(t,e){t.info(function(){return"TIMEOUT: "+e})}ub.prototype.info=function(){};function UZ(t,e){if(!t.g)return e;if(!e)return null;try{var i=JSON.parse(e);if(i){for(t=0;t<i.length;t++)if(Array.isArray(i[t])){var s=i[t];if(!(2>s.length)){var u=s[1];if(Array.isArray(u)&&!(1>u.length)){var p=u[0];if(p!="noop"&&p!="stop"&&p!="close")for(var v=1;v<u.length;v++)u[v]=""}}}}return fP(i)}catch{return e}}var ed={},FD=null;function hb(){return FD=FD||new Mi}ed.Ta="serverreachability";function Z5(t){ho.call(this,ed.Ta,t)}Ri(Z5,ho);function M_(t){const e=hb();Zi(e,new Z5(e))}ed.STAT_EVENT="statevent";function X5(t,e){ho.call(this,ed.STAT_EVENT,t),this.stat=e}Ri(X5,ho);function bo(t){const e=hb();Zi(e,new X5(e,t))}ed.Ua="timingevent";function Y5(t,e){ho.call(this,ed.Ua,t),this.size=e}Ri(Y5,ho);function _y(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return Tn.setTimeout(function(){t()},e)}var db={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},K5={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function _P(){}_P.prototype.h=null;function BD(t){return t.h||(t.h=t.i())}function J5(){}var yy={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function yP(){ho.call(this,"d")}Ri(yP,ho);function vP(){ho.call(this,"c")}Ri(vP,ho);var LS;function fb(){}Ri(fb,_P);fb.prototype.g=function(){return new XMLHttpRequest};fb.prototype.i=function(){return{}};LS=new fb;function vy(t,e,i,s){this.l=t,this.j=e,this.m=i,this.W=s||1,this.U=new C_(this),this.P=$Z,t=CS?125:void 0,this.V=new cb(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Q5}function Q5(){this.i=null,this.g="",this.h=!1}var $Z=45e3,zS={},fx={};Gt=vy.prototype;Gt.setTimeout=function(t){this.P=t};function NS(t,e,i){t.L=1,t.v=mb(Xl(e)),t.s=i,t.S=!0,eF(t,null)}function eF(t,e){t.G=Date.now(),xy(t),t.A=Xl(t.v);var i=t.A,s=t.W;Array.isArray(s)||(s=[String(s)]),lF(i.i,"t",s),t.C=0,i=t.l.J,t.h=new Q5,t.g=kF(t.l,i?e:null,!t.s),0<t.O&&(t.M=new FZ(uo(t.Pa,t,t.g),t.O)),q5(t.U,t.g,"readystatechange",t.nb),e=t.I?z5(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),M_(),BZ(t.j,t.u,t.A,t.m,t.W,t.s)}Gt.nb=function(t){t=t.target;const e=this.M;e&&Ua(t)==3?e.l():this.Pa(t)};Gt.Pa=function(t){try{if(t==this.g)e:{const B=Ua(this.g);var e=this.g.Ia();const $=this.g.da();if(!(3>B)&&(B!=3||CS||this.g&&(this.h.h||this.g.ja()||$D(this.g)))){this.J||B!=4||e==7||(e==8||0>=$?M_(3):M_(2)),pb(this);var i=this.g.da();this.ca=i;t:if(tF(this)){var s=$D(this.g);t="";var u=s.length,p=Ua(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ph(this),Kg(this);var v="";break t}this.h.i=new Tn.TextDecoder}for(e=0;e<u;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:p&&e==u-1});s.splice(0,u),this.h.g+=t,this.C=0,v=this.h.g}else v=this.g.ja();if(this.i=i==200,jZ(this.j,this.u,this.A,this.m,this.W,B,i),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,A=this.g;if((a=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I_(a)){var O=a;break t}}O=null}if(i=O)kf(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,FS(this,i);else{this.i=!1,this.o=3,bo(12),Ph(this),Kg(this);break e}}this.S?(nF(this,B,v),CS&&this.i&&B==3&&(q5(this.U,this.V,"tick",this.mb),this.V.start())):(kf(this.j,this.m,v,null),FS(this,v)),B==4&&Ph(this),this.i&&!this.J&&(B==4?SF(this.l,this):(this.i=!1,xy(this)))}else uX(this.g),i==400&&0<v.indexOf("Unknown SID")?(this.o=3,bo(12)):(this.o=0,bo(13)),Ph(this),Kg(this)}}}catch{}finally{}};function tF(t){return t.g?t.u=="GET"&&t.L!=2&&t.l.Ha:!1}function nF(t,e,i){let s=!0,u;for(;!t.J&&t.C<i.length;)if(u=GZ(t,i),u==fx){e==4&&(t.o=4,bo(14),s=!1),kf(t.j,t.m,null,"[Incomplete Response]");break}else if(u==zS){t.o=4,bo(15),kf(t.j,t.m,i,"[Invalid Chunk]"),s=!1;break}else kf(t.j,t.m,u,null),FS(t,u);tF(t)&&u!=fx&&u!=zS&&(t.h.g="",t.C=0),e!=4||i.length!=0||t.h.h||(t.o=1,bo(16),s=!1),t.i=t.i&&s,s?0<i.length&&!t.ba&&(t.ba=!0,e=t.l,e.g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+i.length),SP(e),e.M=!0,bo(11))):(kf(t.j,t.m,i,"[Invalid Chunked Response]"),Ph(t),Kg(t))}Gt.mb=function(){if(this.g){var t=Ua(this.g),e=this.g.ja();this.C<e.length&&(pb(this),nF(this,t,e),this.i&&t!=4&&xy(this))}};function GZ(t,e){var i=t.C,s=e.indexOf(`
`,i);return s==-1?fx:(i=Number(e.substring(i,s)),isNaN(i)?zS:(s+=1,s+i>e.length?fx:(e=e.slice(s,s+i),t.C=s+i,e)))}Gt.cancel=function(){this.J=!0,Ph(this)};function xy(t){t.Y=Date.now()+t.P,rF(t,t.P)}function rF(t,e){if(t.B!=null)throw Error("WatchDog timer not null");t.B=_y(uo(t.lb,t),e)}function pb(t){t.B&&(Tn.clearTimeout(t.B),t.B=null)}Gt.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(VZ(this.j,this.A),this.L!=2&&(M_(),bo(17)),Ph(this),this.o=2,Kg(this)):rF(this,this.Y-t)};function Kg(t){t.l.H==0||t.J||SF(t.l,t)}function Ph(t){pb(t);var e=t.M;e&&typeof e.sa=="function"&&e.sa(),t.M=null,mP(t.V),H5(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function FS(t,e){try{var i=t.l;if(i.H!=0&&(i.g==t||BS(i.i,t))){if(!t.K&&BS(i.i,t)&&i.H==3){try{var s=i.Ja.g.parse(e)}catch{s=null}if(Array.isArray(s)&&s.length==3){var u=s;if(u[0]==0){e:if(!i.u){if(i.g)if(i.g.G+3e3<t.G)gx(i),vb(i);else break e;EP(i),bo(18)}}else i.Fa=u[1],0<i.Fa-i.V&&37500>u[2]&&i.G&&i.A==0&&!i.v&&(i.v=_y(uo(i.ib,i),6e3));if(1>=hF(i.i)&&i.oa){try{i.oa()}catch{}i.oa=void 0}}else kh(i,11)}else if((t.K||i.g==t)&&gx(i),!I_(e))for(u=i.Ja.g.parse(e),e=0;e<u.length;e++){let O=u[e];if(i.V=O[0],O=O[1],i.H==2)if(O[0]=="c"){i.K=O[1],i.pa=O[2];const B=O[3];B!=null&&(i.ra=B,i.l.info("VER="+i.ra));const $=O[4];$!=null&&(i.Ga=$,i.l.info("SVER="+i.Ga));const Y=O[5];Y!=null&&typeof Y=="number"&&0<Y&&(s=1.5*Y,i.L=s,i.l.info("backChannelRequestTimeoutMs_="+s)),s=i;const se=t.g;if(se){const me=se.g?se.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(me){var p=s.i;p.g||me.indexOf("spdy")==-1&&me.indexOf("quic")==-1&&me.indexOf("h2")==-1||(p.j=p.l,p.g=new Set,p.h&&(xP(p,p.h),p.h=null))}if(s.F){const _e=se.g?se.g.getResponseHeader("X-HTTP-Session-Id"):null;_e&&(s.Da=_e,Nr(s.I,s.F,_e))}}i.H=3,i.h&&i.h.Ba(),i.ca&&(i.S=Date.now()-t.G,i.l.info("Handshake RTT: "+i.S+"ms")),s=i;var v=t;if(s.wa=PF(s,s.J?s.pa:null,s.Y),v.K){dF(s.i,v);var a=v,A=s.L;A&&a.setTimeout(A),a.B&&(pb(a),xy(a)),s.g=v}else TF(s);0<i.j.length&&xb(i)}else O[0]!="stop"&&O[0]!="close"||kh(i,7);else i.H==3&&(O[0]=="stop"||O[0]=="close"?O[0]=="stop"?kh(i,7):TP(i):O[0]!="noop"&&i.h&&i.h.Aa(O),i.A=0)}}M_(4)}catch{}}function WZ(t){if(t.Z&&typeof t.Z=="function")return t.Z();if(typeof Map<"u"&&t instanceof Map||typeof Set<"u"&&t instanceof Set)return Array.from(t.values());if(typeof t=="string")return t.split("");if(ob(t)){for(var e=[],i=t.length,s=0;s<i;s++)e.push(t[s]);return e}e=[],i=0;for(s in t)e[i++]=t[s];return e}function qZ(t){if(t.ta&&typeof t.ta=="function")return t.ta();if(!t.Z||typeof t.Z!="function"){if(typeof Map<"u"&&t instanceof Map)return Array.from(t.keys());if(!(typeof Set<"u"&&t instanceof Set)){if(ob(t)||typeof t=="string"){var e=[];t=t.length;for(var i=0;i<t;i++)e.push(i);return e}e=[],i=0;for(const s in t)e[i++]=s;return e}}}function iF(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(ob(t)||typeof t=="string")Array.prototype.forEach.call(t,e,void 0);else for(var i=qZ(t),s=WZ(t),u=s.length,p=0;p<u;p++)e.call(void 0,s[p],i&&i[p],t)}var oF=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function HZ(t,e){if(t){t=t.split("&");for(var i=0;i<t.length;i++){var s=t[i].indexOf("="),u=null;if(0<=s){var p=t[i].substring(0,s);u=t[i].substring(s+1)}else p=t[i];e(p,u?decodeURIComponent(u.replace(/\+/g," ")):"")}}}function Dh(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Dh){this.h=t.h,px(this,t.j),this.s=t.s,this.g=t.g,mx(this,t.m),this.l=t.l;var e=t.i,i=new R_;i.i=e.i,e.g&&(i.g=new Map(e.g),i.h=e.h),jD(this,i),this.o=t.o}else t&&(e=String(t).match(oF))?(this.h=!1,px(this,e[1]||"",!0),this.s=Og(e[2]||""),this.g=Og(e[3]||"",!0),mx(this,e[4]),this.l=Og(e[5]||"",!0),jD(this,e[6]||"",!0),this.o=Og(e[7]||"")):(this.h=!1,this.i=new R_(null,this.h))}Dh.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Dg(e,VD,!0),":");var i=this.g;return(i||e=="file")&&(t.push("//"),(e=this.s)&&t.push(Dg(e,VD,!0),"@"),t.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i=this.m,i!=null&&t.push(":",String(i))),(i=this.l)&&(this.g&&i.charAt(0)!="/"&&t.push("/"),t.push(Dg(i,i.charAt(0)=="/"?YZ:XZ,!0))),(i=this.i.toString())&&t.push("?",i),(i=this.o)&&t.push("#",Dg(i,JZ)),t.join("")};function Xl(t){return new Dh(t)}function px(t,e,i){t.j=i?Og(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function mx(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function jD(t,e,i){e instanceof R_?(t.i=e,QZ(t.i,t.h)):(i||(e=Dg(e,KZ)),t.i=new R_(e,t.h))}function Nr(t,e,i){t.i.set(e,i)}function mb(t){return Nr(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Og(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Dg(t,e,i){return typeof t=="string"?(t=encodeURI(t).replace(e,ZZ),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ZZ(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var VD=/[#\/\?@]/g,XZ=/[#\?:]/g,YZ=/[#\?]/g,KZ=/[#\?@]/g,JZ=/#/g;function R_(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Iu(t){t.g||(t.g=new Map,t.h=0,t.i&&HZ(t.i,function(e,i){t.add(decodeURIComponent(e.replace(/\+/g," ")),i)}))}Gt=R_.prototype;Gt.add=function(t,e){Iu(this),this.i=null,t=Tp(this,t);var i=this.g.get(t);return i||this.g.set(t,i=[]),i.push(e),this.h+=1,this};function sF(t,e){Iu(t),e=Tp(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function aF(t,e){return Iu(t),e=Tp(t,e),t.g.has(e)}Gt.forEach=function(t,e){Iu(this),this.g.forEach(function(i,s){i.forEach(function(u){t.call(e,u,s,this)},this)},this)};Gt.ta=function(){Iu(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),i=[];for(let s=0;s<e.length;s++){const u=t[s];for(let p=0;p<u.length;p++)i.push(e[s])}return i};Gt.Z=function(t){Iu(this);let e=[];if(typeof t=="string")aF(this,t)&&(e=e.concat(this.g.get(Tp(this,t))));else{t=Array.from(this.g.values());for(let i=0;i<t.length;i++)e=e.concat(t[i])}return e};Gt.set=function(t,e){return Iu(this),this.i=null,t=Tp(this,t),aF(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};Gt.get=function(t,e){return t?(t=this.Z(t),0<t.length?String(t[0]):e):e};function lF(t,e,i){sF(t,e),0<i.length&&(t.i=null,t.g.set(Tp(t,e),sP(i)),t.h+=i.length)}Gt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var i=0;i<e.length;i++){var s=e[i];const p=encodeURIComponent(String(s)),v=this.Z(s);for(s=0;s<v.length;s++){var u=p;v[s]!==""&&(u+="="+encodeURIComponent(String(v[s]))),t.push(u)}}return this.i=t.join("&")};function Tp(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function QZ(t,e){e&&!t.j&&(Iu(t),t.i=null,t.g.forEach(function(i,s){var u=s.toLowerCase();s!=u&&(sF(this,s),lF(this,u,i))},t)),t.j=e}var eX=class{constructor(t,e){this.g=t,this.map=e}};function cF(t){this.l=t||tX,Tn.PerformanceNavigationTiming?(t=Tn.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(Tn.g&&Tn.g.Ka&&Tn.g.Ka()&&Tn.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var tX=10;function uF(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function hF(t){return t.h?1:t.g?t.g.size:0}function BS(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function xP(t,e){t.g?t.g.add(e):t.h=e}function dF(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}cF.prototype.cancel=function(){if(this.i=fF(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const t of this.g.values())t.cancel();this.g.clear()}};function fF(t){if(t.h!=null)return t.i.concat(t.h.F);if(t.g!=null&&t.g.size!==0){let e=t.i;for(const i of t.g.values())e=e.concat(i.F);return e}return sP(t.i)}var nX=class{stringify(t){return Tn.JSON.stringify(t,void 0)}parse(t){return Tn.JSON.parse(t,void 0)}};function rX(){this.g=new nX}function iX(t,e,i){const s=i||"";try{iF(t,function(u,p){let v=u;my(u)&&(v=fP(u)),e.push(s+p+"="+encodeURIComponent(v))})}catch(u){throw e.push(s+"type="+encodeURIComponent("_badmap")),u}}function oX(t,e){const i=new ub;if(Tn.Image){const s=new Image;s.onload=Hv(Xv,i,s,"TestLoadImage: loaded",!0,e),s.onerror=Hv(Xv,i,s,"TestLoadImage: error",!1,e),s.onabort=Hv(Xv,i,s,"TestLoadImage: abort",!1,e),s.ontimeout=Hv(Xv,i,s,"TestLoadImage: timeout",!1,e),Tn.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}function Xv(t,e,i,s,u){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,u(s)}catch{}}function gb(t){this.l=t.ec||null,this.j=t.ob||!1}Ri(gb,_P);gb.prototype.g=function(){return new _b(this.l,this.j)};gb.prototype.i=function(t){return function(){return t}}({});function _b(t,e){Mi.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=bP,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ri(_b,Mi);var bP=0;Gt=_b.prototype;Gt.open=function(t,e){if(this.readyState!=bP)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,O_(this)};Gt.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||Tn).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};Gt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,by(this)),this.readyState=bP};Gt.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,O_(this)),this.g&&(this.readyState=3,O_(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Tn.ReadableStream<"u"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;pF(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))};function pF(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}Gt.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?by(this):O_(this),this.readyState==3&&pF(this)}};Gt.Za=function(t){this.g&&(this.response=this.responseText=t,by(this))};Gt.Ya=function(t){this.g&&(this.response=t,by(this))};Gt.ka=function(){this.g&&by(this)};function by(t){t.readyState=4,t.l=null,t.j=null,t.A=null,O_(t)}Gt.setRequestHeader=function(t,e){this.v.append(t,e)};Gt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};Gt.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var i=e.next();!i.done;)i=i.value,t.push(i[0]+": "+i[1]),i=e.next();return t.join(`\r
`)};function O_(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(_b.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var sX=Tn.JSON.parse;function Jr(t){Mi.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=mF,this.L=this.M=!1}Ri(Jr,Mi);var mF="",aX=/^https?$/i,lX=["POST","PUT"];Gt=Jr.prototype;Gt.Oa=function(t){this.M=t};Gt.ha=function(t,e,i,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():LS.g(),this.C=this.u?BD(this.u):BD(LS),this.g.onreadystatechange=uo(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(p){UD(this,p);return}if(t=i||"",i=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var u in s)i.set(u,s[u]);else if(typeof s.keys=="function"&&typeof s.get=="function")for(const p of s.keys())i.set(p,s.get(p));else throw Error("Unknown input type for opt_headers: "+String(s));s=Array.from(i.keys()).find(p=>p.toLowerCase()=="content-type"),u=Tn.FormData&&t instanceof Tn.FormData,!(0<=R5(lX,e))||s||u||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[p,v]of i)this.g.setRequestHeader(p,v);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{yF(this),0<this.B&&((this.L=cX(this.g))?(this.g.timeout=this.B,this.g.ontimeout=uo(this.ua,this)):this.A=gP(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(p){UD(this,p)}};function cX(t){return ep&&typeof t.timeout=="number"&&t.ontimeout!==void 0}Gt.ua=function(){typeof oP<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Zi(this,"timeout"),this.abort(8))};function UD(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,gF(t),yb(t)}function gF(t){t.F||(t.F=!0,Zi(t,"complete"),Zi(t,"error"))}Gt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Zi(this,"complete"),Zi(this,"abort"),yb(this))};Gt.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),yb(this,!0)),Jr.$.N.call(this)};Gt.La=function(){this.s||(this.G||this.v||this.l?_F(this):this.kb())};Gt.kb=function(){_F(this)};function _F(t){if(t.h&&typeof oP<"u"&&(!t.C[1]||Ua(t)!=4||t.da()!=2)){if(t.v&&Ua(t)==4)gP(t.La,0,t);else if(Zi(t,"readystatechange"),Ua(t)==4){t.h=!1;try{const v=t.da();e:switch(v){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var i;if(!(i=e)){var s;if(s=v===0){var u=String(t.I).match(oF)[1]||null;!u&&Tn.self&&Tn.self.location&&(u=Tn.self.location.protocol.slice(0,-1)),s=!aX.test(u?u.toLowerCase():"")}i=s}if(i)Zi(t,"complete"),Zi(t,"success");else{t.m=6;try{var p=2<Ua(t)?t.g.statusText:""}catch{p=""}t.j=p+" ["+t.da()+"]",gF(t)}}finally{yb(t)}}}}function yb(t,e){if(t.g){yF(t);const i=t.g,s=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Zi(t,"ready");try{i.onreadystatechange=s}catch{}}}function yF(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(Tn.clearTimeout(t.A),t.A=null)}Gt.isActive=function(){return!!this.g};function Ua(t){return t.g?t.g.readyState:0}Gt.da=function(){try{return 2<Ua(this)?this.g.status:-1}catch{return-1}};Gt.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};Gt.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),sX(e)}};function $D(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case mF:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}function uX(t){const e={};t=(t.g&&2<=Ua(t)&&t.g.getAllResponseHeaders()||"").split(`\r
`);for(let s=0;s<t.length;s++){if(I_(t[s]))continue;var i=LZ(t[s]);const u=i[0];if(i=i[1],typeof i!="string")continue;i=i.trim();const p=e[u]||[];e[u]=p,p.push(i)}PZ(e,function(s){return s.join(", ")})}Gt.Ia=function(){return this.m};Gt.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function vF(t){let e="";return lP(t,function(i,s){e+=s,e+=":",e+=i,e+=`\r
`}),e}function wP(t,e,i){e:{for(s in i){var s=!1;break e}s=!0}s||(i=vF(i),typeof t=="string"?i!=null&&encodeURIComponent(String(i)):Nr(t,e,i))}function Eg(t,e,i){return i&&i.internalChannelParams&&i.internalChannelParams[t]||e}function xF(t){this.Ga=0,this.j=[],this.l=new ub,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Eg("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Eg("baseRetryDelayMs",5e3,t),this.hb=Eg("retryDelaySeedMs",1e4,t),this.eb=Eg("forwardChannelMaxRetries",2,t),this.xa=Eg("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new cF(t&&t.concurrentRequestLimit),this.Ja=new rX,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}Gt=xF.prototype;Gt.ra=8;Gt.H=1;function TP(t){if(bF(t),t.H==3){var e=t.W++,i=Xl(t.I);if(Nr(i,"SID",t.K),Nr(i,"RID",e),Nr(i,"TYPE","terminate"),wy(t,i),e=new vy(t,t.l,e),e.L=2,e.v=mb(Xl(i)),i=!1,Tn.navigator&&Tn.navigator.sendBeacon)try{i=Tn.navigator.sendBeacon(e.v.toString(),"")}catch{}!i&&Tn.Image&&(new Image().src=e.v,i=!0),i||(e.g=kF(e.l,null),e.g.ha(e.v)),e.G=Date.now(),xy(e)}AF(t)}function vb(t){t.g&&(SP(t),t.g.cancel(),t.g=null)}function bF(t){vb(t),t.u&&(Tn.clearTimeout(t.u),t.u=null),gx(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&Tn.clearTimeout(t.m),t.m=null)}function xb(t){if(!uF(t.i)&&!t.m){t.m=!0;var e=t.Na;P_||G5(),k_||(P_(),k_=!0),pP.add(e,t),t.C=0}}function hX(t,e){return hF(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.j=e.F.concat(t.j),!0):t.H==1||t.H==2||t.C>=(t.cb?0:t.eb)?!1:(t.m=_y(uo(t.Na,t,e),IF(t,t.C)),t.C++,!0)}Gt.Na=function(t){if(this.m)if(this.m=null,this.H==1){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const u=new vy(this,this.l,t);let p=this.s;if(this.U&&(p?(p=z5(p),N5(p,this.U)):p=this.U),this.o!==null||this.O||(u.I=p,p=null),this.P)e:{for(var e=0,i=0;i<this.j.length;i++){t:{var s=this.j[i];if("__data__"in s.map&&(s=s.map.__data__,typeof s=="string")){s=s.length;break t}s=void 0}if(s===void 0)break;if(e+=s,4096<e){e=i;break e}if(e===4096||i===this.j.length-1){e=i+1;break e}}e=1e3}else e=1e3;e=wF(this,u,e),i=Xl(this.I),Nr(i,"RID",t),Nr(i,"CVER",22),this.F&&Nr(i,"X-HTTP-Session-Id",this.F),wy(this,i),p&&(this.O?e="headers="+encodeURIComponent(String(vF(p)))+"&"+e:this.o&&wP(i,this.o,p)),xP(this.i,u),this.bb&&Nr(i,"TYPE","init"),this.P?(Nr(i,"$req",e),Nr(i,"SID","null"),u.aa=!0,NS(u,i,null)):NS(u,i,e),this.H=2}}else this.H==3&&(t?GD(this,t):this.j.length==0||uF(this.i)||GD(this))};function GD(t,e){var i;e?i=e.m:i=t.W++;const s=Xl(t.I);Nr(s,"SID",t.K),Nr(s,"RID",i),Nr(s,"AID",t.V),wy(t,s),t.o&&t.s&&wP(s,t.o,t.s),i=new vy(t,t.l,i,t.C+1),t.o===null&&(i.I=t.s),e&&(t.j=e.F.concat(t.j)),e=wF(t,i,1e3),i.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),xP(t.i,i),NS(i,s,e)}function wy(t,e){t.na&&lP(t.na,function(i,s){Nr(e,s,i)}),t.h&&iF({},function(i,s){Nr(e,s,i)})}function wF(t,e,i){i=Math.min(t.j.length,i);var s=t.h?uo(t.h.Va,t.h,t):null;e:{var u=t.j;let p=-1;for(;;){const v=["count="+i];p==-1?0<i?(p=u[0].g,v.push("ofs="+p)):p=0:v.push("ofs="+p);let a=!0;for(let A=0;A<i;A++){let O=u[A].g;const B=u[A].map;if(O-=p,0>O)p=Math.max(0,u[A].g-100),a=!1;else try{iX(B,v,"req"+O+"_")}catch{s&&s(B)}}if(a){s=v.join("&");break e}}}return t=t.j.splice(0,i),e.F=t,s}function TF(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;P_||G5(),k_||(P_(),k_=!0),pP.add(e,t),t.A=0}}function EP(t){return t.g||t.u||3<=t.A?!1:(t.ba++,t.u=_y(uo(t.Ma,t),IF(t,t.A)),t.A++,!0)}Gt.Ma=function(){if(this.u=null,EF(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=_y(uo(this.jb,this),t)}};Gt.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,bo(10),vb(this),EF(this))};function SP(t){t.B!=null&&(Tn.clearTimeout(t.B),t.B=null)}function EF(t){t.g=new vy(t,t.l,"rpc",t.ba),t.o===null&&(t.g.I=t.s),t.g.O=0;var e=Xl(t.wa);Nr(e,"RID","rpc"),Nr(e,"SID",t.K),Nr(e,"AID",t.V),Nr(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Nr(e,"TO",t.qa),Nr(e,"TYPE","xmlhttp"),wy(t,e),t.o&&t.s&&wP(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var i=t.g;t=t.pa,i.L=1,i.v=mb(Xl(e)),i.s=null,i.S=!0,eF(i,t)}Gt.ib=function(){this.v!=null&&(this.v=null,vb(this),EP(this),bo(19))};function gx(t){t.v!=null&&(Tn.clearTimeout(t.v),t.v=null)}function SF(t,e){var i=null;if(t.g==e){gx(t),SP(t),t.g=null;var s=2}else if(BS(t.i,e))i=e.F,dF(t.i,e),s=1;else return;if(t.H!=0){if(e.i)if(s==1){i=e.s?e.s.length:0,e=Date.now()-e.G;var u=t.C;s=hb(),Zi(s,new Y5(s,i)),xb(t)}else TF(t);else if(u=e.o,u==3||u==0&&0<e.ca||!(s==1&&hX(t,e)||s==2&&EP(t)))switch(i&&0<i.length&&(e=t.i,e.i=e.i.concat(i)),u){case 1:kh(t,5);break;case 4:kh(t,10);break;case 3:kh(t,6);break;default:kh(t,2)}}}function IF(t,e){let i=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(i*=2),i*e}function kh(t,e){if(t.l.info("Error code "+e),e==2){var i=null;t.h&&(i=null);var s=uo(t.pb,t);i||(i=new Dh("//www.google.com/images/cleardot.gif"),Tn.location&&Tn.location.protocol=="http"||px(i,"https"),mb(i)),oX(i.toString(),s)}else bo(2);t.H=0,t.h&&t.h.za(e),AF(t),bF(t)}Gt.pb=function(t){t?(this.l.info("Successfully pinged google.com"),bo(2)):(this.l.info("Failed to ping google.com"),bo(1))};function AF(t){if(t.H=0,t.ma=[],t.h){const e=fF(t.i);(e.length!=0||t.j.length!=0)&&(DD(t.ma,e),DD(t.ma,t.j),t.i.i.length=0,sP(t.j),t.j.length=0),t.h.ya()}}function PF(t,e,i){var s=i instanceof Dh?Xl(i):new Dh(i);if(s.g!="")e&&(s.g=e+"."+s.g),mx(s,s.m);else{var u=Tn.location;s=u.protocol,e=e?e+"."+u.hostname:u.hostname,u=+u.port;var p=new Dh(null);s&&px(p,s),e&&(p.g=e),u&&mx(p,u),i&&(p.l=i),s=p}return i=t.F,e=t.Da,i&&e&&Nr(s,i,e),Nr(s,"VER",t.ra),wy(t,s),s}function kF(t,e,i){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=i&&t.Ha&&!t.va?new Jr(new gb({ob:!0})):new Jr(t.va),e.Oa(t.J),e}Gt.isActive=function(){return!!this.h&&this.h.isActive(this)};function CF(){}Gt=CF.prototype;Gt.Ba=function(){};Gt.Aa=function(){};Gt.za=function(){};Gt.ya=function(){};Gt.isActive=function(){return!0};Gt.Va=function(){};function _x(){if(ep&&!(10<=Number(EZ)))throw Error("Environmental error: no available transport.")}_x.prototype.g=function(t,e){return new ps(t,e)};function ps(t,e){Mi.call(this),this.g=new xF(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!I_(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!I_(e)&&(this.g.F=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new Ep(this)}Ri(ps,Mi);ps.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,i=this.h||void 0;bo(0),t.Y=e,t.na=i||{},t.G=t.aa,t.I=PF(t,null,t.Y),xb(t)};ps.prototype.close=function(){TP(this.g)};ps.prototype.u=function(t){var e=this.g;if(typeof t=="string"){var i={};i.__data__=t,t=i}else this.v&&(i={},i.__data__=fP(t),t=i);e.j.push(new eX(e.fb++,t)),e.H==3&&xb(e)};ps.prototype.N=function(){this.g.h=null,delete this.j,TP(this.g),delete this.g,ps.$.N.call(this)};function MF(t){yP.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){e:{for(const i in e){t=i;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}Ri(MF,yP);function RF(){vP.call(this),this.status=1}Ri(RF,vP);function Ep(t){this.g=t}Ri(Ep,CF);Ep.prototype.Ba=function(){Zi(this.g,"a")};Ep.prototype.Aa=function(t){Zi(this.g,new MF(t))};Ep.prototype.za=function(t){Zi(this.g,new RF)};Ep.prototype.ya=function(){Zi(this.g,"b")};function dX(){this.blockSize=-1}function ha(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Ri(ha,dX);ha.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function hE(t,e,i){i||(i=0);var s=Array(16);if(typeof e=="string")for(var u=0;16>u;++u)s[u]=e.charCodeAt(i++)|e.charCodeAt(i++)<<8|e.charCodeAt(i++)<<16|e.charCodeAt(i++)<<24;else for(u=0;16>u;++u)s[u]=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;e=t.g[0],i=t.g[1],u=t.g[2];var p=t.g[3],v=e+(p^i&(u^p))+s[0]+3614090360&4294967295;e=i+(v<<7&4294967295|v>>>25),v=p+(u^e&(i^u))+s[1]+3905402710&4294967295,p=e+(v<<12&4294967295|v>>>20),v=u+(i^p&(e^i))+s[2]+606105819&4294967295,u=p+(v<<17&4294967295|v>>>15),v=i+(e^u&(p^e))+s[3]+3250441966&4294967295,i=u+(v<<22&4294967295|v>>>10),v=e+(p^i&(u^p))+s[4]+4118548399&4294967295,e=i+(v<<7&4294967295|v>>>25),v=p+(u^e&(i^u))+s[5]+1200080426&4294967295,p=e+(v<<12&4294967295|v>>>20),v=u+(i^p&(e^i))+s[6]+2821735955&4294967295,u=p+(v<<17&4294967295|v>>>15),v=i+(e^u&(p^e))+s[7]+4249261313&4294967295,i=u+(v<<22&4294967295|v>>>10),v=e+(p^i&(u^p))+s[8]+1770035416&4294967295,e=i+(v<<7&4294967295|v>>>25),v=p+(u^e&(i^u))+s[9]+2336552879&4294967295,p=e+(v<<12&4294967295|v>>>20),v=u+(i^p&(e^i))+s[10]+4294925233&4294967295,u=p+(v<<17&4294967295|v>>>15),v=i+(e^u&(p^e))+s[11]+2304563134&4294967295,i=u+(v<<22&4294967295|v>>>10),v=e+(p^i&(u^p))+s[12]+1804603682&4294967295,e=i+(v<<7&4294967295|v>>>25),v=p+(u^e&(i^u))+s[13]+4254626195&4294967295,p=e+(v<<12&4294967295|v>>>20),v=u+(i^p&(e^i))+s[14]+2792965006&4294967295,u=p+(v<<17&4294967295|v>>>15),v=i+(e^u&(p^e))+s[15]+1236535329&4294967295,i=u+(v<<22&4294967295|v>>>10),v=e+(u^p&(i^u))+s[1]+4129170786&4294967295,e=i+(v<<5&4294967295|v>>>27),v=p+(i^u&(e^i))+s[6]+3225465664&4294967295,p=e+(v<<9&4294967295|v>>>23),v=u+(e^i&(p^e))+s[11]+643717713&4294967295,u=p+(v<<14&4294967295|v>>>18),v=i+(p^e&(u^p))+s[0]+3921069994&4294967295,i=u+(v<<20&4294967295|v>>>12),v=e+(u^p&(i^u))+s[5]+3593408605&4294967295,e=i+(v<<5&4294967295|v>>>27),v=p+(i^u&(e^i))+s[10]+38016083&4294967295,p=e+(v<<9&4294967295|v>>>23),v=u+(e^i&(p^e))+s[15]+3634488961&4294967295,u=p+(v<<14&4294967295|v>>>18),v=i+(p^e&(u^p))+s[4]+3889429448&4294967295,i=u+(v<<20&4294967295|v>>>12),v=e+(u^p&(i^u))+s[9]+568446438&4294967295,e=i+(v<<5&4294967295|v>>>27),v=p+(i^u&(e^i))+s[14]+3275163606&4294967295,p=e+(v<<9&4294967295|v>>>23),v=u+(e^i&(p^e))+s[3]+4107603335&4294967295,u=p+(v<<14&4294967295|v>>>18),v=i+(p^e&(u^p))+s[8]+1163531501&4294967295,i=u+(v<<20&4294967295|v>>>12),v=e+(u^p&(i^u))+s[13]+2850285829&4294967295,e=i+(v<<5&4294967295|v>>>27),v=p+(i^u&(e^i))+s[2]+4243563512&4294967295,p=e+(v<<9&4294967295|v>>>23),v=u+(e^i&(p^e))+s[7]+1735328473&4294967295,u=p+(v<<14&4294967295|v>>>18),v=i+(p^e&(u^p))+s[12]+2368359562&4294967295,i=u+(v<<20&4294967295|v>>>12),v=e+(i^u^p)+s[5]+4294588738&4294967295,e=i+(v<<4&4294967295|v>>>28),v=p+(e^i^u)+s[8]+2272392833&4294967295,p=e+(v<<11&4294967295|v>>>21),v=u+(p^e^i)+s[11]+1839030562&4294967295,u=p+(v<<16&4294967295|v>>>16),v=i+(u^p^e)+s[14]+4259657740&4294967295,i=u+(v<<23&4294967295|v>>>9),v=e+(i^u^p)+s[1]+2763975236&4294967295,e=i+(v<<4&4294967295|v>>>28),v=p+(e^i^u)+s[4]+1272893353&4294967295,p=e+(v<<11&4294967295|v>>>21),v=u+(p^e^i)+s[7]+4139469664&4294967295,u=p+(v<<16&4294967295|v>>>16),v=i+(u^p^e)+s[10]+3200236656&4294967295,i=u+(v<<23&4294967295|v>>>9),v=e+(i^u^p)+s[13]+681279174&4294967295,e=i+(v<<4&4294967295|v>>>28),v=p+(e^i^u)+s[0]+3936430074&4294967295,p=e+(v<<11&4294967295|v>>>21),v=u+(p^e^i)+s[3]+3572445317&4294967295,u=p+(v<<16&4294967295|v>>>16),v=i+(u^p^e)+s[6]+76029189&4294967295,i=u+(v<<23&4294967295|v>>>9),v=e+(i^u^p)+s[9]+3654602809&4294967295,e=i+(v<<4&4294967295|v>>>28),v=p+(e^i^u)+s[12]+3873151461&4294967295,p=e+(v<<11&4294967295|v>>>21),v=u+(p^e^i)+s[15]+530742520&4294967295,u=p+(v<<16&4294967295|v>>>16),v=i+(u^p^e)+s[2]+3299628645&4294967295,i=u+(v<<23&4294967295|v>>>9),v=e+(u^(i|~p))+s[0]+4096336452&4294967295,e=i+(v<<6&4294967295|v>>>26),v=p+(i^(e|~u))+s[7]+1126891415&4294967295,p=e+(v<<10&4294967295|v>>>22),v=u+(e^(p|~i))+s[14]+2878612391&4294967295,u=p+(v<<15&4294967295|v>>>17),v=i+(p^(u|~e))+s[5]+4237533241&4294967295,i=u+(v<<21&4294967295|v>>>11),v=e+(u^(i|~p))+s[12]+1700485571&4294967295,e=i+(v<<6&4294967295|v>>>26),v=p+(i^(e|~u))+s[3]+2399980690&4294967295,p=e+(v<<10&4294967295|v>>>22),v=u+(e^(p|~i))+s[10]+4293915773&4294967295,u=p+(v<<15&4294967295|v>>>17),v=i+(p^(u|~e))+s[1]+2240044497&4294967295,i=u+(v<<21&4294967295|v>>>11),v=e+(u^(i|~p))+s[8]+1873313359&4294967295,e=i+(v<<6&4294967295|v>>>26),v=p+(i^(e|~u))+s[15]+4264355552&4294967295,p=e+(v<<10&4294967295|v>>>22),v=u+(e^(p|~i))+s[6]+2734768916&4294967295,u=p+(v<<15&4294967295|v>>>17),v=i+(p^(u|~e))+s[13]+1309151649&4294967295,i=u+(v<<21&4294967295|v>>>11),v=e+(u^(i|~p))+s[4]+4149444226&4294967295,e=i+(v<<6&4294967295|v>>>26),v=p+(i^(e|~u))+s[11]+3174756917&4294967295,p=e+(v<<10&4294967295|v>>>22),v=u+(e^(p|~i))+s[2]+718787259&4294967295,u=p+(v<<15&4294967295|v>>>17),v=i+(p^(u|~e))+s[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(u+(v<<21&4294967295|v>>>11))&4294967295,t.g[2]=t.g[2]+u&4294967295,t.g[3]=t.g[3]+p&4294967295}ha.prototype.j=function(t,e){e===void 0&&(e=t.length);for(var i=e-this.blockSize,s=this.m,u=this.h,p=0;p<e;){if(u==0)for(;p<=i;)hE(this,t,p),p+=this.blockSize;if(typeof t=="string"){for(;p<e;)if(s[u++]=t.charCodeAt(p++),u==this.blockSize){hE(this,s),u=0;break}}else for(;p<e;)if(s[u++]=t[p++],u==this.blockSize){hE(this,s),u=0;break}}this.h=u,this.i+=e};ha.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var i=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=i&255,i/=256;for(this.j(t),t=Array(16),e=i=0;4>e;++e)for(var s=0;32>s;s+=8)t[i++]=this.g[e]>>>s&255;return t};function vr(t,e){this.h=e;for(var i=[],s=!0,u=t.length-1;0<=u;u--){var p=t[u]|0;s&&p==e||(i[u]=p,s=!1)}this.g=i}var fX={};function IP(t){return-128<=t&&128>t?bZ(t,function(e){return new vr([e|0],0>e?-1:0)}):new vr([t|0],0>t?-1:0)}function $a(t){if(isNaN(t)||!isFinite(t))return Vf;if(0>t)return Wi($a(-t));for(var e=[],i=1,s=0;t>=i;s++)e[s]=t/i|0,i*=jS;return new vr(e,0)}function OF(t,e){if(t.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(t.charAt(0)=="-")return Wi(OF(t.substring(1),e));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=$a(Math.pow(e,8)),s=Vf,u=0;u<t.length;u+=8){var p=Math.min(8,t.length-u),v=parseInt(t.substring(u,u+p),e);8>p?(p=$a(Math.pow(e,p)),s=s.R(p).add($a(v))):(s=s.R(i),s=s.add($a(v)))}return s}var jS=4294967296,Vf=IP(0),VS=IP(1),WD=IP(16777216);Gt=vr.prototype;Gt.ea=function(){if(Rs(this))return-Wi(this).ea();for(var t=0,e=1,i=0;i<this.g.length;i++){var s=this.D(i);t+=(0<=s?s:jS+s)*e,e*=jS}return t};Gt.toString=function(t){if(t=t||10,2>t||36<t)throw Error("radix out of range: "+t);if(Bl(this))return"0";if(Rs(this))return"-"+Wi(this).toString(t);for(var e=$a(Math.pow(t,6)),i=this,s="";;){var u=vx(i,e).g;i=yx(i,u.R(e));var p=((0<i.g.length?i.g[0]:i.h)>>>0).toString(t);if(i=u,Bl(i))return p+s;for(;6>p.length;)p="0"+p;s=p+s}};Gt.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h};function Bl(t){if(t.h!=0)return!1;for(var e=0;e<t.g.length;e++)if(t.g[e]!=0)return!1;return!0}function Rs(t){return t.h==-1}Gt.X=function(t){return t=yx(this,t),Rs(t)?-1:Bl(t)?0:1};function Wi(t){for(var e=t.g.length,i=[],s=0;s<e;s++)i[s]=~t.g[s];return new vr(i,~t.h).add(VS)}Gt.abs=function(){return Rs(this)?Wi(this):this};Gt.add=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],s=0,u=0;u<=e;u++){var p=s+(this.D(u)&65535)+(t.D(u)&65535),v=(p>>>16)+(this.D(u)>>>16)+(t.D(u)>>>16);s=v>>>16,p&=65535,v&=65535,i[u]=v<<16|p}return new vr(i,i[i.length-1]&-2147483648?-1:0)};function yx(t,e){return t.add(Wi(e))}Gt.R=function(t){if(Bl(this)||Bl(t))return Vf;if(Rs(this))return Rs(t)?Wi(this).R(Wi(t)):Wi(Wi(this).R(t));if(Rs(t))return Wi(this.R(Wi(t)));if(0>this.X(WD)&&0>t.X(WD))return $a(this.ea()*t.ea());for(var e=this.g.length+t.g.length,i=[],s=0;s<2*e;s++)i[s]=0;for(s=0;s<this.g.length;s++)for(var u=0;u<t.g.length;u++){var p=this.D(s)>>>16,v=this.D(s)&65535,a=t.D(u)>>>16,A=t.D(u)&65535;i[2*s+2*u]+=v*A,Yv(i,2*s+2*u),i[2*s+2*u+1]+=p*A,Yv(i,2*s+2*u+1),i[2*s+2*u+1]+=v*a,Yv(i,2*s+2*u+1),i[2*s+2*u+2]+=p*a,Yv(i,2*s+2*u+2)}for(s=0;s<e;s++)i[s]=i[2*s+1]<<16|i[2*s];for(s=e;s<2*e;s++)i[s]=0;return new vr(i,0)};function Yv(t,e){for(;(t[e]&65535)!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function Sg(t,e){this.g=t,this.h=e}function vx(t,e){if(Bl(e))throw Error("division by zero");if(Bl(t))return new Sg(Vf,Vf);if(Rs(t))return e=vx(Wi(t),e),new Sg(Wi(e.g),Wi(e.h));if(Rs(e))return e=vx(t,Wi(e)),new Sg(Wi(e.g),e.h);if(30<t.g.length){if(Rs(t)||Rs(e))throw Error("slowDivide_ only works with positive integers.");for(var i=VS,s=e;0>=s.X(t);)i=qD(i),s=qD(s);var u=df(i,1),p=df(s,1);for(s=df(s,2),i=df(i,2);!Bl(s);){var v=p.add(s);0>=v.X(t)&&(u=u.add(i),p=v),s=df(s,1),i=df(i,1)}return e=yx(t,u.R(e)),new Sg(u,e)}for(u=Vf;0<=t.X(e);){for(i=Math.max(1,Math.floor(t.ea()/e.ea())),s=Math.ceil(Math.log(i)/Math.LN2),s=48>=s?1:Math.pow(2,s-48),p=$a(i),v=p.R(e);Rs(v)||0<v.X(t);)i-=s,p=$a(i),v=p.R(e);Bl(p)&&(p=VS),u=u.add(p),t=yx(t,v)}return new Sg(u,t)}Gt.gb=function(t){return vx(this,t).h};Gt.and=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],s=0;s<e;s++)i[s]=this.D(s)&t.D(s);return new vr(i,this.h&t.h)};Gt.or=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],s=0;s<e;s++)i[s]=this.D(s)|t.D(s);return new vr(i,this.h|t.h)};Gt.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),i=[],s=0;s<e;s++)i[s]=this.D(s)^t.D(s);return new vr(i,this.h^t.h)};function qD(t){for(var e=t.g.length+1,i=[],s=0;s<e;s++)i[s]=t.D(s)<<1|t.D(s-1)>>>31;return new vr(i,t.h)}function df(t,e){var i=e>>5;e%=32;for(var s=t.g.length-i,u=[],p=0;p<s;p++)u[p]=0<e?t.D(p+i)>>>e|t.D(p+i+1)<<32-e:t.D(p+i);return new vr(u,t.h)}_x.prototype.createWebChannel=_x.prototype.g;ps.prototype.send=ps.prototype.u;ps.prototype.open=ps.prototype.m;ps.prototype.close=ps.prototype.close;db.NO_ERROR=0;db.TIMEOUT=8;db.HTTP_ERROR=6;K5.COMPLETE="complete";J5.EventType=yy;yy.OPEN="a";yy.CLOSE="b";yy.ERROR="c";yy.MESSAGE="d";Mi.prototype.listen=Mi.prototype.O;Jr.prototype.listenOnce=Jr.prototype.P;Jr.prototype.getLastError=Jr.prototype.Sa;Jr.prototype.getLastErrorCode=Jr.prototype.Ia;Jr.prototype.getStatus=Jr.prototype.da;Jr.prototype.getResponseJson=Jr.prototype.Wa;Jr.prototype.getResponseText=Jr.prototype.ja;Jr.prototype.send=Jr.prototype.ha;Jr.prototype.setWithCredentials=Jr.prototype.Oa;ha.prototype.digest=ha.prototype.l;ha.prototype.reset=ha.prototype.reset;ha.prototype.update=ha.prototype.j;vr.prototype.add=vr.prototype.add;vr.prototype.multiply=vr.prototype.R;vr.prototype.modulo=vr.prototype.gb;vr.prototype.compare=vr.prototype.X;vr.prototype.toNumber=vr.prototype.ea;vr.prototype.toString=vr.prototype.toString;vr.prototype.getBits=vr.prototype.D;vr.fromNumber=$a;vr.fromString=OF;var pX=function(){return new _x},mX=function(){return hb()},dE=db,gX=K5,_X=ed,HD={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Kv=J5,yX=Jr,vX=ha,Uf=vr;const ZD="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ao.UNAUTHENTICATED=new ao(null),ao.GOOGLE_CREDENTIALS=new ao("google-credentials-uid"),ao.FIRST_PARTY=new ao("first-party-uid"),ao.MOCK_USER=new ao("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sp="10.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qh=new qA("@firebase/firestore");function Ig(){return qh.logLevel}function Kt(t,...e){if(qh.logLevel<=qn.DEBUG){const i=e.map(AP);qh.debug(`Firestore (${Sp}): ${t}`,...i)}}function Yl(t,...e){if(qh.logLevel<=qn.ERROR){const i=e.map(AP);qh.error(`Firestore (${Sp}): ${t}`,...i)}}function tp(t,...e){if(qh.logLevel<=qn.WARN){const i=e.map(AP);qh.warn(`Firestore (${Sp}): ${t}`,...i)}}function AP(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xn(t="Unexpected state"){const e=`FIRESTORE (${Sp}) INTERNAL ASSERTION FAILED: `+t;throw Yl(e),new Error(e)}function jr(t,e){t||xn()}function Pn(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ht={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ht extends ic{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vl{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DF{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class xX{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(ao.UNAUTHENTICATED))}shutdown(){}}class bX{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class wX{constructor(e){this.t=e,this.currentUser=ao.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){let s=this.i;const u=A=>this.i!==s?(s=this.i,i(A)):Promise.resolve();let p=new Vl;this.o=()=>{this.i++,this.currentUser=this.u(),p.resolve(),p=new Vl,e.enqueueRetryable(()=>u(this.currentUser))};const v=()=>{const A=p;e.enqueueRetryable(async()=>{await A.promise,await u(this.currentUser)})},a=A=>{Kt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=A,this.auth.addAuthTokenListener(this.o),v()};this.t.onInit(A=>a(A)),setTimeout(()=>{if(!this.auth){const A=this.t.getImmediate({optional:!0});A?a(A):(Kt("FirebaseAuthCredentialsProvider","Auth not yet detected"),p.resolve(),p=new Vl)}},0),v()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(s=>this.i!==e?(Kt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(jr(typeof s.accessToken=="string"),new DF(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return jr(e===null||typeof e=="string"),new ao(e)}}class TX{constructor(e,i,s){this.l=e,this.h=i,this.P=s,this.type="FirstParty",this.user=ao.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class EX{constructor(e,i,s){this.l=e,this.h=i,this.P=s}getToken(){return Promise.resolve(new TX(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(ao.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class SX{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class IX{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,i){const s=p=>{p.error!=null&&Kt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${p.error.message}`);const v=p.token!==this.R;return this.R=p.token,Kt("FirebaseAppCheckTokenProvider",`Received ${v?"new":"existing"} token.`),v?i(p.token):Promise.resolve()};this.o=p=>{e.enqueueRetryable(()=>s(p))};const u=p=>{Kt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=p,this.appCheck.addTokenListener(this.o)};this.A.onInit(p=>u(p)),setTimeout(()=>{if(!this.appCheck){const p=this.A.getImmediate({optional:!0});p?u(p):Kt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(jr(typeof i.token=="string"),this.R=i.token,new SX(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AX(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let s=0;s<t;s++)i[s]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LF{static V(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=Math.floor(256/e.length)*e.length;let s="";for(;s.length<20;){const u=AX(40);for(let p=0;p<u.length;++p)s.length<20&&u[p]<i&&(s+=e.charAt(u[p]%e.length))}return s}}function dr(t,e){return t<e?-1:t>e?1:0}function np(t,e,i){return t.length===e.length&&t.every((s,u)=>i(s,e[u]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new Ht(ht.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Ht(ht.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<-62135596800)throw new Ht(ht.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ht(ht.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return _i.fromMillis(Date.now())}static fromDate(e){return _i.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),s=Math.floor(1e6*(e-1e3*i));return new _i(i,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?dr(this.nanoseconds,e.nanoseconds):dr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(e){this.timestamp=e}static fromTimestamp(e){return new En(e)}static min(){return new En(new _i(0,0))}static max(){return new En(new _i(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D_{constructor(e,i,s){i===void 0?i=0:i>e.length&&xn(),s===void 0?s=e.length-i:s>e.length-i&&xn(),this.segments=e,this.offset=i,this.len=s}get length(){return this.len}isEqual(e){return D_.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof D_?e.forEach(s=>{i.push(s)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,s=this.limit();i<s;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const s=Math.min(e.length,i.length);for(let u=0;u<s;u++){const p=e.get(u),v=i.get(u);if(p<v)return-1;if(p>v)return 1}return e.length<i.length?-1:e.length>i.length?1:0}}class Fr extends D_{construct(e,i,s){return new Fr(e,i,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const i=[];for(const s of e){if(s.indexOf("//")>=0)throw new Ht(ht.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);i.push(...s.split("/").filter(u=>u.length>0))}return new Fr(i)}static emptyPath(){return new Fr([])}}const PX=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qi extends D_{construct(e,i,s){return new qi(e,i,s)}static isValidIdentifier(e){return PX.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),qi.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new qi(["__name__"])}static fromServerFormat(e){const i=[];let s="",u=0;const p=()=>{if(s.length===0)throw new Ht(ht.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(s),s=""};let v=!1;for(;u<e.length;){const a=e[u];if(a==="\\"){if(u+1===e.length)throw new Ht(ht.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const A=e[u+1];if(A!=="\\"&&A!=="."&&A!=="`")throw new Ht(ht.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=A,u+=2}else a==="`"?(v=!v,u++):a!=="."||v?(s+=a,u++):(p(),u++)}if(p(),v)throw new Ht(ht.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new qi(i)}static emptyPath(){return new qi([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class an{constructor(e){this.path=e}static fromPath(e){return new an(Fr.fromString(e))}static fromName(e){return new an(Fr.fromString(e).popFirst(5))}static empty(){return new an(Fr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Fr.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return Fr.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new an(new Fr(e.slice()))}}function kX(t,e){const i=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,u=En.fromTimestamp(s===1e9?new _i(i+1,0):new _i(i,s));return new _u(u,an.empty(),e)}function CX(t){return new _u(t.readTime,t.key,-1)}class _u{constructor(e,i,s){this.readTime=e,this.documentKey=i,this.largestBatchId=s}static min(){return new _u(En.min(),an.empty(),-1)}static max(){return new _u(En.max(),an.empty(),-1)}}function MX(t,e){let i=t.readTime.compareTo(e.readTime);return i!==0?i:(i=an.comparator(t.documentKey,e.documentKey),i!==0?i:dr(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RX="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class OX{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ty(t){if(t.code!==ht.FAILED_PRECONDITION||t.message!==RX)throw t;Kt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&xn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new vt((s,u)=>{this.nextCallback=p=>{this.wrapSuccess(e,p).next(s,u)},this.catchCallback=p=>{this.wrapFailure(i,p).next(s,u)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof vt?i:vt.resolve(i)}catch(i){return vt.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):vt.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):vt.reject(i)}static resolve(e){return new vt((i,s)=>{i(e)})}static reject(e){return new vt((i,s)=>{s(e)})}static waitFor(e){return new vt((i,s)=>{let u=0,p=0,v=!1;e.forEach(a=>{++u,a.next(()=>{++p,v&&p===u&&i()},A=>s(A))}),v=!0,p===u&&i()})}static or(e){let i=vt.resolve(!1);for(const s of e)i=i.next(u=>u?vt.resolve(u):s());return i}static forEach(e,i){const s=[];return e.forEach((u,p)=>{s.push(i.call(this,u,p))}),this.waitFor(s)}static mapArray(e,i){return new vt((s,u)=>{const p=e.length,v=new Array(p);let a=0;for(let A=0;A<p;A++){const O=A;i(e[O]).next(B=>{v[O]=B,++a,a===p&&s(v)},B=>u(B))}})}static doWhile(e,i){return new vt((s,u)=>{const p=()=>{e()===!0?i().next(()=>{p()},u):s()};p()})}}function Ey(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=s=>this.oe(s),this._e=s=>i.writeSequenceNumber(s))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}PP.ae=-1;function bb(t){return t==null}function xx(t){return t===0&&1/t==-1/0}function DX(t){return typeof t=="number"&&Number.isInteger(t)&&!xx(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XD(t){let e=0;for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&e++;return e}function Ip(t,e){for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&e(i,t[i])}function zF(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yr{constructor(e,i){this.comparator=e,this.root=i||Gi.EMPTY}insert(e,i){return new Yr(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,Gi.BLACK,null,null))}remove(e){return new Yr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Gi.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const s=this.comparator(e,i.key);if(s===0)return i.value;s<0?i=i.left:s>0&&(i=i.right)}return null}indexOf(e){let i=0,s=this.root;for(;!s.isEmpty();){const u=this.comparator(e,s.key);if(u===0)return i+s.left.size;u<0?s=s.left:(i+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,s)=>(e(i,s),!1))}toString(){const e=[];return this.inorderTraversal((i,s)=>(e.push(`${i}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Jv(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Jv(this.root,e,this.comparator,!1)}getReverseIterator(){return new Jv(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Jv(this.root,e,this.comparator,!0)}}class Jv{constructor(e,i,s,u){this.isReverse=u,this.nodeStack=[];let p=1;for(;!e.isEmpty();)if(p=i?s(e.key,i):1,i&&u&&(p*=-1),p<0)e=this.isReverse?e.left:e.right;else{if(p===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Gi{constructor(e,i,s,u,p){this.key=e,this.value=i,this.color=s??Gi.RED,this.left=u??Gi.EMPTY,this.right=p??Gi.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,s,u,p){return new Gi(e??this.key,i??this.value,s??this.color,u??this.left,p??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,s){let u=this;const p=s(e,u.key);return u=p<0?u.copy(null,null,null,u.left.insert(e,i,s),null):p===0?u.copy(null,i,null,null,null):u.copy(null,null,null,null,u.right.insert(e,i,s)),u.fixUp()}removeMin(){if(this.left.isEmpty())return Gi.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let s,u=this;if(i(e,u.key)<0)u.left.isEmpty()||u.left.isRed()||u.left.left.isRed()||(u=u.moveRedLeft()),u=u.copy(null,null,null,u.left.remove(e,i),null);else{if(u.left.isRed()&&(u=u.rotateRight()),u.right.isEmpty()||u.right.isRed()||u.right.left.isRed()||(u=u.moveRedRight()),i(e,u.key)===0){if(u.right.isEmpty())return Gi.EMPTY;s=u.right.min(),u=u.copy(s.key,s.value,null,null,u.right.removeMin())}u=u.copy(null,null,null,null,u.right.remove(e,i))}return u.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Gi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Gi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw xn();const e=this.left.check();if(e!==this.right.check())throw xn();return e+(this.isRed()?0:1)}}Gi.EMPTY=null,Gi.RED=!0,Gi.BLACK=!1;Gi.EMPTY=new class{constructor(){this.size=0}get key(){throw xn()}get value(){throw xn()}get color(){throw xn()}get left(){throw xn()}get right(){throw xn()}copy(e,i,s,u,p){return this}insert(e,i,s){return new Gi(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xi{constructor(e){this.comparator=e,this.data=new Yr(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,s)=>(e(i),!1))}forEachInRange(e,i){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const u=s.getNext();if(this.comparator(u.key,e[1])>=0)return;i(u.key)}}forEachWhile(e,i){let s;for(s=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new YD(this.data.getIterator())}getIteratorFrom(e){return new YD(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(s=>{i=i.add(s)}),i}isEqual(e){if(!(e instanceof Xi)||this.size!==e.size)return!1;const i=this.data.getIterator(),s=e.data.getIterator();for(;i.hasNext();){const u=i.getNext().key,p=s.getNext().key;if(this.comparator(u,p)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new Xi(this.comparator);return i.data=e,i}}class YD{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e){this.fields=e,e.sort(qi.comparator)}static empty(){return new aa([])}unionWith(e){let i=new Xi(qi.comparator);for(const s of this.fields)i=i.add(s);for(const s of e)i=i.add(s);return new aa(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return np(this.fields,e.fields,(i,s)=>i.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NF extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mo{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(u){try{return atob(u)}catch(p){throw typeof DOMException<"u"&&p instanceof DOMException?new NF("Invalid base64 string: "+p):p}}(e);return new mo(i)}static fromUint8Array(e){const i=function(u){let p="";for(let v=0;v<u.length;++v)p+=String.fromCharCode(u[v]);return p}(e);return new mo(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const s=new Uint8Array(i.length);for(let u=0;u<i.length;u++)s[u]=i.charCodeAt(u);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return dr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}mo.EMPTY_BYTE_STRING=new mo("");const LX=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function yu(t){if(jr(!!t),typeof t=="string"){let e=0;const i=LX.exec(t);if(jr(!!i),i[1]){let u=i[1];u=(u+"000000000").substr(0,9),e=Number(u)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:fi(t.seconds),nanos:fi(t.nanos)}}function fi(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Hh(t){return typeof t=="string"?mo.fromBase64String(t):mo.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kP(t){var e,i;return((i=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||i===void 0?void 0:i.stringValue)==="server_timestamp"}function CP(t){const e=t.mapValue.fields.__previous_value__;return kP(e)?CP(e):e}function L_(t){const e=yu(t.mapValue.fields.__local_write_time__.timestampValue);return new _i(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zX{constructor(e,i,s,u,p,v,a,A,O){this.databaseId=e,this.appId=i,this.persistenceKey=s,this.host=u,this.ssl=p,this.forceLongPolling=v,this.autoDetectLongPolling=a,this.longPollingOptions=A,this.useFetchStreams=O}}class z_{constructor(e,i){this.projectId=e,this.database=i||"(default)"}static empty(){return new z_("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof z_&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qv={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Zh(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?kP(t)?4:NX(t)?9007199254740991:10:xn()}function Ja(t,e){if(t===e)return!0;const i=Zh(t);if(i!==Zh(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return L_(t).isEqual(L_(e));case 3:return function(u,p){if(typeof u.timestampValue=="string"&&typeof p.timestampValue=="string"&&u.timestampValue.length===p.timestampValue.length)return u.timestampValue===p.timestampValue;const v=yu(u.timestampValue),a=yu(p.timestampValue);return v.seconds===a.seconds&&v.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(u,p){return Hh(u.bytesValue).isEqual(Hh(p.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(u,p){return fi(u.geoPointValue.latitude)===fi(p.geoPointValue.latitude)&&fi(u.geoPointValue.longitude)===fi(p.geoPointValue.longitude)}(t,e);case 2:return function(u,p){if("integerValue"in u&&"integerValue"in p)return fi(u.integerValue)===fi(p.integerValue);if("doubleValue"in u&&"doubleValue"in p){const v=fi(u.doubleValue),a=fi(p.doubleValue);return v===a?xx(v)===xx(a):isNaN(v)&&isNaN(a)}return!1}(t,e);case 9:return np(t.arrayValue.values||[],e.arrayValue.values||[],Ja);case 10:return function(u,p){const v=u.mapValue.fields||{},a=p.mapValue.fields||{};if(XD(v)!==XD(a))return!1;for(const A in v)if(v.hasOwnProperty(A)&&(a[A]===void 0||!Ja(v[A],a[A])))return!1;return!0}(t,e);default:return xn()}}function N_(t,e){return(t.values||[]).find(i=>Ja(i,e))!==void 0}function rp(t,e){if(t===e)return 0;const i=Zh(t),s=Zh(e);if(i!==s)return dr(i,s);switch(i){case 0:case 9007199254740991:return 0;case 1:return dr(t.booleanValue,e.booleanValue);case 2:return function(p,v){const a=fi(p.integerValue||p.doubleValue),A=fi(v.integerValue||v.doubleValue);return a<A?-1:a>A?1:a===A?0:isNaN(a)?isNaN(A)?0:-1:1}(t,e);case 3:return KD(t.timestampValue,e.timestampValue);case 4:return KD(L_(t),L_(e));case 5:return dr(t.stringValue,e.stringValue);case 6:return function(p,v){const a=Hh(p),A=Hh(v);return a.compareTo(A)}(t.bytesValue,e.bytesValue);case 7:return function(p,v){const a=p.split("/"),A=v.split("/");for(let O=0;O<a.length&&O<A.length;O++){const B=dr(a[O],A[O]);if(B!==0)return B}return dr(a.length,A.length)}(t.referenceValue,e.referenceValue);case 8:return function(p,v){const a=dr(fi(p.latitude),fi(v.latitude));return a!==0?a:dr(fi(p.longitude),fi(v.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(p,v){const a=p.values||[],A=v.values||[];for(let O=0;O<a.length&&O<A.length;++O){const B=rp(a[O],A[O]);if(B)return B}return dr(a.length,A.length)}(t.arrayValue,e.arrayValue);case 10:return function(p,v){if(p===Qv.mapValue&&v===Qv.mapValue)return 0;if(p===Qv.mapValue)return 1;if(v===Qv.mapValue)return-1;const a=p.fields||{},A=Object.keys(a),O=v.fields||{},B=Object.keys(O);A.sort(),B.sort();for(let $=0;$<A.length&&$<B.length;++$){const Y=dr(A[$],B[$]);if(Y!==0)return Y;const se=rp(a[A[$]],O[B[$]]);if(se!==0)return se}return dr(A.length,B.length)}(t.mapValue,e.mapValue);default:throw xn()}}function KD(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return dr(t,e);const i=yu(t),s=yu(e),u=dr(i.seconds,s.seconds);return u!==0?u:dr(i.nanos,s.nanos)}function ip(t){return US(t)}function US(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(i){const s=yu(i);return`time(${s.seconds},${s.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(i){return Hh(i).toBase64()}(t.bytesValue):"referenceValue"in t?function(i){return an.fromName(i).toString()}(t.referenceValue):"geoPointValue"in t?function(i){return`geo(${i.latitude},${i.longitude})`}(t.geoPointValue):"arrayValue"in t?function(i){let s="[",u=!0;for(const p of i.values||[])u?u=!1:s+=",",s+=US(p);return s+"]"}(t.arrayValue):"mapValue"in t?function(i){const s=Object.keys(i.fields||{}).sort();let u="{",p=!0;for(const v of s)p?p=!1:u+=",",u+=`${v}:${US(i.fields[v])}`;return u+"}"}(t.mapValue):xn()}function JD(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function $S(t){return!!t&&"integerValue"in t}function MP(t){return!!t&&"arrayValue"in t}function QD(t){return!!t&&"nullValue"in t}function eL(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function E1(t){return!!t&&"mapValue"in t}function Jg(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ip(t.mapValue.fields,(i,s)=>e.mapValue.fields[i]=Jg(s)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(t.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=Jg(t.arrayValue.values[i]);return e}return Object.assign({},t)}function NX(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os{constructor(e){this.value=e}static empty(){return new Os({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let s=0;s<e.length-1;++s)if(i=(i.mapValue.fields||{})[e.get(s)],!E1(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=Jg(i)}setAll(e){let i=qi.emptyPath(),s={},u=[];e.forEach((v,a)=>{if(!i.isImmediateParentOf(a)){const A=this.getFieldsMap(i);this.applyChanges(A,s,u),s={},u=[],i=a.popLast()}v?s[a.lastSegment()]=Jg(v):u.push(a.lastSegment())});const p=this.getFieldsMap(i);this.applyChanges(p,s,u)}delete(e){const i=this.field(e.popLast());E1(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return Ja(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let s=0;s<e.length;++s){let u=i.mapValue.fields[e.get(s)];E1(u)&&u.mapValue.fields||(u={mapValue:{fields:{}}},i.mapValue.fields[e.get(s)]=u),i=u}return i.mapValue.fields}applyChanges(e,i,s){Ip(i,(u,p)=>e[u]=p);for(const u of s)delete e[u]}clone(){return new Os(Jg(this.value))}}function FF(t){const e=[];return Ip(t.fields,(i,s)=>{const u=new qi([i]);if(E1(s)){const p=FF(s.mapValue).fields;if(p.length===0)e.push(u);else for(const v of p)e.push(u.child(v))}else e.push(u)}),new aa(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e,i,s,u,p,v,a){this.key=e,this.documentType=i,this.version=s,this.readTime=u,this.createTime=p,this.data=v,this.documentState=a}static newInvalidDocument(e){return new co(e,0,En.min(),En.min(),En.min(),Os.empty(),0)}static newFoundDocument(e,i,s,u){return new co(e,1,i,En.min(),s,u,0)}static newNoDocument(e,i){return new co(e,2,i,En.min(),En.min(),Os.empty(),0)}static newUnknownDocument(e,i){return new co(e,3,i,En.min(),En.min(),Os.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(En.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Os.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Os.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=En.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof co&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new co(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bx{constructor(e,i){this.position=e,this.inclusive=i}}function tL(t,e,i){let s=0;for(let u=0;u<t.position.length;u++){const p=e[u],v=t.position[u];if(p.field.isKeyField()?s=an.comparator(an.fromName(v.referenceValue),i.key):s=rp(v,i.data.field(p.field)),p.dir==="desc"&&(s*=-1),s!==0)break}return s}function nL(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let i=0;i<t.position.length;i++)if(!Ja(t.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F_{constructor(e,i="asc"){this.field=e,this.dir=i}}function FX(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let BF=class{};class gi extends BF{constructor(e,i,s){super(),this.field=e,this.op=i,this.value=s}static create(e,i,s){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,s):new jX(e,i,s):i==="array-contains"?new $X(e,s):i==="in"?new GX(e,s):i==="not-in"?new WX(e,s):i==="array-contains-any"?new qX(e,s):new gi(e,i,s)}static createKeyFieldInFilter(e,i,s){return i==="in"?new VX(e,s):new UX(e,s)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(rp(i,this.value)):i!==null&&Zh(this.value)===Zh(i)&&this.matchesComparison(rp(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return xn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class da extends BF{constructor(e,i){super(),this.filters=e,this.op=i,this.ce=null}static create(e,i){return new da(e,i)}matches(e){return jF(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function jF(t){return t.op==="and"}function VF(t){return BX(t)&&jF(t)}function BX(t){for(const e of t.filters)if(e instanceof da)return!1;return!0}function GS(t){if(t instanceof gi)return t.field.canonicalString()+t.op.toString()+ip(t.value);if(VF(t))return t.filters.map(e=>GS(e)).join(",");{const e=t.filters.map(i=>GS(i)).join(",");return`${t.op}(${e})`}}function UF(t,e){return t instanceof gi?function(s,u){return u instanceof gi&&s.op===u.op&&s.field.isEqual(u.field)&&Ja(s.value,u.value)}(t,e):t instanceof da?function(s,u){return u instanceof da&&s.op===u.op&&s.filters.length===u.filters.length?s.filters.reduce((p,v,a)=>p&&UF(v,u.filters[a]),!0):!1}(t,e):void xn()}function $F(t){return t instanceof gi?function(i){return`${i.field.canonicalString()} ${i.op} ${ip(i.value)}`}(t):t instanceof da?function(i){return i.op.toString()+" {"+i.getFilters().map($F).join(" ,")+"}"}(t):"Filter"}class jX extends gi{constructor(e,i,s){super(e,i,s),this.key=an.fromName(s.referenceValue)}matches(e){const i=an.comparator(e.key,this.key);return this.matchesComparison(i)}}class VX extends gi{constructor(e,i){super(e,"in",i),this.keys=GF("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class UX extends gi{constructor(e,i){super(e,"not-in",i),this.keys=GF("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function GF(t,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(s=>an.fromName(s.referenceValue))}class $X extends gi{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return MP(i)&&N_(i.arrayValue,this.value)}}class GX extends gi{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&N_(this.value.arrayValue,i)}}class WX extends gi{constructor(e,i){super(e,"not-in",i)}matches(e){if(N_(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!N_(this.value.arrayValue,i)}}class qX extends gi{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!MP(i)||!i.arrayValue.values)&&i.arrayValue.values.some(s=>N_(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HX{constructor(e,i=null,s=[],u=[],p=null,v=null,a=null){this.path=e,this.collectionGroup=i,this.orderBy=s,this.filters=u,this.limit=p,this.startAt=v,this.endAt=a,this.le=null}}function rL(t,e=null,i=[],s=[],u=null,p=null,v=null){return new HX(t,e,i,s,u,p,v)}function RP(t){const e=Pn(t);if(e.le===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(s=>GS(s)).join(","),i+="|ob:",i+=e.orderBy.map(s=>function(p){return p.field.canonicalString()+p.dir}(s)).join(","),bb(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(s=>ip(s)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(s=>ip(s)).join(",")),e.le=i}return e.le}function OP(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<t.orderBy.length;i++)if(!FX(t.orderBy[i],e.orderBy[i]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(!UF(t.filters[i],e.filters[i]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!nL(t.startAt,e.startAt)&&nL(t.endAt,e.endAt)}function WS(t){return an.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ap{constructor(e,i=null,s=[],u=[],p=null,v="F",a=null,A=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=s,this.filters=u,this.limit=p,this.limitType=v,this.startAt=a,this.endAt=A,this.he=null,this.Pe=null,this.Ie=null,this.startAt,this.endAt}}function ZX(t,e,i,s,u,p,v,a){return new Ap(t,e,i,s,u,p,v,a)}function wb(t){return new Ap(t)}function iL(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function WF(t){return t.collectionGroup!==null}function Qg(t){const e=Pn(t);if(e.he===null){e.he=[];const i=new Set;for(const p of e.explicitOrderBy)e.he.push(p),i.add(p.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(v){let a=new Xi(qi.comparator);return v.filters.forEach(A=>{A.getFlattenedFilters().forEach(O=>{O.isInequality()&&(a=a.add(O.field))})}),a})(e).forEach(p=>{i.has(p.canonicalString())||p.isKeyField()||e.he.push(new F_(p,s))}),i.has(qi.keyField().canonicalString())||e.he.push(new F_(qi.keyField(),s))}return e.he}function Ya(t){const e=Pn(t);return e.Pe||(e.Pe=XX(e,Qg(t))),e.Pe}function XX(t,e){if(t.limitType==="F")return rL(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(u=>{const p=u.dir==="desc"?"asc":"desc";return new F_(u.field,p)});const i=t.endAt?new bx(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new bx(t.startAt.position,t.startAt.inclusive):null;return rL(t.path,t.collectionGroup,e,t.filters,t.limit,i,s)}}function qS(t,e){const i=t.filters.concat([e]);return new Ap(t.path,t.collectionGroup,t.explicitOrderBy.slice(),i,t.limit,t.limitType,t.startAt,t.endAt)}function HS(t,e,i){return new Ap(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,i,t.startAt,t.endAt)}function Tb(t,e){return OP(Ya(t),Ya(e))&&t.limitType===e.limitType}function qF(t){return`${RP(Ya(t))}|lt:${t.limitType}`}function ff(t){return`Query(target=${function(i){let s=i.path.canonicalString();return i.collectionGroup!==null&&(s+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(s+=`, filters: [${i.filters.map(u=>$F(u)).join(", ")}]`),bb(i.limit)||(s+=", limit: "+i.limit),i.orderBy.length>0&&(s+=`, orderBy: [${i.orderBy.map(u=>function(v){return`${v.field.canonicalString()} (${v.dir})`}(u)).join(", ")}]`),i.startAt&&(s+=", startAt: ",s+=i.startAt.inclusive?"b:":"a:",s+=i.startAt.position.map(u=>ip(u)).join(",")),i.endAt&&(s+=", endAt: ",s+=i.endAt.inclusive?"a:":"b:",s+=i.endAt.position.map(u=>ip(u)).join(",")),`Target(${s})`}(Ya(t))}; limitType=${t.limitType})`}function Eb(t,e){return e.isFoundDocument()&&function(s,u){const p=u.key.path;return s.collectionGroup!==null?u.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(p):an.isDocumentKey(s.path)?s.path.isEqual(p):s.path.isImmediateParentOf(p)}(t,e)&&function(s,u){for(const p of Qg(s))if(!p.field.isKeyField()&&u.data.field(p.field)===null)return!1;return!0}(t,e)&&function(s,u){for(const p of s.filters)if(!p.matches(u))return!1;return!0}(t,e)&&function(s,u){return!(s.startAt&&!function(v,a,A){const O=tL(v,a,A);return v.inclusive?O<=0:O<0}(s.startAt,Qg(s),u)||s.endAt&&!function(v,a,A){const O=tL(v,a,A);return v.inclusive?O>=0:O>0}(s.endAt,Qg(s),u))}(t,e)}function YX(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function HF(t){return(e,i)=>{let s=!1;for(const u of Qg(t)){const p=KX(u,e,i);if(p!==0)return p;s=s||u.field.isKeyField()}return 0}}function KX(t,e,i){const s=t.field.isKeyField()?an.comparator(e.key,i.key):function(p,v,a){const A=v.data.field(p),O=a.data.field(p);return A!==null&&O!==null?rp(A,O):xn()}(t.field,e,i);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return xn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pp{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),s=this.inner[i];if(s!==void 0){for(const[u,p]of s)if(this.equalsFn(u,e))return p}}has(e){return this.get(e)!==void 0}set(e,i){const s=this.mapKeyFn(e),u=this.inner[s];if(u===void 0)return this.inner[s]=[[e,i]],void this.innerSize++;for(let p=0;p<u.length;p++)if(this.equalsFn(u[p][0],e))return void(u[p]=[e,i]);u.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),s=this.inner[i];if(s===void 0)return!1;for(let u=0;u<s.length;u++)if(this.equalsFn(s[u][0],e))return s.length===1?delete this.inner[i]:s.splice(u,1),this.innerSize--,!0;return!1}forEach(e){Ip(this.inner,(i,s)=>{for(const[u,p]of s)e(u,p)})}isEmpty(){return zF(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JX=new Yr(an.comparator);function Kl(){return JX}const ZF=new Yr(an.comparator);function Lg(...t){let e=ZF;for(const i of t)e=e.insert(i.key,i);return e}function XF(t){let e=ZF;return t.forEach((i,s)=>e=e.insert(i,s.overlayedDocument)),e}function Ch(){return e_()}function YF(){return e_()}function e_(){return new Pp(t=>t.toString(),(t,e)=>t.isEqual(e))}const QX=new Yr(an.comparator),eY=new Xi(an.comparator);function $n(...t){let e=eY;for(const i of t)e=e.add(i);return e}const tY=new Xi(dr);function nY(){return tY}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KF(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xx(e)?"-0":e}}function JF(t){return{integerValue:""+t}}function rY(t,e){return DX(e)?JF(e):KF(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sb{constructor(){this._=void 0}}function iY(t,e,i){return t instanceof wx?function(u,p){const v={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:u.seconds,nanos:u.nanoseconds}}}};return p&&kP(p)&&(p=CP(p)),p&&(v.fields.__previous_value__=p),{mapValue:v}}(i,e):t instanceof B_?eB(t,e):t instanceof j_?tB(t,e):function(u,p){const v=QF(u,p),a=oL(v)+oL(u.Te);return $S(v)&&$S(u.Te)?JF(a):KF(u.serializer,a)}(t,e)}function oY(t,e,i){return t instanceof B_?eB(t,e):t instanceof j_?tB(t,e):i}function QF(t,e){return t instanceof Tx?function(s){return $S(s)||function(p){return!!p&&"doubleValue"in p}(s)}(e)?e:{integerValue:0}:null}class wx extends Sb{}class B_ extends Sb{constructor(e){super(),this.elements=e}}function eB(t,e){const i=nB(e);for(const s of t.elements)i.some(u=>Ja(u,s))||i.push(s);return{arrayValue:{values:i}}}class j_ extends Sb{constructor(e){super(),this.elements=e}}function tB(t,e){let i=nB(e);for(const s of t.elements)i=i.filter(u=>!Ja(u,s));return{arrayValue:{values:i}}}class Tx extends Sb{constructor(e,i){super(),this.serializer=e,this.Te=i}}function oL(t){return fi(t.integerValue||t.doubleValue)}function nB(t){return MP(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function sY(t,e){return t.field.isEqual(e.field)&&function(s,u){return s instanceof B_&&u instanceof B_||s instanceof j_&&u instanceof j_?np(s.elements,u.elements,Ja):s instanceof Tx&&u instanceof Tx?Ja(s.Te,u.Te):s instanceof wx&&u instanceof wx}(t.transform,e.transform)}class aY{constructor(e,i){this.version=e,this.transformResults=i}}class Ul{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new Ul}static exists(e){return new Ul(void 0,e)}static updateTime(e){return new Ul(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function S1(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Ib{}function rB(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new oB(t.key,Ul.none()):new Sy(t.key,t.data,Ul.none());{const i=t.data,s=Os.empty();let u=new Xi(qi.comparator);for(let p of e.fields)if(!u.has(p)){let v=i.field(p);v===null&&p.length>1&&(p=p.popLast(),v=i.field(p)),v===null?s.delete(p):s.set(p,v),u=u.add(p)}return new td(t.key,s,new aa(u.toArray()),Ul.none())}}function lY(t,e,i){t instanceof Sy?function(u,p,v){const a=u.value.clone(),A=aL(u.fieldTransforms,p,v.transformResults);a.setAll(A),p.convertToFoundDocument(v.version,a).setHasCommittedMutations()}(t,e,i):t instanceof td?function(u,p,v){if(!S1(u.precondition,p))return void p.convertToUnknownDocument(v.version);const a=aL(u.fieldTransforms,p,v.transformResults),A=p.data;A.setAll(iB(u)),A.setAll(a),p.convertToFoundDocument(v.version,A).setHasCommittedMutations()}(t,e,i):function(u,p,v){p.convertToNoDocument(v.version).setHasCommittedMutations()}(0,e,i)}function t_(t,e,i,s){return t instanceof Sy?function(p,v,a,A){if(!S1(p.precondition,v))return a;const O=p.value.clone(),B=lL(p.fieldTransforms,A,v);return O.setAll(B),v.convertToFoundDocument(v.version,O).setHasLocalMutations(),null}(t,e,i,s):t instanceof td?function(p,v,a,A){if(!S1(p.precondition,v))return a;const O=lL(p.fieldTransforms,A,v),B=v.data;return B.setAll(iB(p)),B.setAll(O),v.convertToFoundDocument(v.version,B).setHasLocalMutations(),a===null?null:a.unionWith(p.fieldMask.fields).unionWith(p.fieldTransforms.map($=>$.field))}(t,e,i,s):function(p,v,a){return S1(p.precondition,v)?(v.convertToNoDocument(v.version).setHasLocalMutations(),null):a}(t,e,i)}function cY(t,e){let i=null;for(const s of t.fieldTransforms){const u=e.data.field(s.field),p=QF(s.transform,u||null);p!=null&&(i===null&&(i=Os.empty()),i.set(s.field,p))}return i||null}function sL(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(s,u){return s===void 0&&u===void 0||!(!s||!u)&&np(s,u,(p,v)=>sY(p,v))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Sy extends Ib{constructor(e,i,s,u=[]){super(),this.key=e,this.value=i,this.precondition=s,this.fieldTransforms=u,this.type=0}getFieldMask(){return null}}class td extends Ib{constructor(e,i,s,u,p=[]){super(),this.key=e,this.data=i,this.fieldMask=s,this.precondition=u,this.fieldTransforms=p,this.type=1}getFieldMask(){return this.fieldMask}}function iB(t){const e=new Map;return t.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const s=t.data.field(i);e.set(i,s)}}),e}function aL(t,e,i){const s=new Map;jr(t.length===i.length);for(let u=0;u<i.length;u++){const p=t[u],v=p.transform,a=e.data.field(p.field);s.set(p.field,oY(v,a,i[u]))}return s}function lL(t,e,i){const s=new Map;for(const u of t){const p=u.transform,v=i.data.field(u.field);s.set(u.field,iY(p,v,e))}return s}class oB extends Ib{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class uY extends Ib{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hY{constructor(e,i,s,u){this.batchId=e,this.localWriteTime=i,this.baseMutations=s,this.mutations=u}applyToRemoteDocument(e,i){const s=i.mutationResults;for(let u=0;u<this.mutations.length;u++){const p=this.mutations[u];p.key.isEqual(e.key)&&lY(p,e,s[u])}}applyToLocalView(e,i){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(i=t_(s,e,i,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(i=t_(s,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const s=YF();return this.mutations.forEach(u=>{const p=e.get(u.key),v=p.overlayedDocument;let a=this.applyToLocalView(v,p.mutatedFields);a=i.has(u.key)?null:a;const A=rB(v,a);A!==null&&s.set(u.key,A),v.isValidDocument()||v.convertToNoDocument(En.min())}),s}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),$n())}isEqual(e){return this.batchId===e.batchId&&np(this.mutations,e.mutations,(i,s)=>sL(i,s))&&np(this.baseMutations,e.baseMutations,(i,s)=>sL(i,s))}}class DP{constructor(e,i,s,u){this.batch=e,this.commitVersion=i,this.mutationResults=s,this.docVersions=u}static from(e,i,s){jr(e.mutations.length===s.length);let u=function(){return QX}();const p=e.mutations;for(let v=0;v<p.length;v++)u=u.insert(p[v].key,s[v].version);return new DP(e,i,s,u)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dY=class{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fY{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var di,Yn;function pY(t){switch(t){default:return xn();case ht.CANCELLED:case ht.UNKNOWN:case ht.DEADLINE_EXCEEDED:case ht.RESOURCE_EXHAUSTED:case ht.INTERNAL:case ht.UNAVAILABLE:case ht.UNAUTHENTICATED:return!1;case ht.INVALID_ARGUMENT:case ht.NOT_FOUND:case ht.ALREADY_EXISTS:case ht.PERMISSION_DENIED:case ht.FAILED_PRECONDITION:case ht.ABORTED:case ht.OUT_OF_RANGE:case ht.UNIMPLEMENTED:case ht.DATA_LOSS:return!0}}function sB(t){if(t===void 0)return Yl("GRPC error has no .code"),ht.UNKNOWN;switch(t){case di.OK:return ht.OK;case di.CANCELLED:return ht.CANCELLED;case di.UNKNOWN:return ht.UNKNOWN;case di.DEADLINE_EXCEEDED:return ht.DEADLINE_EXCEEDED;case di.RESOURCE_EXHAUSTED:return ht.RESOURCE_EXHAUSTED;case di.INTERNAL:return ht.INTERNAL;case di.UNAVAILABLE:return ht.UNAVAILABLE;case di.UNAUTHENTICATED:return ht.UNAUTHENTICATED;case di.INVALID_ARGUMENT:return ht.INVALID_ARGUMENT;case di.NOT_FOUND:return ht.NOT_FOUND;case di.ALREADY_EXISTS:return ht.ALREADY_EXISTS;case di.PERMISSION_DENIED:return ht.PERMISSION_DENIED;case di.FAILED_PRECONDITION:return ht.FAILED_PRECONDITION;case di.ABORTED:return ht.ABORTED;case di.OUT_OF_RANGE:return ht.OUT_OF_RANGE;case di.UNIMPLEMENTED:return ht.UNIMPLEMENTED;case di.DATA_LOSS:return ht.DATA_LOSS;default:return xn()}}(Yn=di||(di={}))[Yn.OK=0]="OK",Yn[Yn.CANCELLED=1]="CANCELLED",Yn[Yn.UNKNOWN=2]="UNKNOWN",Yn[Yn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Yn[Yn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Yn[Yn.NOT_FOUND=5]="NOT_FOUND",Yn[Yn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Yn[Yn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Yn[Yn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Yn[Yn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Yn[Yn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Yn[Yn.ABORTED=10]="ABORTED",Yn[Yn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Yn[Yn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Yn[Yn.INTERNAL=13]="INTERNAL",Yn[Yn.UNAVAILABLE=14]="UNAVAILABLE",Yn[Yn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mY(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gY=new Uf([4294967295,4294967295],0);function cL(t){const e=mY().encode(t),i=new vX;return i.update(e),new Uint8Array(i.digest())}function uL(t){const e=new DataView(t.buffer),i=e.getUint32(0,!0),s=e.getUint32(4,!0),u=e.getUint32(8,!0),p=e.getUint32(12,!0);return[new Uf([i,s],0),new Uf([u,p],0)]}class LP{constructor(e,i,s){if(this.bitmap=e,this.padding=i,this.hashCount=s,i<0||i>=8)throw new zg(`Invalid padding: ${i}`);if(s<0)throw new zg(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new zg(`Invalid hash count: ${s}`);if(e.length===0&&i!==0)throw new zg(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*e.length-i,this.de=Uf.fromNumber(this.Ee)}Ae(e,i,s){let u=e.add(i.multiply(Uf.fromNumber(s)));return u.compare(gY)===1&&(u=new Uf([u.getBits(0),u.getBits(1)],0)),u.modulo(this.de).toNumber()}Re(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ee===0)return!1;const i=cL(e),[s,u]=uL(i);for(let p=0;p<this.hashCount;p++){const v=this.Ae(s,u,p);if(!this.Re(v))return!1}return!0}static create(e,i,s){const u=e%8==0?0:8-e%8,p=new Uint8Array(Math.ceil(e/8)),v=new LP(p,u,i);return s.forEach(a=>v.insert(a)),v}insert(e){if(this.Ee===0)return;const i=cL(e),[s,u]=uL(i);for(let p=0;p<this.hashCount;p++){const v=this.Ae(s,u,p);this.Ve(v)}}Ve(e){const i=Math.floor(e/8),s=e%8;this.bitmap[i]|=1<<s}}class zg extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ab{constructor(e,i,s,u,p){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=s,this.documentUpdates=u,this.resolvedLimboDocuments=p}static createSynthesizedRemoteEventForCurrentChange(e,i,s){const u=new Map;return u.set(e,Iy.createSynthesizedTargetChangeForCurrentChange(e,i,s)),new Ab(En.min(),u,new Yr(dr),Kl(),$n())}}class Iy{constructor(e,i,s,u,p){this.resumeToken=e,this.current=i,this.addedDocuments=s,this.modifiedDocuments=u,this.removedDocuments=p}static createSynthesizedTargetChangeForCurrentChange(e,i,s){return new Iy(s,i,$n(),$n(),$n())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I1{constructor(e,i,s,u){this.me=e,this.removedTargetIds=i,this.key=s,this.fe=u}}class aB{constructor(e,i){this.targetId=e,this.ge=i}}class lB{constructor(e,i,s=mo.EMPTY_BYTE_STRING,u=null){this.state=e,this.targetIds=i,this.resumeToken=s,this.cause=u}}class hL{constructor(){this.pe=0,this.ye=fL(),this.we=mo.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get Ce(){return this.be}ve(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=$n(),i=$n(),s=$n();return this.ye.forEach((u,p)=>{switch(p){case 0:e=e.add(u);break;case 2:i=i.add(u);break;case 1:s=s.add(u);break;default:xn()}}),new Iy(this.we,this.Se,e,i,s)}Me(){this.be=!1,this.ye=fL()}xe(e,i){this.be=!0,this.ye=this.ye.insert(e,i)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1}Le(){this.be=!0,this.Se=!0}}class _Y{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Kl(),this.Ke=dL(),this.$e=new Yr(dr)}Ue(e){for(const i of e.me)e.fe&&e.fe.isFoundDocument()?this.We(i,e.fe):this.Ge(i,e.key,e.fe);for(const i of e.removedTargetIds)this.Ge(i,e.key,e.fe)}ze(e){this.forEachTarget(e,i=>{const s=this.je(i);switch(e.state){case 0:this.He(i)&&s.ve(e.resumeToken);break;case 1:s.Be(),s.De||s.Me(),s.ve(e.resumeToken);break;case 2:s.Be(),s.De||this.removeTarget(i);break;case 3:this.He(i)&&(s.Le(),s.ve(e.resumeToken));break;case 4:this.He(i)&&(this.Je(i),s.ve(e.resumeToken));break;default:xn()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.qe.forEach((s,u)=>{this.He(u)&&i(u)})}Ye(e){const i=e.targetId,s=e.ge.count,u=this.Ze(i);if(u){const p=u.target;if(WS(p))if(s===0){const v=new an(p.path);this.Ge(i,v,co.newNoDocument(v,En.min()))}else jr(s===1);else{const v=this.Xe(i);if(v!==s){const a=this.et(e),A=a?this.tt(a,e,v):1;if(A!==0){this.Je(i);const O=A===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.$e=this.$e.insert(i,O)}}}}}et(e){const i=e.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:s="",padding:u=0},hashCount:p=0}=i;let v,a;try{v=Hh(s).toUint8Array()}catch(A){if(A instanceof NF)return tp("Decoding the base64 bloom filter in existence filter failed ("+A.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw A}try{a=new LP(v,u,p)}catch(A){return tp(A instanceof zg?"BloomFilter error: ":"Applying bloom filter failed: ",A),null}return a.Ee===0?null:a}tt(e,i,s){return i.ge.count===s-this.it(e,i.targetId)?0:2}it(e,i){const s=this.ke.getRemoteKeysForTarget(i);let u=0;return s.forEach(p=>{const v=this.ke.rt(),a=`projects/${v.projectId}/databases/${v.database}/documents/${p.path.canonicalString()}`;e.mightContain(a)||(this.Ge(i,p,null),u++)}),u}st(e){const i=new Map;this.qe.forEach((p,v)=>{const a=this.Ze(v);if(a){if(p.current&&WS(a.target)){const A=new an(a.target.path);this.Qe.get(A)!==null||this.ot(v,A)||this.Ge(v,A,co.newNoDocument(A,e))}p.Ce&&(i.set(v,p.Fe()),p.Me())}});let s=$n();this.Ke.forEach((p,v)=>{let a=!0;v.forEachWhile(A=>{const O=this.Ze(A);return!O||O.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(s=s.add(p))}),this.Qe.forEach((p,v)=>v.setReadTime(e));const u=new Ab(e,i,this.$e,this.Qe,s);return this.Qe=Kl(),this.Ke=dL(),this.$e=new Yr(dr),u}We(e,i){if(!this.He(e))return;const s=this.ot(e,i.key)?2:0;this.je(e).xe(i.key,s),this.Qe=this.Qe.insert(i.key,i),this.Ke=this.Ke.insert(i.key,this._t(i.key).add(e))}Ge(e,i,s){if(!this.He(e))return;const u=this.je(e);this.ot(e,i)?u.xe(i,1):u.Oe(i),this.Ke=this.Ke.insert(i,this._t(i).delete(e)),s&&(this.Qe=this.Qe.insert(i,s))}removeTarget(e){this.qe.delete(e)}Xe(e){const i=this.je(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ne(e){this.je(e).Ne()}je(e){let i=this.qe.get(e);return i||(i=new hL,this.qe.set(e,i)),i}_t(e){let i=this.Ke.get(e);return i||(i=new Xi(dr),this.Ke=this.Ke.insert(e,i)),i}He(e){const i=this.Ze(e)!==null;return i||Kt("WatchChangeAggregator","Detected inactive target",e),i}Ze(e){const i=this.qe.get(e);return i&&i.De?null:this.ke.ut(e)}Je(e){this.qe.set(e,new hL),this.ke.getRemoteKeysForTarget(e).forEach(i=>{this.Ge(e,i,null)})}ot(e,i){return this.ke.getRemoteKeysForTarget(e).has(i)}}function dL(){return new Yr(an.comparator)}function fL(){return new Yr(an.comparator)}const yY=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),vY=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),xY=(()=>({and:"AND",or:"OR"}))();class bY{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function ZS(t,e){return t.useProto3Json||bb(e)?e:{value:e}}function Ex(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cB(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function wY(t,e){return Ex(t,e.toTimestamp())}function Ka(t){return jr(!!t),En.fromTimestamp(function(i){const s=yu(i);return new _i(s.seconds,s.nanos)}(t))}function zP(t,e){return function(s){return new Fr(["projects",s.projectId,"databases",s.database])}(t).child("documents").child(e).canonicalString()}function uB(t){const e=Fr.fromString(t);return jr(pB(e)),e}function XS(t,e){return zP(t.databaseId,e.path)}function fE(t,e){const i=uB(e);if(i.get(1)!==t.databaseId.projectId)throw new Ht(ht.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+t.databaseId.projectId);if(i.get(3)!==t.databaseId.database)throw new Ht(ht.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+t.databaseId.database);return new an(hB(i))}function YS(t,e){return zP(t.databaseId,e)}function TY(t){const e=uB(t);return e.length===4?Fr.emptyPath():hB(e)}function KS(t){return new Fr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function hB(t){return jr(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function pL(t,e,i){return{name:XS(t,e),fields:i.value.mapValue.fields}}function EY(t,e){let i;if("targetChange"in e){e.targetChange;const s=function(O){return O==="NO_CHANGE"?0:O==="ADD"?1:O==="REMOVE"?2:O==="CURRENT"?3:O==="RESET"?4:xn()}(e.targetChange.targetChangeType||"NO_CHANGE"),u=e.targetChange.targetIds||[],p=function(O,B){return O.useProto3Json?(jr(B===void 0||typeof B=="string"),mo.fromBase64String(B||"")):(jr(B===void 0||B instanceof Uint8Array),mo.fromUint8Array(B||new Uint8Array))}(t,e.targetChange.resumeToken),v=e.targetChange.cause,a=v&&function(O){const B=O.code===void 0?ht.UNKNOWN:sB(O.code);return new Ht(B,O.message||"")}(v);i=new lB(s,u,p,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const u=fE(t,s.document.name),p=Ka(s.document.updateTime),v=s.document.createTime?Ka(s.document.createTime):En.min(),a=new Os({mapValue:{fields:s.document.fields}}),A=co.newFoundDocument(u,p,v,a),O=s.targetIds||[],B=s.removedTargetIds||[];i=new I1(O,B,A.key,A)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const u=fE(t,s.document),p=s.readTime?Ka(s.readTime):En.min(),v=co.newNoDocument(u,p),a=s.removedTargetIds||[];i=new I1([],a,v.key,v)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const u=fE(t,s.document),p=s.removedTargetIds||[];i=new I1([],p,u,null)}else{if(!("filter"in e))return xn();{e.filter;const s=e.filter;s.targetId;const{count:u=0,unchangedNames:p}=s,v=new fY(u,p),a=s.targetId;i=new aB(a,v)}}return i}function SY(t,e){let i;if(e instanceof Sy)i={update:pL(t,e.key,e.value)};else if(e instanceof oB)i={delete:XS(t,e.key)};else if(e instanceof td)i={update:pL(t,e.key,e.data),updateMask:DY(e.fieldMask)};else{if(!(e instanceof uY))return xn();i={verify:XS(t,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(s=>function(p,v){const a=v.transform;if(a instanceof wx)return{fieldPath:v.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof B_)return{fieldPath:v.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof j_)return{fieldPath:v.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Tx)return{fieldPath:v.field.canonicalString(),increment:a.Te};throw xn()}(0,s))),e.precondition.isNone||(i.currentDocument=function(u,p){return p.updateTime!==void 0?{updateTime:wY(u,p.updateTime)}:p.exists!==void 0?{exists:p.exists}:xn()}(t,e.precondition)),i}function IY(t,e){return t&&t.length>0?(jr(e!==void 0),t.map(i=>function(u,p){let v=u.updateTime?Ka(u.updateTime):Ka(p);return v.isEqual(En.min())&&(v=Ka(p)),new aY(v,u.transformResults||[])}(i,e))):[]}function AY(t,e){return{documents:[YS(t,e.path)]}}function PY(t,e){const i={structuredQuery:{}},s=e.path;e.collectionGroup!==null?(i.parent=YS(t,s),i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i.parent=YS(t,s.popLast()),i.structuredQuery.from=[{collectionId:s.lastSegment()}]);const u=function(A){if(A.length!==0)return fB(da.create(A,"and"))}(e.filters);u&&(i.structuredQuery.where=u);const p=function(A){if(A.length!==0)return A.map(O=>function($){return{field:pf($.field),direction:MY($.dir)}}(O))}(e.orderBy);p&&(i.structuredQuery.orderBy=p);const v=ZS(t,e.limit);return v!==null&&(i.structuredQuery.limit=v),e.startAt&&(i.structuredQuery.startAt=function(A){return{before:A.inclusive,values:A.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(A){return{before:!A.inclusive,values:A.position}}(e.endAt)),i}function kY(t){let e=TY(t.parent);const i=t.structuredQuery,s=i.from?i.from.length:0;let u=null;if(s>0){jr(s===1);const B=i.from[0];B.allDescendants?u=B.collectionId:e=e.child(B.collectionId)}let p=[];i.where&&(p=function($){const Y=dB($);return Y instanceof da&&VF(Y)?Y.getFilters():[Y]}(i.where));let v=[];i.orderBy&&(v=function($){return $.map(Y=>function(me){return new F_(mf(me.field),function(Ee){switch(Ee){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(me.direction))}(Y))}(i.orderBy));let a=null;i.limit&&(a=function($){let Y;return Y=typeof $=="object"?$.value:$,bb(Y)?null:Y}(i.limit));let A=null;i.startAt&&(A=function($){const Y=!!$.before,se=$.values||[];return new bx(se,Y)}(i.startAt));let O=null;return i.endAt&&(O=function($){const Y=!$.before,se=$.values||[];return new bx(se,Y)}(i.endAt)),ZX(e,u,v,p,a,"F",A,O)}function CY(t,e){const i=function(u){switch(u){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return xn()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function dB(t){return t.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const s=mf(i.unaryFilter.field);return gi.create(s,"==",{doubleValue:NaN});case"IS_NULL":const u=mf(i.unaryFilter.field);return gi.create(u,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const p=mf(i.unaryFilter.field);return gi.create(p,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const v=mf(i.unaryFilter.field);return gi.create(v,"!=",{nullValue:"NULL_VALUE"});default:return xn()}}(t):t.fieldFilter!==void 0?function(i){return gi.create(mf(i.fieldFilter.field),function(u){switch(u){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return xn()}}(i.fieldFilter.op),i.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(i){return da.create(i.compositeFilter.filters.map(s=>dB(s)),function(u){switch(u){case"AND":return"and";case"OR":return"or";default:return xn()}}(i.compositeFilter.op))}(t):xn()}function MY(t){return yY[t]}function RY(t){return vY[t]}function OY(t){return xY[t]}function pf(t){return{fieldPath:t.canonicalString()}}function mf(t){return qi.fromServerFormat(t.fieldPath)}function fB(t){return t instanceof gi?function(i){if(i.op==="=="){if(eL(i.value))return{unaryFilter:{field:pf(i.field),op:"IS_NAN"}};if(QD(i.value))return{unaryFilter:{field:pf(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(eL(i.value))return{unaryFilter:{field:pf(i.field),op:"IS_NOT_NAN"}};if(QD(i.value))return{unaryFilter:{field:pf(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:pf(i.field),op:RY(i.op),value:i.value}}}(t):t instanceof da?function(i){const s=i.getFilters().map(u=>fB(u));return s.length===1?s[0]:{compositeFilter:{op:OY(i.op),filters:s}}}(t):xn()}function DY(t){const e=[];return t.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function pB(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kc{constructor(e,i,s,u,p=En.min(),v=En.min(),a=mo.EMPTY_BYTE_STRING,A=null){this.target=e,this.targetId=i,this.purpose=s,this.sequenceNumber=u,this.snapshotVersion=p,this.lastLimboFreeSnapshotVersion=v,this.resumeToken=a,this.expectedCount=A}withSequenceNumber(e){return new Kc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new Kc(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Kc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Kc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LY{constructor(e){this.ct=e}}function zY(t){const e=kY({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?HS(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NY{constructor(){this._n=new FY}addToCollectionParentIndex(e,i){return this._n.add(i),vt.resolve()}getCollectionParents(e,i){return vt.resolve(this._n.getEntries(i))}addFieldIndex(e,i){return vt.resolve()}deleteFieldIndex(e,i){return vt.resolve()}deleteAllFieldIndexes(e){return vt.resolve()}createTargetIndexes(e,i){return vt.resolve()}getDocumentsMatchingTarget(e,i){return vt.resolve(null)}getIndexType(e,i){return vt.resolve(0)}getFieldIndexes(e,i){return vt.resolve([])}getNextCollectionGroupToUpdate(e){return vt.resolve(null)}getMinOffset(e,i){return vt.resolve(_u.min())}getMinOffsetFromCollectionGroup(e,i){return vt.resolve(_u.min())}updateCollectionGroup(e,i,s){return vt.resolve()}updateIndexEntries(e,i){return vt.resolve()}}class FY{constructor(){this.index={}}add(e){const i=e.lastSegment(),s=e.popLast(),u=this.index[i]||new Xi(Fr.comparator),p=!u.has(s);return this.index[i]=u.add(s),p}has(e){const i=e.lastSegment(),s=e.popLast(),u=this.index[i];return u&&u.has(s)}getEntries(e){return(this.index[e]||new Xi(Fr.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class op{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new op(0)}static Bn(){return new op(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BY{constructor(){this.changes=new Pp(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,co.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const s=this.changes.get(i);return s!==void 0?vt.resolve(s):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jY{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VY{constructor(e,i,s,u){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=s,this.indexManager=u}getDocument(e,i){let s=null;return this.documentOverlayCache.getOverlay(e,i).next(u=>(s=u,this.remoteDocumentCache.getEntry(e,i))).next(u=>(s!==null&&t_(s.mutation,u,aa.empty(),_i.now()),u))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(s=>this.getLocalViewOfDocuments(e,s,$n()).next(()=>s))}getLocalViewOfDocuments(e,i,s=$n()){const u=Ch();return this.populateOverlays(e,u,i).next(()=>this.computeViews(e,i,u,s).next(p=>{let v=Lg();return p.forEach((a,A)=>{v=v.insert(a,A.overlayedDocument)}),v}))}getOverlayedDocuments(e,i){const s=Ch();return this.populateOverlays(e,s,i).next(()=>this.computeViews(e,i,s,$n()))}populateOverlays(e,i,s){const u=[];return s.forEach(p=>{i.has(p)||u.push(p)}),this.documentOverlayCache.getOverlays(e,u).next(p=>{p.forEach((v,a)=>{i.set(v,a)})})}computeViews(e,i,s,u){let p=Kl();const v=e_(),a=function(){return e_()}();return i.forEach((A,O)=>{const B=s.get(O.key);u.has(O.key)&&(B===void 0||B.mutation instanceof td)?p=p.insert(O.key,O):B!==void 0?(v.set(O.key,B.mutation.getFieldMask()),t_(B.mutation,O,B.mutation.getFieldMask(),_i.now())):v.set(O.key,aa.empty())}),this.recalculateAndSaveOverlays(e,p).next(A=>(A.forEach((O,B)=>v.set(O,B)),i.forEach((O,B)=>{var $;return a.set(O,new jY(B,($=v.get(O))!==null&&$!==void 0?$:null))}),a))}recalculateAndSaveOverlays(e,i){const s=e_();let u=new Yr((v,a)=>v-a),p=$n();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(v=>{for(const a of v)a.keys().forEach(A=>{const O=i.get(A);if(O===null)return;let B=s.get(A)||aa.empty();B=a.applyToLocalView(O,B),s.set(A,B);const $=(u.get(a.batchId)||$n()).add(A);u=u.insert(a.batchId,$)})}).next(()=>{const v=[],a=u.getReverseIterator();for(;a.hasNext();){const A=a.getNext(),O=A.key,B=A.value,$=YF();B.forEach(Y=>{if(!p.has(Y)){const se=rB(i.get(Y),s.get(Y));se!==null&&$.set(Y,se),p=p.add(Y)}}),v.push(this.documentOverlayCache.saveOverlays(e,O,$))}return vt.waitFor(v)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,i,s,u){return function(v){return an.isDocumentKey(v.path)&&v.collectionGroup===null&&v.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):WF(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,s,u):this.getDocumentsMatchingCollectionQuery(e,i,s,u)}getNextDocuments(e,i,s,u){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,s,u).next(p=>{const v=u-p.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,s.largestBatchId,u-p.size):vt.resolve(Ch());let a=-1,A=p;return v.next(O=>vt.forEach(O,(B,$)=>(a<$.largestBatchId&&(a=$.largestBatchId),p.get(B)?vt.resolve():this.remoteDocumentCache.getEntry(e,B).next(Y=>{A=A.insert(B,Y)}))).next(()=>this.populateOverlays(e,O,p)).next(()=>this.computeViews(e,A,O,$n())).next(B=>({batchId:a,changes:XF(B)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new an(i)).next(s=>{let u=Lg();return s.isFoundDocument()&&(u=u.insert(s.key,s)),u})}getDocumentsMatchingCollectionGroupQuery(e,i,s,u){const p=i.collectionGroup;let v=Lg();return this.indexManager.getCollectionParents(e,p).next(a=>vt.forEach(a,A=>{const O=function($,Y){return new Ap(Y,null,$.explicitOrderBy.slice(),$.filters.slice(),$.limit,$.limitType,$.startAt,$.endAt)}(i,A.child(p));return this.getDocumentsMatchingCollectionQuery(e,O,s,u).next(B=>{B.forEach(($,Y)=>{v=v.insert($,Y)})})}).next(()=>v))}getDocumentsMatchingCollectionQuery(e,i,s,u){let p;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,s.largestBatchId).next(v=>(p=v,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,s,p,u))).next(v=>{p.forEach((A,O)=>{const B=O.getKey();v.get(B)===null&&(v=v.insert(B,co.newInvalidDocument(B)))});let a=Lg();return v.forEach((A,O)=>{const B=p.get(A);B!==void 0&&t_(B.mutation,O,aa.empty(),_i.now()),Eb(i,O)&&(a=a.insert(A,O))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UY{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,i){return vt.resolve(this.cr.get(i))}saveBundleMetadata(e,i){return this.cr.set(i.id,function(u){return{id:u.id,version:u.version,createTime:Ka(u.createTime)}}(i)),vt.resolve()}getNamedQuery(e,i){return vt.resolve(this.lr.get(i))}saveNamedQuery(e,i){return this.lr.set(i.name,function(u){return{name:u.name,query:zY(u.bundledQuery),readTime:Ka(u.readTime)}}(i)),vt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $Y{constructor(){this.overlays=new Yr(an.comparator),this.hr=new Map}getOverlay(e,i){return vt.resolve(this.overlays.get(i))}getOverlays(e,i){const s=Ch();return vt.forEach(i,u=>this.getOverlay(e,u).next(p=>{p!==null&&s.set(u,p)})).next(()=>s)}saveOverlays(e,i,s){return s.forEach((u,p)=>{this.ht(e,i,p)}),vt.resolve()}removeOverlaysForBatchId(e,i,s){const u=this.hr.get(s);return u!==void 0&&(u.forEach(p=>this.overlays=this.overlays.remove(p)),this.hr.delete(s)),vt.resolve()}getOverlaysForCollection(e,i,s){const u=Ch(),p=i.length+1,v=new an(i.child("")),a=this.overlays.getIteratorFrom(v);for(;a.hasNext();){const A=a.getNext().value,O=A.getKey();if(!i.isPrefixOf(O.path))break;O.path.length===p&&A.largestBatchId>s&&u.set(A.getKey(),A)}return vt.resolve(u)}getOverlaysForCollectionGroup(e,i,s,u){let p=new Yr((O,B)=>O-B);const v=this.overlays.getIterator();for(;v.hasNext();){const O=v.getNext().value;if(O.getKey().getCollectionGroup()===i&&O.largestBatchId>s){let B=p.get(O.largestBatchId);B===null&&(B=Ch(),p=p.insert(O.largestBatchId,B)),B.set(O.getKey(),O)}}const a=Ch(),A=p.getIterator();for(;A.hasNext()&&(A.getNext().value.forEach((O,B)=>a.set(O,B)),!(a.size()>=u)););return vt.resolve(a)}ht(e,i,s){const u=this.overlays.get(s.key);if(u!==null){const v=this.hr.get(u.largestBatchId).delete(s.key);this.hr.set(u.largestBatchId,v)}this.overlays=this.overlays.insert(s.key,new dY(i,s));let p=this.hr.get(i);p===void 0&&(p=$n(),this.hr.set(i,p)),this.hr.set(i,p.add(s.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NP{constructor(){this.Pr=new Xi(Pi.Ir),this.Tr=new Xi(Pi.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,i){const s=new Pi(e,i);this.Pr=this.Pr.add(s),this.Tr=this.Tr.add(s)}dr(e,i){e.forEach(s=>this.addReference(s,i))}removeReference(e,i){this.Ar(new Pi(e,i))}Rr(e,i){e.forEach(s=>this.removeReference(s,i))}Vr(e){const i=new an(new Fr([])),s=new Pi(i,e),u=new Pi(i,e+1),p=[];return this.Tr.forEachInRange([s,u],v=>{this.Ar(v),p.push(v.key)}),p}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const i=new an(new Fr([])),s=new Pi(i,e),u=new Pi(i,e+1);let p=$n();return this.Tr.forEachInRange([s,u],v=>{p=p.add(v.key)}),p}containsKey(e){const i=new Pi(e,0),s=this.Pr.firstAfterOrEqual(i);return s!==null&&e.isEqual(s.key)}}class Pi{constructor(e,i){this.key=e,this.pr=i}static Ir(e,i){return an.comparator(e.key,i.key)||dr(e.pr,i.pr)}static Er(e,i){return dr(e.pr,i.pr)||an.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GY{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.yr=1,this.wr=new Xi(Pi.Ir)}checkEmpty(e){return vt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,s,u){const p=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const v=new hY(p,i,s,u);this.mutationQueue.push(v);for(const a of u)this.wr=this.wr.add(new Pi(a.key,p)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return vt.resolve(v)}lookupMutationBatch(e,i){return vt.resolve(this.Sr(i))}getNextMutationBatchAfterBatchId(e,i){const s=i+1,u=this.br(s),p=u<0?0:u;return vt.resolve(this.mutationQueue.length>p?this.mutationQueue[p]:null)}getHighestUnacknowledgedBatchId(){return vt.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return vt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const s=new Pi(i,0),u=new Pi(i,Number.POSITIVE_INFINITY),p=[];return this.wr.forEachInRange([s,u],v=>{const a=this.Sr(v.pr);p.push(a)}),vt.resolve(p)}getAllMutationBatchesAffectingDocumentKeys(e,i){let s=new Xi(dr);return i.forEach(u=>{const p=new Pi(u,0),v=new Pi(u,Number.POSITIVE_INFINITY);this.wr.forEachInRange([p,v],a=>{s=s.add(a.pr)})}),vt.resolve(this.Dr(s))}getAllMutationBatchesAffectingQuery(e,i){const s=i.path,u=s.length+1;let p=s;an.isDocumentKey(p)||(p=p.child(""));const v=new Pi(new an(p),0);let a=new Xi(dr);return this.wr.forEachWhile(A=>{const O=A.key.path;return!!s.isPrefixOf(O)&&(O.length===u&&(a=a.add(A.pr)),!0)},v),vt.resolve(this.Dr(a))}Dr(e){const i=[];return e.forEach(s=>{const u=this.Sr(s);u!==null&&i.push(u)}),i}removeMutationBatch(e,i){jr(this.Cr(i.batchId,"removed")===0),this.mutationQueue.shift();let s=this.wr;return vt.forEach(i.mutations,u=>{const p=new Pi(u.key,i.batchId);return s=s.delete(p),this.referenceDelegate.markPotentiallyOrphaned(e,u.key)}).next(()=>{this.wr=s})}Mn(e){}containsKey(e,i){const s=new Pi(i,0),u=this.wr.firstAfterOrEqual(s);return vt.resolve(i.isEqual(u&&u.key))}performConsistencyCheck(e){return this.mutationQueue.length,vt.resolve()}Cr(e,i){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){const i=this.br(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WY{constructor(e){this.vr=e,this.docs=function(){return new Yr(an.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const s=i.key,u=this.docs.get(s),p=u?u.size:0,v=this.vr(i);return this.docs=this.docs.insert(s,{document:i.mutableCopy(),size:v}),this.size+=v-p,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const s=this.docs.get(i);return vt.resolve(s?s.document.mutableCopy():co.newInvalidDocument(i))}getEntries(e,i){let s=Kl();return i.forEach(u=>{const p=this.docs.get(u);s=s.insert(u,p?p.document.mutableCopy():co.newInvalidDocument(u))}),vt.resolve(s)}getDocumentsMatchingQuery(e,i,s,u){let p=Kl();const v=i.path,a=new an(v.child("")),A=this.docs.getIteratorFrom(a);for(;A.hasNext();){const{key:O,value:{document:B}}=A.getNext();if(!v.isPrefixOf(O.path))break;O.path.length>v.length+1||MX(CX(B),s)<=0||(u.has(B.key)||Eb(i,B))&&(p=p.insert(B.key,B.mutableCopy()))}return vt.resolve(p)}getAllFromCollectionGroup(e,i,s,u){xn()}Fr(e,i){return vt.forEach(this.docs,s=>i(s))}newChangeBuffer(e){return new qY(this)}getSize(e){return vt.resolve(this.size)}}class qY extends BY{constructor(e){super(),this.ar=e}applyChanges(e){const i=[];return this.changes.forEach((s,u)=>{u.isValidDocument()?i.push(this.ar.addEntry(e,u)):this.ar.removeEntry(s)}),vt.waitFor(i)}getFromCache(e,i){return this.ar.getEntry(e,i)}getAllFromCache(e,i){return this.ar.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HY{constructor(e){this.persistence=e,this.Mr=new Pp(i=>RP(i),OP),this.lastRemoteSnapshotVersion=En.min(),this.highestTargetId=0,this.Or=0,this.Nr=new NP,this.targetCount=0,this.Br=op.Nn()}forEachTarget(e,i){return this.Mr.forEach((s,u)=>i(u)),vt.resolve()}getLastRemoteSnapshotVersion(e){return vt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return vt.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),vt.resolve(this.highestTargetId)}setTargetsMetadata(e,i,s){return s&&(this.lastRemoteSnapshotVersion=s),i>this.Or&&(this.Or=i),vt.resolve()}qn(e){this.Mr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Br=new op(i),this.highestTargetId=i),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,i){return this.qn(i),this.targetCount+=1,vt.resolve()}updateTargetData(e,i){return this.qn(i),vt.resolve()}removeTargetData(e,i){return this.Mr.delete(i.target),this.Nr.Vr(i.targetId),this.targetCount-=1,vt.resolve()}removeTargets(e,i,s){let u=0;const p=[];return this.Mr.forEach((v,a)=>{a.sequenceNumber<=i&&s.get(a.targetId)===null&&(this.Mr.delete(v),p.push(this.removeMatchingKeysForTargetId(e,a.targetId)),u++)}),vt.waitFor(p).next(()=>u)}getTargetCount(e){return vt.resolve(this.targetCount)}getTargetData(e,i){const s=this.Mr.get(i)||null;return vt.resolve(s)}addMatchingKeys(e,i,s){return this.Nr.dr(i,s),vt.resolve()}removeMatchingKeys(e,i,s){this.Nr.Rr(i,s);const u=this.persistence.referenceDelegate,p=[];return u&&i.forEach(v=>{p.push(u.markPotentiallyOrphaned(e,v))}),vt.waitFor(p)}removeMatchingKeysForTargetId(e,i){return this.Nr.Vr(i),vt.resolve()}getMatchingKeysForTargetId(e,i){const s=this.Nr.gr(i);return vt.resolve(s)}containsKey(e,i){return vt.resolve(this.Nr.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZY{constructor(e,i){this.Lr={},this.overlays={},this.kr=new PP(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new HY(this),this.indexManager=new NY,this.remoteDocumentCache=function(u){return new WY(u)}(s=>this.referenceDelegate.Kr(s)),this.serializer=new LY(i),this.$r=new UY(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new $Y,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let s=this.Lr[e.toKey()];return s||(s=new GY(i,this.referenceDelegate),this.Lr[e.toKey()]=s),s}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,i,s){Kt("MemoryPersistence","Starting transaction:",e);const u=new XY(this.kr.next());return this.referenceDelegate.Ur(),s(u).next(p=>this.referenceDelegate.Wr(u).next(()=>p)).toPromise().then(p=>(u.raiseOnCommittedEvent(),p))}Gr(e,i){return vt.or(Object.values(this.Lr).map(s=>()=>s.containsKey(e,i)))}}class XY extends OX{constructor(e){super(),this.currentSequenceNumber=e}}class FP{constructor(e){this.persistence=e,this.zr=new NP,this.jr=null}static Hr(e){return new FP(e)}get Jr(){if(this.jr)return this.jr;throw xn()}addReference(e,i,s){return this.zr.addReference(s,i),this.Jr.delete(s.toString()),vt.resolve()}removeReference(e,i,s){return this.zr.removeReference(s,i),this.Jr.add(s.toString()),vt.resolve()}markPotentiallyOrphaned(e,i){return this.Jr.add(i.toString()),vt.resolve()}removeTarget(e,i){this.zr.Vr(i.targetId).forEach(u=>this.Jr.add(u.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,i.targetId).next(u=>{u.forEach(p=>this.Jr.add(p.toString()))}).next(()=>s.removeTargetData(e,i))}Ur(){this.jr=new Set}Wr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return vt.forEach(this.Jr,s=>{const u=an.fromPath(s);return this.Yr(e,u).next(p=>{p||i.removeEntry(u,En.min())})}).next(()=>(this.jr=null,i.apply(e)))}updateLimboDocument(e,i){return this.Yr(e,i).next(s=>{s?this.Jr.delete(i.toString()):this.Jr.add(i.toString())})}Kr(e){return 0}Yr(e,i){return vt.or([()=>vt.resolve(this.zr.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.Gr(e,i)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BP{constructor(e,i,s,u){this.targetId=e,this.fromCache=i,this.qi=s,this.Qi=u}static Ki(e,i){let s=$n(),u=$n();for(const p of i.docChanges)switch(p.type){case 0:s=s.add(p.doc.key);break;case 1:u=u.add(p.doc.key)}return new BP(e,i.fromCache,s,u)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YY{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KY{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=8}initialize(e,i){this.zi=e,this.indexManager=i,this.$i=!0}getDocumentsMatchingQuery(e,i,s,u){const p={result:null};return this.ji(e,i).next(v=>{p.result=v}).next(()=>{if(!p.result)return this.Hi(e,i,u,s).next(v=>{p.result=v})}).next(()=>{if(p.result)return;const v=new YY;return this.Ji(e,i,v).next(a=>{if(p.result=a,this.Ui)return this.Yi(e,i,v,a.size)})}).next(()=>p.result)}Yi(e,i,s,u){return s.documentReadCount<this.Wi?(Ig()<=qn.DEBUG&&Kt("QueryEngine","SDK will not create cache indexes for query:",ff(i),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),vt.resolve()):(Ig()<=qn.DEBUG&&Kt("QueryEngine","Query:",ff(i),"scans",s.documentReadCount,"local documents and returns",u,"documents as results."),s.documentReadCount>this.Gi*u?(Ig()<=qn.DEBUG&&Kt("QueryEngine","The SDK decides to create cache indexes for query:",ff(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ya(i))):vt.resolve())}ji(e,i){if(iL(i))return vt.resolve(null);let s=Ya(i);return this.indexManager.getIndexType(e,s).next(u=>u===0?null:(i.limit!==null&&u===1&&(i=HS(i,null,"F"),s=Ya(i)),this.indexManager.getDocumentsMatchingTarget(e,s).next(p=>{const v=$n(...p);return this.zi.getDocuments(e,v).next(a=>this.indexManager.getMinOffset(e,s).next(A=>{const O=this.Zi(i,a);return this.Xi(i,O,v,A.readTime)?this.ji(e,HS(i,null,"F")):this.es(e,O,i,A)}))})))}Hi(e,i,s,u){return iL(i)||u.isEqual(En.min())?vt.resolve(null):this.zi.getDocuments(e,s).next(p=>{const v=this.Zi(i,p);return this.Xi(i,v,s,u)?vt.resolve(null):(Ig()<=qn.DEBUG&&Kt("QueryEngine","Re-using previous result from %s to execute query: %s",u.toString(),ff(i)),this.es(e,v,i,kX(u,-1)).next(a=>a))})}Zi(e,i){let s=new Xi(HF(e));return i.forEach((u,p)=>{Eb(e,p)&&(s=s.add(p))}),s}Xi(e,i,s,u){if(e.limit===null)return!1;if(s.size!==i.size)return!0;const p=e.limitType==="F"?i.last():i.first();return!!p&&(p.hasPendingWrites||p.version.compareTo(u)>0)}Ji(e,i,s){return Ig()<=qn.DEBUG&&Kt("QueryEngine","Using full collection scan to execute query:",ff(i)),this.zi.getDocumentsMatchingQuery(e,i,_u.min(),s)}es(e,i,s,u){return this.zi.getDocumentsMatchingQuery(e,s,u).next(p=>(i.forEach(v=>{p=p.insert(v.key,v)}),p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JY{constructor(e,i,s,u){this.persistence=e,this.ts=i,this.serializer=u,this.ns=new Yr(dr),this.rs=new Pp(p=>RP(p),OP),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(s)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new VY(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.ns))}}function QY(t,e,i,s){return new JY(t,e,i,s)}async function mB(t,e){const i=Pn(t);return await i.persistence.runTransaction("Handle user change","readonly",s=>{let u;return i.mutationQueue.getAllMutationBatches(s).next(p=>(u=p,i._s(e),i.mutationQueue.getAllMutationBatches(s))).next(p=>{const v=[],a=[];let A=$n();for(const O of u){v.push(O.batchId);for(const B of O.mutations)A=A.add(B.key)}for(const O of p){a.push(O.batchId);for(const B of O.mutations)A=A.add(B.key)}return i.localDocuments.getDocuments(s,A).next(O=>({us:O,removedBatchIds:v,addedBatchIds:a}))})})}function eK(t,e){const i=Pn(t);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const u=e.batch.keys(),p=i.os.newChangeBuffer({trackRemovals:!0});return function(a,A,O,B){const $=O.batch,Y=$.keys();let se=vt.resolve();return Y.forEach(me=>{se=se.next(()=>B.getEntry(A,me)).next(_e=>{const Ee=O.docVersions.get(me);jr(Ee!==null),_e.version.compareTo(Ee)<0&&($.applyToRemoteDocument(_e,O),_e.isValidDocument()&&(_e.setReadTime(O.commitVersion),B.addEntry(_e)))})}),se.next(()=>a.mutationQueue.removeMutationBatch(A,$))}(i,s,e,p).next(()=>p.apply(s)).next(()=>i.mutationQueue.performConsistencyCheck(s)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(s,u,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(a){let A=$n();for(let O=0;O<a.mutationResults.length;++O)a.mutationResults[O].transformResults.length>0&&(A=A.add(a.batch.mutations[O].key));return A}(e))).next(()=>i.localDocuments.getDocuments(s,u))})}function gB(t){const e=Pn(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Qr.getLastRemoteSnapshotVersion(i))}function tK(t,e){const i=Pn(t),s=e.snapshotVersion;let u=i.ns;return i.persistence.runTransaction("Apply remote event","readwrite-primary",p=>{const v=i.os.newChangeBuffer({trackRemovals:!0});u=i.ns;const a=[];e.targetChanges.forEach((B,$)=>{const Y=u.get($);if(!Y)return;a.push(i.Qr.removeMatchingKeys(p,B.removedDocuments,$).next(()=>i.Qr.addMatchingKeys(p,B.addedDocuments,$)));let se=Y.withSequenceNumber(p.currentSequenceNumber);e.targetMismatches.get($)!==null?se=se.withResumeToken(mo.EMPTY_BYTE_STRING,En.min()).withLastLimboFreeSnapshotVersion(En.min()):B.resumeToken.approximateByteSize()>0&&(se=se.withResumeToken(B.resumeToken,s)),u=u.insert($,se),function(_e,Ee,ae){return _e.resumeToken.approximateByteSize()===0||Ee.snapshotVersion.toMicroseconds()-_e.snapshotVersion.toMicroseconds()>=3e8?!0:ae.addedDocuments.size+ae.modifiedDocuments.size+ae.removedDocuments.size>0}(Y,se,B)&&a.push(i.Qr.updateTargetData(p,se))});let A=Kl(),O=$n();if(e.documentUpdates.forEach(B=>{e.resolvedLimboDocuments.has(B)&&a.push(i.persistence.referenceDelegate.updateLimboDocument(p,B))}),a.push(nK(p,v,e.documentUpdates).next(B=>{A=B.cs,O=B.ls})),!s.isEqual(En.min())){const B=i.Qr.getLastRemoteSnapshotVersion(p).next($=>i.Qr.setTargetsMetadata(p,p.currentSequenceNumber,s));a.push(B)}return vt.waitFor(a).next(()=>v.apply(p)).next(()=>i.localDocuments.getLocalViewOfDocuments(p,A,O)).next(()=>A)}).then(p=>(i.ns=u,p))}function nK(t,e,i){let s=$n(),u=$n();return i.forEach(p=>s=s.add(p)),e.getEntries(t,s).next(p=>{let v=Kl();return i.forEach((a,A)=>{const O=p.get(a);A.isFoundDocument()!==O.isFoundDocument()&&(u=u.add(a)),A.isNoDocument()&&A.version.isEqual(En.min())?(e.removeEntry(a,A.readTime),v=v.insert(a,A)):!O.isValidDocument()||A.version.compareTo(O.version)>0||A.version.compareTo(O.version)===0&&O.hasPendingWrites?(e.addEntry(A),v=v.insert(a,A)):Kt("LocalStore","Ignoring outdated watch update for ",a,". Current version:",O.version," Watch version:",A.version)}),{cs:v,ls:u}})}function rK(t,e){const i=Pn(t);return i.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=-1),i.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function iK(t,e){const i=Pn(t);return i.persistence.runTransaction("Allocate target","readwrite",s=>{let u;return i.Qr.getTargetData(s,e).next(p=>p?(u=p,vt.resolve(u)):i.Qr.allocateTargetId(s).next(v=>(u=new Kc(e,v,"TargetPurposeListen",s.currentSequenceNumber),i.Qr.addTargetData(s,u).next(()=>u))))}).then(s=>{const u=i.ns.get(s.targetId);return(u===null||s.snapshotVersion.compareTo(u.snapshotVersion)>0)&&(i.ns=i.ns.insert(s.targetId,s),i.rs.set(e,s.targetId)),s})}async function JS(t,e,i){const s=Pn(t),u=s.ns.get(e),p=i?"readwrite":"readwrite-primary";try{i||await s.persistence.runTransaction("Release target",p,v=>s.persistence.referenceDelegate.removeTarget(v,u))}catch(v){if(!Ey(v))throw v;Kt("LocalStore",`Failed to update sequence numbers for target ${e}: ${v}`)}s.ns=s.ns.remove(e),s.rs.delete(u.target)}function mL(t,e,i){const s=Pn(t);let u=En.min(),p=$n();return s.persistence.runTransaction("Execute query","readwrite",v=>function(A,O,B){const $=Pn(A),Y=$.rs.get(B);return Y!==void 0?vt.resolve($.ns.get(Y)):$.Qr.getTargetData(O,B)}(s,v,Ya(e)).next(a=>{if(a)return u=a.lastLimboFreeSnapshotVersion,s.Qr.getMatchingKeysForTargetId(v,a.targetId).next(A=>{p=A})}).next(()=>s.ts.getDocumentsMatchingQuery(v,e,i?u:En.min(),i?p:$n())).next(a=>(oK(s,YX(e),a),{documents:a,hs:p})))}function oK(t,e,i){let s=t.ss.get(e)||En.min();i.forEach((u,p)=>{p.readTime.compareTo(s)>0&&(s=p.readTime)}),t.ss.set(e,s)}class gL{constructor(){this.activeTargetIds=nY()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class sK{constructor(){this.no=new gL,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,s){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,i,s){this.ro[e]=i}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new gL,Promise.resolve()}handleUserChange(e,i,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aK{io(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _L{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){Kt("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){Kt("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e1=null;function pE(){return e1===null?e1=function(){return 268435456+Math.round(2147483648*Math.random())}():e1++,"0x"+e1.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lK={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cK{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const so="WebChannelConnection";class uK extends class{constructor(i){this.databaseInfo=i,this.databaseId=i.databaseId;const s=i.ssl?"https":"http",u=encodeURIComponent(this.databaseId.projectId),p=encodeURIComponent(this.databaseId.database);this.fo=s+"://"+i.host,this.po=`projects/${u}/databases/${p}`,this.yo=this.databaseId.database==="(default)"?`project_id=${u}`:`project_id=${u}&database_id=${p}`}get wo(){return!1}So(i,s,u,p,v){const a=pE(),A=this.bo(i,s);Kt("RestConnection",`Sending RPC '${i}' ${a}:`,A,u);const O={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(O,p,v),this.Co(i,A,O,u).then(B=>(Kt("RestConnection",`Received RPC '${i}' ${a}: `,B),B),B=>{throw tp("RestConnection",`RPC '${i}' ${a} failed with error: `,B,"url: ",A,"request:",u),B})}vo(i,s,u,p,v,a){return this.So(i,s,u,p,v)}Do(i,s,u){i["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Sp}(),i["Content-Type"]="text/plain",this.databaseInfo.appId&&(i["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((p,v)=>i[v]=p),u&&u.headers.forEach((p,v)=>i[v]=p)}bo(i,s){const u=lK[i];return`${this.fo}/v1/${s}:${u}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,i,s,u){const p=pE();return new Promise((v,a)=>{const A=new yX;A.setWithCredentials(!0),A.listenOnce(gX.COMPLETE,()=>{try{switch(A.getLastErrorCode()){case dE.NO_ERROR:const B=A.getResponseJson();Kt(so,`XHR for RPC '${e}' ${p} received:`,JSON.stringify(B)),v(B);break;case dE.TIMEOUT:Kt(so,`RPC '${e}' ${p} timed out`),a(new Ht(ht.DEADLINE_EXCEEDED,"Request time out"));break;case dE.HTTP_ERROR:const $=A.getStatus();if(Kt(so,`RPC '${e}' ${p} failed with status:`,$,"response text:",A.getResponseText()),$>0){let Y=A.getResponseJson();Array.isArray(Y)&&(Y=Y[0]);const se=Y==null?void 0:Y.error;if(se&&se.status&&se.message){const me=function(Ee){const ae=Ee.toLowerCase().replace(/_/g,"-");return Object.values(ht).indexOf(ae)>=0?ae:ht.UNKNOWN}(se.status);a(new Ht(me,se.message))}else a(new Ht(ht.UNKNOWN,"Server responded with status "+A.getStatus()))}else a(new Ht(ht.UNAVAILABLE,"Connection failed."));break;default:xn()}}finally{Kt(so,`RPC '${e}' ${p} completed.`)}});const O=JSON.stringify(u);Kt(so,`RPC '${e}' ${p} sending request:`,u),A.send(i,"POST",O,s,15)})}Fo(e,i,s){const u=pE(),p=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],v=pX(),a=mX(),A={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},O=this.longPollingOptions.timeoutSeconds;O!==void 0&&(A.longPollingTimeout=Math.round(1e3*O)),this.useFetchStreams&&(A.useFetchStreams=!0),this.Do(A.initMessageHeaders,i,s),A.encodeInitMessageHeaders=!0;const B=p.join("");Kt(so,`Creating RPC '${e}' stream ${u}: ${B}`,A);const $=v.createWebChannel(B,A);let Y=!1,se=!1;const me=new cK({lo:Ee=>{se?Kt(so,`Not sending because RPC '${e}' stream ${u} is closed:`,Ee):(Y||(Kt(so,`Opening RPC '${e}' stream ${u} transport.`),$.open(),Y=!0),Kt(so,`RPC '${e}' stream ${u} sending:`,Ee),$.send(Ee))},ho:()=>$.close()}),_e=(Ee,ae,le)=>{Ee.listen(ae,fe=>{try{le(fe)}catch(Ce){setTimeout(()=>{throw Ce},0)}})};return _e($,Kv.EventType.OPEN,()=>{se||Kt(so,`RPC '${e}' stream ${u} transport opened.`)}),_e($,Kv.EventType.CLOSE,()=>{se||(se=!0,Kt(so,`RPC '${e}' stream ${u} transport closed`),me.Vo())}),_e($,Kv.EventType.ERROR,Ee=>{se||(se=!0,tp(so,`RPC '${e}' stream ${u} transport errored:`,Ee),me.Vo(new Ht(ht.UNAVAILABLE,"The operation could not be completed")))}),_e($,Kv.EventType.MESSAGE,Ee=>{var ae;if(!se){const le=Ee.data[0];jr(!!le);const fe=le,Ce=fe.error||((ae=fe[0])===null||ae===void 0?void 0:ae.error);if(Ce){Kt(so,`RPC '${e}' stream ${u} received error:`,Ce);const Ge=Ce.status;let gt=function(Oe){const Yt=di[Oe];if(Yt!==void 0)return sB(Yt)}(Ge),It=Ce.message;gt===void 0&&(gt=ht.INTERNAL,It="Unknown error status: "+Ge+" with message "+Ce.message),se=!0,me.Vo(new Ht(gt,It)),$.close()}else Kt(so,`RPC '${e}' stream ${u} received:`,le),me.mo(le)}}),_e(a,_X.STAT_EVENT,Ee=>{Ee.stat===HD.PROXY?Kt(so,`RPC '${e}' stream ${u} detected buffering proxy`):Ee.stat===HD.NOPROXY&&Kt(so,`RPC '${e}' stream ${u} detected no buffering proxy`)}),setTimeout(()=>{me.Ro()},0),me}}function mE(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pb(t){return new bY(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _B{constructor(e,i,s=1e3,u=1.5,p=6e4){this.oi=e,this.timerId=i,this.Mo=s,this.xo=u,this.Oo=p,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const i=Math.floor(this.No+this.Qo()),s=Math.max(0,Date.now()-this.Lo),u=Math.max(0,i-s);u>0&&Kt("ExponentialBackoff",`Backing off for ${u} ms (base delay: ${this.No} ms, delay with jitter: ${i} ms, last attempt: ${s} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,u,()=>(this.Lo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Bo!==null&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){this.Bo!==null&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yB{constructor(e,i,s,u,p,v,a,A){this.oi=e,this.$o=s,this.Uo=u,this.connection=p,this.authCredentialsProvider=v,this.appCheckCredentialsProvider=a,this.listener=A,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new _B(e,i)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,i){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,e!==4?this.jo.reset():i&&i.code===ht.RESOURCE_EXHAUSTED?(Yl(i.toString()),Yl("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):i&&i.code===ht.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(i)}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),i=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,u])=>{this.Wo===i&&this.o_(s,u)},s=>{e(()=>{const u=new Ht(ht.UNKNOWN,"Fetching auth token failed: "+s.message);return this.__(u)})})}o_(e,i){const s=this.s_(this.Wo);this.stream=this.a_(e,i),this.stream.Po(()=>{s(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(u=>{s(()=>this.__(u))}),this.stream.onMessage(u=>{s(()=>this.onMessage(u))})}Yo(){this.state=5,this.jo.qo(async()=>{this.state=0,this.start()})}__(e){return Kt("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return i=>{this.oi.enqueueAndForget(()=>this.Wo===e?i():(Kt("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class hK extends yB{constructor(e,i,s,u,p,v){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,s,u,v),this.serializer=p}a_(e,i){return this.connection.Fo("Listen",e,i)}onMessage(e){this.jo.reset();const i=EY(this.serializer,e),s=function(p){if(!("targetChange"in p))return En.min();const v=p.targetChange;return v.targetIds&&v.targetIds.length?En.min():v.readTime?Ka(v.readTime):En.min()}(e);return this.listener.u_(i,s)}c_(e){const i={};i.database=KS(this.serializer),i.addTarget=function(p,v){let a;const A=v.target;if(a=WS(A)?{documents:AY(p,A)}:{query:PY(p,A)},a.targetId=v.targetId,v.resumeToken.approximateByteSize()>0){a.resumeToken=cB(p,v.resumeToken);const O=ZS(p,v.expectedCount);O!==null&&(a.expectedCount=O)}else if(v.snapshotVersion.compareTo(En.min())>0){a.readTime=Ex(p,v.snapshotVersion.toTimestamp());const O=ZS(p,v.expectedCount);O!==null&&(a.expectedCount=O)}return a}(this.serializer,e);const s=CY(this.serializer,e);s&&(i.labels=s),this.t_(i)}l_(e){const i={};i.database=KS(this.serializer),i.removeTarget=e,this.t_(i)}}class dK extends yB{constructor(e,i,s,u,p,v){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,s,u,v),this.serializer=p,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,i){return this.connection.Fo("Write",e,i)}onMessage(e){if(jr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const i=IY(e.writeResults,e.commitTime),s=Ka(e.commitTime);return this.listener.T_(s,i)}return jr(!e.writeResults||e.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=KS(this.serializer),this.t_(e)}I_(e){const i={streamToken:this.lastStreamToken,writes:e.map(s=>SY(this.serializer,s))};this.t_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fK extends class{}{constructor(e,i,s,u){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=s,this.serializer=u,this.A_=!1}R_(){if(this.A_)throw new Ht(ht.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,p])=>this.connection.So(e,i,s,u,p)).catch(u=>{throw u.name==="FirebaseError"?(u.code===ht.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new Ht(ht.UNKNOWN,u.toString())})}vo(e,i,s,u){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,v])=>this.connection.vo(e,i,s,p,v,u)).catch(p=>{throw p.name==="FirebaseError"?(p.code===ht.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new Ht(ht.UNKNOWN,p.toString())})}terminate(){this.A_=!0}}class pK{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,e==="Online"&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Yl(i),this.g_=!1):Kt("OnlineStateTracker",i)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mK{constructor(e,i,s,u,p){this.localStore=e,this.datastore=i,this.asyncQueue=s,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=p,this.M_.io(v=>{s.enqueueAndForget(async()=>{nd(this)&&(Kt("RemoteStore","Restarting streams for network reachability change."),await async function(A){const O=Pn(A);O.v_.add(4),await Ay(O),O.x_.set("Unknown"),O.v_.delete(4),await kb(O)}(this))})}),this.x_=new pK(s,u)}}async function kb(t){if(nd(t))for(const e of t.F_)await e(!0)}async function Ay(t){for(const e of t.F_)await e(!1)}function vB(t,e){const i=Pn(t);i.C_.has(e.targetId)||(i.C_.set(e.targetId,e),UP(i)?VP(i):kp(i).Jo()&&jP(i,e))}function xB(t,e){const i=Pn(t),s=kp(i);i.C_.delete(e),s.Jo()&&bB(i,e),i.C_.size===0&&(s.Jo()?s.Xo():nd(i)&&i.x_.set("Unknown"))}function jP(t,e){if(t.O_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(En.min())>0){const i=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}kp(t).c_(e)}function bB(t,e){t.O_.Ne(e),kp(t).l_(e)}function VP(t){t.O_=new _Y({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>t.C_.get(e)||null,rt:()=>t.datastore.serializer.databaseId}),kp(t).start(),t.x_.p_()}function UP(t){return nd(t)&&!kp(t).Ho()&&t.C_.size>0}function nd(t){return Pn(t).v_.size===0}function wB(t){t.O_=void 0}async function gK(t){t.C_.forEach((e,i)=>{jP(t,e)})}async function _K(t,e){wB(t),UP(t)?(t.x_.S_(e),VP(t)):t.x_.set("Unknown")}async function yK(t,e,i){if(t.x_.set("Online"),e instanceof lB&&e.state===2&&e.cause)try{await async function(u,p){const v=p.cause;for(const a of p.targetIds)u.C_.has(a)&&(await u.remoteSyncer.rejectListen(a,v),u.C_.delete(a),u.O_.removeTarget(a))}(t,e)}catch(s){Kt("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),s),await Sx(t,s)}else if(e instanceof I1?t.O_.Ue(e):e instanceof aB?t.O_.Ye(e):t.O_.ze(e),!i.isEqual(En.min()))try{const s=await gB(t.localStore);i.compareTo(s)>=0&&await function(p,v){const a=p.O_.st(v);return a.targetChanges.forEach((A,O)=>{if(A.resumeToken.approximateByteSize()>0){const B=p.C_.get(O);B&&p.C_.set(O,B.withResumeToken(A.resumeToken,v))}}),a.targetMismatches.forEach((A,O)=>{const B=p.C_.get(A);if(!B)return;p.C_.set(A,B.withResumeToken(mo.EMPTY_BYTE_STRING,B.snapshotVersion)),bB(p,A);const $=new Kc(B.target,A,O,B.sequenceNumber);jP(p,$)}),p.remoteSyncer.applyRemoteEvent(a)}(t,i)}catch(s){Kt("RemoteStore","Failed to raise snapshot:",s),await Sx(t,s)}}async function Sx(t,e,i){if(!Ey(e))throw e;t.v_.add(1),await Ay(t),t.x_.set("Offline"),i||(i=()=>gB(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Kt("RemoteStore","Retrying IndexedDB access"),await i(),t.v_.delete(1),await kb(t)})}function TB(t,e){return e().catch(i=>Sx(t,i,e))}async function Cb(t){const e=Pn(t),i=vu(e);let s=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;vK(e);)try{const u=await rK(e.localStore,s);if(u===null){e.D_.length===0&&i.Xo();break}s=u.batchId,xK(e,u)}catch(u){await Sx(e,u)}EB(e)&&SB(e)}function vK(t){return nd(t)&&t.D_.length<10}function xK(t,e){t.D_.push(e);const i=vu(t);i.Jo()&&i.P_&&i.I_(e.mutations)}function EB(t){return nd(t)&&!vu(t).Ho()&&t.D_.length>0}function SB(t){vu(t).start()}async function bK(t){vu(t).d_()}async function wK(t){const e=vu(t);for(const i of t.D_)e.I_(i.mutations)}async function TK(t,e,i){const s=t.D_.shift(),u=DP.from(s,e,i);await TB(t,()=>t.remoteSyncer.applySuccessfulWrite(u)),await Cb(t)}async function EK(t,e){e&&vu(t).P_&&await async function(s,u){if(function(v){return pY(v)&&v!==ht.ABORTED}(u.code)){const p=s.D_.shift();vu(s).Zo(),await TB(s,()=>s.remoteSyncer.rejectFailedWrite(p.batchId,u)),await Cb(s)}}(t,e),EB(t)&&SB(t)}async function yL(t,e){const i=Pn(t);i.asyncQueue.verifyOperationInProgress(),Kt("RemoteStore","RemoteStore received new credentials");const s=nd(i);i.v_.add(3),await Ay(i),s&&i.x_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.v_.delete(3),await kb(i)}async function SK(t,e){const i=Pn(t);e?(i.v_.delete(2),await kb(i)):e||(i.v_.add(2),await Ay(i),i.x_.set("Unknown"))}function kp(t){return t.N_||(t.N_=function(i,s,u){const p=Pn(i);return p.R_(),new hK(s,p.connection,p.authCredentials,p.appCheckCredentials,p.serializer,u)}(t.datastore,t.asyncQueue,{Po:gK.bind(null,t),To:_K.bind(null,t),u_:yK.bind(null,t)}),t.F_.push(async e=>{e?(t.N_.Zo(),UP(t)?VP(t):t.x_.set("Unknown")):(await t.N_.stop(),wB(t))})),t.N_}function vu(t){return t.B_||(t.B_=function(i,s,u){const p=Pn(i);return p.R_(),new dK(s,p.connection,p.authCredentials,p.appCheckCredentials,p.serializer,u)}(t.datastore,t.asyncQueue,{Po:bK.bind(null,t),To:EK.bind(null,t),E_:wK.bind(null,t),T_:TK.bind(null,t)}),t.F_.push(async e=>{e?(t.B_.Zo(),await Cb(t)):(await t.B_.stop(),t.D_.length>0&&(Kt("RemoteStore",`Stopping write stream with ${t.D_.length} pending writes`),t.D_=[]))})),t.B_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $P{constructor(e,i,s,u,p){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=s,this.op=u,this.removalCallback=p,this.deferred=new Vl,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(v=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,s,u,p){const v=Date.now()+s,a=new $P(e,i,v,u,p);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ht(ht.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function GP(t,e){if(Yl("AsyncQueue",`${e}: ${t}`),Ey(t))return new Ht(ht.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $f{constructor(e){this.comparator=e?(i,s)=>e(i,s)||an.comparator(i.key,s.key):(i,s)=>an.comparator(i.key,s.key),this.keyedMap=Lg(),this.sortedSet=new Yr(this.comparator)}static emptySet(e){return new $f(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,s)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof $f)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;i.hasNext();){const u=i.getNext().key,p=s.getNext().key;if(!u.isEqual(p))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const s=new $f;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=i,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vL{constructor(){this.L_=new Yr(an.comparator)}track(e){const i=e.doc.key,s=this.L_.get(i);s?e.type!==0&&s.type===3?this.L_=this.L_.insert(i,e):e.type===3&&s.type!==1?this.L_=this.L_.insert(i,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.L_=this.L_.insert(i,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.L_=this.L_.insert(i,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.L_=this.L_.remove(i):e.type===1&&s.type===2?this.L_=this.L_.insert(i,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.L_=this.L_.insert(i,{type:2,doc:e.doc}):xn():this.L_=this.L_.insert(i,e)}k_(){const e=[];return this.L_.inorderTraversal((i,s)=>{e.push(s)}),e}}class sp{constructor(e,i,s,u,p,v,a,A,O){this.query=e,this.docs=i,this.oldDocs=s,this.docChanges=u,this.mutatedKeys=p,this.fromCache=v,this.syncStateChanged=a,this.excludesMetadataChanges=A,this.hasCachedResults=O}static fromInitialDocuments(e,i,s,u,p){const v=[];return i.forEach(a=>{v.push({type:0,doc:a})}),new sp(e,i,$f.emptySet(i),v,s,u,!0,!1,p)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Tb(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,s=e.docChanges;if(i.length!==s.length)return!1;for(let u=0;u<i.length;u++)if(i[u].type!==s[u].type||!i[u].doc.isEqual(s[u].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IK{constructor(){this.q_=void 0,this.listeners=[]}}class AK{constructor(){this.queries=new Pp(e=>qF(e),Tb),this.onlineState="Unknown",this.Q_=new Set}}async function WP(t,e){const i=Pn(t),s=e.query;let u=!1,p=i.queries.get(s);if(p||(u=!0,p=new IK),u)try{p.q_=await i.onListen(s)}catch(v){const a=GP(v,`Initialization of query '${ff(e.query)}' failed`);return void e.onError(a)}i.queries.set(s,p),p.listeners.push(e),e.K_(i.onlineState),p.q_&&e.U_(p.q_)&&HP(i)}async function qP(t,e){const i=Pn(t),s=e.query;let u=!1;const p=i.queries.get(s);if(p){const v=p.listeners.indexOf(e);v>=0&&(p.listeners.splice(v,1),u=p.listeners.length===0)}if(u)return i.queries.delete(s),i.onUnlisten(s)}function PK(t,e){const i=Pn(t);let s=!1;for(const u of e){const p=u.query,v=i.queries.get(p);if(v){for(const a of v.listeners)a.U_(u)&&(s=!0);v.q_=u}}s&&HP(i)}function kK(t,e,i){const s=Pn(t),u=s.queries.get(e);if(u)for(const p of u.listeners)p.onError(i);s.queries.delete(e)}function HP(t){t.Q_.forEach(e=>{e.next()})}class ZP{constructor(e,i,s){this.query=e,this.W_=i,this.G_=!1,this.z_=null,this.onlineState="Unknown",this.options=s||{}}U_(e){if(!this.options.includeMetadataChanges){const s=[];for(const u of e.docChanges)u.type!==3&&s.push(u);e=new sp(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.G_?this.j_(e)&&(this.W_.next(e),i=!0):this.H_(e,this.onlineState)&&(this.J_(e),i=!0),this.z_=e,i}onError(e){this.W_.error(e)}K_(e){this.onlineState=e;let i=!1;return this.z_&&!this.G_&&this.H_(this.z_,e)&&(this.J_(this.z_),i=!0),i}H_(e,i){if(!e.fromCache)return!0;const s=i!=="Offline";return(!this.options.Y_||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}j_(e){if(e.docChanges.length>0)return!0;const i=this.z_&&this.z_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}J_(e){e=sp.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.G_=!0,this.W_.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IB{constructor(e){this.key=e}}class AB{constructor(e){this.key=e}}class CK{constructor(e,i){this.query=e,this.sa=i,this.oa=null,this.hasCachedResults=!1,this.current=!1,this._a=$n(),this.mutatedKeys=$n(),this.aa=HF(e),this.ua=new $f(this.aa)}get ca(){return this.sa}la(e,i){const s=i?i.ha:new vL,u=i?i.ua:this.ua;let p=i?i.mutatedKeys:this.mutatedKeys,v=u,a=!1;const A=this.query.limitType==="F"&&u.size===this.query.limit?u.last():null,O=this.query.limitType==="L"&&u.size===this.query.limit?u.first():null;if(e.inorderTraversal((B,$)=>{const Y=u.get(B),se=Eb(this.query,$)?$:null,me=!!Y&&this.mutatedKeys.has(Y.key),_e=!!se&&(se.hasLocalMutations||this.mutatedKeys.has(se.key)&&se.hasCommittedMutations);let Ee=!1;Y&&se?Y.data.isEqual(se.data)?me!==_e&&(s.track({type:3,doc:se}),Ee=!0):this.Pa(Y,se)||(s.track({type:2,doc:se}),Ee=!0,(A&&this.aa(se,A)>0||O&&this.aa(se,O)<0)&&(a=!0)):!Y&&se?(s.track({type:0,doc:se}),Ee=!0):Y&&!se&&(s.track({type:1,doc:Y}),Ee=!0,(A||O)&&(a=!0)),Ee&&(se?(v=v.add(se),p=_e?p.add(B):p.delete(B)):(v=v.delete(B),p=p.delete(B)))}),this.query.limit!==null)for(;v.size>this.query.limit;){const B=this.query.limitType==="F"?v.last():v.first();v=v.delete(B.key),p=p.delete(B.key),s.track({type:1,doc:B})}return{ua:v,ha:s,Xi:a,mutatedKeys:p}}Pa(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,s){const u=this.ua;this.ua=e.ua,this.mutatedKeys=e.mutatedKeys;const p=e.ha.k_();p.sort((O,B)=>function(Y,se){const me=_e=>{switch(_e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xn()}};return me(Y)-me(se)}(O.type,B.type)||this.aa(O.doc,B.doc)),this.Ia(s);const v=i?this.Ta():[],a=this._a.size===0&&this.current?1:0,A=a!==this.oa;return this.oa=a,p.length!==0||A?{snapshot:new sp(this.query,e.ua,u,p,e.mutatedKeys,a===0,A,!1,!!s&&s.resumeToken.approximateByteSize()>0),Ea:v}:{Ea:v}}K_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({ua:this.ua,ha:new vL,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Ea:[]}}da(e){return!this.sa.has(e)&&!!this.ua.has(e)&&!this.ua.get(e).hasLocalMutations}Ia(e){e&&(e.addedDocuments.forEach(i=>this.sa=this.sa.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.sa=this.sa.delete(i)),this.current=e.current)}Ta(){if(!this.current)return[];const e=this._a;this._a=$n(),this.ua.forEach(s=>{this.da(s.key)&&(this._a=this._a.add(s.key))});const i=[];return e.forEach(s=>{this._a.has(s)||i.push(new AB(s))}),this._a.forEach(s=>{e.has(s)||i.push(new IB(s))}),i}Aa(e){this.sa=e.hs,this._a=$n();const i=this.la(e.documents);return this.applyChanges(i,!0)}Ra(){return sp.fromInitialDocuments(this.query,this.ua,this.mutatedKeys,this.oa===0,this.hasCachedResults)}}class MK{constructor(e,i,s){this.query=e,this.targetId=i,this.view=s}}class RK{constructor(e){this.key=e,this.Va=!1}}class OK{constructor(e,i,s,u,p,v){this.localStore=e,this.remoteStore=i,this.eventManager=s,this.sharedClientState=u,this.currentUser=p,this.maxConcurrentLimboResolutions=v,this.ma={},this.fa=new Pp(a=>qF(a),Tb),this.ga=new Map,this.pa=new Set,this.ya=new Yr(an.comparator),this.wa=new Map,this.Sa=new NP,this.ba={},this.Da=new Map,this.Ca=op.Bn(),this.onlineState="Unknown",this.va=void 0}get isPrimaryClient(){return this.va===!0}}async function DK(t,e){const i=GK(t);let s,u;const p=i.fa.get(e);if(p)s=p.targetId,i.sharedClientState.addLocalQueryTarget(s),u=p.view.Ra();else{const v=await iK(i.localStore,Ya(e)),a=i.sharedClientState.addLocalQueryTarget(v.targetId);s=v.targetId,u=await LK(i,e,s,a==="current",v.resumeToken),i.isPrimaryClient&&vB(i.remoteStore,v)}return u}async function LK(t,e,i,s,u){t.Fa=($,Y,se)=>async function(_e,Ee,ae,le){let fe=Ee.view.la(ae);fe.Xi&&(fe=await mL(_e.localStore,Ee.query,!1).then(({documents:gt})=>Ee.view.la(gt,fe)));const Ce=le&&le.targetChanges.get(Ee.targetId),Ge=Ee.view.applyChanges(fe,_e.isPrimaryClient,Ce);return bL(_e,Ee.targetId,Ge.Ea),Ge.snapshot}(t,$,Y,se);const p=await mL(t.localStore,e,!0),v=new CK(e,p.hs),a=v.la(p.documents),A=Iy.createSynthesizedTargetChangeForCurrentChange(i,s&&t.onlineState!=="Offline",u),O=v.applyChanges(a,t.isPrimaryClient,A);bL(t,i,O.Ea);const B=new MK(e,i,v);return t.fa.set(e,B),t.ga.has(i)?t.ga.get(i).push(e):t.ga.set(i,[e]),O.snapshot}async function zK(t,e){const i=Pn(t),s=i.fa.get(e),u=i.ga.get(s.targetId);if(u.length>1)return i.ga.set(s.targetId,u.filter(p=>!Tb(p,e))),void i.fa.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(s.targetId),i.sharedClientState.isActiveQueryTarget(s.targetId)||await JS(i.localStore,s.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(s.targetId),xB(i.remoteStore,s.targetId),QS(i,s.targetId)}).catch(Ty)):(QS(i,s.targetId),await JS(i.localStore,s.targetId,!0))}async function NK(t,e,i){const s=WK(t);try{const u=await function(v,a){const A=Pn(v),O=_i.now(),B=a.reduce((se,me)=>se.add(me.key),$n());let $,Y;return A.persistence.runTransaction("Locally write mutations","readwrite",se=>{let me=Kl(),_e=$n();return A.os.getEntries(se,B).next(Ee=>{me=Ee,me.forEach((ae,le)=>{le.isValidDocument()||(_e=_e.add(ae))})}).next(()=>A.localDocuments.getOverlayedDocuments(se,me)).next(Ee=>{$=Ee;const ae=[];for(const le of a){const fe=cY(le,$.get(le.key).overlayedDocument);fe!=null&&ae.push(new td(le.key,fe,FF(fe.value.mapValue),Ul.exists(!0)))}return A.mutationQueue.addMutationBatch(se,O,ae,a)}).next(Ee=>{Y=Ee;const ae=Ee.applyToLocalDocumentSet($,_e);return A.documentOverlayCache.saveOverlays(se,Ee.batchId,ae)})}).then(()=>({batchId:Y.batchId,changes:XF($)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(u.batchId),function(v,a,A){let O=v.ba[v.currentUser.toKey()];O||(O=new Yr(dr)),O=O.insert(a,A),v.ba[v.currentUser.toKey()]=O}(s,u.batchId,i),await Py(s,u.changes),await Cb(s.remoteStore)}catch(u){const p=GP(u,"Failed to persist write");i.reject(p)}}async function PB(t,e){const i=Pn(t);try{const s=await tK(i.localStore,e);e.targetChanges.forEach((u,p)=>{const v=i.wa.get(p);v&&(jr(u.addedDocuments.size+u.modifiedDocuments.size+u.removedDocuments.size<=1),u.addedDocuments.size>0?v.Va=!0:u.modifiedDocuments.size>0?jr(v.Va):u.removedDocuments.size>0&&(jr(v.Va),v.Va=!1))}),await Py(i,s,e)}catch(s){await Ty(s)}}function xL(t,e,i){const s=Pn(t);if(s.isPrimaryClient&&i===0||!s.isPrimaryClient&&i===1){const u=[];s.fa.forEach((p,v)=>{const a=v.view.K_(e);a.snapshot&&u.push(a.snapshot)}),function(v,a){const A=Pn(v);A.onlineState=a;let O=!1;A.queries.forEach((B,$)=>{for(const Y of $.listeners)Y.K_(a)&&(O=!0)}),O&&HP(A)}(s.eventManager,e),u.length&&s.ma.u_(u),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function FK(t,e,i){const s=Pn(t);s.sharedClientState.updateQueryState(e,"rejected",i);const u=s.wa.get(e),p=u&&u.key;if(p){let v=new Yr(an.comparator);v=v.insert(p,co.newNoDocument(p,En.min()));const a=$n().add(p),A=new Ab(En.min(),new Map,new Yr(dr),v,a);await PB(s,A),s.ya=s.ya.remove(p),s.wa.delete(e),XP(s)}else await JS(s.localStore,e,!1).then(()=>QS(s,e,i)).catch(Ty)}async function BK(t,e){const i=Pn(t),s=e.batch.batchId;try{const u=await eK(i.localStore,e);CB(i,s,null),kB(i,s),i.sharedClientState.updateMutationState(s,"acknowledged"),await Py(i,u)}catch(u){await Ty(u)}}async function jK(t,e,i){const s=Pn(t);try{const u=await function(v,a){const A=Pn(v);return A.persistence.runTransaction("Reject batch","readwrite-primary",O=>{let B;return A.mutationQueue.lookupMutationBatch(O,a).next($=>(jr($!==null),B=$.keys(),A.mutationQueue.removeMutationBatch(O,$))).next(()=>A.mutationQueue.performConsistencyCheck(O)).next(()=>A.documentOverlayCache.removeOverlaysForBatchId(O,B,a)).next(()=>A.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(O,B)).next(()=>A.localDocuments.getDocuments(O,B))})}(s.localStore,e);CB(s,e,i),kB(s,e),s.sharedClientState.updateMutationState(e,"rejected",i),await Py(s,u)}catch(u){await Ty(u)}}function kB(t,e){(t.Da.get(e)||[]).forEach(i=>{i.resolve()}),t.Da.delete(e)}function CB(t,e,i){const s=Pn(t);let u=s.ba[s.currentUser.toKey()];if(u){const p=u.get(e);p&&(i?p.reject(i):p.resolve(),u=u.remove(e)),s.ba[s.currentUser.toKey()]=u}}function QS(t,e,i=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.ga.get(e))t.fa.delete(s),i&&t.ma.Ma(s,i);t.ga.delete(e),t.isPrimaryClient&&t.Sa.Vr(e).forEach(s=>{t.Sa.containsKey(s)||MB(t,s)})}function MB(t,e){t.pa.delete(e.path.canonicalString());const i=t.ya.get(e);i!==null&&(xB(t.remoteStore,i),t.ya=t.ya.remove(e),t.wa.delete(i),XP(t))}function bL(t,e,i){for(const s of i)s instanceof IB?(t.Sa.addReference(s.key,e),VK(t,s)):s instanceof AB?(Kt("SyncEngine","Document no longer in limbo: "+s.key),t.Sa.removeReference(s.key,e),t.Sa.containsKey(s.key)||MB(t,s.key)):xn()}function VK(t,e){const i=e.key,s=i.path.canonicalString();t.ya.get(i)||t.pa.has(s)||(Kt("SyncEngine","New document in limbo: "+i),t.pa.add(s),XP(t))}function XP(t){for(;t.pa.size>0&&t.ya.size<t.maxConcurrentLimboResolutions;){const e=t.pa.values().next().value;t.pa.delete(e);const i=new an(Fr.fromString(e)),s=t.Ca.next();t.wa.set(s,new RK(i)),t.ya=t.ya.insert(i,s),vB(t.remoteStore,new Kc(Ya(wb(i.path)),s,"TargetPurposeLimboResolution",PP.ae))}}async function Py(t,e,i){const s=Pn(t),u=[],p=[],v=[];s.fa.isEmpty()||(s.fa.forEach((a,A)=>{v.push(s.Fa(A,e,i).then(O=>{if((O||i)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(A.targetId,O!=null&&O.fromCache?"not-current":"current"),O){u.push(O);const B=BP.Ki(A.targetId,O);p.push(B)}}))}),await Promise.all(v),s.ma.u_(u),await async function(A,O){const B=Pn(A);try{await B.persistence.runTransaction("notifyLocalViewChanges","readwrite",$=>vt.forEach(O,Y=>vt.forEach(Y.qi,se=>B.persistence.referenceDelegate.addReference($,Y.targetId,se)).next(()=>vt.forEach(Y.Qi,se=>B.persistence.referenceDelegate.removeReference($,Y.targetId,se)))))}catch($){if(!Ey($))throw $;Kt("LocalStore","Failed to update sequence numbers: "+$)}for(const $ of O){const Y=$.targetId;if(!$.fromCache){const se=B.ns.get(Y),me=se.snapshotVersion,_e=se.withLastLimboFreeSnapshotVersion(me);B.ns=B.ns.insert(Y,_e)}}}(s.localStore,p))}async function UK(t,e){const i=Pn(t);if(!i.currentUser.isEqual(e)){Kt("SyncEngine","User change. New user:",e.toKey());const s=await mB(i.localStore,e);i.currentUser=e,function(p,v){p.Da.forEach(a=>{a.forEach(A=>{A.reject(new Ht(ht.CANCELLED,v))})}),p.Da.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await Py(i,s.us)}}function $K(t,e){const i=Pn(t),s=i.wa.get(e);if(s&&s.Va)return $n().add(s.key);{let u=$n();const p=i.ga.get(e);if(!p)return u;for(const v of p){const a=i.fa.get(v);u=u.unionWith(a.view.ca)}return u}}function GK(t){const e=Pn(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=PB.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=$K.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=FK.bind(null,e),e.ma.u_=PK.bind(null,e.eventManager),e.ma.Ma=kK.bind(null,e.eventManager),e}function WK(t){const e=Pn(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=BK.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=jK.bind(null,e),e}class wL{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Pb(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,i){return null}createIndexBackfillerScheduler(e,i){return null}createLocalStore(e){return QY(this.persistence,new KY,e.initialUser,this.serializer)}createPersistence(e){return new ZY(FP.Hr,this.serializer)}createSharedClientState(e){return new sK}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class qK{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>xL(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=UK.bind(null,this.syncEngine),await SK(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new AK}()}createDatastore(e){const i=Pb(e.databaseInfo.databaseId),s=function(p){return new uK(p)}(e.databaseInfo);return function(p,v,a,A){return new fK(p,v,a,A)}(e.authCredentials,e.appCheckCredentials,s,i)}createRemoteStore(e){return function(s,u,p,v,a){return new mK(s,u,p,v,a)}(this.localStore,this.datastore,e.asyncQueue,i=>xL(this.syncEngine,i,0),function(){return _L.C()?new _L:new aK}())}createSyncEngine(e,i){return function(u,p,v,a,A,O,B){const $=new OK(u,p,v,a,A,O);return B&&($.va=!0),$}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}terminate(){return async function(i){const s=Pn(i);Kt("RemoteStore","RemoteStore shutting down."),s.v_.add(5),await Ay(s),s.M_.shutdown(),s.x_.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YP{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Na(this.observer.next,e)}error(e){this.observer.error?this.Na(this.observer.error,e):Yl("Uncaught Error in snapshot listener:",e.toString())}Ba(){this.muted=!0}Na(e,i){this.muted||setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HK{constructor(e,i,s,u){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=s,this.databaseInfo=u,this.user=ao.UNAUTHENTICATED,this.clientId=LF.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,async p=>{Kt("FirestoreClient","Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(s,p=>(Kt("FirestoreClient","Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ht(ht.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Vl;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const s=GP(i,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function gE(t,e){t.asyncQueue.verifyOperationInProgress(),Kt("FirestoreClient","Initializing OfflineComponentProvider");const i=await t.getConfiguration();await e.initialize(i);let s=i.initialUser;t.setCredentialChangeListener(async u=>{s.isEqual(u)||(await mB(e.localStore,u),s=u)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function TL(t,e){t.asyncQueue.verifyOperationInProgress();const i=await XK(t);Kt("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(i,s),t.setCredentialChangeListener(u=>yL(e.remoteStore,u)),t.setAppCheckTokenChangeListener((u,p)=>yL(e.remoteStore,p)),t._onlineComponents=e}function ZK(t){return t.name==="FirebaseError"?t.code===ht.FAILED_PRECONDITION||t.code===ht.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}async function XK(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Kt("FirestoreClient","Using user provided OfflineComponentProvider");try{await gE(t,t._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!ZK(i))throw i;tp("Error using user provided cache. Falling back to memory cache: "+i),await gE(t,new wL)}}else Kt("FirestoreClient","Using default OfflineComponentProvider"),await gE(t,new wL);return t._offlineComponents}async function RB(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Kt("FirestoreClient","Using user provided OnlineComponentProvider"),await TL(t,t._uninitializedComponentsProvider._online)):(Kt("FirestoreClient","Using default OnlineComponentProvider"),await TL(t,new qK))),t._onlineComponents}function YK(t){return RB(t).then(e=>e.syncEngine)}async function Ix(t){const e=await RB(t),i=e.eventManager;return i.onListen=DK.bind(null,e.syncEngine),i.onUnlisten=zK.bind(null,e.syncEngine),i}function KK(t,e,i={}){const s=new Vl;return t.asyncQueue.enqueueAndForget(async()=>function(p,v,a,A,O){const B=new YP({next:Y=>{v.enqueueAndForget(()=>qP(p,$));const se=Y.docs.has(a);!se&&Y.fromCache?O.reject(new Ht(ht.UNAVAILABLE,"Failed to get document because the client is offline.")):se&&Y.fromCache&&A&&A.source==="server"?O.reject(new Ht(ht.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):O.resolve(Y)},error:Y=>O.reject(Y)}),$=new ZP(wb(a.path),B,{includeMetadataChanges:!0,Y_:!0});return WP(p,$)}(await Ix(t),t.asyncQueue,e,i,s)),s.promise}function JK(t,e,i={}){const s=new Vl;return t.asyncQueue.enqueueAndForget(async()=>function(p,v,a,A,O){const B=new YP({next:Y=>{v.enqueueAndForget(()=>qP(p,$)),Y.fromCache&&A.source==="server"?O.reject(new Ht(ht.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):O.resolve(Y)},error:Y=>O.reject(Y)}),$=new ZP(a,B,{includeMetadataChanges:!0,Y_:!0});return WP(p,$)}(await Ix(t),t.asyncQueue,e,i,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OB(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EL=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DB(t,e,i){if(!i)throw new Ht(ht.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function QK(t,e,i,s){if(e===!0&&s===!0)throw new Ht(ht.INVALID_ARGUMENT,`${t} and ${i} cannot be used together.`)}function SL(t){if(!an.isDocumentKey(t))throw new Ht(ht.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function IL(t){if(an.isDocumentKey(t))throw new Ht(ht.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Mb(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":xn()}function $l(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ht(ht.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=Mb(t);throw new Ht(ht.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AL{constructor(e){var i,s;if(e.host===void 0){if(e.ssl!==void 0)throw new Ht(ht.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(i=e.ssl)===null||i===void 0||i;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Ht(ht.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}QK("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=OB((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(p){if(p.timeoutSeconds!==void 0){if(isNaN(p.timeoutSeconds))throw new Ht(ht.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (must not be NaN)`);if(p.timeoutSeconds<5)throw new Ht(ht.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (minimum allowed value is 5)`);if(p.timeoutSeconds>30)throw new Ht(ht.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,u){return s.timeoutSeconds===u.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Rb{constructor(e,i,s,u){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=s,this._app=u,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new AL({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Ht(ht.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new Ht(ht.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new AL(e),e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new xX;switch(s.type){case"firstParty":return new EX(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Ht(ht.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const s=EL.get(i);s&&(Kt("ComponentProvider","Removing Datastore"),EL.delete(i),s.terminate())}(this),Promise.resolve()}}function eJ(t,e,i,s={}){var u;const p=(t=$l(t,Rb))._getSettings(),v=`${e}:${i}`;if(p.host!=="firestore.googleapis.com"&&p.host!==v&&tp("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},p),{host:v,ssl:!1})),s.mockUserToken){let a,A;if(typeof s.mockUserToken=="string")a=s.mockUserToken,A=ao.MOCK_USER;else{a=MG(s.mockUserToken,(u=t._app)===null||u===void 0?void 0:u.options.projectId);const O=s.mockUserToken.sub||s.mockUserToken.user_id;if(!O)throw new Ht(ht.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");A=new ao(O)}t._authCredentials=new bX(new DF(a,A))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{constructor(e,i,s){this.converter=i,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Au(this.firestore,e,this._query)}}class Ho{constructor(e,i,s){this.converter=i,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fu(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ho(this.firestore,e,this._key)}}class fu extends Au{constructor(e,i,s){super(e,i,wb(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ho(this.firestore,null,new an(e))}withConverter(e){return new fu(this.firestore,e,this._path)}}function Xh(t,e,...i){if(t=Ii(t),DB("collection","path",e),t instanceof Rb){const s=Fr.fromString(e,...i);return IL(s),new fu(t,null,s)}{if(!(t instanceof Ho||t instanceof fu))throw new Ht(ht.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Fr.fromString(e,...i));return IL(s),new fu(t.firestore,null,s)}}function A1(t,e,...i){if(t=Ii(t),arguments.length===1&&(e=LF.V()),DB("doc","path",e),t instanceof Rb){const s=Fr.fromString(e,...i);return SL(s),new Ho(t,null,new an(s))}{if(!(t instanceof Ho||t instanceof fu))throw new Ht(ht.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Fr.fromString(e,...i));return SL(s),new Ho(t.firestore,t instanceof fu?t.converter:null,new an(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tJ{constructor(){this.Ya=Promise.resolve(),this.Za=[],this.Xa=!1,this.eu=[],this.tu=null,this.nu=!1,this.ru=!1,this.iu=[],this.jo=new _B(this,"async_queue_retry"),this.su=()=>{const i=mE();i&&Kt("AsyncQueue","Visibility state changed to "+i.visibilityState),this.jo.Ko()};const e=mE();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.su)}get isShuttingDown(){return this.Xa}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ou(),this._u(e)}enterRestrictedMode(e){if(!this.Xa){this.Xa=!0,this.ru=e||!1;const i=mE();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.su)}}enqueue(e){if(this.ou(),this.Xa)return new Promise(()=>{});const i=new Vl;return this._u(()=>this.Xa&&this.ru?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Za.push(e),this.au()))}async au(){if(this.Za.length!==0){try{await this.Za[0](),this.Za.shift(),this.jo.reset()}catch(e){if(!Ey(e))throw e;Kt("AsyncQueue","Operation failed with retryable error: "+e)}this.Za.length>0&&this.jo.qo(()=>this.au())}}_u(e){const i=this.Ya.then(()=>(this.nu=!0,e().catch(s=>{this.tu=s,this.nu=!1;const u=function(v){let a=v.message||"";return v.stack&&(a=v.stack.includes(v.message)?v.stack:v.message+`
`+v.stack),a}(s);throw Yl("INTERNAL UNHANDLED ERROR: ",u),s}).then(s=>(this.nu=!1,s))));return this.Ya=i,i}enqueueAfterDelay(e,i,s){this.ou(),this.iu.indexOf(e)>-1&&(i=0);const u=$P.createAndSchedule(this,e,i,s,p=>this.uu(p));return this.eu.push(u),u}ou(){this.tu&&xn()}verifyOperationInProgress(){}async cu(){let e;do e=this.Ya,await e;while(e!==this.Ya)}lu(e){for(const i of this.eu)if(i.timerId===e)return!0;return!1}hu(e){return this.cu().then(()=>{this.eu.sort((i,s)=>i.targetTimeMs-s.targetTimeMs);for(const i of this.eu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.cu()})}Pu(e){this.iu.push(e)}uu(e){const i=this.eu.indexOf(e);this.eu.splice(i,1)}}function PL(t){return function(i,s){if(typeof i!="object"||i===null)return!1;const u=i;for(const p of s)if(p in u&&typeof u[p]=="function")return!0;return!1}(t,["next","error","complete"])}class ap extends Rb{constructor(e,i,s,u){super(e,i,s,u),this.type="firestore",this._queue=function(){return new tJ}(),this._persistenceKey=(u==null?void 0:u.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||LB(this),this._firestoreClient.terminate()}}function nJ(t,e){const i=typeof t=="object"?t:ZN(),s=typeof t=="string"?t:e||"(default)",u=ZA(i,"firestore").getImmediate({identifier:s});if(!u._initialized){const p=kG("firestore");p&&eJ(u,...p)}return u}function Ob(t){return t._firestoreClient||LB(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function LB(t){var e,i,s;const u=t._freezeSettings(),p=function(a,A,O,B){return new zX(a,A,O,B.host,B.ssl,B.experimentalForceLongPolling,B.experimentalAutoDetectLongPolling,OB(B.experimentalLongPollingOptions),B.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,u);t._firestoreClient=new HK(t._authCredentials,t._appCheckCredentials,t._queue,p),!((i=u.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((s=u.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:u.localCache.kind,_offline:u.localCache._offlineComponentProvider,_online:u.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lp{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lp(mo.fromBase64String(e))}catch(i){throw new Ht(ht.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new lp(mo.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new Ht(ht.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qi(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zB{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Db{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new Ht(ht.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new Ht(ht.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return dr(this._lat,e._lat)||dr(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rJ=/^__.*__$/;class iJ{constructor(e,i,s){this.data=e,this.fieldMask=i,this.fieldTransforms=s}toMutation(e,i){return this.fieldMask!==null?new td(e,this.data,this.fieldMask,i,this.fieldTransforms):new Sy(e,this.data,i,this.fieldTransforms)}}function NB(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw xn()}}class JP{constructor(e,i,s,u,p,v){this.settings=e,this.databaseId=i,this.serializer=s,this.ignoreUndefinedProperties=u,p===void 0&&this.Iu(),this.fieldTransforms=p||[],this.fieldMask=v||[]}get path(){return this.settings.path}get Tu(){return this.settings.Tu}Eu(e){return new JP(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}du(e){var i;const s=(i=this.path)===null||i===void 0?void 0:i.child(e),u=this.Eu({path:s,Au:!1});return u.Ru(e),u}Vu(e){var i;const s=(i=this.path)===null||i===void 0?void 0:i.child(e),u=this.Eu({path:s,Au:!1});return u.Iu(),u}mu(e){return this.Eu({path:void 0,Au:!0})}fu(e){return Ax(e,this.settings.methodName,this.settings.gu||!1,this.path,this.settings.pu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Iu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ru(this.path.get(e))}Ru(e){if(e.length===0)throw this.fu("Document fields must not be empty");if(NB(this.Tu)&&rJ.test(e))throw this.fu('Document fields cannot begin and end with "__"')}}class oJ{constructor(e,i,s){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=s||Pb(e)}yu(e,i,s,u=!1){return new JP({Tu:e,methodName:i,pu:s,path:qi.emptyPath(),Au:!1,gu:u},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function FB(t){const e=t._freezeSettings(),i=Pb(t._databaseId);return new oJ(t._databaseId,!!e.ignoreUndefinedProperties,i)}function sJ(t,e,i,s,u,p={}){const v=t.yu(p.merge||p.mergeFields?2:0,e,i,u);VB("Data must be an object, but it was:",v,s);const a=BB(s,v);let A,O;if(p.merge)A=new aa(v.fieldMask),O=v.fieldTransforms;else if(p.mergeFields){const B=[];for(const $ of p.mergeFields){const Y=lJ(e,$,i);if(!v.contains(Y))throw new Ht(ht.INVALID_ARGUMENT,`Field '${Y}' is specified in your field mask but missing from your input data.`);uJ(B,Y)||B.push(Y)}A=new aa(B),O=v.fieldTransforms.filter($=>A.covers($.field))}else A=null,O=v.fieldTransforms;return new iJ(new Os(a),A,O)}function aJ(t,e,i,s=!1){return QP(i,t.yu(s?4:3,e))}function QP(t,e){if(jB(t=Ii(t)))return VB("Unsupported field value:",e,t),BB(t,e);if(t instanceof zB)return function(s,u){if(!NB(u.Tu))throw u.fu(`${s._methodName}() can only be used with update() and set()`);if(!u.path)throw u.fu(`${s._methodName}() is not currently supported inside arrays`);const p=s._toFieldTransform(u);p&&u.fieldTransforms.push(p)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Au&&e.Tu!==4)throw e.fu("Nested arrays are not supported");return function(s,u){const p=[];let v=0;for(const a of s){let A=QP(a,u.mu(v));A==null&&(A={nullValue:"NULL_VALUE"}),p.push(A),v++}return{arrayValue:{values:p}}}(t,e)}return function(s,u){if((s=Ii(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return rY(u.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const p=_i.fromDate(s);return{timestampValue:Ex(u.serializer,p)}}if(s instanceof _i){const p=new _i(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Ex(u.serializer,p)}}if(s instanceof Db)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof lp)return{bytesValue:cB(u.serializer,s._byteString)};if(s instanceof Ho){const p=u.databaseId,v=s.firestore._databaseId;if(!v.isEqual(p))throw u.fu(`Document reference is for database ${v.projectId}/${v.database} but should be for database ${p.projectId}/${p.database}`);return{referenceValue:zP(s.firestore._databaseId||u.databaseId,s._key.path)}}throw u.fu(`Unsupported field value: ${Mb(s)}`)}(t,e)}function BB(t,e){const i={};return zF(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ip(t,(s,u)=>{const p=QP(u,e.du(s));p!=null&&(i[s]=p)}),{mapValue:{fields:i}}}function jB(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof _i||t instanceof Db||t instanceof lp||t instanceof Ho||t instanceof zB)}function VB(t,e,i){if(!jB(i)||!function(u){return typeof u=="object"&&u!==null&&(Object.getPrototypeOf(u)===Object.prototype||Object.getPrototypeOf(u)===null)}(i)){const s=Mb(i);throw s==="an object"?e.fu(t+" a custom object"):e.fu(t+" "+s)}}function lJ(t,e,i){if((e=Ii(e))instanceof KP)return e._internalPath;if(typeof e=="string")return UB(t,e);throw Ax("Field path arguments must be of type string or ",t,!1,void 0,i)}const cJ=new RegExp("[~\\*/\\[\\]]");function UB(t,e,i){if(e.search(cJ)>=0)throw Ax(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,i);try{return new KP(...e.split("."))._internalPath}catch{throw Ax(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,i)}}function Ax(t,e,i,s,u){const p=s&&!s.isEmpty(),v=u!==void 0;let a=`Function ${e}() called with invalid data`;i&&(a+=" (via `toFirestore()`)"),a+=". ";let A="";return(p||v)&&(A+=" (found",p&&(A+=` in field ${s}`),v&&(A+=` in document ${u}`),A+=")"),new Ht(ht.INVALID_ARGUMENT,a+t+A)}function uJ(t,e){return t.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $B{constructor(e,i,s,u,p){this._firestore=e,this._userDataWriter=i,this._key=s,this._document=u,this._converter=p}get id(){return this._key.path.lastSegment()}get ref(){return new Ho(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new hJ(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(Lb("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class hJ extends $B{data(){return super.data()}}function Lb(t,e){return typeof e=="string"?UB(t,e):e instanceof KP?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GB(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Ht(ht.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ek{}class WB extends ek{}function tk(t,e,...i){let s=[];e instanceof ek&&s.push(e),s=s.concat(i),function(p){const v=p.filter(A=>A instanceof nk).length,a=p.filter(A=>A instanceof zb).length;if(v>1||v>0&&a>0)throw new Ht(ht.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const u of s)t=u._apply(t);return t}class zb extends WB{constructor(e,i,s){super(),this._field=e,this._op=i,this._value=s,this.type="where"}static _create(e,i,s){return new zb(e,i,s)}_apply(e){const i=this._parse(e);return HB(e._query,i),new Au(e.firestore,e.converter,qS(e._query,i))}_parse(e){const i=FB(e.firestore);return function(p,v,a,A,O,B,$){let Y;if(O.isKeyField()){if(B==="array-contains"||B==="array-contains-any")throw new Ht(ht.INVALID_ARGUMENT,`Invalid Query. You can't perform '${B}' queries on documentId().`);if(B==="in"||B==="not-in"){CL($,B);const se=[];for(const me of $)se.push(kL(A,p,me));Y={arrayValue:{values:se}}}else Y=kL(A,p,$)}else B!=="in"&&B!=="not-in"&&B!=="array-contains-any"||CL($,B),Y=aJ(a,v,$,B==="in"||B==="not-in");return gi.create(O,B,Y)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function dJ(t,e,i){const s=e,u=Lb("where",t);return zb._create(u,s,i)}class nk extends ek{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new nk(e,i)}_parse(e){const i=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return i.length===1?i[0]:da.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(u,p){let v=u;const a=p.getFlattenedFilters();for(const A of a)HB(v,A),v=qS(v,A)}(e._query,i),new Au(e.firestore,e.converter,qS(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class rk extends WB{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new rk(e,i)}_apply(e){const i=function(u,p,v){if(u.startAt!==null)throw new Ht(ht.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(u.endAt!==null)throw new Ht(ht.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new F_(p,v)}(e._query,this._field,this._direction);return new Au(e.firestore,e.converter,function(u,p){const v=u.explicitOrderBy.concat([p]);return new Ap(u.path,u.collectionGroup,v,u.filters.slice(),u.limit,u.limitType,u.startAt,u.endAt)}(e._query,i))}}function qB(t,e="asc"){const i=e,s=Lb("orderBy",t);return rk._create(s,i)}function kL(t,e,i){if(typeof(i=Ii(i))=="string"){if(i==="")throw new Ht(ht.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!WF(e)&&i.indexOf("/")!==-1)throw new Ht(ht.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const s=e.path.child(Fr.fromString(i));if(!an.isDocumentKey(s))throw new Ht(ht.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return JD(t,new an(s))}if(i instanceof Ho)return JD(t,i._key);throw new Ht(ht.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Mb(i)}.`)}function CL(t,e){if(!Array.isArray(t)||t.length===0)throw new Ht(ht.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function HB(t,e){const i=function(u,p){for(const v of u)for(const a of v.getFlattenedFilters())if(p.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(u){switch(u){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new Ht(ht.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ht(ht.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class fJ{convertValue(e,i="none"){switch(Zh(e)){case 0:return null;case 1:return e.booleanValue;case 2:return fi(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(Hh(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 10:return this.convertObject(e.mapValue,i);default:throw xn()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const s={};return Ip(e,(u,p)=>{s[u]=this.convertValue(p,i)}),s}convertGeoPoint(e){return new Db(fi(e.latitude),fi(e.longitude))}convertArray(e,i){return(e.values||[]).map(s=>this.convertValue(s,i))}convertServerTimestamp(e,i){switch(i){case"previous":const s=CP(e);return s==null?null:this.convertValue(s,i);case"estimate":return this.convertTimestamp(L_(e));default:return null}}convertTimestamp(e){const i=yu(e);return new _i(i.seconds,i.nanos)}convertDocumentKey(e,i){const s=Fr.fromString(e);jr(pB(s));const u=new z_(s.get(1),s.get(3)),p=new an(s.popFirst(5));return u.isEqual(i)||Yl(`Document ${p} contains a document reference within a different database (${u.projectId}/${u.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pJ(t,e,i){let s;return s=t?i&&(i.merge||i.mergeFields)?t.toFirestore(e,i):t.toFirestore(e):e,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ZB extends $B{constructor(e,i,s,u,p,v){super(e,i,s,u,v),this._firestore=e,this._firestoreImpl=e,this.metadata=p}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new P1(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const s=this._document.data.field(Lb("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,i.serverTimestamps)}}}class P1 extends ZB{data(e={}){return super.data(e)}}class XB{constructor(e,i,s,u){this._firestore=e,this._userDataWriter=i,this._snapshot=u,this.metadata=new Ng(u.hasPendingWrites,u.fromCache),this.query=s}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(s=>{e.call(i,new P1(this._firestore,this._userDataWriter,s.key,s,new Ng(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Ht(ht.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(u,p){if(u._snapshot.oldDocs.isEmpty()){let v=0;return u._snapshot.docChanges.map(a=>{const A=new P1(u._firestore,u._userDataWriter,a.doc.key,a.doc,new Ng(u._snapshot.mutatedKeys.has(a.doc.key),u._snapshot.fromCache),u.query.converter);return a.doc,{type:"added",doc:A,oldIndex:-1,newIndex:v++}})}{let v=u._snapshot.oldDocs;return u._snapshot.docChanges.filter(a=>p||a.type!==3).map(a=>{const A=new P1(u._firestore,u._userDataWriter,a.doc.key,a.doc,new Ng(u._snapshot.mutatedKeys.has(a.doc.key),u._snapshot.fromCache),u.query.converter);let O=-1,B=-1;return a.type!==0&&(O=v.indexOf(a.doc.key),v=v.delete(a.doc.key)),a.type!==1&&(v=v.add(a.doc),B=v.indexOf(a.doc.key)),{type:mJ(a.type),doc:A,oldIndex:O,newIndex:B}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function mJ(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gJ(t){t=$l(t,Ho);const e=$l(t.firestore,ap);return KK(Ob(e),t._key).then(i=>KB(e,t,i))}class ik extends fJ{constructor(e){super(),this.firestore=e}convertBytes(e){return new lp(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new Ho(this.firestore,null,i)}}function _J(t){t=$l(t,Au);const e=$l(t.firestore,ap),i=Ob(e),s=new ik(e);return GB(t._query),JK(i,t._query).then(u=>new XB(e,s,t,u))}function Nb(t,e){const i=$l(t.firestore,ap),s=A1(t),u=pJ(t.converter,e);return yJ(i,[sJ(FB(t.firestore),"addDoc",s._key,u,t.converter!==null,{}).toMutation(s._key,Ul.exists(!1))]).then(()=>s)}function YB(t,...e){var i,s,u;t=Ii(t);let p={includeMetadataChanges:!1},v=0;typeof e[v]!="object"||PL(e[v])||(p=e[v],v++);const a={includeMetadataChanges:p.includeMetadataChanges};if(PL(e[v])){const $=e[v];e[v]=(i=$.next)===null||i===void 0?void 0:i.bind($),e[v+1]=(s=$.error)===null||s===void 0?void 0:s.bind($),e[v+2]=(u=$.complete)===null||u===void 0?void 0:u.bind($)}let A,O,B;if(t instanceof Ho)O=$l(t.firestore,ap),B=wb(t._key.path),A={next:$=>{e[v]&&e[v](KB(O,t,$))},error:e[v+1],complete:e[v+2]};else{const $=$l(t,Au);O=$l($.firestore,ap),B=$._query;const Y=new ik(O);A={next:se=>{e[v]&&e[v](new XB(O,Y,$,se))},error:e[v+1],complete:e[v+2]},GB(t._query)}return function(Y,se,me,_e){const Ee=new YP(_e),ae=new ZP(se,Ee,me);return Y.asyncQueue.enqueueAndForget(async()=>WP(await Ix(Y),ae)),()=>{Ee.Ba(),Y.asyncQueue.enqueueAndForget(async()=>qP(await Ix(Y),ae))}}(Ob(O),B,a,A)}function yJ(t,e){return function(s,u){const p=new Vl;return s.asyncQueue.enqueueAndForget(async()=>NK(await YK(s),u,p)),p.promise}(Ob(t),e)}function KB(t,e,i){const s=i.docs.get(e._key),u=new ik(t);return new ZB(t,u,e._key,s,new Ng(i.hasPendingWrites,i.fromCache),e.converter)}(function(e,i=!0){(function(u){Sp=u})(bp),Jf(new Vh("firestore",(s,{instanceIdentifier:u,options:p})=>{const v=s.getProvider("app").getImmediate(),a=new ap(new wX(s.getProvider("auth-internal")),new IX(s.getProvider("app-check-internal")),function(O,B){if(!Object.prototype.hasOwnProperty.apply(O.options,["projectId"]))throw new Ht(ht.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new z_(O.options.projectId,B)}(v,u),v);return p=Object.assign({useFetchStreams:i},p),a._setSettings(p),a},"PUBLIC").setMultipleInstances(!0)),du(ZD,"4.3.0",e),du(ZD,"4.3.0","esm2017")})();function JB(t){var e,i,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(i=JB(t[e]))&&(s&&(s+=" "),s+=i);else for(e in t)t[e]&&(s&&(s+=" "),s+=e);return s}function Jc(){for(var t,e,i=0,s="";i<arguments.length;)(t=arguments[i++])&&(e=JB(t))&&(s&&(s+=" "),s+=e);return s}const n_=t=>typeof t=="number"&&!isNaN(t),Yh=t=>typeof t=="string",$o=t=>typeof t=="function",k1=t=>Yh(t)||$o(t)?t:null,_E=t=>Be.isValidElement(t)||Yh(t)||$o(t)||n_(t);function vJ(t,e,i){i===void 0&&(i=300);const{scrollHeight:s,style:u}=t;requestAnimationFrame(()=>{u.minHeight="initial",u.height=s+"px",u.transition=`all ${i}ms`,requestAnimationFrame(()=>{u.height="0",u.padding="0",u.margin="0",setTimeout(e,i)})})}function Fb(t){let{enter:e,exit:i,appendPosition:s=!1,collapse:u=!0,collapseDuration:p=300}=t;return function(v){let{children:a,position:A,preventExitTransition:O,done:B,nodeRef:$,isIn:Y}=v;const se=s?`${e}--${A}`:e,me=s?`${i}--${A}`:i,_e=Be.useRef(0);return Be.useLayoutEffect(()=>{const Ee=$.current,ae=se.split(" "),le=fe=>{fe.target===$.current&&(Ee.dispatchEvent(new Event("d")),Ee.removeEventListener("animationend",le),Ee.removeEventListener("animationcancel",le),_e.current===0&&fe.type!=="animationcancel"&&Ee.classList.remove(...ae))};Ee.classList.add(...ae),Ee.addEventListener("animationend",le),Ee.addEventListener("animationcancel",le)},[]),Be.useEffect(()=>{const Ee=$.current,ae=()=>{Ee.removeEventListener("animationend",ae),u?vJ(Ee,B,p):B()};Y||(O?ae():(_e.current=1,Ee.className+=` ${me}`,Ee.addEventListener("animationend",ae)))},[Y]),Re.createElement(Re.Fragment,null,a)}}function ML(t,e){return t!=null?{content:t.content,containerId:t.props.containerId,id:t.props.toastId,theme:t.props.theme,type:t.props.type,data:t.props.data||{},isLoading:t.props.isLoading,icon:t.props.icon,status:e}:{}}const ks={list:new Map,emitQueue:new Map,on(t,e){return this.list.has(t)||this.list.set(t,[]),this.list.get(t).push(e),this},off(t,e){if(e){const i=this.list.get(t).filter(s=>s!==e);return this.list.set(t,i),this}return this.list.delete(t),this},cancelEmit(t){const e=this.emitQueue.get(t);return e&&(e.forEach(clearTimeout),this.emitQueue.delete(t)),this},emit(t){this.list.has(t)&&this.list.get(t).forEach(e=>{const i=setTimeout(()=>{e(...[].slice.call(arguments,1))},0);this.emitQueue.has(t)||this.emitQueue.set(t,[]),this.emitQueue.get(t).push(i)})}},t1=t=>{let{theme:e,type:i,...s}=t;return Re.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:e==="colored"?"currentColor":`var(--toastify-icon-color-${i})`,...s})},yE={info:function(t){return Re.createElement(t1,{...t},Re.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(t){return Re.createElement(t1,{...t},Re.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(t){return Re.createElement(t1,{...t},Re.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(t){return Re.createElement(t1,{...t},Re.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return Re.createElement("div",{className:"Toastify__spinner"})}};function xJ(t){const[,e]=Be.useReducer(se=>se+1,0),[i,s]=Be.useState([]),u=Be.useRef(null),p=Be.useRef(new Map).current,v=se=>i.indexOf(se)!==-1,a=Be.useRef({toastKey:1,displayedToast:0,count:0,queue:[],props:t,containerId:null,isToastActive:v,getToast:se=>p.get(se)}).current;function A(se){let{containerId:me}=se;const{limit:_e}=a.props;!_e||me&&a.containerId!==me||(a.count-=a.queue.length,a.queue=[])}function O(se){s(me=>se==null?[]:me.filter(_e=>_e!==se))}function B(){const{toastContent:se,toastProps:me,staleId:_e}=a.queue.shift();Y(se,me,_e)}function $(se,me){let{delay:_e,staleId:Ee,...ae}=me;if(!_E(se)||function(pt){return!u.current||a.props.enableMultiContainer&&pt.containerId!==a.props.containerId||p.has(pt.toastId)&&pt.updateId==null}(ae))return;const{toastId:le,updateId:fe,data:Ce}=ae,{props:Ge}=a,gt=()=>O(le),It=fe==null;It&&a.count++;const Tt={...Ge,style:Ge.toastStyle,key:a.toastKey++,...Object.fromEntries(Object.entries(ae).filter(pt=>{let[kn,Er]=pt;return Er!=null})),toastId:le,updateId:fe,data:Ce,closeToast:gt,isIn:!1,className:k1(ae.className||Ge.toastClassName),bodyClassName:k1(ae.bodyClassName||Ge.bodyClassName),progressClassName:k1(ae.progressClassName||Ge.progressClassName),autoClose:!ae.isLoading&&(Oe=ae.autoClose,Yt=Ge.autoClose,Oe===!1||n_(Oe)&&Oe>0?Oe:Yt),deleteToast(){const pt=ML(p.get(le),"removed");p.delete(le),ks.emit(4,pt);const kn=a.queue.length;if(a.count=le==null?a.count-a.displayedToast:a.count-1,a.count<0&&(a.count=0),kn>0){const Er=le==null?a.props.limit:1;if(kn===1||Er===1)a.displayedToast++,B();else{const si=Er>kn?kn:Er;a.displayedToast=si;for(let xr=0;xr<si;xr++)B()}}else e()}};var Oe,Yt;Tt.iconOut=function(pt){let{theme:kn,type:Er,isLoading:si,icon:xr}=pt,rr=null;const Ze={theme:kn,type:Er};return xr===!1||($o(xr)?rr=xr(Ze):Be.isValidElement(xr)?rr=Be.cloneElement(xr,Ze):Yh(xr)||n_(xr)?rr=xr:si?rr=yE.spinner():(St=>St in yE)(Er)&&(rr=yE[Er](Ze))),rr}(Tt),$o(ae.onOpen)&&(Tt.onOpen=ae.onOpen),$o(ae.onClose)&&(Tt.onClose=ae.onClose),Tt.closeButton=Ge.closeButton,ae.closeButton===!1||_E(ae.closeButton)?Tt.closeButton=ae.closeButton:ae.closeButton===!0&&(Tt.closeButton=!_E(Ge.closeButton)||Ge.closeButton);let er=se;Be.isValidElement(se)&&!Yh(se.type)?er=Be.cloneElement(se,{closeToast:gt,toastProps:Tt,data:Ce}):$o(se)&&(er=se({closeToast:gt,toastProps:Tt,data:Ce})),Ge.limit&&Ge.limit>0&&a.count>Ge.limit&&It?a.queue.push({toastContent:er,toastProps:Tt,staleId:Ee}):n_(_e)?setTimeout(()=>{Y(er,Tt,Ee)},_e):Y(er,Tt,Ee)}function Y(se,me,_e){const{toastId:Ee}=me;_e&&p.delete(_e);const ae={content:se,props:me};p.set(Ee,ae),s(le=>[...le,Ee].filter(fe=>fe!==_e)),ks.emit(4,ML(ae,ae.props.updateId==null?"added":"updated"))}return Be.useEffect(()=>(a.containerId=t.containerId,ks.cancelEmit(3).on(0,$).on(1,se=>u.current&&O(se)).on(5,A).emit(2,a),()=>{p.clear(),ks.emit(3,a)}),[]),Be.useEffect(()=>{a.props=t,a.isToastActive=v,a.displayedToast=i.length}),{getToastToRender:function(se){const me=new Map,_e=Array.from(p.values());return t.newestOnTop&&_e.reverse(),_e.forEach(Ee=>{const{position:ae}=Ee.props;me.has(ae)||me.set(ae,[]),me.get(ae).push(Ee)}),Array.from(me,Ee=>se(Ee[0],Ee[1]))},containerRef:u,isToastActive:v}}function RL(t){return t.targetTouches&&t.targetTouches.length>=1?t.targetTouches[0].clientX:t.clientX}function OL(t){return t.targetTouches&&t.targetTouches.length>=1?t.targetTouches[0].clientY:t.clientY}function bJ(t){const[e,i]=Be.useState(!1),[s,u]=Be.useState(!1),p=Be.useRef(null),v=Be.useRef({start:0,x:0,y:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,boundingRect:null,didMove:!1}).current,a=Be.useRef(t),{autoClose:A,pauseOnHover:O,closeToast:B,onClick:$,closeOnClick:Y}=t;function se(Ce){if(t.draggable){Ce.nativeEvent.type==="touchstart"&&Ce.nativeEvent.preventDefault(),v.didMove=!1,document.addEventListener("mousemove",ae),document.addEventListener("mouseup",le),document.addEventListener("touchmove",ae),document.addEventListener("touchend",le);const Ge=p.current;v.canCloseOnClick=!0,v.canDrag=!0,v.boundingRect=Ge.getBoundingClientRect(),Ge.style.transition="",v.x=RL(Ce.nativeEvent),v.y=OL(Ce.nativeEvent),t.draggableDirection==="x"?(v.start=v.x,v.removalDistance=Ge.offsetWidth*(t.draggablePercent/100)):(v.start=v.y,v.removalDistance=Ge.offsetHeight*(t.draggablePercent===80?1.5*t.draggablePercent:t.draggablePercent/100))}}function me(Ce){if(v.boundingRect){const{top:Ge,bottom:gt,left:It,right:Tt}=v.boundingRect;Ce.nativeEvent.type!=="touchend"&&t.pauseOnHover&&v.x>=It&&v.x<=Tt&&v.y>=Ge&&v.y<=gt?Ee():_e()}}function _e(){i(!0)}function Ee(){i(!1)}function ae(Ce){const Ge=p.current;v.canDrag&&Ge&&(v.didMove=!0,e&&Ee(),v.x=RL(Ce),v.y=OL(Ce),v.delta=t.draggableDirection==="x"?v.x-v.start:v.y-v.start,v.start!==v.x&&(v.canCloseOnClick=!1),Ge.style.transform=`translate${t.draggableDirection}(${v.delta}px)`,Ge.style.opacity=""+(1-Math.abs(v.delta/v.removalDistance)))}function le(){document.removeEventListener("mousemove",ae),document.removeEventListener("mouseup",le),document.removeEventListener("touchmove",ae),document.removeEventListener("touchend",le);const Ce=p.current;if(v.canDrag&&v.didMove&&Ce){if(v.canDrag=!1,Math.abs(v.delta)>v.removalDistance)return u(!0),void t.closeToast();Ce.style.transition="transform 0.2s, opacity 0.2s",Ce.style.transform=`translate${t.draggableDirection}(0)`,Ce.style.opacity="1"}}Be.useEffect(()=>{a.current=t}),Be.useEffect(()=>(p.current&&p.current.addEventListener("d",_e,{once:!0}),$o(t.onOpen)&&t.onOpen(Be.isValidElement(t.children)&&t.children.props),()=>{const Ce=a.current;$o(Ce.onClose)&&Ce.onClose(Be.isValidElement(Ce.children)&&Ce.children.props)}),[]),Be.useEffect(()=>(t.pauseOnFocusLoss&&(document.hasFocus()||Ee(),window.addEventListener("focus",_e),window.addEventListener("blur",Ee)),()=>{t.pauseOnFocusLoss&&(window.removeEventListener("focus",_e),window.removeEventListener("blur",Ee))}),[t.pauseOnFocusLoss]);const fe={onMouseDown:se,onTouchStart:se,onMouseUp:me,onTouchEnd:me};return A&&O&&(fe.onMouseEnter=Ee,fe.onMouseLeave=_e),Y&&(fe.onClick=Ce=>{$&&$(Ce),v.canCloseOnClick&&B()}),{playToast:_e,pauseToast:Ee,isRunning:e,preventExitTransition:s,toastRef:p,eventHandlers:fe}}function QB(t){let{closeToast:e,theme:i,ariaLabel:s="close"}=t;return Re.createElement("button",{className:`Toastify__close-button Toastify__close-button--${i}`,type:"button",onClick:u=>{u.stopPropagation(),e(u)},"aria-label":s},Re.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},Re.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function wJ(t){let{delay:e,isRunning:i,closeToast:s,type:u="default",hide:p,className:v,style:a,controlledProgress:A,progress:O,rtl:B,isIn:$,theme:Y}=t;const se=p||A&&O===0,me={...a,animationDuration:`${e}ms`,animationPlayState:i?"running":"paused",opacity:se?0:1};A&&(me.transform=`scaleX(${O})`);const _e=Jc("Toastify__progress-bar",A?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${Y}`,`Toastify__progress-bar--${u}`,{"Toastify__progress-bar--rtl":B}),Ee=$o(v)?v({rtl:B,type:u,defaultClassName:_e}):Jc(_e,v);return Re.createElement("div",{role:"progressbar","aria-hidden":se?"true":"false","aria-label":"notification timer",className:Ee,style:me,[A&&O>=1?"onTransitionEnd":"onAnimationEnd"]:A&&O<1?null:()=>{$&&s()}})}const TJ=t=>{const{isRunning:e,preventExitTransition:i,toastRef:s,eventHandlers:u}=bJ(t),{closeButton:p,children:v,autoClose:a,onClick:A,type:O,hideProgressBar:B,closeToast:$,transition:Y,position:se,className:me,style:_e,bodyClassName:Ee,bodyStyle:ae,progressClassName:le,progressStyle:fe,updateId:Ce,role:Ge,progress:gt,rtl:It,toastId:Tt,deleteToast:Oe,isIn:Yt,isLoading:er,iconOut:pt,closeOnClick:kn,theme:Er}=t,si=Jc("Toastify__toast",`Toastify__toast-theme--${Er}`,`Toastify__toast--${O}`,{"Toastify__toast--rtl":It},{"Toastify__toast--close-on-click":kn}),xr=$o(me)?me({rtl:It,position:se,type:O,defaultClassName:si}):Jc(si,me),rr=!!gt||!a,Ze={closeToast:$,type:O,theme:Er};let St=null;return p===!1||(St=$o(p)?p(Ze):Be.isValidElement(p)?Be.cloneElement(p,Ze):QB(Ze)),Re.createElement(Y,{isIn:Yt,done:Oe,position:se,preventExitTransition:i,nodeRef:s},Re.createElement("div",{id:Tt,onClick:A,className:xr,...u,style:_e,ref:s},Re.createElement("div",{...Yt&&{role:Ge},className:$o(Ee)?Ee({type:O}):Jc("Toastify__toast-body",Ee),style:ae},pt!=null&&Re.createElement("div",{className:Jc("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!er})},pt),Re.createElement("div",null,v)),St,Re.createElement(wJ,{...Ce&&!rr?{key:`pb-${Ce}`}:{},rtl:It,theme:Er,delay:a,isRunning:e,isIn:Yt,closeToast:$,hide:B,type:O,style:fe,className:le,controlledProgress:rr,progress:gt||0})))},Bb=function(t,e){return e===void 0&&(e=!1),{enter:`Toastify--animate Toastify__${t}-enter`,exit:`Toastify--animate Toastify__${t}-exit`,appendPosition:e}},EJ=Fb(Bb("bounce",!0));Fb(Bb("slide",!0));Fb(Bb("zoom"));Fb(Bb("flip"));const eI=Be.forwardRef((t,e)=>{const{getToastToRender:i,containerRef:s,isToastActive:u}=xJ(t),{className:p,style:v,rtl:a,containerId:A}=t;function O(B){const $=Jc("Toastify__toast-container",`Toastify__toast-container--${B}`,{"Toastify__toast-container--rtl":a});return $o(p)?p({position:B,rtl:a,defaultClassName:$}):Jc($,k1(p))}return Be.useEffect(()=>{e&&(e.current=s.current)},[]),Re.createElement("div",{ref:s,className:"Toastify",id:A},i((B,$)=>{const Y=$.length?{...v}:{...v,pointerEvents:"none"};return Re.createElement("div",{className:O(B),style:Y,key:`container-${B}`},$.map((se,me)=>{let{content:_e,props:Ee}=se;return Re.createElement(TJ,{...Ee,isIn:u(Ee.toastId),style:{...Ee.style,"--nth":me+1,"--len":$.length},key:`toast-${Ee.key}`},_e)}))}))});eI.displayName="ToastContainer",eI.defaultProps={position:"top-right",transition:EJ,autoClose:5e3,closeButton:QB,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,draggable:!0,draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};let vE,wh=new Map,Fg=[],SJ=1;function e6(){return""+SJ++}function IJ(t){return t&&(Yh(t.toastId)||n_(t.toastId))?t.toastId:e6()}function r_(t,e){return wh.size>0?ks.emit(0,t,e):Fg.push({content:t,options:e}),e.toastId}function Px(t,e){return{...e,type:e&&e.type||t,toastId:IJ(e)}}function n1(t){return(e,i)=>r_(e,Px(t,i))}function nr(t,e){return r_(t,Px("default",e))}nr.loading=(t,e)=>r_(t,Px("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...e})),nr.promise=function(t,e,i){let s,{pending:u,error:p,success:v}=e;u&&(s=Yh(u)?nr.loading(u,i):nr.loading(u.render,{...i,...u}));const a={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},A=(B,$,Y)=>{if($==null)return void nr.dismiss(s);const se={type:B,...a,...i,data:Y},me=Yh($)?{render:$}:$;return s?nr.update(s,{...se,...me}):nr(me.render,{...se,...me}),Y},O=$o(t)?t():t;return O.then(B=>A("success",v,B)).catch(B=>A("error",p,B)),O},nr.success=n1("success"),nr.info=n1("info"),nr.error=n1("error"),nr.warning=n1("warning"),nr.warn=nr.warning,nr.dark=(t,e)=>r_(t,Px("default",{theme:"dark",...e})),nr.dismiss=t=>{wh.size>0?ks.emit(1,t):Fg=Fg.filter(e=>t!=null&&e.options.toastId!==t)},nr.clearWaitingQueue=function(t){return t===void 0&&(t={}),ks.emit(5,t)},nr.isActive=t=>{let e=!1;return wh.forEach(i=>{i.isToastActive&&i.isToastActive(t)&&(e=!0)}),e},nr.update=function(t,e){e===void 0&&(e={}),setTimeout(()=>{const i=function(s,u){let{containerId:p}=u;const v=wh.get(p||vE);return v&&v.getToast(s)}(t,e);if(i){const{props:s,content:u}=i,p={delay:100,...s,...e,toastId:e.toastId||t,updateId:e6()};p.toastId!==t&&(p.staleId=t);const v=p.render||u;delete p.render,r_(v,p)}},0)},nr.done=t=>{nr.update(t,{progress:1})},nr.onChange=t=>(ks.on(4,t),()=>{ks.off(4,t)}),nr.POSITION={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},nr.TYPE={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},ks.on(2,t=>{vE=t.containerId||t,wh.set(vE,t),Fg.forEach(e=>{ks.emit(0,e.content,e.options)}),Fg=[]}).on(3,t=>{wh.delete(t.containerId||t),wh.size===0&&ks.off(0).off(1).off(5)});const AJ={apiKey:"AIzaSyDrC7CEpSHF6W-3LeNwlYnXXNvvbMMcc1I",authDomain:"whisper-2f40a.firebaseapp.com",databaseURL:"https://whisper-2f40a-default-rtdb.europe-west1.firebasedatabase.app/",projectId:"whisper-2f40a",storageBucket:"whisper-2f40a.appspot.com",messagingSenderId:"436334501650",appId:"1:436334501650:web:39b308b96a9a78bf135dcb"},t6=HN(AJ),Jl=M5(t6),pu=nJ(t6),PJ=new Ol,kJ=async()=>{try{const e=(await TH(Jl,PJ)).user,i=tk(Xh(pu,"users"),dJ("uid","==",e.uid));(await _J(i)).docs.length===0&&await Nb(Xh(pu,"users"),{uid:e.uid,name:e.displayName,authProvider:"google",email:e.email})}catch(t){console.error(t),alert(t.message)}},CJ=async(t,e,i)=>{try{const u=(await Zq(Jl,e,i)).user;console.log(u),await Nb(Xh(pu,"users"),{uid:u.uid,name:t,authProvider:"email",email:e}),await PS(u,{displayName:t,photoURL:`https://api.dicebear.com/8.x/pixel-art/svg?seed=${t}`}),await u.reload(),console.log("User registered and profile updated successfully")}catch(s){console.error(s),alert(s.message)}},MJ=async t=>{try{await Hq(Jl,t),alert("Password reset link sent!")}catch(e){console.error(e),alert(e.message)}},RJ=()=>{nH(Jl),nr.success("signing out")};function DL(){const t=Qh(),[e,i]=Be.useState(""),[s,u]=Be.useState("");return Be.useEffect(()=>{const p=Jl.onAuthStateChanged(v=>{v&&t("/")});return()=>p()},[]),We.jsx("div",{className:"login",children:We.jsxs("div",{className:"login__container",children:[We.jsx("input",{type:"text",className:"login__textBox",value:e,onChange:p=>i(p.target.value),placeholder:"E-mail Address"}),We.jsx("input",{type:"password",className:"login__textBox",value:s,onChange:p=>u(p.target.value),placeholder:"Password"}),We.jsx("button",{className:"login__btn",onClick:()=>Xq(Jl,e,s),children:"Login"}),We.jsx("button",{className:"login__btn login__google",onClick:kJ,children:"Login with Google"}),We.jsxs("div",{children:["Don't have an account? ",We.jsx(zl,{to:"/register",children:"Register"})]}),We.jsx(zl,{to:"/forgot-password",children:"Forgot your password?"})]})})}function OJ(){const t=Qh(),[e,i]=Be.useState(""),[s,u]=Be.useState(""),[p,v]=Be.useState(""),a=async()=>{if(!p){alert("Please enter name");return}try{await CJ(p,e,s)}catch{}};return Be.useEffect(()=>{const A=Jl.onAuthStateChanged(async O=>{O&&(await O.reload(),O.emailVerified&&t("/login"))});return()=>A()},[]),We.jsx("div",{className:"register",children:We.jsxs("div",{className:"register__container",children:[We.jsx("input",{type:"text",className:"register__textBox",value:p,onChange:A=>v(A.target.value),placeholder:"Full Name"}),We.jsx("input",{type:"text",className:"register__textBox",value:e,onChange:A=>i(A.target.value),placeholder:"E-mail Address"}),We.jsx("input",{type:"password",className:"register__textBox",value:s,onChange:A=>u(A.target.value),placeholder:"Password"}),We.jsx("button",{className:"registerbtn",onClick:a,children:"Register"}),We.jsxs("div",{children:["Already have an account? ",We.jsx(zl,{to:"/login",children:"Login"})," now."]})]})})}/*!
 * Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 */function i_(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?i_=function(e){return typeof e}:i_=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i_(t)}function DJ(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function LL(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function LJ(t,e,i){return e&&LL(t.prototype,e),i&&LL(t,i),t}function zJ(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function fr(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{},s=Object.keys(i);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(i).filter(function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable}))),s.forEach(function(u){zJ(t,u,i[u])})}return t}function n6(t,e){return NJ(t)||FJ(t,e)||BJ()}function NJ(t){if(Array.isArray(t))return t}function FJ(t,e){var i=[],s=!0,u=!1,p=void 0;try{for(var v=t[Symbol.iterator](),a;!(s=(a=v.next()).done)&&(i.push(a.value),!(e&&i.length===e));s=!0);}catch(A){u=!0,p=A}finally{try{!s&&v.return!=null&&v.return()}finally{if(u)throw p}}return i}function BJ(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var zL=function(){},ok={},r6={},jJ=null,i6={mark:zL,measure:zL};try{typeof window<"u"&&(ok=window),typeof document<"u"&&(r6=document),typeof MutationObserver<"u"&&(jJ=MutationObserver),typeof performance<"u"&&(i6=performance)}catch{}var VJ=ok.navigator||{},NL=VJ.userAgent,FL=NL===void 0?"":NL,jb=ok,wo=r6,r1=i6;jb.document;var sk=!!wo.documentElement&&!!wo.head&&typeof wo.addEventListener=="function"&&typeof wo.createElement=="function";~FL.indexOf("MSIE")||~FL.indexOf("Trident/");var Ql="___FONT_AWESOME___",o6="fa",s6="svg-inline--fa",UJ="data-fa-i2svg";(function(){try{return!0}catch{return!1}})();var xE={GROUP:"group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},a6=jb.FontAwesomeConfig||{};function $J(t){var e=wo.querySelector("script["+t+"]");if(e)return e.getAttribute(t)}function GJ(t){return t===""?!0:t==="false"?!1:t==="true"?!0:t}if(wo&&typeof wo.querySelector=="function"){var WJ=[["data-family-prefix","familyPrefix"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]];WJ.forEach(function(t){var e=n6(t,2),i=e[0],s=e[1],u=GJ($J(i));u!=null&&(a6[s]=u)})}var qJ={familyPrefix:o6,replacementClass:s6,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0},tI=fr({},qJ,a6);tI.autoReplaceSvg||(tI.observeMutations=!1);var ds=fr({},tI);jb.FontAwesomeConfig=ds;var ec=jb||{};ec[Ql]||(ec[Ql]={});ec[Ql].styles||(ec[Ql].styles={});ec[Ql].hooks||(ec[Ql].hooks={});ec[Ql].shims||(ec[Ql].shims=[]);var Ga=ec[Ql],HJ=[],ZJ=function t(){wo.removeEventListener("DOMContentLoaded",t),nI=1,HJ.map(function(e){return e()})},nI=!1;sk&&(nI=(wo.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(wo.readyState),nI||wo.addEventListener("DOMContentLoaded",ZJ));var ak="pending",l6="settled",kx="fulfilled",Cx="rejected",XJ=function(){},c6=typeof global<"u"&&typeof global.process<"u"&&typeof global.process.emit=="function",YJ=typeof setImmediate>"u"?setTimeout:setImmediate,Bg=[],rI;function KJ(){for(var t=0;t<Bg.length;t++)Bg[t][0](Bg[t][1]);Bg=[],rI=!1}function Mx(t,e){Bg.push([t,e]),rI||(rI=!0,YJ(KJ,0))}function JJ(t,e){function i(u){lk(e,u)}function s(u){V_(e,u)}try{t(i,s)}catch(u){s(u)}}function u6(t){var e=t.owner,i=e._state,s=e._data,u=t[i],p=t.then;if(typeof u=="function"){i=kx;try{s=u(s)}catch(v){V_(p,v)}}h6(p,s)||(i===kx&&lk(p,s),i===Cx&&V_(p,s))}function h6(t,e){var i;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(e&&(typeof e=="function"||i_(e)==="object")){var s=e.then;if(typeof s=="function")return s.call(e,function(u){i||(i=!0,e===u?d6(t,u):lk(t,u))},function(u){i||(i=!0,V_(t,u))}),!0}}catch(u){return i||V_(t,u),!0}return!1}function lk(t,e){(t===e||!h6(t,e))&&d6(t,e)}function d6(t,e){t._state===ak&&(t._state=l6,t._data=e,Mx(QJ,t))}function V_(t,e){t._state===ak&&(t._state=l6,t._data=e,Mx(eQ,t))}function f6(t){t._then=t._then.forEach(u6)}function QJ(t){t._state=kx,f6(t)}function eQ(t){t._state=Cx,f6(t),!t._handled&&c6&&global.process.emit("unhandledRejection",t._data,t)}function tQ(t){global.process.emit("rejectionHandled",t)}function zs(t){if(typeof t!="function")throw new TypeError("Promise resolver "+t+" is not a function");if(!(this instanceof zs))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],JJ(t,this)}zs.prototype={constructor:zs,_state:ak,_then:null,_data:void 0,_handled:!1,then:function(e,i){var s={owner:this,then:new this.constructor(XJ),fulfilled:e,rejected:i};return(i||e)&&!this._handled&&(this._handled=!0,this._state===Cx&&c6&&Mx(tQ,this)),this._state===kx||this._state===Cx?Mx(u6,s):this._then.push(s),s.then},catch:function(e){return this.then(null,e)}};zs.all=function(t){if(!Array.isArray(t))throw new TypeError("You must pass an array to Promise.all().");return new zs(function(e,i){var s=[],u=0;function p(A){return u++,function(O){s[A]=O,--u||e(s)}}for(var v=0,a;v<t.length;v++)a=t[v],a&&typeof a.then=="function"?a.then(p(v),i):s[v]=a;u||e(s)})};zs.race=function(t){if(!Array.isArray(t))throw new TypeError("You must pass an array to Promise.race().");return new zs(function(e,i){for(var s=0,u;s<t.length;s++)u=t[s],u&&typeof u.then=="function"?u.then(e,i):e(u)})};zs.resolve=function(t){return t&&i_(t)==="object"&&t.constructor===zs?t:new zs(function(e){e(t)})};zs.reject=function(t){return new zs(function(e,i){i(t)})};var Cf={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function nQ(t){if(!(!t||!sk)){var e=wo.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=t;for(var i=wo.head.childNodes,s=null,u=i.length-1;u>-1;u--){var p=i[u],v=(p.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(v)>-1&&(s=p)}return wo.head.insertBefore(e,s),t}}var rQ="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function Rx(){for(var t=12,e="";t-- >0;)e+=rQ[Math.random()*62|0];return e}function p6(t){return"".concat(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function iQ(t){return Object.keys(t||{}).reduce(function(e,i){return e+"".concat(i,'="').concat(p6(t[i]),'" ')},"").trim()}function m6(t){return Object.keys(t||{}).reduce(function(e,i){return e+"".concat(i,": ").concat(t[i],";")},"")}function g6(t){return t.size!==Cf.size||t.x!==Cf.x||t.y!==Cf.y||t.rotate!==Cf.rotate||t.flipX||t.flipY}function _6(t){var e=t.transform,i=t.containerWidth,s=t.iconWidth,u={transform:"translate(".concat(i/2," 256)")},p="translate(".concat(e.x*32,", ").concat(e.y*32,") "),v="scale(".concat(e.size/16*(e.flipX?-1:1),", ").concat(e.size/16*(e.flipY?-1:1),") "),a="rotate(".concat(e.rotate," 0 0)"),A={transform:"".concat(p," ").concat(v," ").concat(a)},O={transform:"translate(".concat(s/2*-1," -256)")};return{outer:u,inner:A,path:O}}var bE={x:0,y:0,width:"100%",height:"100%"};function BL(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return t.attributes&&(t.attributes.fill||e)&&(t.attributes.fill="black"),t}function oQ(t){return t.tag==="g"?t.children:[t]}function sQ(t){var e=t.children,i=t.attributes,s=t.main,u=t.mask,p=t.maskId,v=t.transform,a=s.width,A=s.icon,O=u.width,B=u.icon,$=_6({transform:v,containerWidth:O,iconWidth:a}),Y={tag:"rect",attributes:fr({},bE,{fill:"white"})},se=A.children?{children:A.children.map(BL)}:{},me={tag:"g",attributes:fr({},$.inner),children:[BL(fr({tag:A.tag,attributes:fr({},A.attributes,$.path)},se))]},_e={tag:"g",attributes:fr({},$.outer),children:[me]},Ee="mask-".concat(p||Rx()),ae="clip-".concat(p||Rx()),le={tag:"mask",attributes:fr({},bE,{id:Ee,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[Y,_e]},fe={tag:"defs",children:[{tag:"clipPath",attributes:{id:ae},children:oQ(B)},le]};return e.push(fe,{tag:"rect",attributes:fr({fill:"currentColor","clip-path":"url(#".concat(ae,")"),mask:"url(#".concat(Ee,")")},bE)}),{children:e,attributes:i}}function aQ(t){var e=t.children,i=t.attributes,s=t.main,u=t.transform,p=t.styles,v=m6(p);if(v.length>0&&(i.style=v),g6(u)){var a=_6({transform:u,containerWidth:s.width,iconWidth:s.width});e.push({tag:"g",attributes:fr({},a.outer),children:[{tag:"g",attributes:fr({},a.inner),children:[{tag:s.icon.tag,children:s.icon.children,attributes:fr({},s.icon.attributes,a.path)}]}]})}else e.push(s.icon);return{children:e,attributes:i}}function lQ(t){var e=t.children,i=t.main,s=t.mask,u=t.attributes,p=t.styles,v=t.transform;if(g6(v)&&i.found&&!s.found){var a=i.width,A=i.height,O={x:a/A/2,y:.5};u.style=m6(fr({},p,{"transform-origin":"".concat(O.x+v.x/16,"em ").concat(O.y+v.y/16,"em")}))}return[{tag:"svg",attributes:u,children:e}]}function cQ(t){var e=t.prefix,i=t.iconName,s=t.children,u=t.attributes,p=t.symbol,v=p===!0?"".concat(e,"-").concat(ds.familyPrefix,"-").concat(i):p;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:fr({},u,{id:v}),children:s}]}]}function uQ(t){var e=t.icons,i=e.main,s=e.mask,u=t.prefix,p=t.iconName,v=t.transform,a=t.symbol,A=t.title,O=t.maskId,B=t.titleId,$=t.extra,Y=t.watchable,se=Y===void 0?!1:Y,me=s.found?s:i,_e=me.width,Ee=me.height,ae=u==="fak",le=ae?"":"fa-w-".concat(Math.ceil(_e/Ee*16)),fe=[ds.replacementClass,p?"".concat(ds.familyPrefix,"-").concat(p):"",le].filter(function(Yt){return $.classes.indexOf(Yt)===-1}).filter(function(Yt){return Yt!==""||!!Yt}).concat($.classes).join(" "),Ce={children:[],attributes:fr({},$.attributes,{"data-prefix":u,"data-icon":p,class:fe,role:$.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(_e," ").concat(Ee)})},Ge=ae&&!~$.classes.indexOf("fa-fw")?{width:"".concat(_e/Ee*16*.0625,"em")}:{};se&&(Ce.attributes[UJ]=""),A&&Ce.children.push({tag:"title",attributes:{id:Ce.attributes["aria-labelledby"]||"title-".concat(B||Rx())},children:[A]});var gt=fr({},Ce,{prefix:u,iconName:p,main:i,mask:s,maskId:O,transform:v,symbol:a,styles:fr({},Ge,$.styles)}),It=s.found&&i.found?sQ(gt):aQ(gt),Tt=It.children,Oe=It.attributes;return gt.children=Tt,gt.attributes=Oe,a?cQ(gt):lQ(gt)}var jL=function(){};ds.measurePerformance&&r1&&r1.mark&&r1.measure;var hQ=function(e,i){return function(s,u,p,v){return e.call(i,s,u,p,v)}},wE=function(e,i,s,u){var p=Object.keys(e),v=p.length,a=u!==void 0?hQ(i,u):i,A,O,B;for(s===void 0?(A=1,B=e[p[0]]):(A=0,B=s);A<v;A++)O=p[A],B=a(B,e[O],O,e);return B};function y6(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=i.skipHooks,u=s===void 0?!1:s,p=Object.keys(e).reduce(function(v,a){var A=e[a],O=!!A.icon;return O?v[A.iconName]=A.icon:v[a]=A,v},{});typeof Ga.hooks.addPack=="function"&&!u?Ga.hooks.addPack(t,p):Ga.styles[t]=fr({},Ga.styles[t]||{},p),t==="fas"&&y6("fa",e)}var VL=Ga.styles,dQ=Ga.shims,v6=function(){var e=function(u){return wE(VL,function(p,v,a){return p[a]=wE(v,u,{}),p},{})};e(function(s,u,p){return u[3]&&(s[u[3]]=p),s}),e(function(s,u,p){var v=u[2];return s[p]=p,v.forEach(function(a){s[a]=p}),s});var i="far"in VL;wE(dQ,function(s,u){var p=u[0],v=u[1],a=u[2];return v==="far"&&!i&&(v="fas"),s[p]={prefix:v,iconName:a},s},{})};v6();Ga.styles;function UL(t,e,i){if(t&&t[e]&&t[e][i])return{prefix:e,iconName:i,icon:t[e][i]}}function x6(t){var e=t.tag,i=t.attributes,s=i===void 0?{}:i,u=t.children,p=u===void 0?[]:u;return typeof t=="string"?p6(t):"<".concat(e," ").concat(iQ(s),">").concat(p.map(x6).join(""),"</").concat(e,">")}var fQ=function(e){var i={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e?e.toLowerCase().split(" ").reduce(function(s,u){var p=u.toLowerCase().split("-"),v=p[0],a=p.slice(1).join("-");if(v&&a==="h")return s.flipX=!0,s;if(v&&a==="v")return s.flipY=!0,s;if(a=parseFloat(a),isNaN(a))return s;switch(v){case"grow":s.size=s.size+a;break;case"shrink":s.size=s.size-a;break;case"left":s.x=s.x-a;break;case"right":s.x=s.x+a;break;case"up":s.y=s.y-a;break;case"down":s.y=s.y+a;break;case"rotate":s.rotate=s.rotate+a;break}return s},i):i};function iI(t){this.name="MissingIcon",this.message=t||"Icon unavailable",this.stack=new Error().stack}iI.prototype=Object.create(Error.prototype);iI.prototype.constructor=iI;var Vb={fill:"currentColor"},b6={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};fr({},Vb,{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"});var ck=fr({},b6,{attributeName:"opacity"});fr({},Vb,{cx:"256",cy:"364",r:"28"}),fr({},b6,{attributeName:"r",values:"28;14;28;28;14;28;"}),fr({},ck,{values:"1;0;1;1;0;1;"});fr({},Vb,{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),fr({},ck,{values:"1;0;0;0;0;1;"});fr({},Vb,{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),fr({},ck,{values:"0;0;1;1;0;0;"});Ga.styles;function $L(t){var e=t[0],i=t[1],s=t.slice(4),u=n6(s,1),p=u[0],v=null;return Array.isArray(p)?v={tag:"g",attributes:{class:"".concat(ds.familyPrefix,"-").concat(xE.GROUP)},children:[{tag:"path",attributes:{class:"".concat(ds.familyPrefix,"-").concat(xE.SECONDARY),fill:"currentColor",d:p[0]}},{tag:"path",attributes:{class:"".concat(ds.familyPrefix,"-").concat(xE.PRIMARY),fill:"currentColor",d:p[1]}}]}:v={tag:"path",attributes:{fill:"currentColor",d:p}},{found:!0,width:e,height:i,icon:v}}Ga.styles;var pQ=`svg:not(:root).svg-inline--fa {
  overflow: visible;
}

.svg-inline--fa {
  display: inline-block;
  font-size: inherit;
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.225em;
}
.svg-inline--fa.fa-w-1 {
  width: 0.0625em;
}
.svg-inline--fa.fa-w-2 {
  width: 0.125em;
}
.svg-inline--fa.fa-w-3 {
  width: 0.1875em;
}
.svg-inline--fa.fa-w-4 {
  width: 0.25em;
}
.svg-inline--fa.fa-w-5 {
  width: 0.3125em;
}
.svg-inline--fa.fa-w-6 {
  width: 0.375em;
}
.svg-inline--fa.fa-w-7 {
  width: 0.4375em;
}
.svg-inline--fa.fa-w-8 {
  width: 0.5em;
}
.svg-inline--fa.fa-w-9 {
  width: 0.5625em;
}
.svg-inline--fa.fa-w-10 {
  width: 0.625em;
}
.svg-inline--fa.fa-w-11 {
  width: 0.6875em;
}
.svg-inline--fa.fa-w-12 {
  width: 0.75em;
}
.svg-inline--fa.fa-w-13 {
  width: 0.8125em;
}
.svg-inline--fa.fa-w-14 {
  width: 0.875em;
}
.svg-inline--fa.fa-w-15 {
  width: 0.9375em;
}
.svg-inline--fa.fa-w-16 {
  width: 1em;
}
.svg-inline--fa.fa-w-17 {
  width: 1.0625em;
}
.svg-inline--fa.fa-w-18 {
  width: 1.125em;
}
.svg-inline--fa.fa-w-19 {
  width: 1.1875em;
}
.svg-inline--fa.fa-w-20 {
  width: 1.25em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-border {
  height: 1.5em;
}
.svg-inline--fa.fa-li {
  width: 2em;
}
.svg-inline--fa.fa-fw {
  width: 1.25em;
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter {
  background-color: #ff253a;
  border-radius: 1em;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  color: #fff;
  height: 1.5em;
  line-height: 1;
  max-width: 5em;
  min-width: 1.5em;
  overflow: hidden;
  padding: 0.25em;
  right: 0;
  text-overflow: ellipsis;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: 0;
  right: 0;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom right;
          transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: 0;
  left: 0;
  right: auto;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom left;
          transform-origin: bottom left;
}

.fa-layers-top-right {
  right: 0;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-top-left {
  left: 0;
  right: auto;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top left;
          transform-origin: top left;
}

.fa-lg {
  font-size: 1.3333333333em;
  line-height: 0.75em;
  vertical-align: -0.0667em;
}

.fa-xs {
  font-size: 0.75em;
}

.fa-sm {
  font-size: 0.875em;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: 2.5em;
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: -2em;
  position: absolute;
  text-align: center;
  width: 2em;
  line-height: inherit;
}

.fa-border {
  border: solid 0.08em #eee;
  border-radius: 0.1em;
  padding: 0.2em 0.25em 0.15em;
}

.fa-pull-left {
  float: left;
}

.fa-pull-right {
  float: right;
}

.fa.fa-pull-left,
.fas.fa-pull-left,
.far.fa-pull-left,
.fal.fa-pull-left,
.fab.fa-pull-left {
  margin-right: 0.3em;
}
.fa.fa-pull-right,
.fas.fa-pull-right,
.far.fa-pull-right,
.fal.fa-pull-right,
.fab.fa-pull-right {
  margin-left: 0.3em;
}

.fa-spin {
  -webkit-animation: fa-spin 2s infinite linear;
          animation: fa-spin 2s infinite linear;
}

.fa-pulse {
  -webkit-animation: fa-spin 1s infinite steps(8);
          animation: fa-spin 1s infinite steps(8);
}

@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}

@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";
  -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
}

.fa-rotate-180 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";
  -webkit-transform: rotate(180deg);
          transform: rotate(180deg);
}

.fa-rotate-270 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";
  -webkit-transform: rotate(270deg);
          transform: rotate(270deg);
}

.fa-flip-horizontal {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";
  -webkit-transform: scale(-1, 1);
          transform: scale(-1, 1);
}

.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(1, -1);
          transform: scale(1, -1);
}

.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(-1, -1);
          transform: scale(-1, -1);
}

:root .fa-rotate-90,
:root .fa-rotate-180,
:root .fa-rotate-270,
:root .fa-flip-horizontal,
:root .fa-flip-vertical,
:root .fa-flip-both {
  -webkit-filter: none;
          filter: none;
}

.fa-stack {
  display: inline-block;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: #fff;
}

.sr-only {
  border: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

.sr-only-focusable:active, .sr-only-focusable:focus {
  clip: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  position: static;
  width: auto;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse {
  color: #fff;
}`;function mQ(){var t=o6,e=s6,i=ds.familyPrefix,s=ds.replacementClass,u=pQ;if(i!==t||s!==e){var p=new RegExp("\\.".concat(t,"\\-"),"g"),v=new RegExp("\\--".concat(t,"\\-"),"g"),a=new RegExp("\\.".concat(e),"g");u=u.replace(p,".".concat(i,"-")).replace(v,"--".concat(i,"-")).replace(a,".".concat(s))}return u}var gQ=function(){function t(){DJ(this,t),this.definitions={}}return LJ(t,[{key:"add",value:function(){for(var i=this,s=arguments.length,u=new Array(s),p=0;p<s;p++)u[p]=arguments[p];var v=u.reduce(this._pullDefinitions,{});Object.keys(v).forEach(function(a){i.definitions[a]=fr({},i.definitions[a]||{},v[a]),y6(a,v[a]),v6()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(i,s){var u=s.prefix&&s.iconName&&s.icon?{0:s}:s;return Object.keys(u).map(function(p){var v=u[p],a=v.prefix,A=v.iconName,O=v.icon;i[a]||(i[a]={}),i[a][A]=O}),i}}]),t}();function _Q(){ds.autoAddCss&&!WL&&(nQ(mQ()),WL=!0)}function yQ(t,e){return Object.defineProperty(t,"abstract",{get:e}),Object.defineProperty(t,"html",{get:function(){return t.abstract.map(function(s){return x6(s)})}}),Object.defineProperty(t,"node",{get:function(){if(sk){var s=wo.createElement("div");return s.innerHTML=t.html,s.children}}}),t}function GL(t){var e=t.prefix,i=e===void 0?"fa":e,s=t.iconName;if(s)return UL(xQ.definitions,i,s)||UL(Ga.styles,i,s)}function vQ(t){return function(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=(e||{}).icon?e:GL(e||{}),u=i.mask;return u&&(u=(u||{}).icon?u:GL(u||{})),t(s,fr({},i,{mask:u}))}}var xQ=new gQ,WL=!1,oI={transform:function(e){return fQ(e)}},bQ=vQ(function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=e.transform,s=i===void 0?Cf:i,u=e.symbol,p=u===void 0?!1:u,v=e.mask,a=v===void 0?null:v,A=e.maskId,O=A===void 0?null:A,B=e.title,$=B===void 0?null:B,Y=e.titleId,se=Y===void 0?null:Y,me=e.classes,_e=me===void 0?[]:me,Ee=e.attributes,ae=Ee===void 0?{}:Ee,le=e.styles,fe=le===void 0?{}:le;if(t){var Ce=t.prefix,Ge=t.iconName,gt=t.icon;return yQ(fr({type:"icon"},t),function(){return _Q(),ds.autoA11y&&($?ae["aria-labelledby"]="".concat(ds.replacementClass,"-title-").concat(se||Rx()):(ae["aria-hidden"]="true",ae.focusable="false")),uQ({icons:{main:$L(gt),mask:a?$L(a.icon):{found:!1,width:null,height:null,icon:{}}},prefix:Ce,iconName:Ge,transform:fr({},Cf,s),symbol:p,title:$,maskId:O,titleId:se,extra:{attributes:ae,styles:fe,classes:_e}})})}}),w6={exports:{}},wQ="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",TQ=wQ,EQ=TQ;function T6(){}function E6(){}E6.resetWarningCache=T6;var SQ=function(){function t(s,u,p,v,a,A){if(A!==EQ){var O=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw O.name="Invariant Violation",O}}t.isRequired=t;function e(){return t}var i={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:E6,resetWarningCache:T6};return i.PropTypes=i,i};w6.exports=SQ();var IQ=w6.exports;const zt=ny(IQ);function qL(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),i.push.apply(i,s)}return i}function Qc(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?qL(Object(i),!0).forEach(function(s){Mf(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):qL(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function Ox(t){"@babel/helpers - typeof";return Ox=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ox(t)}function Mf(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function AQ(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}function S6(t,e){if(t==null)return{};var i=AQ(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function sI(t){return PQ(t)||kQ(t)||CQ(t)||MQ()}function PQ(t){if(Array.isArray(t))return aI(t)}function kQ(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function CQ(t,e){if(t){if(typeof t=="string")return aI(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return aI(t,e)}}function aI(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function MQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RQ(t){var e,i=t.beat,s=t.fade,u=t.beatFade,p=t.bounce,v=t.shake,a=t.flash,A=t.spin,O=t.spinPulse,B=t.spinReverse,$=t.pulse,Y=t.fixedWidth,se=t.inverse,me=t.border,_e=t.listItem,Ee=t.flip,ae=t.size,le=t.rotation,fe=t.pull,Ce=(e={"fa-beat":i,"fa-fade":s,"fa-beat-fade":u,"fa-bounce":p,"fa-shake":v,"fa-flash":a,"fa-spin":A,"fa-spin-reverse":B,"fa-spin-pulse":O,"fa-pulse":$,"fa-fw":Y,"fa-inverse":se,"fa-border":me,"fa-li":_e,"fa-flip":Ee===!0,"fa-flip-horizontal":Ee==="horizontal"||Ee==="both","fa-flip-vertical":Ee==="vertical"||Ee==="both"},Mf(e,"fa-".concat(ae),typeof ae<"u"&&ae!==null),Mf(e,"fa-rotate-".concat(le),typeof le<"u"&&le!==null&&le!==0),Mf(e,"fa-pull-".concat(fe),typeof fe<"u"&&fe!==null),Mf(e,"fa-swap-opacity",t.swapOpacity),e);return Object.keys(Ce).map(function(Ge){return Ce[Ge]?Ge:null}).filter(function(Ge){return Ge})}function OQ(t){return t=t-0,t===t}function I6(t){return OQ(t)?t:(t=t.replace(/[\-_\s]+(.)?/g,function(e,i){return i?i.toUpperCase():""}),t.substr(0,1).toLowerCase()+t.substr(1))}var DQ=["style"];function LQ(t){return t.charAt(0).toUpperCase()+t.slice(1)}function zQ(t){return t.split(";").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,i){var s=i.indexOf(":"),u=I6(i.slice(0,s)),p=i.slice(s+1).trim();return u.startsWith("webkit")?e[LQ(u)]=p:e[u]=p,e},{})}function A6(t,e){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof e=="string")return e;var s=(e.children||[]).map(function(A){return A6(t,A)}),u=Object.keys(e.attributes||{}).reduce(function(A,O){var B=e.attributes[O];switch(O){case"class":A.attrs.className=B,delete e.attributes.class;break;case"style":A.attrs.style=zQ(B);break;default:O.indexOf("aria-")===0||O.indexOf("data-")===0?A.attrs[O.toLowerCase()]=B:A.attrs[I6(O)]=B}return A},{attrs:{}}),p=i.style,v=p===void 0?{}:p,a=S6(i,DQ);return u.attrs.style=Qc(Qc({},u.attrs.style),v),t.apply(void 0,[e.tag,Qc(Qc({},u.attrs),a)].concat(sI(s)))}var P6=!1;try{P6=!0}catch{}function NQ(){if(!P6&&console&&typeof console.error=="function"){var t;(t=console).error.apply(t,arguments)}}function HL(t){if(t&&Ox(t)==="object"&&t.prefix&&t.iconName&&t.icon)return t;if(oI.icon)return oI.icon(t);if(t===null)return null;if(t&&Ox(t)==="object"&&t.prefix&&t.iconName)return t;if(Array.isArray(t)&&t.length===2)return{prefix:t[0],iconName:t[1]};if(typeof t=="string")return{prefix:"fas",iconName:t}}function TE(t,e){return Array.isArray(e)&&e.length>0||!Array.isArray(e)&&e?Mf({},t,e):{}}var FQ=["forwardedRef"];function fa(t){var e=t.forwardedRef,i=S6(t,FQ),s=i.icon,u=i.mask,p=i.symbol,v=i.className,a=i.title,A=i.titleId,O=i.maskId,B=HL(s),$=TE("classes",[].concat(sI(RQ(i)),sI(v.split(" ")))),Y=TE("transform",typeof i.transform=="string"?oI.transform(i.transform):i.transform),se=TE("mask",HL(u)),me=bQ(B,Qc(Qc(Qc(Qc({},$),Y),se),{},{symbol:p,title:a,titleId:A,maskId:O}));if(!me)return NQ("Could not find icon",B),null;var _e=me.abstract,Ee={ref:e};return Object.keys(i).forEach(function(ae){fa.defaultProps.hasOwnProperty(ae)||(Ee[ae]=i[ae])}),BQ(_e[0],Ee)}fa.displayName="FontAwesomeIcon";fa.propTypes={beat:zt.bool,border:zt.bool,beatFade:zt.bool,bounce:zt.bool,className:zt.string,fade:zt.bool,flash:zt.bool,mask:zt.oneOfType([zt.object,zt.array,zt.string]),maskId:zt.string,fixedWidth:zt.bool,inverse:zt.bool,flip:zt.oneOf([!0,!1,"horizontal","vertical","both"]),icon:zt.oneOfType([zt.object,zt.array,zt.string]),listItem:zt.bool,pull:zt.oneOf(["right","left"]),pulse:zt.bool,rotation:zt.oneOf([0,90,180,270]),shake:zt.bool,size:zt.oneOf(["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"]),spin:zt.bool,spinPulse:zt.bool,spinReverse:zt.bool,symbol:zt.oneOfType([zt.bool,zt.string]),title:zt.string,titleId:zt.string,transform:zt.oneOfType([zt.string,zt.object]),swapOpacity:zt.bool};fa.defaultProps={border:!1,className:"",mask:null,maskId:null,fixedWidth:!1,inverse:!1,flip:!1,icon:null,listItem:!1,pull:null,pulse:!1,rotation:null,size:null,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:null,transform:null,swapOpacity:!1};var BQ=A6.bind(null,Re.createElement);/*!
 * Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 */var jQ={prefix:"fas",iconName:"bars",icon:[448,512,[],"f0c9","M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"]},VQ={prefix:"fas",iconName:"search",icon:[512,512,[],"f002","M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"]},UQ={prefix:"fas",iconName:"times",icon:[352,512,[],"f00d","M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"]};const $Q=()=>{let t=Qh();const[e,i]=Be.useState(!1),s=()=>{i(!e)},u=()=>{t("/"),RJ(),nr.success("Signed out")},p=()=>{t("/profile")},v=()=>{i(!1)};return We.jsxs("div",{className:"menu-container",children:[We.jsx("button",{className:"menu-button",onClick:s,children:We.jsx(fa,{icon:jQ,size:"2x"})}),e&&We.jsxs("div",{className:"menu",onMouseLeave:v,children:[We.jsx("button",{onClick:u,children:"Logout"}),We.jsx("button",{onClick:p,children:"Profile"})]})]})},GQ=()=>{let t=Qh();const{user:e}=Be.useContext(ku),i=()=>{t("/")};return We.jsx(We.Fragment,{children:We.jsxs("div",{className:"header",children:[We.jsx("p",{onClick:i,id:"appName",children:"Whisper"}),We.jsx("p",{id:"slogan",children:"Keep it close"}),e?We.jsx("div",{id:"hamburger",children:We.jsx($Q,{})}):""]})})};const WQ="/assets/github-7869da78.png",qQ=()=>We.jsx("footer",{className:"footer",children:We.jsx("a",{href:"https://github.com/jaypopat/Project",children:We.jsx("img",{id:"logo",src:WQ,alt:"GitHub"})})});const HQ=()=>We.jsx("div",{id:"about",children:"hi, this is Whisper, a proximity based chat application"});const ZQ=()=>{const{user:t}=Be.useContext(ku),[e,i]=Be.useState(t.displayName),[s,u]=Be.useState(t.email),[p,v]=Be.useState(""),[a,A]=Be.useState(t.photoURL),O=async()=>{if(e!==t.displayName||s!==t.email||p||a!==t.photoURL)try{await Promise.all([e!==t.displayName&&PS(t,{displayName:e}),s!==t.email&&Kq(t,s),p&&Jq(t,p),a!==t.photoURL&&PS(t,{photoURL:a})]),nr.success("Profile updated successfully!",{autoClose:3e3})}catch(B){console.error("Error updating profile:",B),nr.error("Failed to update profile. Please try again.",{autoClose:3e3})}};return console.log(t),We.jsxs("div",{className:"profile-page",children:[We.jsx("h1",{children:"User Profile"}),We.jsx("input",{type:"text",value:e,onChange:B=>i(B.target.value),placeholder:"Display Name"}),We.jsx("input",{type:"email",value:s,onChange:B=>u(B.target.value),placeholder:"Email"}),We.jsx("input",{type:"password",value:p,onChange:B=>v(B.target.value),placeholder:"New Password (leave blank to keep current)"}),We.jsx("input",{type:"text",value:a,onChange:B=>A(B.target.value),placeholder:"Profile Picture URL"}),We.jsx("button",{onClick:O,children:"Update Profile"})]})};const k6=()=>We.jsx("div",{className:"spinner-container",children:We.jsx("div",{className:"loading-spinner"})});function EE({children:t}){const{user:e,userLocation:i,userLocationFetchingInBackground:s}=Be.useContext(ku);return s?We.jsx(k6,{}):e?i?t:(nr.error("give access to location"),We.jsx(oD,{to:"/",replace:!0})):We.jsx(oD,{to:"/login",replace:!0})}function XQ(){return We.jsxs("div",{className:"error-page",children:[We.jsx("h1",{children:"404"}),We.jsx("p",{children:"Oops! The page you are looking for does not exist."})]})}const YQ=["ahole","anus","ash0le","ash0les","asholes","ass","Ass Monkey","Assface","assh0le","assh0lez","asshole","assholes","assholz","asswipe","azzhole","bassterds","bastard","bastards","bastardz","basterds","basterdz","Biatch","bitch","bitches","Blow Job","boffing","butthole","buttwipe","c0ck","c0cks","c0k","Carpet Muncher","cawk","cawks","Clit","cnts","cntz","cock","cockhead","cock-head","cocks","CockSucker","cock-sucker","crap","cum","cunt","cunts","cuntz","dick","dild0","dild0s","dildo","dildos","dilld0","dilld0s","dominatricks","dominatrics","dominatrix","dyke","enema","f u c k","f u c k e r","fag","fag1t","faget","fagg1t","faggit","faggot","fagg0t","fagit","fags","fagz","faig","faigs","fart","flipping the bird","fuck","fucker","fuckin","fucking","fucks","Fudge Packer","fuk","Fukah","Fuken","fuker","Fukin","Fukk","Fukkah","Fukken","Fukker","Fukkin","g00k","God-damned","h00r","h0ar","h0re","hells","hoar","hoor","hoore","jackoff","jap","japs","jerk-off","jisim","jiss","jizm","jizz","knob","knobs","knobz","kunt","kunts","kuntz","Lezzian","Lipshits","Lipshitz","masochist","masokist","massterbait","masstrbait","masstrbate","masterbaiter","masterbate","masterbates","Motha Fucker","Motha Fuker","Motha Fukkah","Motha Fukker","Mother Fucker","Mother Fukah","Mother Fuker","Mother Fukkah","Mother Fukker","mother-fucker","Mutha Fucker","Mutha Fukah","Mutha Fuker","Mutha Fukkah","Mutha Fukker","n1gr","nastt","nigger;","nigur;","niiger;","niigr;","orafis","orgasim;","orgasm","orgasum","oriface","orifice","orifiss","packi","packie","packy","paki","pakie","paky","pecker","peeenus","peeenusss","peenus","peinus","pen1s","penas","penis","penis-breath","penus","penuus","Phuc","Phuck","Phuk","Phuker","Phukker","polac","polack","polak","Poonani","pr1c","pr1ck","pr1k","pusse","pussee","pussy","puuke","puuker","qweir","recktum","rectum","retard","sadist","scank","schlong","screwing","semen","sex","sexy","Sh!t","sh1t","sh1ter","sh1ts","sh1tter","sh1tz","shit","shits","shitter","Shitty","Shity","shitz","Shyt","Shyte","Shytty","Shyty","skanck","skank","skankee","skankey","skanks","Skanky","slag","slut","sluts","Slutty","slutz","son-of-a-bitch","tit","turd","va1jina","vag1na","vagiina","vagina","vaj1na","vajina","vullva","vulva","w0p","wh00r","wh0re","whore","xrated","xxx","b!+ch","bitch","blowjob","clit","arschloch","fuck","shit","ass","asshole","b!tch","b17ch","b1tch","bastard","bi+ch","boiolas","buceta","c0ck","cawk","chink","cipa","clits","cock","cum","cunt","dildo","dirsa","ejakulate","fatass","fcuk","fuk","fux0r","hoer","hore","jism","kawk","l3itch","l3i+ch","masturbate","masterbat*","masterbat3","motherfucker","s.o.b.","mofo","nazi","nigga","nigger","nutsack","phuck","pimpis","pusse","pussy","scrotum","sh!t","shemale","shi+","sh!+","slut","smut","teets","tits","boobs","b00bs","teez","testical","testicle","titt","w00se","jackoff","wank","whoar","whore","*damn","*dyke","*fuck*","*shit*","@$$","amcik","andskota","arse*","assrammer","ayir","bi7ch","bitch*","bollock*","breasts","butt-pirate","cabron","cazzo","chraa","chuj","Cock*","cunt*","d4mn","daygo","dego","dick*","dike*","dupa","dziwka","ejackulate","Ekrem*","Ekto","enculer","faen","fag*","fanculo","fanny","feces","feg","Felcher","ficken","fitt*","Flikker","foreskin","Fotze","Fu(*","fuk*","futkretzn","gook","guiena","h0r","h4x0r","hell","helvete","hoer*","honkey","Huevon","hui","injun","jizz","kanker*","kike","klootzak","kraut","knulle","kuk","kuksuger","Kurac","kurwa","kusi*","kyrpa*","lesbo","mamhoon","masturbat*","merd*","mibun","monkleigh","mouliewop","muie","mulkku","muschi","nazis","nepesaurio","nigger*","orospu","paska*","perse","picka","pierdol*","pillu*","pimmel","piss*","pizda","poontsee","poop","porn","p0rn","pr0n","preteen","pula","pule","puta","puto","qahbeh","queef*","rautenberg","schaffer","scheiss*","schlampe","schmuck","screw","sh!t*","sharmuta","sharmute","shipal","shiz","skribz","skurwysyn","sphencter","spic","spierdalaj","splooge","suka","b00b*","testicle*","titt*","twat","vittu","wank*","wetback*","wichser","wop*","yed","zabourah"],KQ={words:YQ};var JQ={"4r5e":1,"5h1t":1,"5hit":1,a55:1,anal:1,anus:1,ar5e:1,arrse:1,arse:1,ass:1,"ass-fucker":1,asses:1,assfucker:1,assfukka:1,asshole:1,assholes:1,asswhole:1,a_s_s:1,"b!tch":1,b00bs:1,b17ch:1,b1tch:1,ballbag:1,balls:1,ballsack:1,bastard:1,beastial:1,beastiality:1,bellend:1,bestial:1,bestiality:1,"bi+ch":1,biatch:1,bitch:1,bitcher:1,bitchers:1,bitches:1,bitchin:1,bitching:1,bloody:1,"blow job":1,blowjob:1,blowjobs:1,boiolas:1,bollock:1,bollok:1,boner:1,boob:1,boobs:1,booobs:1,boooobs:1,booooobs:1,booooooobs:1,breasts:1,buceta:1,bugger:1,bum:1,"bunny fucker":1,butt:1,butthole:1,buttmuch:1,buttplug:1,c0ck:1,c0cksucker:1,"carpet muncher":1,cawk:1,chink:1,cipa:1,cl1t:1,clit:1,clitoris:1,clits:1,cnut:1,cock:1,"cock-sucker":1,cockface:1,cockhead:1,cockmunch:1,cockmuncher:1,cocks:1,cocksuck:1,cocksucked:1,cocksucker:1,cocksucking:1,cocksucks:1,cocksuka:1,cocksukka:1,cok:1,cokmuncher:1,coksucka:1,coon:1,cox:1,crap:1,cum:1,cummer:1,cumming:1,cums:1,cumshot:1,cunilingus:1,cunillingus:1,cunnilingus:1,cunt:1,cuntlick:1,cuntlicker:1,cuntlicking:1,cunts:1,cyalis:1,cyberfuc:1,cyberfuck:1,cyberfucked:1,cyberfucker:1,cyberfuckers:1,cyberfucking:1,d1ck:1,damn:1,dick:1,dickhead:1,dildo:1,dildos:1,dink:1,dinks:1,dirsa:1,dlck:1,"dog-fucker":1,doggin:1,dogging:1,donkeyribber:1,doosh:1,duche:1,dyke:1,ejaculate:1,ejaculated:1,ejaculates:1,ejaculating:1,ejaculatings:1,ejaculation:1,ejakulate:1,"f u c k":1,"f u c k e r":1,f4nny:1,fag:1,fagging:1,faggitt:1,faggot:1,faggs:1,fagot:1,fagots:1,fags:1,fanny:1,fannyflaps:1,fannyfucker:1,fanyy:1,fatass:1,fcuk:1,fcuker:1,fcuking:1,feck:1,fecker:1,felching:1,fellate:1,fellatio:1,fingerfuck:1,fingerfucked:1,fingerfucker:1,fingerfuckers:1,fingerfucking:1,fingerfucks:1,fistfuck:1,fistfucked:1,fistfucker:1,fistfuckers:1,fistfucking:1,fistfuckings:1,fistfucks:1,flange:1,fook:1,fooker:1,fuck:1,fucka:1,fucked:1,fucker:1,fuckers:1,fuckhead:1,fuckheads:1,fuckin:1,fucking:1,fuckings:1,fuckingshitmotherfucker:1,fuckme:1,fucks:1,fuckwhit:1,fuckwit:1,"fudge packer":1,fudgepacker:1,fuk:1,fuker:1,fukker:1,fukkin:1,fuks:1,fukwhit:1,fukwit:1,fux:1,fux0r:1,f_u_c_k:1,gangbang:1,gangbanged:1,gangbangs:1,gaylord:1,gaysex:1,goatse:1,God:1,"god-dam":1,"god-damned":1,goddamn:1,goddamned:1,hardcoresex:1,hell:1,heshe:1,hoar:1,hoare:1,hoer:1,homo:1,hore:1,horniest:1,horny:1,hotsex:1,"jack-off":1,jackoff:1,jap:1,"jerk-off":1,jism:1,jiz:1,jizm:1,jizz:1,kawk:1,knob:1,knobead:1,knobed:1,knobend:1,knobhead:1,knobjocky:1,knobjokey:1,kock:1,kondum:1,kondums:1,kum:1,kummer:1,kumming:1,kums:1,kunilingus:1,"l3i+ch":1,l3itch:1,labia:1,lust:1,lusting:1,m0f0:1,m0fo:1,m45terbate:1,ma5terb8:1,ma5terbate:1,masochist:1,"master-bate":1,masterb8:1,"masterbat*":1,masterbat3:1,masterbate:1,masterbation:1,masterbations:1,masturbate:1,"mo-fo":1,mof0:1,mofo:1,mothafuck:1,mothafucka:1,mothafuckas:1,mothafuckaz:1,mothafucked:1,mothafucker:1,mothafuckers:1,mothafuckin:1,mothafucking:1,mothafuckings:1,mothafucks:1,"mother fucker":1,motherfuck:1,motherfucked:1,motherfucker:1,motherfuckers:1,motherfuckin:1,motherfucking:1,motherfuckings:1,motherfuckka:1,motherfucks:1,muff:1,mutha:1,muthafecker:1,muthafuckker:1,muther:1,mutherfucker:1,n1gga:1,n1gger:1,nazi:1,nigg3r:1,nigg4h:1,nigga:1,niggah:1,niggas:1,niggaz:1,nigger:1,niggers:1,nob:1,"nob jokey":1,nobhead:1,nobjocky:1,nobjokey:1,numbnuts:1,nutsack:1,orgasim:1,orgasims:1,orgasm:1,orgasms:1,p0rn:1,pawn:1,pecker:1,penis:1,penisfucker:1,phonesex:1,phuck:1,phuk:1,phuked:1,phuking:1,phukked:1,phukking:1,phuks:1,phuq:1,pigfucker:1,pimpis:1,piss:1,pissed:1,pisser:1,pissers:1,pisses:1,pissflaps:1,pissin:1,pissing:1,pissoff:1,poop:1,porn:1,porno:1,pornography:1,pornos:1,prick:1,pricks:1,pron:1,pube:1,pusse:1,pussi:1,pussies:1,pussy:1,pussys:1,rectum:1,retard:1,rimjaw:1,rimming:1,"s hit":1,"s.o.b.":1,sadist:1,schlong:1,screwing:1,scroat:1,scrote:1,scrotum:1,semen:1,sex:1,"sh!+":1,"sh!t":1,sh1t:1,shag:1,shagger:1,shaggin:1,shagging:1,shemale:1,"shi+":1,shit:1,shitdick:1,shite:1,shited:1,shitey:1,shitfuck:1,shitfull:1,shithead:1,shiting:1,shitings:1,shits:1,shitted:1,shitter:1,shitters:1,shitting:1,shittings:1,shitty:1,skank:1,slut:1,sluts:1,smegma:1,smut:1,snatch:1,"son-of-a-bitch":1,spac:1,spunk:1,s_h_i_t:1,t1tt1e5:1,t1tties:1,teets:1,teez:1,testical:1,testicle:1,tit:1,titfuck:1,tits:1,titt:1,tittie5:1,tittiefucker:1,titties:1,tittyfuck:1,tittywank:1,titwank:1,tosser:1,turd:1,tw4t:1,twat:1,twathead:1,twatty:1,twunt:1,twunter:1,v14gra:1,v1gra:1,vagina:1,viagra:1,vulva:1,w00se:1,wang:1,wank:1,wanker:1,wanky:1,whoar:1,whore:1,willies:1,willy:1,xrated:1,xxx:1},QQ=["4r5e","5h1t","5hit","a55","anal","anus","ar5e","arrse","arse","ass","ass-fucker","asses","assfucker","assfukka","asshole","assholes","asswhole","a_s_s","b!tch","b00bs","b17ch","b1tch","ballbag","balls","ballsack","bastard","beastial","beastiality","bellend","bestial","bestiality","bi+ch","biatch","bitch","bitcher","bitchers","bitches","bitchin","bitching","bloody","blow job","blowjob","blowjobs","boiolas","bollock","bollok","boner","boob","boobs","booobs","boooobs","booooobs","booooooobs","breasts","buceta","bugger","bum","bunny fucker","butt","butthole","buttmuch","buttplug","c0ck","c0cksucker","carpet muncher","cawk","chink","cipa","cl1t","clit","clitoris","clits","cnut","cock","cock-sucker","cockface","cockhead","cockmunch","cockmuncher","cocks","cocksuck","cocksucked","cocksucker","cocksucking","cocksucks","cocksuka","cocksukka","cok","cokmuncher","coksucka","coon","cox","crap","cum","cummer","cumming","cums","cumshot","cunilingus","cunillingus","cunnilingus","cunt","cuntlick","cuntlicker","cuntlicking","cunts","cyalis","cyberfuc","cyberfuck","cyberfucked","cyberfucker","cyberfuckers","cyberfucking","d1ck","damn","dick","dickhead","dildo","dildos","dink","dinks","dirsa","dlck","dog-fucker","doggin","dogging","donkeyribber","doosh","duche","dyke","ejaculate","ejaculated","ejaculates","ejaculating","ejaculatings","ejaculation","ejakulate","f u c k","f u c k e r","f4nny","fag","fagging","faggitt","faggot","faggs","fagot","fagots","fags","fanny","fannyflaps","fannyfucker","fanyy","fatass","fcuk","fcuker","fcuking","feck","fecker","felching","fellate","fellatio","fingerfuck","fingerfucked","fingerfucker","fingerfuckers","fingerfucking","fingerfucks","fistfuck","fistfucked","fistfucker","fistfuckers","fistfucking","fistfuckings","fistfucks","flange","fook","fooker","fuck","fucka","fucked","fucker","fuckers","fuckhead","fuckheads","fuckin","fucking","fuckings","fuckingshitmotherfucker","fuckme","fucks","fuckwhit","fuckwit","fudge packer","fudgepacker","fuk","fuker","fukker","fukkin","fuks","fukwhit","fukwit","fux","fux0r","f_u_c_k","gangbang","gangbanged","gangbangs","gaylord","gaysex","goatse","God","god-dam","god-damned","goddamn","goddamned","hardcoresex","hell","heshe","hoar","hoare","hoer","homo","hore","horniest","horny","hotsex","jack-off","jackoff","jap","jerk-off","jism","jiz","jizm","jizz","kawk","knob","knobead","knobed","knobend","knobhead","knobjocky","knobjokey","kock","kondum","kondums","kum","kummer","kumming","kums","kunilingus","l3i+ch","l3itch","labia","lust","lusting","m0f0","m0fo","m45terbate","ma5terb8","ma5terbate","masochist","master-bate","masterb8","masterbat*","masterbat3","masterbate","masterbation","masterbations","masturbate","mo-fo","mof0","mofo","mothafuck","mothafucka","mothafuckas","mothafuckaz","mothafucked","mothafucker","mothafuckers","mothafuckin","mothafucking","mothafuckings","mothafucks","mother fucker","motherfuck","motherfucked","motherfucker","motherfuckers","motherfuckin","motherfucking","motherfuckings","motherfuckka","motherfucks","muff","mutha","muthafecker","muthafuckker","muther","mutherfucker","n1gga","n1gger","nazi","nigg3r","nigg4h","nigga","niggah","niggas","niggaz","nigger","niggers","nob","nob jokey","nobhead","nobjocky","nobjokey","numbnuts","nutsack","orgasim","orgasims","orgasm","orgasms","p0rn","pawn","pecker","penis","penisfucker","phonesex","phuck","phuk","phuked","phuking","phukked","phukking","phuks","phuq","pigfucker","pimpis","piss","pissed","pisser","pissers","pisses","pissflaps","pissin","pissing","pissoff","poop","porn","porno","pornography","pornos","prick","pricks","pron","pube","pusse","pussi","pussies","pussy","pussys","rectum","retard","rimjaw","rimming","s hit","s.o.b.","sadist","schlong","screwing","scroat","scrote","scrotum","semen","sex","sh!+","sh!t","sh1t","shag","shagger","shaggin","shagging","shemale","shi+","shit","shitdick","shite","shited","shitey","shitfuck","shitfull","shithead","shiting","shitings","shits","shitted","shitter","shitters","shitting","shittings","shitty","skank","slut","sluts","smegma","smut","snatch","son-of-a-bitch","spac","spunk","s_h_i_t","t1tt1e5","t1tties","teets","teez","testical","testicle","tit","titfuck","tits","titt","tittie5","tittiefucker","titties","tittyfuck","tittywank","titwank","tosser","turd","tw4t","twat","twathead","twatty","twunt","twunter","v14gra","v1gra","vagina","viagra","vulva","w00se","wang","wank","wanker","wanky","whoar","whore","willies","willy","xrated","xxx"],eee=/\b(4r5e|5h1t|5hit|a55|anal|anus|ar5e|arrse|arse|ass|ass-fucker|asses|assfucker|assfukka|asshole|assholes|asswhole|a_s_s|b!tch|b00bs|b17ch|b1tch|ballbag|balls|ballsack|bastard|beastial|beastiality|bellend|bestial|bestiality|bi\+ch|biatch|bitch|bitcher|bitchers|bitches|bitchin|bitching|bloody|blow job|blowjob|blowjobs|boiolas|bollock|bollok|boner|boob|boobs|booobs|boooobs|booooobs|booooooobs|breasts|buceta|bugger|bum|bunny fucker|butt|butthole|buttmuch|buttplug|c0ck|c0cksucker|carpet muncher|cawk|chink|cipa|cl1t|clit|clitoris|clits|cnut|cock|cock-sucker|cockface|cockhead|cockmunch|cockmuncher|cocks|cocksuck|cocksucked|cocksucker|cocksucking|cocksucks|cocksuka|cocksukka|cok|cokmuncher|coksucka|coon|cox|crap|cum|cummer|cumming|cums|cumshot|cunilingus|cunillingus|cunnilingus|cunt|cuntlick|cuntlicker|cuntlicking|cunts|cyalis|cyberfuc|cyberfuck|cyberfucked|cyberfucker|cyberfuckers|cyberfucking|d1ck|damn|dick|dickhead|dildo|dildos|dink|dinks|dirsa|dlck|dog-fucker|doggin|dogging|donkeyribber|doosh|duche|dyke|ejaculate|ejaculated|ejaculates|ejaculating|ejaculatings|ejaculation|ejakulate|f u c k|f u c k e r|f4nny|fag|fagging|faggitt|faggot|faggs|fagot|fagots|fags|fanny|fannyflaps|fannyfucker|fanyy|fatass|fcuk|fcuker|fcuking|feck|fecker|felching|fellate|fellatio|fingerfuck|fingerfucked|fingerfucker|fingerfuckers|fingerfucking|fingerfucks|fistfuck|fistfucked|fistfucker|fistfuckers|fistfucking|fistfuckings|fistfucks|flange|fook|fooker|fuck|fucka|fucked|fucker|fuckers|fuckhead|fuckheads|fuckin|fucking|fuckings|fuckingshitmotherfucker|fuckme|fucks|fuckwhit|fuckwit|fudge packer|fudgepacker|fuk|fuker|fukker|fukkin|fuks|fukwhit|fukwit|fux|fux0r|f_u_c_k|gangbang|gangbanged|gangbangs|gaylord|gaysex|goatse|God|god-dam|god-damned|goddamn|goddamned|hardcoresex|hell|heshe|hoar|hoare|hoer|homo|hore|horniest|horny|hotsex|jack-off|jackoff|jap|jerk-off|jism|jiz|jizm|jizz|kawk|knob|knobead|knobed|knobend|knobhead|knobjocky|knobjokey|kock|kondum|kondums|kum|kummer|kumming|kums|kunilingus|l3i\+ch|l3itch|labia|lust|lusting|m0f0|m0fo|m45terbate|ma5terb8|ma5terbate|masochist|master-bate|masterb8|masterbat*|masterbat3|masterbate|masterbation|masterbations|masturbate|mo-fo|mof0|mofo|mothafuck|mothafucka|mothafuckas|mothafuckaz|mothafucked|mothafucker|mothafuckers|mothafuckin|mothafucking|mothafuckings|mothafucks|mother fucker|motherfuck|motherfucked|motherfucker|motherfuckers|motherfuckin|motherfucking|motherfuckings|motherfuckka|motherfucks|muff|mutha|muthafecker|muthafuckker|muther|mutherfucker|n1gga|n1gger|nazi|nigg3r|nigg4h|nigga|niggah|niggas|niggaz|nigger|niggers|nob|nob jokey|nobhead|nobjocky|nobjokey|numbnuts|nutsack|orgasim|orgasims|orgasm|orgasms|p0rn|pawn|pecker|penis|penisfucker|phonesex|phuck|phuk|phuked|phuking|phukked|phukking|phuks|phuq|pigfucker|pimpis|piss|pissed|pisser|pissers|pisses|pissflaps|pissin|pissing|pissoff|poop|porn|porno|pornography|pornos|prick|pricks|pron|pube|pusse|pussi|pussies|pussy|pussys|rectum|retard|rimjaw|rimming|s hit|s.o.b.|sadist|schlong|screwing|scroat|scrote|scrotum|semen|sex|sh!\+|sh!t|sh1t|shag|shagger|shaggin|shagging|shemale|shi\+|shit|shitdick|shite|shited|shitey|shitfuck|shitfull|shithead|shiting|shitings|shits|shitted|shitter|shitters|shitting|shittings|shitty|skank|slut|sluts|smegma|smut|snatch|son-of-a-bitch|spac|spunk|s_h_i_t|t1tt1e5|t1tties|teets|teez|testical|testicle|tit|titfuck|tits|titt|tittie5|tittiefucker|titties|tittyfuck|tittywank|titwank|tosser|turd|tw4t|twat|twathead|twatty|twunt|twunter|v14gra|v1gra|vagina|viagra|vulva|w00se|wang|wank|wanker|wanky|whoar|whore|willies|willy|xrated|xxx)\b/gi,tee={object:JQ,array:QQ,regex:eee};const nee=KQ.words,ree=tee.array;class iee{constructor(e={}){Object.assign(this,{list:e.emptyList&&[]||Array.prototype.concat.apply(nee,[ree,e.list||[]]),exclude:e.exclude||[],splitRegex:e.splitRegex||/\b/,placeHolder:e.placeHolder||"*",regex:e.regex||/[^a-zA-Z0-9|\$|\@]|\^/g,replaceRegex:e.replaceRegex||/\w/g})}isProfane(e){return this.list.filter(i=>{const s=new RegExp(`\\b${i.replace(/(\W)/g,"\\$1")}\\b`,"gi");return!this.exclude.includes(i.toLowerCase())&&s.test(e)}).length>0||!1}replaceWord(e){return e.replace(this.regex,"").replace(this.replaceRegex,this.placeHolder)}clean(e){return e.split(this.splitRegex).map(i=>this.isProfane(i)?this.replaceWord(i):i).join(this.splitRegex.exec(e)[0])}addWords(){let e=Array.from(arguments);this.list.push(...e),e.map(i=>i.toLowerCase()).forEach(i=>{this.exclude.includes(i)&&this.exclude.splice(this.exclude.indexOf(i),1)})}removeWords(){this.exclude.push(...Array.from(arguments).map(e=>e.toLowerCase()))}}var oee=iee;const see=ny(oee),aee=new see,lee=t=>aee.isProfane(t);var C6={exports:{}};(function(t,e){(function(i,s){t.exports=s()})(Y8,function(){var i,s,u;function p(a,A){if(!i)i=A;else if(!s)s=A;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+s+")(sharedChunk); self.onerror = null;",B={};i(B),u=A(B),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}p(["exports"],function(a){var A="3.2.0";let O;const B={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(O==null){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{O={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):r}catch{O=r}}return O},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!B.API_URL)return null;try{const r=new URL(B.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},$={supported:!1,testSupport:function(r){!me&&se&&(_e?ae(r):Y=r)}};let Y,se,me=!1,_e=!1;const Ee=typeof self<"u"?self:{};function ae(r){const n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,se),r.isContextLost())return;$.supported=!0}catch{}r.deleteTexture(n),me=!0}Ee.document&&(se=Ee.document.createElement("img"),se.onload=function(){Y&&ae(Y),Y=null,_e=!0},se.onerror=function(){me=!0,Y=null},se.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const le="01";function fe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ce=Ge;function Ge(r,n,o,l){this.cx=3*r,this.bx=3*(o-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(l-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=n,this.p2x=o,this.p2y=l}Ge.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,n){if(n===void 0&&(n=1e-6),r<0)return 0;if(r>1)return 1;for(var o=r,l=0;l<8;l++){var h=this.sampleCurveX(o)-r;if(Math.abs(h)<n)return o;var f=this.sampleCurveDerivativeX(o);if(Math.abs(f)<1e-6)break;o-=h/f}var m=0,_=1;for(o=r,l=0;l<20&&(h=this.sampleCurveX(o),!(Math.abs(h-r)<n));l++)r>h?m=o:_=o,o=.5*(_-m)+m;return o},solve:function(r,n){return this.sampleCurveY(this.solveCurveX(r,n))}};var gt=fe(Ce),It=Tt;function Tt(r,n){this.x=r,this.y=n}Tt.prototype={clone:function(){return new Tt(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,n){return this.clone()._rotateAround(r,n)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var n=r.x-this.x,o=r.y-this.y;return n*n+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,n){return Math.atan2(this.x*n-this.y*r,this.x*r+this.y*n)},_matMult:function(r){var n=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=n,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var n=Math.cos(r),o=Math.sin(r),l=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=l,this},_rotateAround:function(r,n){var o=Math.cos(r),l=Math.sin(r),h=n.y+l*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-l*(this.y-n.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Tt.convert=function(r){return r instanceof Tt?r:Array.isArray(r)?new Tt(r[0],r[1]):r};var Oe=fe(It);const Yt=Math.PI/180,er=180/Math.PI;function pt(r){return r*Yt}function kn(r){return r*er}const Er=[[0,0],[1,0],[1,1],[0,1]];function si(r){if(r<=0)return 0;if(r>=1)return 1;const n=r*r,o=n*r;return 4*(r<.5?o:3*(r-n)+o-.75)}function xr(r,n,o,l){const h=new gt(r,n,o,l);return function(f){return h.solve(f)}}const rr=xr(.25,.1,.25,1);function Ze(r,n,o){return Math.min(o,Math.max(n,r))}function St(r,n,o){return(o=Ze((o-r)/(n-r),0,1))*o*(3-2*o)}function Lt(r,n,o){const l=o-n,h=((r-n)%l+l)%l+n;return h===n?o:h}function vn(r,n,o){if(!r.length)return o(null,[]);let l=r.length;const h=new Array(r.length);let f=null;r.forEach((m,_)=>{n(m,(x,w)=>{x&&(f=x),h[_]=w,--l==0&&o(f,h)})})}function Kn(r){const n=[];for(const o in r)n.push(r[o]);return n}function br(r,...n){for(const o of n)for(const l in o)r[l]=o[l];return r}let Io=1;function _s(){return Io++}function Oi(){return function r(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function Ao(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function rd(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function ac(r,n){r.forEach(o=>{n[o]&&(n[o]=n[o].bind(n))})}function lc(r,n){return r.indexOf(n,r.length-n.length)!==-1}function Cu(r,n,o){const l={};for(const h in r)l[h]=n.call(o||this,r[h],h,r);return l}function id(r,n,o){const l={};for(const h in r)n.call(o||this,r[h],h,r)&&(l[h]=r[h]);return l}function Zo(r){return Array.isArray(r)?r.map(Zo):typeof r=="object"&&r?Cu(r,Zo):r}const od={};function pr(r){od[r]||(typeof console<"u"&&console.warn(r),od[r]=!0)}function nt(r,n,o){return(o.y-r.y)*(n.x-r.x)>(n.y-r.y)*(o.x-r.x)}function ie(r){let n=0;for(let o,l,h=0,f=r.length,m=f-1;h<f;m=h++)o=r[h],l=r[m],n+=(l.x-o.x)*(o.y+l.y);return n}function ue([r,n,o]){const l=pt(n+90),h=pt(o);return{x:r*Math.cos(l)*Math.sin(h),y:r*Math.sin(l)*Math.sin(h),z:r*Math.cos(h),azimuthal:n,polar:o}}function we(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Je(r){const n={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,l,h,f)=>{const m=h||f;return n[l]=!m||m.toLowerCase(),""}),n["max-age"]){const o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n}let Ye=null;function Et(r){try{const n=self[r];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ot(r,n){return[r[4*n],r[4*n+1],r[4*n+2],r[4*n+3]]}function et(r,n,o,l){for(;n<o;){const h=n+o>>1;r[h]<l?n=h+1:o=h}return n}function $t(r,n,o,l){for(;n<o;){const h=n+o>>1;r[h]<=l?n=h+1:o=h}return n}const Wt="mapbox-tiles";let Zt=500,Vn=50,ir,Vr;function tr(){try{return caches}catch{}}function or(){const r=tr();r&&!ir&&(ir=r.open(Wt))}function Un(r){const n=r.indexOf("?");if(n<0)return r;const o=function(h){const f=h.indexOf("?");return f>0?h.slice(f+1).split("&"):[]}(r),l=o.filter(h=>{const f=h.split("=");return f[0]==="language"||f[0]==="worldview"});return l.length?`${r.slice(0,n)}?${l.join("&")}`:r.slice(0,n)}let Qr=1/0;const ai={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ai);class Po extends Error{constructor(n,o,l){o===401&&st(l)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=o,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Di=we()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,js=function(r,n){if(!(/^file:/.test(o=r.url)||/^file:/.test(Di())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(l,h){const f=new AbortController,m=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Di(),referrerPolicy:l.referrerPolicy,signal:f.signal});let _=!1,x=!1;const w=(E=m.url).indexOf("sku=")>0&&st(E);var E;l.type==="json"&&m.headers.set("Accept","application/json");const I=(C,R,L)=>{if(x)return;if(C&&C.message!=="SecurityError"&&pr(C.toString()),R&&L)return k(R);const N=Date.now();fetch(m).then(j=>{if(j.ok){const Z=w?j.clone():null;return k(j,Z,N)}return h(new Po(j.statusText,j.status,l.url))}).catch(j=>{j.name!=="AbortError"&&h(new Error(`${j.message} ${l.url}`))})},k=(C,R,L)=>{(l.type==="arrayBuffer"?C.arrayBuffer():l.type==="json"?C.json():C.text()).then(N=>{x||(R&&L&&function(j,Z,X){if(or(),!ir)return;const J={status:Z.status,statusText:Z.statusText,headers:new Headers};Z.headers.forEach((pe,ve)=>J.headers.set(ve,pe));const te=Je(Z.headers.get("Cache-Control")||"");if(te["no-store"])return;te["max-age"]&&J.headers.set("Expires",new Date(X+1e3*te["max-age"]).toUTCString());const re=J.headers.get("Expires");re&&(new Date(re).getTime()-X<42e4||function(pe,ve){if(Vr===void 0)try{new Response(new ReadableStream),Vr=!0}catch{Vr=!1}Vr?ve(pe.body):pe.blob().then(ve)}(Z,pe=>{const ve=new Response(pe,J);or(),ir&&ir.then(be=>be.put(Un(j.url),ve)).catch(be=>pr(be.message))}))}(m,R,L),_=!0,h(null,N,C.headers.get("Cache-Control"),C.headers.get("Expires")))}).catch(N=>{x||h(new Error(N.message))})};return w?function(C,R){if(or(),!ir)return R(null);const L=Un(C.url);ir.then(N=>{N.match(L).then(j=>{const Z=function(X){if(!X)return!1;const J=new Date(X.headers.get("Expires")||0),te=Je(X.headers.get("Cache-Control")||"");return J>Date.now()&&!te["no-cache"]}(j);N.delete(L),Z&&N.put(L,j.clone()),R(null,j,Z)}).catch(R)}).catch(R)}(m,I):I(null,null),{cancel:()=>{x=!0,_||f.abort()}}}(r,n);if(we()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,n,void 0,!0)}var o;return function(l,h){const f=new XMLHttpRequest;f.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const m in l.headers)f.setRequestHeader(m,l.headers[m]);return l.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=l.credentials==="include",f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let m=f.response;if(l.type==="json")try{m=JSON.parse(f.response)}catch(_){return h(_)}h(null,m,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else h(new Po(f.statusText,f.status,l.url))},f.send(l.body),{cancel:()=>f.abort()}}(r,n)},li=function(r,n){return js(br(r,{type:"arrayBuffer"}),n)};function Vs(r){const n=document.createElement("a");return n.href=r,n.protocol===location.protocol&&n.host===location.host}const pa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ci,je;ci=[],je=0;const Ue=function(r,n){if($.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),je>=B.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:r,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return ci.push(f),f}je++;let o=!1;const l=()=>{if(!o)for(o=!0,je--;ci.length&&je<B.MAX_PARALLEL_IMAGE_REQUESTS;){const f=ci.shift(),{requestParameters:m,callback:_,cancelled:x}=f;x||(f.cancel=Ue(m,_).cancel)}},h=li(r,(f,m,_,x)=>{l(),f?n(f):m&&(self.createImageBitmap?function(w,E){const I=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(I).then(k=>{E(null,k)}).catch(k=>{E(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(w,E)=>n(w,E,_,x)):function(w,E){const I=new Image;I.onload=()=>{E(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=pa})},I.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new Blob([new Uint8Array(w)],{type:"image/png"});I.src=w.byteLength?URL.createObjectURL(k):pa}(m,(w,E)=>n(w,E,_,x)))});return{cancel:()=>{h.cancel(),l()}}},tt="NO_ACCESS_TOKEN";function rt(r){return r.indexOf("mapbox:")===0}function st(r){return B.API_URL_REGEX.test(r)}function dt(r){return B.API_CDN_URL_REGEX.test(r)}function ft(r){return B.API_STYLE_REGEX.test(r)&&!lt(r)}function lt(r){return B.API_SPRITE_REGEX.test(r)}const At=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ot(r){const n=r.match(At);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function tn(r){const n=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${n}`}const Mn="mapbox.eventData";function Ft(r){if(!r)return null;const n=r.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(n[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class zn{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const o=Ft(B.ACCESS_TOKEN);let l="";return l=o&&o.u?btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(h,f)=>String.fromCharCode(+("0x"+f)))):B.ACCESS_TOKEN||"",n?`${Mn}.${n}:${l}`:`${Mn}:${l}`}fetchEventData(){const n=Et("localStorage"),o=this.getStorageKey(),l=this.getStorageKey("uuid");if(n)try{const h=localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));const f=localStorage.getItem(l);f&&(this.anonId=f)}catch{pr("Unable to read from LocalStorage")}}saveEventData(){const n=Et("localStorage"),o=this.getStorageKey(),l=this.getStorageKey("uuid"),h=this.anonId;if(n&&h)try{localStorage.setItem(l,h),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{pr("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,o,l,h){if(!B.EVENTS_URL)return;const f=ot(B.EVENTS_URL);f.params.push(`access_token=${h||B.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(n).toISOString()},_=o?br(m,o):m,x={url:tn(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(w,E){return js(br(w,{method:"POST"}),E)}(x,w=>{this.pendingRequest=null,l(w),this.saveEventData(),this.processRequests(h)})}queueRequest(n,o){this.queue.push(n),this.processRequests(o)}}const wr=new class extends zn{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,n){B.EVENTS_URL&&B.ACCESS_TOKEN&&Array.isArray(r)&&r.some(o=>rt(o)||st(o))&&this.queueRequest(Date.now(),n)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Ft(B.ACCESS_TOKEN),o=n?n.u:B.ACCESS_TOKEN;let l=o!==this.eventData.tokenU;rd(this.anonId)||(this.anonId=Oi(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),m=new Date(h),_=(h-this.eventData.lastSuccess)/864e5;l=l||_>=1||_<-1||f.getDate()!==m.getDate()}else l=!0;l?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:le,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=h,this.eventData.tokenU=o)},r):this.processRequests()}},Sr=wr.postTurnstileEvent.bind(wr),Mr=new class extends zn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,n,o,l){this.skuToken=n,this.errorCb=l,B.EVENTS_URL&&(o||B.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},o):this.errorCb(new Error(tt)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),rd(this.anonId)||(this.anonId=Oi()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:le,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):n&&(this.success[n]=!0)},r))}},yi=Mr.postMapLoadEvent.bind(Mr),go=new class extends zn{constructor(){super("gljs.performance")}postPerformanceEvent(r,n){B.EVENTS_URL&&(r||B.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},r)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:o}=this.queue.shift(),l=function(h){const f=performance.getEntriesByType("resource"),m=performance.getEntriesByType("mark"),_=function(C){const R={};if(C){for(const L in C)if(L!=="other")for(const N of C[L]){const j=`${L}ResolveRangeMin`,Z=`${L}ResolveRangeMax`,X=`${L}RequestCount`,J=`${L}RequestCachedCount`;R[j]=Math.min(R[j]||1/0,N.startTime),R[Z]=Math.max(R[Z]||-1/0,N.responseEnd);const te=re=>{R[re]===void 0&&(R[re]=0),++R[re]};N.transferSize!==void 0&&N.transferSize===0&&te(J),te(X)}}return R}(function(C,R){const L={};if(C)for(const N of C){const j=R(N);L[j]===void 0&&(L[j]=[]),L[j].push(N)}return L}(f,cc)),x=window.devicePixelRatio,w=navigator.connection||navigator.mozConnection||navigator.webkitConnection,E=w?w.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},k=(C,R,L)=>{L!=null&&C.push({name:R,value:L.toString()})};for(const C in _)k(I.counters,C,_[C]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(k(I.counters,"interactionRangeMin",h.interactionRange[0]),k(I.counters,"interactionRangeMax",h.interactionRange[1])),m)for(const C of Object.keys(Us)){const R=Us[C],L=m.find(N=>N.name===R);L&&k(I.counters,R,L.startTime)}return k(I.counters,"visibilityHidden",h.visibilityHidden),k(I.attributes,"style",function(C){if(C)for(const R of C){const L=R.name.split("?")[0];if(ft(L)){const N=L.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(f)),k(I.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),k(I.attributes,"fogEnabled",h.fogEnabled?"true":"false"),k(I.attributes,"projection",h.projection),k(I.attributes,"zoom",h.zoom),k(I.metadata,"devicePixelRatio",x),k(I.metadata,"connectionEffectiveType",E),k(I.metadata,"navigatorUserAgent",navigator.userAgent),k(I.metadata,"screenWidth",window.screen.width),k(I.metadata,"screenHeight",window.screen.height),k(I.metadata,"windowWidth",window.innerWidth),k(I.metadata,"windowHeight",window.innerHeight),k(I.metadata,"mapWidth",h.width/x),k(I.metadata,"mapHeight",h.height/x),k(I.metadata,"webglRenderer",h.renderer),k(I.metadata,"webglVendor",h.vendor),k(I.metadata,"sdkVersion",A),k(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(o);for(const h of l.metadata);for(const h of l.counters);for(const h of l.attributes);this.postEvent(n,l,()=>{},r)}},ko=go.postPerformanceEvent.bind(go),_o=new class extends zn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,n,o,l){if(!B.API_URL||!B.SESSION_PATH)return;const h=ot(B.API_URL+B.SESSION_PATH);h.params.push(`sku=${n||""}`),h.params.push(`access_token=${l||B.ACCESS_TOKEN||""}`);const f={url:tn(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,_){return js(br(m,{method:"GET"}),_)}(f,m=>{this.pendingRequest=null,o(m),this.saveEventData(),this.processRequests(l)})}getSessionAPI(r,n,o,l){this.skuToken=n,this.errorCb=l,B.SESSION_PATH&&B.API_URL&&(o||B.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},o):this.errorCb(new Error(tt)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||this.getSession(o,this.skuToken,l=>{l?this.errorCb(l):n&&(this.success[n]=!0)},r)}},vi=_o.getSessionAPI.bind(_o),Ki=new Set,Us={create:"create",load:"load",fullLoad:"fullLoad"};function cc(r){const n=r.name.split("?")[0];return dt(n)&&n.includes("mapbox-gl.js")?"javascript":dt(n)&&n.includes("mapbox-gl.css")?"css":function(o){return B.API_FONTS_REGEX.test(o)}(n)?"fontRange":lt(n)?"sprite":ft(n)?"style":function(o){return B.API_TILEJSON_REGEX.test(o)}(n)?"tilejson":"other"}function Lp(r){const n=r?r.url.toString():void 0;return n?performance.getEntriesByName(n):[]}let sd,ad,zp,Mu,Qa;function Dy(){return sd==null&&(sd=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),sd}const Li={now:()=>Mu!==void 0?Mu:performance.now(),setNow(r){Mu=r},restoreNow(){Mu=void 0},frame(r){const n=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(r,n=0){const{width:o,height:l}=r;Qa||(Qa=document.createElement("canvas"));const h=Qa.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(o>Qa.width||l>Qa.height)&&(Qa.width=o,Qa.height=l),h.clearRect(-n,-n,o+2*n,l+2*n),h.drawImage(r,0,0,o,l),h.getImageData(-n,-n,o+2*n,l+2*n)},resolveURL:r=>(ad||(ad=document.createElement("a")),ad.href=r,ad.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(zp==null&&(zp=window.matchMedia("(prefers-reduced-motion: reduce)")),zp.matches)},hasCanvasFingerprintNoise(){if(!Dy())return!1;const r=new OffscreenCanvas(85,1),n=r.getContext("2d",{willReadFrequently:!0});let o=0;for(let h=0;h<r.width;++h)n.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,n.fillRect(h,0,1,1);const l=n.getImageData(0,0,r.width,r.height);o=0;for(let h=0;h<l.data.length;++h)if(h%4!=3&&o++!==l.data[h])return!0;return!1}};function ld(r,n,o){o[r]&&o[r].indexOf(n)!==-1||(o[r]=o[r]||[],o[r].push(n))}function el(r,n,o){if(o&&o[r]){const l=o[r].indexOf(n);l!==-1&&o[r].splice(l,1)}}class Xo{constructor(n,o={}){br(this,o),this.type=n}}class tl extends Xo{constructor(n,o={}){super("error",br({error:n},o))}}class ys{on(n,o){return this._listeners=this._listeners||{},ld(n,o,this._listeners),this}off(n,o){return el(n,o,this._listeners),el(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},ld(n,o,this._oneTimeListeners),this):new Promise(l=>this.once(n,l))}fire(n,o){typeof n=="string"&&(n=new Xo(n,o||{}));const l=n.type;if(this.listens(l)){n.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const _ of h)_.call(this,n);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const _ of f)el(l,_,this._oneTimeListeners),_.call(this,n);const m=this._eventedParent;m&&(br(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(n))}else n instanceof tl&&console.error(n.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}var Ie=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class kt{constructor(n,o,l,h){this.message=(n?`${n}: `:"")+l,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)}}class vs extends kt{}function Yo(r,...n){for(const o of n)for(const l in o)r[l]=o[l];return r}function Rr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function $s(r){if(Array.isArray(r))return r.map($s);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const n={};for(const o in r)n[o]=$s(r[o]);return n}return Rr(r)}class nw extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}var Ko=nw;class Np{constructor(n,o=[]){this.parent=n,this.bindings={};for(const[l,h]of o)this.bindings[l]=h}concat(n){return new Np(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}var rw=Np;const nl={kind:"null"},qe={kind:"number"},_n={kind:"string"},bn={kind:"boolean"},Co={kind:"color"},uc={kind:"object"},pn={kind:"value"},rl={kind:"collator"},ma={kind:"formatted"},Ru={kind:"resolvedImage"};function zi(r,n){return{kind:"array",itemType:r,N:n}}function Wn(r){if(r.kind==="array"){const n=Wn(r.itemType);return typeof r.N=="number"?`array<${n}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${n}>`}return r.kind}const iw=[nl,qe,_n,bn,Co,ma,uc,zi(pn),Ru];function il(r,n){if(n.kind==="error")return null;if(r.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!il(r.itemType,n.itemType))&&(typeof r.N!="number"||r.N===n.N))return null}else{if(r.kind===n.kind)return null;if(r.kind==="value"){for(const o of iw)if(!il(o,n))return null}}return`Expected ${Wn(r)} but found ${Wn(n)} instead.`}function Fp(r,n){return n.some(o=>o.kind===r.kind)}function ol(r,n){return n.some(o=>o==="null"?r===null:o==="array"?Array.isArray(r):o==="object"?r&&!Array.isArray(r)&&typeof r=="object":o===typeof r)}var cd,hc={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function dc(r){return(r=Math.round(r))<0?0:r>255?255:r}function Bp(r){return dc(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function ud(r){return(n=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:n>1?1:n;var n}function jp(r,n,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?r+(n-r)*o*6:2*o<1?n:3*o<2?r+(n-r)*(2/3-o)*6:r}try{cd={}.parseCSSColor=function(r){var n,o=r.replace(/ /g,"").toLowerCase();if(o in hc)return hc[o].slice();if(o[0]==="#")return o.length===4?(n=parseInt(o.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:o.length===7&&(n=parseInt(o.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var l=o.indexOf("("),h=o.indexOf(")");if(l!==-1&&h+1===o.length){var f=o.substr(0,l),m=o.substr(l+1,h-(l+1)).split(","),_=1;switch(f){case"rgba":if(m.length!==4)return null;_=ud(m.pop());case"rgb":return m.length!==3?null:[Bp(m[0]),Bp(m[1]),Bp(m[2]),_];case"hsla":if(m.length!==4)return null;_=ud(m.pop());case"hsl":if(m.length!==3)return null;var x=(parseFloat(m[0])%360+360)%360/360,w=ud(m[1]),E=ud(m[2]),I=E<=.5?E*(w+1):E+w-E*w,k=2*E-I;return[dc(255*jp(k,I,x+1/3)),dc(255*jp(k,I,x)),dc(255*jp(k,I,x-1/3)),_];default:return null}}return null}}catch{}class Ni{constructor(n,o,l,h=1){this.r=n,this.g=o,this.b=l,this.a=h}static parse(n){if(!n)return;if(n instanceof Ni)return n;if(typeof n!="string")return;const o=cd(n);return o?new Ni(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[n,o,l,h]=this.toArray();return`rgba(${Math.round(n)},${Math.round(o)},${Math.round(l)},${h})`}toArray(){const{r:n,g:o,b:l,a:h}=this;return h===0?[0,0,0,0]:[255*n/h,255*o/h,255*l/h,h]}toArray01(){const{r:n,g:o,b:l,a:h}=this;return h===0?[0,0,0,0]:[n/h,o/h,l/h,h]}toArray01Scaled(n){const{r:o,g:l,b:h,a:f}=this;return f===0?[0,0,0]:[o/f*n,l/f*n,h/f*n]}toArray01PremultipliedAlpha(){const{r:n,g:o,b:l,a:h}=this;return[n,o,l,h]}toArray01Linear(){const{r:n,g:o,b:l,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(n/h,2.2),Math.pow(o/h,2.2),Math.pow(l/h,2.2),h]}}Ni.black=new Ni(0,0,0,1),Ni.white=new Ni(1,1,1,1),Ni.transparent=new Ni(0,0,0,0),Ni.red=new Ni(1,0,0,1),Ni.blue=new Ni(0,0,1,1);var sr=Ni;class Vp{constructor(n,o,l){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class sl{constructor(n,o,l,h,f){this.text=n.normalize?n.normalize():n,this.image=o,this.scale=l,this.fontStack=h,this.textColor=f}}class Fi{constructor(n){this.sections=n}static fromString(n){return new Fi([new sl(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.namePrimary.length!==0)}static factory(n){return n instanceof Fi?n:Fi.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const o of this.sections){if(o.image){n.push(["image",o.image.namePrimary]);continue}n.push(o.text);const l={};o.fontStack&&(l["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(l["font-scale"]=o.scale),o.textColor&&(l["text-color"]=["rgba"].concat(o.textColor.toArray())),n.push(l)}return n}}class Mo{constructor(n){this.namePrimary=n.namePrimary,n.nameSecondary&&(this.nameSecondary=n.nameSecondary),this.available=n.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(n,o){return n?new Mo({namePrimary:n,nameSecondary:o,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ly(r,n,o,l){return typeof r=="number"&&r>=0&&r<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[r,n,o,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[r,n,o,l]:[r,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fc(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof sr||r instanceof Vp||r instanceof Fi||r instanceof Mo)return!0;if(Array.isArray(r)){for(const n of r)if(!fc(n))return!1;return!0}if(typeof r=="object"){for(const n in r)if(!fc(r[n]))return!1;return!0}return!1}function $r(r){if(r===null)return nl;if(typeof r=="string")return _n;if(typeof r=="boolean")return bn;if(typeof r=="number")return qe;if(r instanceof sr)return Co;if(r instanceof Vp)return rl;if(r instanceof Fi)return ma;if(r instanceof Mo)return Ru;if(Array.isArray(r)){const n=r.length;let o;for(const l of r){const h=$r(l);if(o){if(o===h)continue;o=pn;break}o=h}return zi(o||pn,n)}return uc}function Ou(r){const n=typeof r;return r===null?"":n==="string"||n==="number"||n==="boolean"?String(r):r instanceof sr||r instanceof Fi||r instanceof Mo?r.toString():JSON.stringify(r)}class Up{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!fc(n[1]))return o.error("invalid value");const l=n[1];let h=$r(l);const f=o.expectedType;return h.kind!=="array"||h.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(h=f),new Up(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof sr?["rgba"].concat(this.value.toArray()):this.value instanceof Fi?this.value.serialize():this.value}}var pc=Up,Or=class{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}};const $p={string:_n,number:qe,boolean:bn,object:uc};class Gp{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let l,h=1;const f=n[0];if(f==="array"){let _,x;if(n.length>2){const w=n[1];if(typeof w!="string"||!(w in $p)||w==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);_=$p[w],h++}else _=pn;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);x=n[2],h++}l=zi(_,x)}else l=$p[f];const m=[];for(;h<n.length;h++){const _=o.parse(n[h],h,pn);if(!_)return null;m.push(_)}return new Gp(l,m)}evaluate(n){for(let o=0;o<this.args.length;o++){const l=this.args[o].evaluate(n);if(!il(this.type,$r(l)))return l;if(o===this.args.length-1)throw new Or(`Expected value to be of type ${Wn(this.type)}, but found ${Wn($r(l))} instead.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,o=[n.kind];if(n.kind==="array"){const l=n.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){o.push(l.kind);const h=n.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(l=>l.serialize()))}}var Jo=Gp;class Du{constructor(n){this.type=ma,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const l=n[1];if(!Array.isArray(l)&&typeof l=="object")return o.error("First argument must be an image or text section.");const h=[];let f=!1;for(let m=1;m<=n.length-1;++m){const _=n[m];if(f&&typeof _=="object"&&!Array.isArray(_)){f=!1;let x=null;if(_["font-scale"]&&(x=o.parse(_["font-scale"],1,qe),!x))return null;let w=null;if(_["text-font"]&&(w=o.parse(_["text-font"],1,zi(_n)),!w))return null;let E=null;if(_["text-color"]&&(E=o.parse(_["text-color"],1,Co),!E))return null;const I=h[h.length-1];I.scale=x,I.font=w,I.textColor=E}else{const x=o.parse(n[m],1,pn);if(!x)return null;const w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:x,scale:null,font:null,textColor:null})}}return new Du(h)}evaluate(n){return new Fi(this.sections.map(o=>{const l=o.content.evaluate(n);return $r(l)===Ru?new sl("",l,null,null,null):new sl(Ou(l),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))}eachChild(n){for(const o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const o of this.sections){n.push(o.content.serialize());const l={};o.scale&&(l["font-scale"]=o.scale.serialize()),o.font&&(l["text-font"]=o.font.serialize()),o.textColor&&(l["text-color"]=o.textColor.serialize()),n.push(l)}return n}}class Lu{constructor(n,o){this.type=Ru,this.inputPrimary=n,this.inputSecondary=o}static parse(n,o){if(n.length<2)return o.error("Expected two or more arguments.");const l=o.parse(n[1],1,_n);if(!l)return o.error("No image name provided.");if(n.length===2)return new Lu(l);const h=o.parse(n[2],1,_n);return h?new Lu(l,h):o.error("Secondary image variant is not a string.")}evaluate(n){const o=Mo.fromString(this.inputPrimary.evaluate(n),this.inputSecondary?this.inputSecondary.evaluate(n):void 0);return o&&n.availableImages&&(o.available=n.availableImages.indexOf(o.namePrimary)>-1,o.nameSecondary&&o.available&&n.availableImages&&(o.available=n.availableImages.indexOf(o.nameSecondary)>-1)),o}eachChild(n){n(this.inputPrimary),this.inputSecondary&&n(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Cn(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}const ow={"to-boolean":bn,"to-color":Co,"to-number":qe,"to-string":_n};class hd{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const l=n[0],h=[];let f=nl;if(l==="to-array"){if(!Array.isArray(n[1]))return null;const m=n[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);f=zi(o.expectedType.itemType,m)}else{if(!(m>0&&fc(n[1][0])))return null;f=zi($r(n[1][0]),m)}for(let _=0;_<m;_++){const x=n[1][_];let w;if(Cn(x)==="array")w=o.parse(x,void 0,f.itemType);else{const E=Cn(x);if(E!==f.itemType.kind)return o.error(`Expected ${f.itemType.kind} but found ${E}.`);w=o.registry.literal.parse(["literal",x===void 0?null:x],o)}if(!w)return null;h.push(w)}}else{if((l==="to-boolean"||l==="to-string")&&n.length!==2)return o.error("Expected one argument.");f=ow[l];for(let m=1;m<n.length;m++){const _=o.parse(n[m],m,pn);if(!_)return null;h.push(_)}}return new hd(f,h)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let o,l;for(const h of this.args){if(o=h.evaluate(n),l=null,o instanceof sr)return o;if(typeof o=="string"){const f=n.parseColor(o);if(f)return f}else if(Array.isArray(o)&&(l=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Ly(o[0],o[1],o[2],o[3]),!l))return new sr(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Or(l||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const l of this.args){if(o=l.evaluate(n),o===null)return 0;const h=Number(o);if(!isNaN(h))return h}throw new Or(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?Fi.fromString(Ou(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?Mo.fromString(Ou(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(o=>o.evaluate(n)):Ou(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Du([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Lu(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{n.push(o.serialize())}),n}}var ga=hd;const zy=["Unknown","Point","LineString","Polygon"];var Wp=class{constructor(r,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?zy[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:o,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*n-r[0])+this.featureDistanceData.bearing[1]*(l*n-r[1])}return 0}parseColor(r){let n=this._parseColorCache[r];return n||(n=this._parseColorCache[r]=sr.parse(r)),n}getConfig(r){return this.options?this.options.get(r):null}};class _a{constructor(n,o,l,h,f){this.name=n,this.type=o,this._evaluate=l,this.args=h,this._overloadIndex=f}evaluate(n){if(!this._evaluate){const o=_a.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,o){const l=n[0],h=_a.definitions[l];if(!h)return o.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,_=[];let x=null,w=-1;for(const[E,I]of m){if(Array.isArray(E)&&E.length!==n.length-1)continue;_.push(E),w++,x=new sm(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const k=[];let C=!1;for(let R=1;R<n.length;R++){const L=n[R],N=Array.isArray(E)?E[R-1]:E.type,j=x.parse(L,1+k.length,N);if(!j){C=!0;break}k.push(j)}if(!C)if(Array.isArray(E)&&E.length!==k.length)x.error(`Expected ${E.length} arguments, but found ${k.length} instead.`);else{for(let R=0;R<k.length;R++){const L=Array.isArray(E)?E[R]:E.type,N=k[R];x.concat(R+1).checkSubtype(L,N.type)}if(x.errors.length===0)return new _a(l,f,I,k,w)}}if(_.length===1)o.errors.push(...x.errors);else{const E=(_.length?_:m.map(([k])=>k)).map(Ny).join(" | "),I=[];for(let k=1;k<n.length;k++){const C=o.parse(n[k],1+I.length);if(!C)return null;I.push(Wn(C.type))}o.error(`Expected arguments of type ${E}, but found (${I.join(", ")}) instead.`)}return null}static register(n,o){_a.definitions=o;for(const l in o)n[l]=_a}}function Ny(r){return Array.isArray(r)?`(${r.map(Wn).join(", ")})`:`(${Wn(r.type)}...)`}var Qo=_a;class zu{constructor(n,o,l){this.type=rl,this.locale=l,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");const l=n[1];if(typeof l!="object"||Array.isArray(l))return o.error("Collator options argument must be an object.");const h=o.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,bn);if(!h)return null;const f=o.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,bn);if(!f)return null;let m=null;return l.locale&&(m=o.parse(l.locale,1,_n),!m)?null:new zu(h,f,m)}evaluate(n){return new Vp(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}var qp={exports:{}};qp.exports=function(){function r(l,h,f,m,_){for(;m>f;){if(m-f>600){var x=m-f+1,w=h-f+1,E=Math.log(x),I=.5*Math.exp(2*E/3),k=.5*Math.sqrt(E*I*(x-I)/x)*(w-x/2<0?-1:1);r(l,h,Math.max(f,Math.floor(h-w*I/x+k)),Math.min(m,Math.floor(h+(x-w)*I/x+k)),_)}var C=l[h],R=f,L=m;for(n(l,f,h),_(l[m],C)>0&&n(l,f,m);R<L;){for(n(l,R,L),R++,L--;_(l[R],C)<0;)R++;for(;_(l[L],C)>0;)L--}_(l[f],C)===0?n(l,f,L):n(l,++L,m),L<=h&&(f=L+1),h<=L&&(m=L-1)}}function n(l,h,f){var m=l[h];l[h]=l[f],l[f]=m}function o(l,h){return l<h?-1:l>h?1:0}return function(l,h,f,m,_){r(l,h,f||0,m||l.length-1,_||o)}}();var Fy=fe(qp.exports);function dd(r){let n=0;for(let o,l,h=0,f=r.length,m=f-1;h<f;m=h++)o=r[h],l=r[m],n+=(l.x-o.x)*(o.y+l.y);return n}function ya(r,n){r[0]=Math.min(r[0],n[0]),r[1]=Math.min(r[1],n[1]),r[2]=Math.max(r[2],n[0]),r[3]=Math.max(r[3],n[1])}function va(r,n){return!(r[0]<=n[0]||r[2]>=n[2]||r[1]<=n[1]||r[3]>=n[3])}function By(r,n,o){const l=r[0]-n[0],h=r[1]-n[1],f=r[0]-o[0],m=r[1]-o[1];return l*m-f*h==0&&l*f<=0&&h*m<=0}function al(r,n,o=!1){let l=!1;for(let _=0,x=n.length;_<x;_++){const w=n[_];for(let E=0,I=w.length,k=I-1;E<I;k=E++){const C=w[k],R=w[E];if(By(r,C,R))return o;(f=C)[1]>(h=r)[1]!=(m=R)[1]>h[1]&&h[0]<(m[0]-f[0])*(h[1]-f[1])/(m[1]-f[1])+f[0]&&(l=!l)}}var h,f,m;return l}function Hp(r,n,o,l){const h=l[0]-o[0],f=l[1]-o[1],m=(r[0]-o[0])*f-h*(r[1]-o[1]),_=(n[0]-o[0])*f-h*(n[1]-o[1]);return m>0&&_<0||m<0&&_>0}function Gs(r,n,o,l){return(h=[l[0]-o[0],l[1]-o[1]])[0]*(f=[n[0]-r[0],n[1]-r[1]])[1]-h[1]*f[0]!=0&&!(!Hp(r,n,o,l)||!Hp(o,l,r,n));var h,f}const dn=8192;function sw(r,n){const o=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,n.z);return[Math.round(o*h*dn),Math.round(l*h*dn)]}function aw(r,n){for(let o=0;o<n.length;o++)if(al(r,n[o]))return!0;return!1}function lw(r,n,o){for(const l of o)for(let h=0,f=l.length,m=f-1;h<f;m=h++)if(Gs(r,n,l[m],l[h]))return!0;return!1}function Zp(r,n){for(let o=0;o<r.length;++o)if(!al(r[o],n))return!1;for(let o=0;o<r.length-1;++o)if(lw(r[o],r[o+1],n))return!1;return!0}function cw(r,n){for(let o=0;o<n.length;o++)if(Zp(r,n[o]))return!0;return!1}function fd(r,n,o){const l=[];for(let h=0;h<r.length;h++){const f=[];for(let m=0;m<r[h].length;m++){const _=sw(r[h][m],o);ya(n,_),f.push(_)}l.push(f)}return l}function Xp(r,n,o){const l=[];for(let h=0;h<r.length;h++){const f=fd(r[h],n,o);l.push(f)}return l}function Yp(r,n,o,l){if(r[0]<o[0]||r[0]>o[2]){const h=.5*l;let f=r[0]-o[0]>h?-l:o[0]-r[0]>h?l:0;f===0&&(f=r[0]-o[2]>h?-l:o[2]-r[0]>h?l:0),r[0]+=f}ya(n,r)}function ll(r,n,o,l){const h=Math.pow(2,l.z)*dn,f=[l.x*dn,l.y*dn],m=[];if(!r)return m;for(const _ of r)for(const x of _){const w=[x.x+f[0],x.y+f[1]];Yp(w,n,o,h),m.push(w)}return m}function Kp(r,n,o,l){const h=Math.pow(2,l.z)*dn,f=[l.x*dn,l.y*dn],m=[];if(!r)return m;for(const x of r){const w=[];for(const E of x){const I=[E.x+f[0],E.y+f[1]];ya(n,I),w.push(I)}m.push(w)}if(n[2]-n[0]<=h/2){(_=n)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of m)for(const w of x)Yp(w,n,o,h)}var _;return m}class xs{constructor(n,o){this.type=bn,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(fc(n[1])){const l=n[1];if(l.type==="FeatureCollection")for(let h=0;h<l.features.length;++h){const f=l.features[h].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new xs(l,l.features[h].geometry)}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new xs(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new xs(l,l)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=o.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const _=fd(l.coordinates,f,m),x=ll(o.geometry(),h,f,m);if(!va(h,f))return!1;for(const w of x)if(!al(w,_))return!1}if(l.type==="MultiPolygon"){const _=Xp(l.coordinates,f,m),x=ll(o.geometry(),h,f,m);if(!va(h,f))return!1;for(const w of x)if(!aw(w,_))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=o.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const _=fd(l.coordinates,f,m),x=Kp(o.geometry(),h,f,m);if(!va(h,f))return!1;for(const w of x)if(!Zp(w,_))return!1}if(l.type==="MultiPolygon"){const _=Xp(l.coordinates,f,m),x=Kp(o.geometry(),h,f,m);if(!va(h,f))return!1;for(const w of x)if(!cw(w,_))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var pd=xs,Jp={exports:{}};Jp.exports=function(){var r={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},n=1/298.257223563,o=n*(2-n),l=Math.PI/180,h=function(w,E){if(w===void 0)throw new Error("No latitude given.");if(E&&!r[E])throw new Error("Unknown unit "+E+". Use one of: "+Object.keys(r).join(", "));var I=6378.137*l*(E?r[E]:1),k=Math.cos(w*l),C=1/(1-o*(1-k*k)),R=Math.sqrt(C);this.kx=I*R*k,this.ky=I*R*C*(1-o)},f={units:{configurable:!0}};function m(w,E){return w[0]===E[0]&&w[1]===E[1]}function _(w,E,I){var k=x(E[0]-w[0]);return[w[0]+k*I,w[1]+(E[1]-w[1])*I]}function x(w){for(;w<-180;)w+=360;for(;w>180;)w-=360;return w}return h.fromTile=function(w,E,I){var k=Math.PI*(1-2*(w+.5)/Math.pow(2,E)),C=Math.atan(.5*(Math.exp(k)-Math.exp(-k)))/l;return new h(C,I)},f.units.get=function(){return r},h.prototype.distance=function(w,E){var I=x(w[0]-E[0])*this.kx,k=(w[1]-E[1])*this.ky;return Math.sqrt(I*I+k*k)},h.prototype.bearing=function(w,E){var I=x(E[0]-w[0])*this.kx;return Math.atan2(I,(E[1]-w[1])*this.ky)/l},h.prototype.destination=function(w,E,I){var k=I*l;return this.offset(w,Math.sin(k)*E,Math.cos(k)*E)},h.prototype.offset=function(w,E,I){return[w[0]+E/this.kx,w[1]+I/this.ky]},h.prototype.lineDistance=function(w){for(var E=0,I=0;I<w.length-1;I++)E+=this.distance(w[I],w[I+1]);return E},h.prototype.area=function(w){for(var E=0,I=0;I<w.length;I++)for(var k=w[I],C=0,R=k.length,L=R-1;C<R;L=C++)E+=x(k[C][0]-k[L][0])*(k[C][1]+k[L][1])*(I?-1:1);return Math.abs(E)/2*this.kx*this.ky},h.prototype.along=function(w,E){var I=0;if(E<=0)return w[0];for(var k=0;k<w.length-1;k++){var C=w[k],R=w[k+1],L=this.distance(C,R);if((I+=L)>E)return _(C,R,(E-(I-L))/L)}return w[w.length-1]},h.prototype.pointToSegmentDistance=function(w,E,I){var k=E[0],C=E[1],R=x(I[0]-k)*this.kx,L=(I[1]-C)*this.ky,N=0;return R===0&&L===0||((N=(x(w[0]-k)*this.kx*R+(w[1]-C)*this.ky*L)/(R*R+L*L))>1?(k=I[0],C=I[1]):N>0&&(k+=R/this.kx*N,C+=L/this.ky*N)),R=x(w[0]-k)*this.kx,L=(w[1]-C)*this.ky,Math.sqrt(R*R+L*L)},h.prototype.pointOnLine=function(w,E){for(var I,k,C,R,L=1/0,N=0;N<w.length-1;N++){var j=w[N][0],Z=w[N][1],X=x(w[N+1][0]-j)*this.kx,J=(w[N+1][1]-Z)*this.ky,te=0;X===0&&J===0||((te=(x(E[0]-j)*this.kx*X+(E[1]-Z)*this.ky*J)/(X*X+J*J))>1?(j=w[N+1][0],Z=w[N+1][1]):te>0&&(j+=X/this.kx*te,Z+=J/this.ky*te));var re=(X=x(E[0]-j)*this.kx)*X+(J=(E[1]-Z)*this.ky)*J;re<L&&(L=re,I=j,k=Z,C=N,R=te)}return{point:[I,k],index:C,t:Math.max(0,Math.min(1,R))}},h.prototype.lineSlice=function(w,E,I){var k=this.pointOnLine(I,w),C=this.pointOnLine(I,E);if(k.index>C.index||k.index===C.index&&k.t>C.t){var R=k;k=C,C=R}var L=[k.point],N=k.index+1,j=C.index;!m(I[N],L[0])&&N<=j&&L.push(I[N]);for(var Z=N+1;Z<=j;Z++)L.push(I[Z]);return m(I[j],C.point)||L.push(C.point),L},h.prototype.lineSliceAlong=function(w,E,I){for(var k=0,C=[],R=0;R<I.length-1;R++){var L=I[R],N=I[R+1],j=this.distance(L,N);if((k+=j)>w&&C.length===0&&C.push(_(L,N,(w-(k-j))/j)),k>=E)return C.push(_(L,N,(E-(k-j))/j)),C;k>w&&C.push(N)}return C},h.prototype.bufferPoint=function(w,E){var I=E/this.ky,k=E/this.kx;return[w[0]-k,w[1]-I,w[0]+k,w[1]+I]},h.prototype.bufferBBox=function(w,E){var I=E/this.ky,k=E/this.kx;return[w[0]-k,w[1]-I,w[2]+k,w[3]+I]},h.prototype.insideBBox=function(w,E){return x(w[0]-E[0])>=0&&x(w[0]-E[2])<=0&&w[1]>=E[1]&&w[1]<=E[3]},Object.defineProperties(h,f),h}();var Qp=fe(Jp.exports),md={exports:{}};md.exports=function(){var r=function(o,l){if(o===void 0&&(o=[]),l===void 0&&(l=n),this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(var h=(this.length>>1)-1;h>=0;h--)this._down(h)};function n(o,l){return o<l?-1:o>l?1:0}return r.prototype.push=function(o){this.data.push(o),this.length++,this._up(this.length-1)},r.prototype.pop=function(){if(this.length!==0){var o=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),o}},r.prototype.peek=function(){return this.data[0]},r.prototype._up=function(o){for(var l=this.data,h=this.compare,f=l[o];o>0;){var m=o-1>>1,_=l[m];if(h(f,_)>=0)break;l[o]=_,o=m}l[o]=f},r.prototype._down=function(o){for(var l=this.data,h=this.compare,f=this.length>>1,m=l[o];o<f;){var _=1+(o<<1),x=l[_],w=_+1;if(w<this.length&&h(l[w],x)<0&&(_=w,x=l[w]),h(x,m)>=0)break;l[o]=x,o=_}l[o]=m},r}();var gd=fe(md.exports),at=8192;function jy(r,n){return n.dist-r.dist}const _d=100,em=50;function Vy(r){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==r.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!==r[o])return!1;return!0}function yd(r){return r[1]-r[0]+1}function Ws(r,n){const o=r[1]>=r[0]&&r[1]<n;return o||console.warn("Distance Expression: Index is out of range"),o}function vd(r,n){if(r[0]>r[1])return[null,null];const o=yd(r);if(n){if(o===2)return[r,null];const l=Math.floor(o/2);return[[r[0],r[0]+l],[r[0]+l,r[1]]]}{if(o===1)return[r,null];const l=Math.floor(o/2)-1;return[[r[0],r[0]+l],[r[0]+l+1,r[1]]]}}function xa(r,n){const o=[1/0,1/0,-1/0,-1/0];if(!Ws(n,r.length))return o;for(let l=n[0];l<=n[1];++l)ya(o,r[l]);return o}function xd(r){const n=[1/0,1/0,-1/0,-1/0];for(let o=0;o<r.length;++o)for(let l=0;l<r[o].length;++l)ya(n,r[o][l]);return n}function cl(r,n,o){if(Vy(r)||Vy(n))return NaN;let l=0,h=0;return r[2]<n[0]&&(l=n[0]-r[2]),r[0]>n[2]&&(l=r[0]-n[2]),r[1]>n[3]&&(h=r[1]-n[3]),r[3]<n[1]&&(h=n[1]-r[3]),o.distance([0,0],[l,h])}function tm(r,n){const o=Math.pow(2,n.z);return[(h=(r.x/at+n.x)/o,360*h-180),(l=(r.y/at+n.y)/o,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,h}function uw(r,n){const o=[];for(let l=0;l<r.length;++l)o.push(tm(r[l],n));return o}function nm(r,n,o){const l=o.pointOnLine(n,r).point;return o.distance(r,l)}function rm(r,n,o,l,h){const f=o.slice(l[0],l[1]+1);let m=1/0;for(let _=n[0];_<=n[1];++_)if((m=Math.min(m,nm(r[_],f,h)))===0)return 0;return m}function im(r,n,o,l,h){const f=Math.min(h.pointToSegmentDistance(r,o,l),h.pointToSegmentDistance(n,o,l)),m=Math.min(h.pointToSegmentDistance(o,r,n),h.pointToSegmentDistance(l,r,n));return Math.min(f,m)}function hw(r,n,o,l,h){if(!Ws(n,r.length)||!Ws(l,o.length))return NaN;let f=1/0;for(let m=n[0];m<n[1];++m)for(let _=l[0];_<l[1];++_){if(Gs(r[m],r[m+1],o[_],o[_+1]))return 0;f=Math.min(f,im(r[m],r[m+1],o[_],o[_+1],h))}return f}function dw(r,n,o,l,h){if(!Ws(n,r.length)||!Ws(l,o.length))return NaN;let f=1/0;for(let m=n[0];m<=n[1];++m)for(let _=l[0];_<=l[1];++_)if((f=Math.min(f,h.distance(r[m],o[_])))===0)return f;return f}function Uy(r,n,o){if(al(r,n,!0))return 0;let l=1/0;for(const h of n){const f=h.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[f-1]&&(l=Math.min(l,o.pointToSegmentDistance(r,h[f-1],h[0])))===0||(l=Math.min(l,nm(r,h,o)))===0)return l}return l}function fw(r,n,o,l){if(!Ws(n,r.length))return NaN;for(let f=n[0];f<=n[1];++f)if(al(r[f],o,!0))return 0;let h=1/0;for(let f=n[0];f<n[1];++f)for(const m of o)for(let _=0,x=m.length,w=x-1;_<x;w=_++){if(Gs(r[f],r[f+1],m[w],m[_]))return 0;h=Math.min(h,im(r[f],r[f+1],m[w],m[_],l))}return h}function $y(r,n){for(const o of r)for(let l=0;l<=o.length-1;++l)if(al(o[l],n,!0))return!0;return!1}function Gy(r,n,o,l=1/0){const h=xd(r),f=xd(n);if(l!==1/0&&cl(h,f,o)>=l)return l;if(va(h,f)){if($y(r,n))return 0}else if($y(n,r))return 0;let m=l;for(const _ of r)for(let x=0,w=_.length,E=w-1;x<w;E=x++)for(const I of n)for(let k=0,C=I.length,R=C-1;k<C;R=k++){if(Gs(_[E],_[x],I[R],I[k]))return 0;m=Math.min(m,im(_[E],_[x],I[R],I[k],o))}return m}function bd(r,n,o,l,h,f,m){if(f===null||m===null)return;const _=cl(xa(l,f),xa(h,m),o);_<n&&r.push({dist:_,range1:f,range2:m})}function pw(r,n,o,l,h=1/0){let f=Math.min(l.distance(r[0],o[0][0]),h);if(f===0)return f;const m=new gd([{dist:0,range1:[0,r.length-1],range2:[0,0]}],jy),_=n?em:_d,x=xd(o);for(;m.length;){const w=m.pop();if(w.dist>=f)continue;const E=w.range1;if(yd(E)<=_){if(!Ws(E,r.length))return NaN;if(n){const I=fw(r,E,o,l);if((f=Math.min(f,I))===0)return f}else for(let I=E[0];I<=E[1];++I){const k=Uy(r[I],o,l);if((f=Math.min(f,k))===0)return f}}else{const I=vd(E,n);if(I[0]!==null){const k=cl(xa(r,I[0]),x,l);k<f&&m.push({dist:k,range1:I[0],range2:[0,0]})}if(I[1]!==null){const k=cl(xa(r,I[1]),x,l);k<f&&m.push({dist:k,range1:I[1],range2:[0,0]})}}}return f}function Wy(r,n,o,l,h,f=1/0){let m=Math.min(f,h.distance(r[0],o[0]));if(m===0)return m;const _=new gd([{dist:0,range1:[0,r.length-1],range2:[0,o.length-1]}],jy),x=n?em:_d,w=l?em:_d;for(;_.length;){const E=_.pop();if(E.dist>=m)continue;const I=E.range1,k=E.range2;if(yd(I)<=x&&yd(k)<=w){if(!Ws(I,r.length)||!Ws(k,o.length))return NaN;if(n&&l?m=Math.min(m,hw(r,I,o,k,h)):n||l?n&&!l?m=Math.min(m,rm(o,k,r,I,h)):!n&&l&&(m=Math.min(m,rm(r,I,o,k,h))):m=Math.min(m,dw(r,I,o,k,h)),m===0)return m}else{const C=vd(I,n),R=vd(k,l);bd(_,m,h,r,o,C[0],R[0]),bd(_,m,h,r,o,C[0],R[1]),bd(_,m,h,r,o,C[1],R[0]),bd(_,m,h,r,o,C[1],R[1])}}return m}function wd(r,n,o,l,h=1/0){let f=h;const m=xa(r,[0,r.length-1]);for(const _ of o)if(!(f!==1/0&&cl(m,xa(_,[0,_.length-1]),l)>=f)&&(f=Math.min(f,Wy(r,n,_,!0,l,f)),f===0))return f;return f}function Nu(r,n,o,l,h=1/0){let f=h;const m=xa(r,[0,r.length-1]);for(const _ of o){if(f!==1/0&&cl(m,xd(_),l)>=f)continue;const x=pw(r,n,_,l,f);if(isNaN(x))return x;if((f=Math.min(f,x))===0)return f}return f}function Td(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class Fu{constructor(n,o){this.type=qe,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(fc(n[1])){const l=n[1];if(l.type==="FeatureCollection"){for(let h=0;h<l.features.length;++h)if(Td(l.features[h].geometry.type))return new Fu(l,l.features[h].geometry)}else if(l.type==="Feature"){if(Td(l.geometry.type))return new Fu(l,l.geometry)}else if(Td(l.type))return new Fu(l,l)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const o=n.geometry(),l=n.canonicalID();if(o!=null&&l!=null){if(n.geometryType()==="Point")return function(h,f,m){const _=[];for(const w of h)for(const E of w)_.push(tm(E,f));const x=new Qp(_[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Wy(_,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",x):m.type==="MultiLineString"?wd(_,!1,m.coordinates,x):m.type==="Polygon"||m.type==="MultiPolygon"?Nu(_,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,x):null}(o,l,this.geometries);if(n.geometryType()==="LineString")return function(h,f,m){const _=[];for(const w of h){const E=[];for(const I of w)E.push(tm(I,f));_.push(E)}const x=new Qp(_[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return wd(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",_,x);if(m.type==="MultiLineString"){let w=1/0;for(let E=0;E<m.coordinates.length;E++){const I=wd(m.coordinates[E],!0,_,x,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}if(m.type==="Polygon"||m.type==="MultiPolygon"){let w=1/0;for(let E=0;E<_.length;E++){const I=Nu(_[E],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,x,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}return null}(o,l,this.geometries);if(n.geometryType()==="Polygon")return function(h,f,m){const _=[];for(const w of function(E,I){const k=E.length;if(k<=1)return[E];const C=[];let R,L;for(let N=0;N<k;N++){const j=dd(E[N]);j!==0&&(E[N].area=Math.abs(j),L===void 0&&(L=j<0),L===j<0?(R&&C.push(R),R=[E[N]]):R.push(E[N]))}return R&&C.push(R),C}(h)){const E=[];for(let I=0;I<w.length;++I)E.push(uw(w[I],f));_.push(E)}const x=new Qp(_[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Nu(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",_,x);if(m.type==="MultiLineString"){let w=1/0;for(let E=0;E<m.coordinates.length;E++){const I=Nu(m.coordinates[E],!0,_,x,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}return m.type==="Polygon"||m.type==="MultiPolygon"?function(w,E,I){let k=1/0;for(const C of w)for(const R of E){const L=Gy(C,R,I,k);if(isNaN(L))return L;if((k=Math.min(k,L))===0)return k}return k}(m.type==="Polygon"?[m.coordinates]:m.coordinates,_,x):null}(o,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var om=Fu;function mc(r){if(r instanceof Qo&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof pd||r instanceof om)return!1;let n=!0;return r.eachChild(o=>{n&&!mc(o)&&(n=!1)}),n}function ui(r){if(r instanceof Qo&&r.name==="feature-state")return!1;let n=!0;return r.eachChild(o=>{n&&!ui(o)&&(n=!1)}),n}function Bu(r){if(r instanceof Qo&&r.name==="config")return!1;let n=!0;return r.eachChild(o=>{n&&!Bu(o)&&(n=!1)}),n}function ul(r,n){if(r instanceof Qo&&n.indexOf(r.name)>=0)return!1;let o=!0;return r.eachChild(l=>{o&&!ul(l,n)&&(o=!1)}),o}class Ed{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const l=n[1];return o.scope.has(l)?new Ed(l,o.scope.get(l)):o.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var qy=Ed;class gc{constructor(n,o=[],l,h=new rw,f=[],m,_){this.registry=n,this.path=o,this.key=o.map(x=>`[${x}]`).join(""),this.scope=h,this.errors=f,this.expectedType=l,this._scope=m,this.options=_}parse(n,o,l,h,f={}){return o||l?this.concat(o,l,h)._parse(n,f):this._parse(n,f)}_parse(n,o){function l(h,f,m){return m==="assert"?new Jo(f,[h]):m==="coerce"?new ga(f,[h]):h}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(h){let f=h.parse(n,this);if(!f)return null;if(this.expectedType){const m=this.expectedType,_=f.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||_.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(m,_))return null}else f=l(f,m,o.typeAnnotation||"coerce");else f=l(f,m,o.typeAnnotation||"assert")}if(!(f instanceof pc)&&f.type.kind!=="resolvedImage"&&Sd(f)){const m=new Wp(this._scope,this.options);try{f=new pc(f.type,f.evaluate(m))}catch(_){return this.error(_.message),null}}return f}return ga.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,l){const h=typeof n=="number"?this.path.concat(n):this.path,f=l?this.scope.concat(l):this.scope;return new gc(this.registry,h,o||null,f,this.errors,this._scope,this.options)}error(n,...o){const l=`${this.key}${o.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ko(l,n))}checkSubtype(n,o){const l=il(n,o);return l&&this.error(l),l}}var sm=gc;function Sd(r){if(r instanceof qy)return Sd(r.boundExpression);if(r instanceof Qo&&r.name==="error"||r instanceof Qo&&r.name==="config"||r instanceof zu||r instanceof pd||r instanceof om)return!1;const n=r instanceof ga||r instanceof Jo;let o=!0;return r.eachChild(l=>{o=n?o&&Sd(l):o&&l instanceof pc}),!!o&&mc(r)&&ul(r,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function Id(r,n){const o=r.length-1;let l,h,f=0,m=o,_=0;for(;f<=m;)if(_=Math.floor((f+m)/2),l=r[_],h=r[_+1],l<=n){if(_===o||n<h)return _;f=_+1}else{if(!(l>n))throw new Or("Input is not a number.");m=_-1}return 0}class am{constructor(n,o,l){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(const[h,f]of l)this.labels.push(h),this.outputs.push(f)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");const l=o.parse(n[1],1,qe);if(!l)return null;const h=[];let f=null;o.expectedType&&o.expectedType.kind!=="value"&&(f=o.expectedType);for(let m=1;m<n.length;m+=2){const _=m===1?-1/0:n[m],x=n[m+1],w=m,E=m+1;if(typeof _!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(h.length&&h[h.length-1][0]>=_)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const I=o.parse(x,E,f);if(!I)return null;f=f||I.type,h.push([_,I])}return new am(f,l,h)}evaluate(n){const o=this.labels,l=this.outputs;if(o.length===1)return l[0].evaluate(n);const h=this.input.evaluate(n);if(h<=o[0])return l[0].evaluate(n);const f=o.length;return h>=o[f-1]?l[f-1].evaluate(n):l[Id(o,h)].evaluate(n)}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n}}var lm=am;function ln(r,n,o){return r*(1-o)+n*o}function Ad(r,n,o){return r.map((l,h)=>ln(l,n[h],o))}var ju=Object.freeze({__proto__:null,array:Ad,color:function(r,n,o){return new sr(ln(r.r,n.r,o),ln(r.g,n.g,o),ln(r.b,n.b,o),ln(r.a,n.a,o))},number:ln});const Vu=.95047,hl=1.08883,Hy=4/29,_c=6/29,Zy=3*_c*_c,mw=_c*_c*_c,gw=Math.PI/180,_w=180/Math.PI;function cm(r){return r>mw?Math.pow(r,1/3):r/Zy+Hy}function um(r){return r>_c?r*r*r:Zy*(r-Hy)}function hm(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function dm(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Xy(r){const n=dm(r.r),o=dm(r.g),l=dm(r.b),h=cm((.4124564*n+.3575761*o+.1804375*l)/Vu),f=cm((.2126729*n+.7151522*o+.072175*l)/1);return{l:116*f-16,a:500*(h-f),b:200*(f-cm((.0193339*n+.119192*o+.9503041*l)/hl)),alpha:r.a}}function dl(r){let n=(r.l+16)/116,o=isNaN(r.a)?n:n+r.a/500,l=isNaN(r.b)?n:n-r.b/200;return n=1*um(n),o=Vu*um(o),l=hl*um(l),new sr(hm(3.2404542*o-1.5371385*n-.4985314*l),hm(-.969266*o+1.8760108*n+.041556*l),hm(.0556434*o-.2040259*n+1.0572252*l),r.alpha)}function Yy(r,n,o){const l=n-r;return r+o*(l>180||l<-180?l-360*Math.round(l/360):l)}const yc={forward:Xy,reverse:dl,interpolate:function(r,n,o){return{l:ln(r.l,n.l,o),a:ln(r.a,n.a,o),b:ln(r.b,n.b,o),alpha:ln(r.alpha,n.alpha,o)}}},ba={forward:function(r){const{l:n,a:o,b:l}=Xy(r),h=Math.atan2(l,o)*_w;return{h:h<0?h+360:h,c:Math.sqrt(o*o+l*l),l:n,alpha:r.a}},reverse:function(r){const n=r.h*gw,o=r.c;return dl({l:r.l,a:Math.cos(n)*o,b:Math.sin(n)*o,alpha:r.alpha})},interpolate:function(r,n,o){return{h:Yy(r.h,n.h,o),c:ln(r.c,n.c,o),l:ln(r.l,n.l,o),alpha:ln(r.alpha,n.alpha,o)}}};var Ky=Object.freeze({__proto__:null,hcl:ba,lab:yc});class Pd{constructor(n,o,l,h,f){this.type=n,this.operator=o,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[m,_]of f)this.labels.push(m),this.outputs.push(_)}static interpolationFactor(n,o,l,h){let f=0;if(n.name==="exponential")f=bs(o,n.base,l,h);else if(n.name==="linear")f=bs(o,1,l,h);else if(n.name==="cubic-bezier"){const m=n.controlPoints;f=new gt(m[0],m[1],m[2],m[3]).solve(bs(o,1,l,h))}return f}static parse(n,o){let[l,h,f,...m]=n;if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const w=h[1];if(typeof w!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:w}}else{if(h[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const w=h.slice(1);if(w.length!==4||w.some(E=>typeof E!="number"||E<0||E>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:w}}}if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(f=o.parse(f,2,qe),!f)return null;const _=[];let x=null;l==="interpolate-hcl"||l==="interpolate-lab"?x=Co:o.expectedType&&o.expectedType.kind!=="value"&&(x=o.expectedType);for(let w=0;w<m.length;w+=2){const E=m[w],I=m[w+1],k=w+3,C=w+4;if(typeof E!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(_.length&&_[_.length-1][0]>=E)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const R=o.parse(I,C,x);if(!R)return null;x=x||R.type,_.push([E,R])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new Pd(x,l,h,f,_):o.error(`Type ${Wn(x)} is not interpolatable.`)}evaluate(n){const o=this.labels,l=this.outputs;if(o.length===1)return l[0].evaluate(n);const h=this.input.evaluate(n);if(h<=o[0])return l[0].evaluate(n);const f=o.length;if(h>=o[f-1])return l[f-1].evaluate(n);const m=Id(o,h),_=Pd.interpolationFactor(this.interpolation,h,o[m],o[m+1]),x=l[m].evaluate(n),w=l[m+1].evaluate(n);return this.operator==="interpolate"?ju[this.type.kind.toLowerCase()](x,w,_):this.operator==="interpolate-hcl"?ba.reverse(ba.interpolate(ba.forward(x),ba.forward(w),_)):yc.reverse(yc.interpolate(yc.forward(x),yc.forward(w),_))}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,n,this.input.serialize()];for(let l=0;l<this.labels.length;l++)o.push(this.labels[l],this.outputs[l].serialize());return o}}function bs(r,n,o,l){const h=l-o,f=r-o;return h===0?0:n===1?f/h:(Math.pow(n,f)-1)/(Math.pow(n,h)-1)}var es=Pd;class wa{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expectected at least one argument.");let l=null;const h=o.expectedType;h&&h.kind!=="value"&&(l=h);const f=[];for(const _ of n.slice(1)){const x=o.parse(_,1+f.length,l,void 0,{typeAnnotation:"omit"});if(!x)return null;l=l||x.type,f.push(x)}const m=h&&f.some(_=>il(h,_.type));return new wa(m?pn:l,f)}evaluate(n){let o,l=null,h=0;for(const f of this.args){if(h++,l=f.evaluate(n),l&&l instanceof Mo&&!l.available&&(o||(o=l),l=null,h===this.args.length))return o;if(l!==null)break}return l}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(o=>{n.push(o.serialize())}),n}}var Jy=wa;class fm{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const l=[];for(let f=1;f<n.length-1;f+=2){const m=n[f];if(typeof m!="string")return o.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return o.error("Variable names must contain only alphanumeric characters or '_'.",f);const _=o.parse(n[f+1],f+1);if(!_)return null;l.push([m,_])}const h=o.parse(n[n.length-1],n.length-1,o.expectedType,l);return h?new fm(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[o,l]of this.bindings)n.push(o,l.serialize());return n.push(this.result.serialize()),n}}var Qy=fm;class pm{constructor(n,o,l){this.type=n,this.index=o,this.input=l}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const l=o.parse(n[1],1,qe),h=o.parse(n[2],2,zi(o.expectedType||pn));return l&&h?new pm(h.type.itemType,l,h):null}evaluate(n){const o=this.index.evaluate(n),l=this.input.evaluate(n);if(o<0)throw new Or(`Array index out of bounds: ${o} < 0.`);if(o>=l.length)throw new Or(`Array index out of bounds: ${o} > ${l.length-1}.`);if(o!==Math.floor(o))throw new Or(`Array index must be an integer, but found ${o} instead.`);return l[o]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var yw=pm;class kd{constructor(n,o){this.type=bn,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const l=o.parse(n[1],1,pn),h=o.parse(n[2],2,pn);return l&&h?Fp(l.type,[bn,_n,qe,nl,pn])?new kd(l,h):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(l.type)} instead`):null}evaluate(n){const o=this.needle.evaluate(n),l=this.haystack.evaluate(n);if(l==null)return!1;if(!ol(o,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${Wn($r(o))} instead.`);if(!ol(l,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${Wn($r(l))} instead.`);return l.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var mm=kd;class fl{constructor(n,o,l){this.type=qe,this.needle=n,this.haystack=o,this.fromIndex=l}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const l=o.parse(n[1],1,pn),h=o.parse(n[2],2,pn);if(!l||!h)return null;if(!Fp(l.type,[bn,_n,qe,nl,pn]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(l.type)} instead`);if(n.length===4){const f=o.parse(n[3],3,qe);return f?new fl(l,h,f):null}return new fl(l,h)}evaluate(n){const o=this.needle.evaluate(n),l=this.haystack.evaluate(n);if(!ol(o,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${Wn($r(o))} instead.`);if(!ol(l,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${Wn($r(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(n);return l.indexOf(o,h)}return l.indexOf(o)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var e0=fl;class Uu{constructor(n,o,l,h,f,m){this.inputType=n,this.type=o,this.input=l,this.cases=h,this.outputs=f,this.otherwise=m}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let l,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);const f={},m=[];for(let w=2;w<n.length-1;w+=2){let E=n[w];const I=n[w+1];Array.isArray(E)||(E=[E]);const k=o.concat(w);if(E.length===0)return k.error("Expected at least one branch label.");for(const R of E){if(typeof R!="number"&&typeof R!="string")return k.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return k.error("Numeric branch labels must be integer values.");if(l){if(k.checkSubtype(l,$r(R)))return null}else l=$r(R);if(f[String(R)]!==void 0)return k.error("Branch labels must be unique.");f[String(R)]=m.length}const C=o.parse(I,w,h);if(!C)return null;h=h||C.type,m.push(C)}const _=o.parse(n[1],1,pn);if(!_)return null;const x=o.parse(n[n.length-1],n.length-1,h);return x?_.type.kind!=="value"&&o.concat(1).checkSubtype(l,_.type)?null:new Uu(l,h,_,f,m,x):null}evaluate(n){const o=this.input.evaluate(n);return($r(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),l=[],h={};for(const m of o){const _=h[this.cases[m]];_===void 0?(h[this.cases[m]]=l.length,l.push([this.cases[m],[m]])):l[_][1].push(m)}const f=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,_]of l)n.push(_.length===1?f(_[0]):_.map(f)),n.push(this.outputs[m].serialize());return n.push(this.otherwise.serialize()),n}}var vw=Uu;class Ro{constructor(n,o,l){this.type=n,this.branches=o,this.otherwise=l}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let l;o.expectedType&&o.expectedType.kind!=="value"&&(l=o.expectedType);const h=[];for(let m=1;m<n.length-1;m+=2){const _=o.parse(n[m],m,bn);if(!_)return null;const x=o.parse(n[m+1],m+1,l);if(!x)return null;h.push([_,x]),l=l||x.type}const f=o.parse(n[n.length-1],n.length-1,l);return f?new Ro(l,h,f):null}evaluate(n){for(const[o,l]of this.branches)if(o.evaluate(n))return l.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[o,l]of this.branches)n(o),n(l);n(this.otherwise)}outputDefined(){return this.branches.every(([n,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(o=>{n.push(o.serialize())}),n}}var xw=Ro;class $u{constructor(n,o,l,h){this.type=n,this.input=o,this.beginIndex=l,this.endIndex=h}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const l=o.parse(n[1],1,pn),h=o.parse(n[2],2,qe);if(!l||!h)return null;if(!Fp(l.type,[zi(pn),_n,pn]))return o.error(`Expected first argument to be of type array or string, but found ${Wn(l.type)} instead`);if(n.length===4){const f=o.parse(n[3],3,qe);return f?new $u(l.type,l,h,f):null}return new $u(l.type,l,h)}evaluate(n){const o=this.input.evaluate(n),l=this.beginIndex.evaluate(n);if(!ol(o,["string","array"]))throw new Or(`Expected first argument to be of type array or string, but found ${Wn($r(o))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(n);return o.slice(l,h)}return o.slice(l)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var bw=$u;function t0(r,n){return r==="=="||r==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function n0(r,n,o,l){return l.compare(n,o)===0}function vc(r,n,o){const l=r!=="=="&&r!=="!=";return class M6{constructor(f,m,_){this.type=bn,this.lhs=f,this.rhs=m,this.collator=_,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const _=f[0];let x=m.parse(f[1],1,pn);if(!x)return null;if(!t0(_,x.type))return m.concat(1).error(`"${_}" comparisons are not supported for type '${Wn(x.type)}'.`);let w=m.parse(f[2],2,pn);if(!w)return null;if(!t0(_,w.type))return m.concat(2).error(`"${_}" comparisons are not supported for type '${Wn(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return m.error(`Cannot compare types '${Wn(x.type)}' and '${Wn(w.type)}'.`);l&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new Jo(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new Jo(x.type,[w])));let E=null;if(f.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(E=m.parse(f[3],3,rl),!E)return null}return new M6(x,w,E)}evaluate(f){const m=this.lhs.evaluate(f),_=this.rhs.evaluate(f);if(l&&this.hasUntypedArgument){const x=$r(m),w=$r(_);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new Or(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const x=$r(m),w=$r(_);if(x.kind!=="string"||w.kind!=="string")return n(f,m,_)}return this.collator?o(f,m,_,this.collator.evaluate(f)):n(f,m,_)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[r];return this.eachChild(m=>{f.push(m.serialize())}),f}}}const r0=vc("==",function(r,n,o){return n===o},n0),gm=vc("!=",function(r,n,o){return n!==o},function(r,n,o,l){return!n0(0,n,o,l)}),i0=vc("<",function(r,n,o){return n<o},function(r,n,o,l){return l.compare(n,o)<0}),ww=vc(">",function(r,n,o){return n>o},function(r,n,o,l){return l.compare(n,o)>0}),Ji=vc("<=",function(r,n,o){return n<=o},function(r,n,o,l){return l.compare(n,o)<=0}),Tw=vc(">=",function(r,n,o){return n>=o},function(r,n,o,l){return l.compare(n,o)>=0});class _m{constructor(n,o,l,h,f,m){this.type=_n,this.number=n,this.locale=o,this.currency=l,this.unit=h,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");const l=o.parse(n[1],1,qe);if(!l)return null;const h=n[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=o.parse(h.locale,1,_n),!f))return null;let m=null;if(h.currency&&(m=o.parse(h.currency,1,_n),!m))return null;let _=null;if(h.unit&&(_=o.parse(h.unit,1,_n),!_))return null;let x=null;if(h["min-fraction-digits"]&&(x=o.parse(h["min-fraction-digits"],1,qe),!x))return null;let w=null;return h["max-fraction-digits"]&&(w=o.parse(h["max-fraction-digits"],1,qe),!w)?null:new _m(l,f,m,_,x,w)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class ym{constructor(n){this.type=qe,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);const l=o.parse(n[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Wn(l.type)} instead.`):new ym(l):null}evaluate(n){const o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Or(`Expected value to be of type string or array, but found ${Wn($r(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(o=>{n.push(o.serialize())}),n}}function Gu(r){return function(){r=1831565813+(r|=0)|0;let n=Math.imul(r^r>>>15,1|r);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const vm={"==":r0,"!=":gm,">":ww,"<":i0,">=":Tw,"<=":Ji,array:Jo,at:yw,boolean:Jo,case:xw,coalesce:Jy,collator:zu,format:Du,image:Lu,in:mm,"index-of":e0,interpolate:es,"interpolate-hcl":es,"interpolate-lab":es,length:ym,let:Qy,literal:pc,match:vw,number:Jo,"number-format":_m,object:Jo,slice:bw,step:lm,string:Jo,"to-boolean":ga,"to-color":ga,"to-number":ga,"to-string":ga,var:qy,within:pd,distance:om};function Cd(r,[n,o,l,h]){n=n.evaluate(r),o=o.evaluate(r),l=l.evaluate(r);const f=h?h.evaluate(r):1,m=Ly(n,o,l,f);if(m)throw new Or(m);return new sr(n/255*f,o/255*f,l/255*f,f)}function o0(r,[n,o,l,h]){n=n.evaluate(r),o=o.evaluate(r),l=l.evaluate(r);const f=h?h.evaluate(r):1,m=function(w,E,I,k){return typeof w=="number"&&w>=0&&w<=360?typeof E=="number"&&E>=0&&E<=100&&typeof I=="number"&&I>=0&&I<=100?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid hsla value [${[w,E,I,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof k=="number"?[w,E,I,k]:[w,E,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof k=="number"?[w,E,I,k]:[w,E,I]).join(", ")}]: 'h' must be between 0 and 360.`}(n,o,l,f);if(m)throw new Or(m);const _=`hsla(${n}, ${o}%, ${l}%, ${f})`,x=sr.parse(_);if(!x)throw new Or(`Failed to parse HSLA color: ${_}`);return x}function s0(r,n){return r in n}function pl(r,n){const o=n[r];return o===void 0?null:o}function a0(r,n){switch(r){case"string":return String(n);case"number":return+n;case"boolean":return!!n;case"color":return sr.parse(n)}return n}function l0(r,n,o,l){return l!==void 0&&(r=l*Math.round(r/l)),n!==void 0&&r<n&&(r=n),o!==void 0&&r>o&&(r=o),r}function xm(r,n,o){n=[n,o,r.scope].filter(Boolean).join("");const l=r.getConfig(n);if(!l)return null;const{type:h,value:f,values:m,minValue:_,maxValue:x,stepValue:w}=l,E=l.default.evaluate(r);let I=E;if(f){const k=r.scope;r.scope=(k||"").split("").slice(1).join(""),I=f.evaluate(r),r.scope=k}return h&&(I=a0(h,I)),f!==void 0&&I!==void 0&&m&&!m.includes(I)&&(I=E,h&&(I=a0(h,I))),I===void 0||_===void 0&&x===void 0&&w===void 0||(typeof I=="number"?I=l0(I,_,x,w):Array.isArray(I)&&(I=I.map(k=>typeof k=="number"?l0(k,_,x,w):k))),I}function Ta(r){return{type:r}}Qo.register(vm,{error:[{kind:"error"},[_n],(r,[n])=>{throw new Or(n.evaluate(r))}],typeof:[_n,[pn],(r,[n])=>Wn($r(n.evaluate(r)))],"to-rgba":[zi(qe,4),[Co],(r,[n])=>n.evaluate(r).toArray()],rgb:[Co,[qe,qe,qe],Cd],rgba:[Co,[qe,qe,qe,qe],Cd],hsl:[Co,[qe,qe,qe],o0],hsla:[Co,[qe,qe,qe,qe],o0],has:{type:bn,overloads:[[[_n],(r,[n])=>s0(n.evaluate(r),r.properties())],[[_n,uc],(r,[n,o])=>s0(n.evaluate(r),o.evaluate(r))]]},get:{type:pn,overloads:[[[_n],(r,[n])=>pl(n.evaluate(r),r.properties())],[[_n,uc],(r,[n,o])=>pl(n.evaluate(r),o.evaluate(r))]]},config:{type:pn,overloads:[[[_n],(r,[n])=>xm(r,n.evaluate(r))],[[_n,_n],(r,[n,o])=>xm(r,n.evaluate(r),o.evaluate(r))]]},"feature-state":[pn,[_n],(r,[n])=>pl(n.evaluate(r),r.featureState||{})],properties:[uc,[],r=>r.properties()],"geometry-type":[_n,[],r=>r.geometryType()],id:[pn,[],r=>r.id()],zoom:[qe,[],r=>r.globals.zoom],pitch:[qe,[],r=>r.globals.pitch||0],"distance-from-center":[qe,[],r=>r.distanceFromCenter()],"measure-light":[qe,[_n],(r,[n])=>r.measureLight(n.evaluate(r))],"heatmap-density":[qe,[],r=>r.globals.heatmapDensity||0],"line-progress":[qe,[],r=>r.globals.lineProgress||0],"raster-value":[qe,[],r=>r.globals.rasterValue||0],"sky-radial-progress":[qe,[],r=>r.globals.skyRadialProgress||0],accumulated:[pn,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[qe,Ta(qe),(r,n)=>{let o=0;for(const l of n)o+=l.evaluate(r);return o}],"*":[qe,Ta(qe),(r,n)=>{let o=1;for(const l of n)o*=l.evaluate(r);return o}],"-":{type:qe,overloads:[[[qe,qe],(r,[n,o])=>n.evaluate(r)-o.evaluate(r)],[[qe],(r,[n])=>-n.evaluate(r)]]},"/":[qe,[qe,qe],(r,[n,o])=>n.evaluate(r)/o.evaluate(r)],"%":[qe,[qe,qe],(r,[n,o])=>n.evaluate(r)%o.evaluate(r)],ln2:[qe,[],()=>Math.LN2],pi:[qe,[],()=>Math.PI],e:[qe,[],()=>Math.E],"^":[qe,[qe,qe],(r,[n,o])=>Math.pow(n.evaluate(r),o.evaluate(r))],sqrt:[qe,[qe],(r,[n])=>Math.sqrt(n.evaluate(r))],log10:[qe,[qe],(r,[n])=>Math.log(n.evaluate(r))/Math.LN10],ln:[qe,[qe],(r,[n])=>Math.log(n.evaluate(r))],log2:[qe,[qe],(r,[n])=>Math.log(n.evaluate(r))/Math.LN2],sin:[qe,[qe],(r,[n])=>Math.sin(n.evaluate(r))],cos:[qe,[qe],(r,[n])=>Math.cos(n.evaluate(r))],tan:[qe,[qe],(r,[n])=>Math.tan(n.evaluate(r))],asin:[qe,[qe],(r,[n])=>Math.asin(n.evaluate(r))],acos:[qe,[qe],(r,[n])=>Math.acos(n.evaluate(r))],atan:[qe,[qe],(r,[n])=>Math.atan(n.evaluate(r))],min:[qe,Ta(qe),(r,n)=>Math.min(...n.map(o=>o.evaluate(r)))],max:[qe,Ta(qe),(r,n)=>Math.max(...n.map(o=>o.evaluate(r)))],abs:[qe,[qe],(r,[n])=>Math.abs(n.evaluate(r))],round:[qe,[qe],(r,[n])=>{const o=n.evaluate(r);return o<0?-Math.round(-o):Math.round(o)}],floor:[qe,[qe],(r,[n])=>Math.floor(n.evaluate(r))],ceil:[qe,[qe],(r,[n])=>Math.ceil(n.evaluate(r))],"filter-==":[bn,[_n,pn],(r,[n,o])=>r.properties()[n.value]===o.value],"filter-id-==":[bn,[pn],(r,[n])=>r.id()===n.value],"filter-type-==":[bn,[_n],(r,[n])=>r.geometryType()===n.value],"filter-<":[bn,[_n,pn],(r,[n,o])=>{const l=r.properties()[n.value],h=o.value;return typeof l==typeof h&&l<h}],"filter-id-<":[bn,[pn],(r,[n])=>{const o=r.id(),l=n.value;return typeof o==typeof l&&o<l}],"filter->":[bn,[_n,pn],(r,[n,o])=>{const l=r.properties()[n.value],h=o.value;return typeof l==typeof h&&l>h}],"filter-id->":[bn,[pn],(r,[n])=>{const o=r.id(),l=n.value;return typeof o==typeof l&&o>l}],"filter-<=":[bn,[_n,pn],(r,[n,o])=>{const l=r.properties()[n.value],h=o.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[bn,[pn],(r,[n])=>{const o=r.id(),l=n.value;return typeof o==typeof l&&o<=l}],"filter->=":[bn,[_n,pn],(r,[n,o])=>{const l=r.properties()[n.value],h=o.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[bn,[pn],(r,[n])=>{const o=r.id(),l=n.value;return typeof o==typeof l&&o>=l}],"filter-has":[bn,[pn],(r,[n])=>n.value in r.properties()],"filter-has-id":[bn,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[bn,[zi(_n)],(r,[n])=>n.value.indexOf(r.geometryType())>=0],"filter-id-in":[bn,[zi(pn)],(r,[n])=>n.value.indexOf(r.id())>=0],"filter-in-small":[bn,[_n,zi(pn)],(r,[n,o])=>o.value.indexOf(r.properties()[n.value])>=0],"filter-in-large":[bn,[_n,zi(pn)],(r,[n,o])=>function(l,h,f,m){for(;f<=m;){const _=f+m>>1;if(h[_]===l)return!0;h[_]>l?m=_-1:f=_+1}return!1}(r.properties()[n.value],o.value,0,o.value.length-1)],all:{type:bn,overloads:[[[bn,bn],(r,[n,o])=>n.evaluate(r)&&o.evaluate(r)],[Ta(bn),(r,n)=>{for(const o of n)if(!o.evaluate(r))return!1;return!0}]]},any:{type:bn,overloads:[[[bn,bn],(r,[n,o])=>n.evaluate(r)||o.evaluate(r)],[Ta(bn),(r,n)=>{for(const o of n)if(o.evaluate(r))return!0;return!1}]]},"!":[bn,[bn],(r,[n])=>!n.evaluate(r)],"is-supported-script":[bn,[_n],(r,[n])=>{const o=r.globals&&r.globals.isSupportedScript;return!o||o(n.evaluate(r))}],upcase:[_n,[_n],(r,[n])=>n.evaluate(r).toUpperCase()],downcase:[_n,[_n],(r,[n])=>n.evaluate(r).toLowerCase()],concat:[_n,Ta(pn),(r,n)=>n.map(o=>Ou(o.evaluate(r))).join("")],"resolved-locale":[_n,[rl],(r,[n])=>n.evaluate(r).resolvedLocale()],random:[qe,[qe,qe,pn],(r,n)=>{const[o,l,h]=n.map(m=>m.evaluate(r));if(o>l||o===l)return o;let f;if(typeof h=="string")f=function(m){let _=0;if(m.length===0)return _;for(let x=0;x<m.length;x++)_=(_<<5)-_+m.charCodeAt(x),_&=_;return _}(h);else{if(typeof h!="number")throw new Or(`Invalid seed input: ${h}`);f=h}return o+Gu(f)()*(l-o)}]});var Wu=vm;function Oo(r){return{result:"success",value:r}}function Ea(r){return{result:"error",value:r}}function c0(r,n){return!!r&&!!r.parameters&&r.parameters.indexOf(n)>-1}function Sa(r){return r["property-type"]==="data-driven"}function qu(r){return c0(r.expression,"measure-light")}function bm(r){return c0(r.expression,"zoom")}function wm(r){return!!r.expression&&r.expression.interpolated}function Md(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Ew(r){return r}function u0(r,n){const o=n.type==="color",l=r.stops&&typeof r.stops[0][0]=="object",h=l||!(l||r.property!==void 0),f=r.type||(wm(n)?"exponential":"interval");if(o&&((r=Yo({},r)).stops&&(r.stops=r.stops.map(w=>[w[0],sr.parse(w[1])])),r.default=sr.parse(r.default?r.default:n.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Ky[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let m,_,x;if(f==="exponential")m=Hu;else if(f==="interval")m=yo;else if(f==="categorical"){m=Rd,_=Object.create(null);for(const w of r.stops)_[w[0]]=w[1];x=typeof r.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);m=Sw}if(l){const w={},E=[];for(let C=0;C<r.stops.length;C++){const R=r.stops[C],L=R[0].zoom;w[L]===void 0&&(w[L]={zoom:L,type:r.type,property:r.property,default:r.default,stops:[]},E.push(L)),w[L].stops.push([R[0].value,R[1]])}const I=[];for(const C of E)I.push([w[C].zoom,u0(w[C],n)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:es.interpolationFactor.bind(void 0,k),zoomStops:I.map(C=>C[0]),evaluate:({zoom:C},R)=>Hu({stops:I,base:r.base},n,C).evaluate(C,R)}}if(h){const w=f==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:es.interpolationFactor.bind(void 0,w),zoomStops:r.stops.map(E=>E[0]),evaluate:({zoom:E})=>m(r,n,E,_,x)}}return{kind:"source",evaluate(w,E){const I=E&&E.properties?E.properties[r.property]:void 0;return I===void 0?Ia(r.default,n.default):m(r,n,I,_,x)}}}function Ia(r,n,o){return r!==void 0?r:n!==void 0?n:o!==void 0?o:void 0}function Rd(r,n,o,l,h){return Ia(typeof o===h?l[o]:void 0,r.default,n.default)}function yo(r,n,o){if(Cn(o)!=="number")return Ia(r.default,n.default);const l=r.stops.length;if(l===1||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[l-1][0])return r.stops[l-1][1];const h=Id(r.stops.map(f=>f[0]),o);return r.stops[h][1]}function Hu(r,n,o){const l=r.base!==void 0?r.base:1;if(Cn(o)!=="number")return Ia(r.default,n.default);const h=r.stops.length;if(h===1||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[h-1][0])return r.stops[h-1][1];const f=Id(r.stops.map(E=>E[0]),o),m=function(E,I,k,C){const R=C-k,L=E-k;return R===0?0:I===1?L/R:(Math.pow(I,L)-1)/(Math.pow(I,R)-1)}(o,l,r.stops[f][0],r.stops[f+1][0]),_=r.stops[f][1],x=r.stops[f+1][1];let w=ju[n.type]||Ew;if(r.colorSpace&&r.colorSpace!=="rgb"){const E=Ky[r.colorSpace];w=(I,k)=>E.reverse(E.interpolate(E.forward(I),E.forward(k),m))}return typeof _.evaluate=="function"?{evaluate(...E){const I=_.evaluate.apply(void 0,E),k=x.evaluate.apply(void 0,E);if(I!==void 0&&k!==void 0)return w(I,k,m)}}:w(_,x,m)}function Sw(r,n,o){return n.type==="color"?o=sr.parse(o):n.type==="formatted"?o=Fi.fromString(o.toString()):n.type==="resolvedImage"?o=Mo.fromString(o.toString()):Cn(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0),Ia(o,r.default,n.default)}class Tm{constructor(n,o,l,h){this.expression=n,this._warningHistory={},this._evaluator=new Wp(l,h),this._defaultValue=o?function(f){return f.type==="color"&&(Md(f.default)||Array.isArray(f.default))?new sr(0,0,0,0):f.type==="color"?sr.parse(f.default)||null:f.default===void 0?null:f.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(n,o,l,h,f,m,_,x){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(n,o,l,h,f,m,_,x){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Or(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Od(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Wu}function Zu(r,n,o,l){const h=new sm(Wu,[],n?function(m){const _={color:Co,string:_n,number:qe,enum:_n,boolean:bn,formatted:ma,resolvedImage:Ru};return m.type==="array"?zi(_[m.value]||pn,m.length):_[m.type]}(n):void 0,void 0,void 0,o,l),f=h.parse(r,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Oo(new Tm(f,n,o,l)):Ea(h.errors)}class Xu{constructor(n,o,l){this.kind=n,this._styleExpression=o,this.isLightConstant=l,this.isStateDependent=n!=="constant"&&!ui(o.expression),this.isConfigDependent=!Bu(o.expression)}evaluateWithoutErrorHandling(n,o,l,h,f,m){return this._styleExpression.evaluateWithoutErrorHandling(n,o,l,h,f,m)}evaluate(n,o,l,h,f,m){return this._styleExpression.evaluate(n,o,l,h,f,m)}}class Yu{constructor(n,o,l,h,f){this.kind=n,this.zoomStops=l,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!ui(o.expression),this.isLightConstant=f,this.isConfigDependent=!Bu(o.expression),this.interpolationType=h}evaluateWithoutErrorHandling(n,o,l,h,f,m){return this._styleExpression.evaluateWithoutErrorHandling(n,o,l,h,f,m)}evaluate(n,o,l,h,f,m){return this._styleExpression.evaluate(n,o,l,h,f,m)}interpolationFactor(n,o,l){return this.interpolationType?es.interpolationFactor(this.interpolationType,n,o,l):0}}function Ku(r,n,o,l){if((r=Zu(r,n,o,l)).result==="error")return r;const h=r.value.expression,f=mc(h);if(!f&&!Sa(n))return Ea([new Ko("","data expressions not supported")]);const m=ul(h,["zoom","pitch","distance-from-center"]);if(!m&&!bm(n))return Ea([new Ko("","zoom expressions not supported")]);const _=ul(h,["measure-light"]);if(!_&&!qu(n))return Ea([new Ko("","measure-light expression not supported")]);const x=n.expression&&n.expression.relaxZoomRestriction,w=Ld(h);return w||m||x?w instanceof Ko?Ea([w]):w instanceof es&&!wm(n)?Ea([new Ko("",'"interpolate" expressions cannot be used with this property')]):Oo(w?new Yu(f?"camera":"composite",r.value,w.labels,w instanceof es?w.interpolation:void 0,_):new Xu(f?"constant":"source",r.value,_)):Ea([new Ko("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Dd{constructor(n,o){this._parameters=n,this._specification=o,Yo(this,u0(this._parameters,this._specification))}static deserialize(n){return new Dd(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Ld(r){let n=null;if(r instanceof Qy)n=Ld(r.result);else if(r instanceof Jy){for(const o of r.args)if(n=Ld(o),n)break}else(r instanceof lm||r instanceof es)&&r.input instanceof Qo&&r.input.name==="zoom"&&(n=r);return n instanceof Ko||r.eachChild(o=>{const l=Ld(o);l instanceof Ko?n=l:n&&l&&n!==l&&(n=new Ko("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function Qi(r){const n=r.key,o=r.value,l=r.valueSpec||{},h=r.objectElementValidators||{},f=r.style,m=r.styleSpec;let _=[];const x=Cn(o);if(x!=="object")return[new kt(n,o,`object expected, ${x} found`)];for(const w in o){const E=w.split(".")[0];let I;h[E]?I=h[E]:l[E]?I=Gr:h["*"]?I=h["*"]:l["*"]&&(I=Gr),I?_=_.concat(I({key:(n&&`${n}.`)+w,value:o[w],valueSpec:l[E]||l["*"],style:f,styleSpec:m,object:o,objectKey:w},o)):_.push(new vs(n,o[w],`unknown property "${w}"`))}for(const w in l)h[w]||l[w].required&&l[w].default===void 0&&o[w]===void 0&&_.push(new kt(n,o,`missing required property "${w}"`));return _}function h0(r){const n=r.value,o=r.valueSpec,l=r.style,h=r.styleSpec,f=r.key,m=r.arrayElementValidator||Gr;if(Cn(n)!=="array")return[new kt(f,n,`array expected, ${Cn(n)} found`)];if(o.length&&n.length!==o.length)return[new kt(f,n,`array length ${o.length} expected, length ${n.length} found`)];if(o["min-length"]&&n.length<o["min-length"])return[new kt(f,n,`array length at least ${o["min-length"]} expected, length ${n.length} found`)];let _={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};h.$version<7&&(_.function=o.function),Cn(o.value)==="object"&&(_=o.value);let x=[];for(let w=0;w<n.length;w++)x=x.concat(m({array:n,arrayIndex:w,value:n[w],valueSpec:_,style:l,styleSpec:h,key:`${f}[${w}]`},!0));return x}function Em(r){const n=r.key,o=r.value,l=r.valueSpec;let h=Cn(o);if(h==="number"&&o!=o&&(h="NaN"),h!=="number")return[new kt(n,o,`number expected, ${h} found`)];if("minimum"in l){let f=l.minimum;if(Cn(l.minimum)==="array"&&(f=l.minimum[r.arrayIndex]),o<f)return[new kt(n,o,`${o} is less than the minimum value ${f}`)]}if("maximum"in l){let f=l.maximum;if(Cn(l.maximum)==="array"&&(f=l.maximum[r.arrayIndex]),o>f)return[new kt(n,o,`${o} is greater than the maximum value ${f}`)]}return[]}function Sm(r){const n=r.valueSpec,o=Rr(r.value.type);let l,h,f,m={};const _=o!=="categorical"&&r.value.property===void 0,x=!_,w=Cn(r.value.stops)==="array"&&Cn(r.value.stops[0])==="array"&&Cn(r.value.stops[0][0])==="object",E=Qi({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(C){if(o==="identity")return[new kt(C.key,C.value,'identity function may not have a "stops" property')];let R=[];const L=C.value;return R=R.concat(h0({key:C.key,value:L,valueSpec:C.valueSpec,style:C.style,styleSpec:C.styleSpec,arrayElementValidator:I})),Cn(L)==="array"&&L.length===0&&R.push(new kt(C.key,L,"array must have at least one stop")),R},default:function(C){return Gr({key:C.key,value:C.value,valueSpec:n,style:C.style,styleSpec:C.styleSpec})}}});return o==="identity"&&_&&E.push(new kt(r.key,r.value,'missing required property "property"')),o==="identity"||r.value.stops||E.push(new kt(r.key,r.value,'missing required property "stops"')),o==="exponential"&&r.valueSpec.expression&&!wm(r.valueSpec)&&E.push(new kt(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!Sa(r.valueSpec)?E.push(new kt(r.key,r.value,"property functions not supported")):_&&!bm(r.valueSpec)&&E.push(new kt(r.key,r.value,"zoom functions not supported"))),o!=="categorical"&&!w||r.value.property!==void 0||E.push(new kt(r.key,r.value,'"property" property is required')),E;function I(C){let R=[];const L=C.value,N=C.key;if(Cn(L)!=="array")return[new kt(N,L,`array expected, ${Cn(L)} found`)];if(L.length!==2)return[new kt(N,L,`array length 2 expected, length ${L.length} found`)];if(w){if(Cn(L[0])!=="object")return[new kt(N,L,`object expected, ${Cn(L[0])} found`)];if(L[0].zoom===void 0)return[new kt(N,L,"object stop key must have zoom")];if(L[0].value===void 0)return[new kt(N,L,"object stop key must have value")];const j=Rr(L[0].zoom);if(typeof j!="number")return[new kt(N,L[0].zoom,"stop zoom values must be numbers")];if(f&&f>j)return[new kt(N,L[0].zoom,"stop zoom values must appear in ascending order")];j!==f&&(f=j,h=void 0,m={}),R=R.concat(Qi({key:`${N}[0]`,value:L[0],valueSpec:{zoom:{}},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{zoom:Em,value:k}}))}else R=R.concat(k({key:`${N}[0]`,value:L[0],valueSpec:{},style:C.style,styleSpec:C.styleSpec},L));return Od($s(L[1]))?R.concat([new kt(`${N}[1]`,L[1],"expressions are not allowed in function stops.")]):R.concat(Gr({key:`${N}[1]`,value:L[1],valueSpec:n,style:C.style,styleSpec:C.styleSpec}))}function k(C,R){const L=Cn(C.value),N=Rr(C.value),j=C.value!==null?C.value:R;if(l){if(L!==l)return[new kt(C.key,j,`${L} stop domain type must match previous stop domain type ${l}`)]}else l=L;if(L!=="number"&&L!=="string"&&L!=="boolean"&&typeof N!="number"&&typeof N!="string"&&typeof N!="boolean")return[new kt(C.key,j,"stop domain value must be a number, string, or boolean")];if(L!=="number"&&o!=="categorical"){let Z=`number expected, ${L} found`;return Sa(n)&&o===void 0&&(Z+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new kt(C.key,j,Z)]}return o!=="categorical"||L!=="number"||typeof N=="number"&&isFinite(N)&&Math.floor(N)===N?o!=="categorical"&&L==="number"&&typeof N=="number"&&typeof h=="number"&&h!==void 0&&N<h?[new kt(C.key,j,"stop domain values must appear in ascending order")]:(h=N,o==="categorical"&&N in m?[new kt(C.key,j,"stop domain values must be unique")]:(m[N]=!0,[])):[new kt(C.key,j,`integer expected, found ${String(N)}`)]}}function ml(r){const n=(r.expressionContext==="property"?Ku:Zu)($s(r.value),r.valueSpec);if(n.result==="error")return n.value.map(l=>new kt(`${r.key}${l.key}`,r.value,l.message));const o=n.value.expression||n.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!o.outputDefined())return[new kt(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!ui(o))return[new kt(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter")return zd(o,r);if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!ul(o,["zoom","feature-state"]))return[new kt(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!mc(o))return[new kt(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zd(r,n){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const h of n.valueSpec.expression.parameters)o.delete(h);if(o.size===0)return[];const l=[];return r instanceof Qo&&o.has(r.name)?[new kt(n.key,n.value,`["${r.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(r.eachChild(h=>{l.push(...zd(h,n))}),l)}function gl(r){const n=r.key,o=r.value,l=r.valueSpec,h=[];return Array.isArray(l.values)?l.values.indexOf(Rr(o))===-1&&h.push(new kt(n,o,`expected one of [${l.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(l.values).indexOf(Rr(o))===-1&&h.push(new kt(n,o,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(o)} found`)),h}function Nd(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const n of r.slice(1))if(!Nd(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function Fd(r,n="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Nd(r)||(r=Bd(r));const o=r;let l=!0;try{l=function(w){if(!Aa(w))return w;let E=$s(w);return d0(E),E=Im(E),E}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}const h=Ie[`filter_${n}`],f=Zu(l,h);let m=null;if(f.result==="error")throw new Error(f.value.map(w=>`${w.key}: ${w.message}`).join(", "));m=(w,E,I)=>f.value.evaluate(w,E,{},I);let _=null,x=null;if(l!==o){const w=Zu(o,h);if(w.result==="error")throw new Error(w.value.map(E=>`${E.key}: ${E.message}`).join(", "));_=(E,I,k,C,R)=>w.value.evaluate(E,I,{},k,void 0,void 0,C,R),x=!mc(w.value.expression)}return{filter:m,dynamicFilter:_||void 0,needGeometry:f0(l),needFeature:!!x}}function Im(r){if(!Array.isArray(r))return r;const n=function(o){if(Iw.has(o[0])){for(let l=1;l<o.length;l++)if(Aa(o[l]))return!0}return o}(r);return n===!0?n:n.map(o=>Im(o))}function d0(r){let n=!1;const o=[];if(r[0]==="case"){for(let l=1;l<r.length-1;l+=2)n=n||Aa(r[l]),o.push(r[l+1]);o.push(r[r.length-1])}else if(r[0]==="match"){n=n||Aa(r[1]);for(let l=2;l<r.length-1;l+=2)o.push(r[l+1]);o.push(r[r.length-1])}else if(r[0]==="step"){n=n||Aa(r[1]);for(let l=1;l<r.length-1;l+=2)o.push(r[l+1])}n&&(r.length=0,r.push("any",...o));for(let l=1;l<r.length;l++)d0(r[l])}function Aa(r){if(!Array.isArray(r))return!1;if((n=r[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let o=1;o<r.length;o++)if(Aa(r[o]))return!0;return!1}const Iw=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Aw(r,n){return r<n?-1:r>n?1:0}function f0(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let n=1;n<r.length;n++)if(f0(r[n]))return!0;return!1}function Bd(r){if(!r)return!0;const n=r[0];return r.length<=1?n!=="any":n==="=="?jd(r[1],r[2],"=="):n==="!="?Vd(jd(r[1],r[2],"==")):n==="<"||n===">"||n==="<="||n===">="?jd(r[1],r[2],n):n==="any"?(o=r.slice(1),["any"].concat(o.map(Bd))):n==="all"?["all"].concat(r.slice(1).map(Bd)):n==="none"?["all"].concat(r.slice(1).map(Bd).map(Vd)):n==="in"?p0(r[1],r.slice(2)):n==="!in"?Vd(p0(r[1],r.slice(2))):n==="has"?m0(r[1]):n!=="!has"||Vd(m0(r[1]));var o}function jd(r,n,o){switch(r){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,r,n]}}function p0(r,n){if(n.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(o=>typeof o!=typeof n[0])?["filter-in-large",r,["literal",n.sort(Aw)]]:["filter-in-small",r,["literal",n]]}}function m0(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Vd(r){return["!",r]}function Am(r){return Nd($s(r.value))?ml(Yo({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${r.layerType||"fill"}`]})):g0(r)}function g0(r){const n=r.value,o=r.key;if(Cn(n)!=="array")return[new kt(o,n,`array expected, ${Cn(n)} found`)];const l=r.styleSpec;let h,f=[];if(n.length<1)return[new kt(o,n,"filter array must have at least 1 element")];switch(f=f.concat(gl({key:`${o}[0]`,value:n[0],valueSpec:l.filter_operator,style:r.style,styleSpec:r.styleSpec})),Rr(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&Rr(n[1])==="$type"&&f.push(new kt(o,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&f.push(new kt(o,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(h=Cn(n[1]),h!=="string"&&f.push(new kt(`${o}[1]`,n[1],`string expected, ${h} found`)));for(let m=2;m<n.length;m++)h=Cn(n[m]),Rr(n[1])==="$type"?f=f.concat(gl({key:`${o}[${m}]`,value:n[m],valueSpec:l.geometry_type,style:r.style,styleSpec:r.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&f.push(new kt(`${o}[${m}]`,n[m],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let m=1;m<n.length;m++)f=f.concat(g0({key:`${o}[${m}]`,value:n[m],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":h=Cn(n[1]),n.length!==2?f.push(new kt(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):h!=="string"&&f.push(new kt(`${o}[1]`,n[1],`string expected, ${h} found`))}return f}function _0(r,n){const o=r.key,l=r.style,h=r.layer,f=r.styleSpec,m=r.value,_=r.objectKey,x=f[`${n}_${r.layerType}`];if(!x)return[];const w=_.match(/^(.*)-transition$/);if(n==="paint"&&w&&x[w[1]]&&x[w[1]].transition)return Gr({key:o,value:m,valueSpec:f.transition,style:l,styleSpec:f});const E=r.valueSpec||x[_];if(!E)return[new vs(o,m,`unknown property "${_}"`)];let I;if(Cn(m)==="string"&&Sa(E)&&!E.tokens&&(I=/^{([^}]+)}$/.exec(m))){const C=`\`{ "type": "identity", "property": ${I?JSON.stringify(I[1]):'"_"'} }\``;return[new kt(o,m,`"${_}" does not support interpolation syntax
Use an identity property function instead: ${C}.`)]}const k=[];if(r.layerType==="symbol")_!=="text-field"||!l||l.glyphs||l.imports||k.push(new kt(o,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Md($s(m))&&Rr(m.type)==="identity"&&k.push(new kt(o,m,'"text-font" does not support identity functions'));else if(r.layerType==="model"&&n==="paint"&&h&&h.layout&&h.layout.hasOwnProperty("model-id")&&Sa(E)&&(qu(E)||bm(E))){const C=Ku($s(m),E),R=C.value.expression||C.value._styleExpression.expression;R&&!ul(R,["measure-light"])&&(_==="model-emissive-strength"&&mc(R)&&ui(R)||k.push(new kt(o,m,`${_} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return k.concat(Gr({key:r.key,value:m,valueSpec:E,style:l,styleSpec:f,expressionContext:"property",propertyType:n,propertyKey:_}))}function y0(r){return _0(r,"paint")}function Ju(r){return _0(r,"layout")}function v0(r){let n=[];const o=r.value,l=r.key,h=r.style,f=r.styleSpec;o.type||o.ref||n.push(new kt(l,o,'either "type" or "ref" is required'));let m=Rr(o.type);const _=Rr(o.ref);if(o.id){const x=Rr(o.id);for(let w=0;w<r.arrayIndex;w++){const E=h.layers[w];Rr(E.id)===x&&n.push(new kt(l,o.id,`duplicate layer id "${o.id}", previously used at line ${E.id.__line__}`))}}if("ref"in o){let x;["type","source","source-layer","filter","layout"].forEach(w=>{w in o&&n.push(new kt(l,o[w],`"${w}" is prohibited for ref layers`))}),h.layers.forEach(w=>{Rr(w.id)===_&&(x=w)}),x?x.ref?n.push(new kt(l,o.ref,"ref cannot reference another ref layer")):m=Rr(x.type):typeof _=="string"&&n.push(new kt(l,o.ref,`ref layer "${_}" not found`))}else if(m!=="background"&&m!=="sky"&&m!=="slot")if(o.source){const x=h.sources&&h.sources[o.source],w=x&&Rr(x.type);x?w==="vector"&&m==="raster"?n.push(new kt(l,o.source,`layer "${o.id}" requires a raster source`)):w==="raster"&&m!=="raster"?n.push(new kt(l,o.source,`layer "${o.id}" requires a vector source`)):w!=="vector"||o["source-layer"]?w==="raster-dem"&&m!=="hillshade"?n.push(new kt(l,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||w==="geojson"&&x.lineMetrics||n.push(new kt(l,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new kt(l,o,`layer "${o.id}" must specify a "source-layer"`)):n.push(new kt(l,o.source,`source "${o.source}" not found`))}else n.push(new kt(l,o,'missing required property "source"'));return n=n.concat(Qi({key:l,value:o,valueSpec:f.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Gr({key:`${l}.type`,value:o.type,valueSpec:f.layer.type,style:r.style,styleSpec:r.styleSpec,object:o,objectKey:"type"}),filter:x=>Am(Yo({layerType:m},x)),layout:x=>Qi({layer:o,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":w=>Ju(Yo({layerType:m},w))}}),paint:x=>Qi({layer:o,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":w=>y0(Yo({layerType:m,layer:o},w))}})}})),n}function xc(r){const n=r.value,o=r.key,l=Cn(n);return l!=="string"?[new kt(o,n,`string expected, ${l} found`)]:[]}const Qu={promoteId:function({key:r,value:n}){if(Cn(n)==="string")return xc({key:r,value:n});{const o=[];for(const l in n)o.push(...xc({key:`${r}.${l}`,value:n[l]}));return o}}};function x0(r){const n=r.value,o=r.key,l=r.styleSpec,h=r.style;if(!n.type)return[new kt(o,n,'"type" is required')];const f=Rr(n.type);let m=[];switch(["vector","raster","raster-dem"].includes(f)&&(n.url||n.tiles||m.push(new vs(o,n,'Either "url" or "tiles" is required.'))),f){case"vector":case"raster":case"raster-dem":return m=m.concat(Qi({key:o,value:n,valueSpec:l[`source_${f.replace("-","_")}`],style:r.style,styleSpec:l,objectElementValidators:Qu})),m;case"geojson":if(m=Qi({key:o,value:n,valueSpec:l.source_geojson,style:h,styleSpec:l,objectElementValidators:Qu}),n.cluster)for(const _ in n.clusterProperties){const[x,w]=n.clusterProperties[_],E=typeof x=="string"?[x,["accumulated"],["get",_]]:x;m.push(...ml({key:`${o}.${_}.map`,value:w,expressionContext:"cluster-map"})),m.push(...ml({key:`${o}.${_}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return m;case"video":return Qi({key:o,value:n,valueSpec:l.source_video,style:h,styleSpec:l});case"image":return Qi({key:o,value:n,valueSpec:l.source_image,style:h,styleSpec:l});case"canvas":return[new kt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return gl({key:`${o}.type`,value:n.type,valueSpec:{values:b0(l)},style:h,styleSpec:l})}}function b0(r){return r.source.reduce((n,o)=>{const l=r[o];return l.type.type==="enum"&&(n=n.concat(Object.keys(l.type.values))),n},[])}function w0(r){const n=r.value;let o=[];if(!n)return o;const l=Cn(n);return l!=="string"?(o=o.concat([new kt(r.key,n,`string expected, "${l}" found`)]),o):(function(h){const f=h.indexOf("://")===-1;try{return new URL(h,f?"http://example.com":void 0),!0}catch{return!1}}(n)||(o=o.concat([new kt(r.key,n,`invalid url "${n}"`)])),o)}function Pm(r){const n=r.value,o=r.styleSpec,l=o.light,h=r.style;let f=[];const m=Cn(n);if(n===void 0)return f;if(m!=="object")return f=f.concat([new kt("light",n,`object expected, ${m} found`)]),f;for(const _ in n){const x=_.match(/^(.*)-transition$/);f=f.concat(x&&l[x[1]]&&l[x[1]].transition?Gr({key:_,value:n[_],valueSpec:o.transition,style:h,styleSpec:o}):l[_]?Gr({key:_,value:n[_],valueSpec:l[_],style:h,styleSpec:o}):[new kt(_,n[_],`unknown property "${_}"`)])}return f}function km(r){const n=r.value;let o=[];if(!n)return o;const l=Cn(n);if(l!=="object")return o=o.concat([new kt("light-3d",n,`object expected, ${l} found`)]),o;const h=r.styleSpec,f=h["light-3d"],m=r.key,_=r.style,x=r.style.lights;for(const I of["type","id"])if(!(I in n))return o=o.concat([new kt("light-3d",n,`missing property ${I} on light`)]),o;if(n.type&&x)for(let I=0;I<r.arrayIndex;I++){const k=Rr(n.type),C=x[I];Rr(C.type)===k&&o.push(new kt(m,n.id,`duplicate light type "${n.type}", previously defined at line ${C.id.__line__}`))}const w=`properties_light_${n.type}`;if(!(w in h))return o=o.concat([new kt("light-3d",n,`Invalid light type ${n.type}`)]),o;const E=h[w];for(const I in n)if(I==="properties"){const k=n[I],C=Cn(k);if(C!=="object")return o=o.concat([new kt("properties",k,`object expected, ${C} found`)]),o;for(const R in k)o=o.concat(E[R]?Gr({key:R,value:k[R],valueSpec:E[R],style:_,styleSpec:h}):[new vs(r.key,k[R],`unknown property "${R}"`)])}else{const k=I.match(/^(.*)-transition$/);o=o.concat(k&&f[k[1]]&&f[k[1]].transition?Gr({key:I,value:n[I],valueSpec:h.transition,style:_,styleSpec:h}):f[I]?Gr({key:I,value:n[I],valueSpec:f[I],style:_,styleSpec:h}):[new vs(I,n[I],`unknown property "${I}"`)])}return o}function Cm(r){const n=r.value,o=r.key,l=r.style,h=r.styleSpec,f=h.terrain;let m=[];const _=Cn(n);if(n===void 0||_==="null")return m;if(_!=="object")return m=m.concat([new kt("terrain",n,`object expected, ${_} found`)]),m;for(const x in n){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&f[w[1]]&&f[w[1]].transition?Gr({key:x,value:n[x],valueSpec:h.transition,style:l,styleSpec:h}):f[x]?Gr({key:x,value:n[x],valueSpec:f[x],style:l,styleSpec:h}):[new vs(x,n[x],`unknown property "${x}"`)])}if(n.source){const x=l.sources&&l.sources[n.source],w=x&&Rr(x.type);x?w!=="raster-dem"&&m.push(new kt(o,n.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):m.push(new kt(o,n.source,`source "${n.source}" not found`))}else m.push(new kt(o,n,'terrain is missing required property "source"'));return m}function Mm(r){const n=r.value,o=r.style,l=r.styleSpec,h=l.fog;let f=[];const m=Cn(n);if(n===void 0)return f;if(m!=="object")return f=f.concat([new kt("fog",n,`object expected, ${m} found`)]),f;for(const _ in n){const x=_.match(/^(.*)-transition$/);f=f.concat(x&&h[x[1]]&&h[x[1]].transition?Gr({key:_,value:n[_],valueSpec:l.transition,style:o,styleSpec:l}):h[_]?Gr({key:_,value:n[_],valueSpec:h[_],style:o,styleSpec:l}):[new vs(_,n[_],`unknown property "${_}"`)])}return f}const Ud={"*":()=>[],array:h0,boolean:function(r){const n=r.value,o=r.key,l=Cn(n);return l!=="boolean"?[new kt(o,n,`boolean expected, ${l} found`)]:[]},number:Em,color:function(r){const n=r.key,o=r.value,l=Cn(o);return l!=="string"?[new kt(n,o,`color expected, ${l} found`)]:cd(o)===null?[new kt(n,o,`color expected, "${o}" found`)]:[]},enum:gl,filter:Am,function:Sm,layer:v0,object:Qi,source:x0,model:w0,light:Pm,"light-3d":km,terrain:Cm,fog:Mm,string:xc,formatted:function(r){return xc(r).length===0?[]:ml(r)},resolvedImage:function(r){return xc(r).length===0?[]:ml(r)},projection:function(r){const n=r.value,o=r.styleSpec,l=o.projection,h=r.style;let f=[];const m=Cn(n);if(m==="object")for(const _ in n)f=f.concat(Gr({key:_,value:n[_],valueSpec:l[_],style:h,styleSpec:o}));else m!=="string"&&(f=f.concat([new kt("projection",n,`object or string expected, ${m} found`)]));return f},import:function(r){const{value:n,styleSpec:o}=r,{data:l,...h}=n;Object.defineProperty(h,"__line__",{value:n.__line__,enumerable:!1});let f=Qi(Yo({},r,{value:h,valueSpec:o.import}));return Rr(h.id)===""&&f.push(new kt(`${r.key}.id`,h,"import id can't be an empty string")),l&&(f=f.concat(T0(l,o,{key:`${r.key}.data`}))),f}};function Gr(r,n=!1){const o=r.value,l=r.valueSpec,h=r.styleSpec;if(l.expression&&Md(Rr(o)))return Sm(r);if(l.expression&&Od($s(o)))return ml(r);if(l.type&&Ud[l.type]){const f=Ud[l.type](r);return n===!0&&f.length>0&&Cn(r.value)==="array"?ml(r):f}return Qi(Yo({},r,{valueSpec:l.type?h[l.type]:l}))}function Pw(r){const n=r.value,o=r.key,l=xc(r);return l.length||(n.indexOf("{fontstack}")===-1&&l.push(new kt(o,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&l.push(new kt(o,n,'"glyphs" url must include a "{range}" token'))),l}function T0(r,n=Ie,o={}){return Gr({key:o.key||"",value:r,valueSpec:n.$root,styleSpec:n,style:r,objectElementValidators:{glyphs:Pw,"*":()=>[]}})}function Rm(r,n=Ie){return ts(T0(r,n))}const kw=r=>ts(y0(r)),Cw=r=>ts(Ju(r));function ts(r){return r.slice().sort((n,o)=>n.line&&o.line?n.line-o.line:0)}function E0(r,n){let o=!1;if(n&&n.length)for(const l of n)l instanceof vs?pr(l.message):(r.fire(new tl(new Error(l.message))),o=!0);return o}var Mw=ws,Pa=3;function ws(r,n,o){var l=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var h=new Int32Array(this.arrayBuffer);r=h[0],this.d=(n=h[1])+2*(o=h[2]);for(var f=0;f<this.d*this.d;f++){var m=h[Pa+f],_=h[Pa+f+1];l.push(m===_?null:h.subarray(m,_))}var x=h[Pa+l.length+1];this.keys=h.subarray(h[Pa+l.length],x),this.bboxes=h.subarray(x),this.insert=this._insertReadonly}else{this.d=n+2*o;for(var w=0;w<this.d*this.d;w++)l.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=r,this.padding=o,this.scale=n/r,this.uid=0;var E=o/n*r;this.min=-E,this.max=r+E}ws.prototype.insert=function(r,n,o,l,h){this._forEachCell(n,o,l,h,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(h)},ws.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ws.prototype._insertCell=function(r,n,o,l,h,f){this.cells[h].push(f)},ws.prototype.query=function(r,n,o,l,h){var f=this.min,m=this.max;if(r<=f&&n<=f&&m<=o&&m<=l&&!h)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(r,n,o,l,this._queryCell,_,{},h),_},ws.prototype._queryCell=function(r,n,o,l,h,f,m,_){var x=this.cells[h];if(x!==null)for(var w=this.keys,E=this.bboxes,I=0;I<x.length;I++){var k=x[I];if(m[k]===void 0){var C=4*k;(_?_(E[C+0],E[C+1],E[C+2],E[C+3]):r<=E[C+2]&&n<=E[C+3]&&o>=E[C+0]&&l>=E[C+1])?(m[k]=!0,f.push(w[k])):m[k]=!1}}},ws.prototype._forEachCell=function(r,n,o,l,h,f,m,_){for(var x=this._convertToCellCoord(r),w=this._convertToCellCoord(n),E=this._convertToCellCoord(o),I=this._convertToCellCoord(l),k=x;k<=E;k++)for(var C=w;C<=I;C++){var R=this.d*C+k;if((!_||_(this._convertFromCellCoord(k),this._convertFromCellCoord(C),this._convertFromCellCoord(k+1),this._convertFromCellCoord(C+1)))&&h.call(this,r,n,o,l,R,f,m,_))return}},ws.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},ws.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},ws.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,n=Pa+this.cells.length+1+1,o=0,l=0;l<this.cells.length;l++)o+=this.cells[l].length;var h=new Int32Array(n+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var f=n,m=0;m<r.length;m++){var _=r[m];h[Pa+m]=f,h.set(_,f),f+=_.length}return h[Pa+r.length]=f,h.set(this.keys,f),h[Pa+r.length+1]=f+=this.keys.length,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer};var bc=fe(Mw);const $d={};function xt(r,n,o={}){Object.defineProperty(r,"_classRegistryKey",{value:n,writeable:!1}),$d[n]={klass:r,omit:o.omit||[]}}xt(Object,"Object"),bc.serialize=function(r,n){const o=r.toArrayBuffer();return n&&n.add(o),{buffer:o}},bc.deserialize=function(r){return new bc(r.buffer)},Object.defineProperty(bc,"name",{value:"Grid"}),xt(bc,"Grid"),xt(sr,"Color"),xt(Error,"Error"),xt(Fi,"Formatted"),xt(sl,"FormattedSection"),xt(Po,"AJAXError"),xt(Mo,"ResolvedImage"),xt(Dd,"StylePropertyFunction"),xt(Tm,"StyleExpression",{omit:["_evaluator"]}),xt(Yu,"ZoomDependentExpression"),xt(Xu,"ZoomConstantExpression"),xt(Qo,"CompoundExpression",{omit:["_evaluate"]});for(const r in Wu)$d[Wu[r]._classRegistryKey]||xt(Wu[r],`Expression${r}`);function g(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function c(r){return self.ImageBitmap&&r instanceof ImageBitmap}function d(r,n){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(g(r)||c(r))return n&&n.add(r),r;if(ArrayBuffer.isView(r)){const o=r;return n&&n.add(o.buffer),o}if(r instanceof ImageData)return n&&n.add(r.data.buffer),r;if(Array.isArray(r)){const o=[];for(const l of r)o.push(d(l,n));return o}if(r instanceof Map){const o={$name:"Map"};for(const[l,h]of r.entries())o[l]=d(h);return o}if(typeof r=="object"){const o=r.constructor,l=o._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const h=o.serialize?o.serialize(r,n):{};if(!o.serialize){for(const f in r)r.hasOwnProperty(f)&&($d[l].omit.indexOf(f)>=0||(h[f]=d(r[f],n)));r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof r)}function y(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||g(r)||c(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(y);if(typeof r=="object"){const n=r.$name||"Object";if(n==="Map"){const h=new Map;for(const f of Object.keys(r))f!=="$name"&&h.set(f,y(r[f]));return h}const{klass:o}=$d[n];if(!o)throw new Error(`can't deserialize unregistered class ${n}`);if(o.deserialize)return o.deserialize(r);const l=Object.create(o.prototype);for(const h of Object.keys(r))h!=="$name"&&(l[h]=y(r[h]));return l}throw new Error("can't deserialize object of type "+typeof r)}const b={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function T(r){for(const n of r)if(M(n.charCodeAt(0)))return!0;return!1}function S(r){for(const n of r)if(!P(n.charCodeAt(0)))return!1;return!0}function P(r){return!(b.Arabic(r)||b["Arabic Supplement"](r)||b["Arabic Extended-A"](r)||b["Arabic Presentation Forms-A"](r)||b["Arabic Presentation Forms-B"](r))}function M(r){return!(r!==746&&r!==747&&(r<4352||!(b["Bopomofo Extended"](r)||b.Bopomofo(r)||b["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||b["CJK Compatibility Ideographs"](r)||b["CJK Compatibility"](r)||b["CJK Radicals Supplement"](r)||b["CJK Strokes"](r)||!(!b["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||b["CJK Unified Ideographs Extension A"](r)||b["CJK Unified Ideographs"](r)||b["Enclosed CJK Letters and Months"](r)||b["Hangul Compatibility Jamo"](r)||b["Hangul Jamo Extended-A"](r)||b["Hangul Jamo Extended-B"](r)||b["Hangul Jamo"](r)||b["Hangul Syllables"](r)||b.Hiragana(r)||b["Ideographic Description Characters"](r)||b.Kanbun(r)||b["Kangxi Radicals"](r)||b["Katakana Phonetic Extensions"](r)||b.Katakana(r)&&r!==12540||!(!b["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!b["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||b["Unified Canadian Aboriginal Syllabics"](r)||b["Unified Canadian Aboriginal Syllabics Extended"](r)||b["Vertical Forms"](r)||b["Yijing Hexagram Symbols"](r)||b["Yi Syllables"](r)||b["Yi Radicals"](r))))}function D(r){return!(M(r)||function(n){return!!(b["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||b["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||b["Letterlike Symbols"](n)||b["Number Forms"](n)||b["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||b["Control Pictures"](n)&&n!==9251||b["Optical Character Recognition"](n)||b["Enclosed Alphanumerics"](n)||b["Geometric Shapes"](n)||b["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||b["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||b["CJK Symbols and Punctuation"](n)||b.Katakana(n)||b["Private Use Area"](n)||b["CJK Compatibility Forms"](n)||b["Small Form Variants"](n)||b["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(r))}function z(r){return r>=1424&&r<=2303||b["Arabic Presentation Forms-A"](r)||b["Arabic Presentation Forms-B"](r)}function F(r,n){return!(!n&&z(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||b.Khmer(r))}function V(r){for(const n of r)if(z(n.charCodeAt(0)))return!0;return!1}const U="deferred",W="loading",H="loaded";let q=null,G="unavailable",Q=null;const oe=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(G="error"),q&&q(r)};function ce(){K.fire(new Xo("pluginStateChange",{pluginStatus:G,pluginURL:Q}))}const K=new ys,ee=function(){return G},he=function(){if(G!==U||!Q)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");G=W,ce(),Q&&li({url:Q},r=>{r?oe(r):(G=H,ce())})},ge={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>G===H||ge.applyArabicShaping!=null,isLoading:()=>G===W,setState(r){G=r.pluginStatus,Q=r.pluginURL},isParsed:()=>ge.applyArabicShaping!=null&&ge.processBidirectionalText!=null&&ge.processStyledBidirectionalText!=null,getPluginURL:()=>Q};class de{constructor(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(o,l){for(const h of o)if(!F(h.charCodeAt(0),l))return!1;return!0}(n,ge.isLoaded())}}class ye{constructor(n,o,l,h){this.property=n,this.value=o,this.expression=function(f,m,_,x){if(Md(f))return new Dd(f,m);if(Od(f)||Array.isArray(f)&&f.length>0){const w=Ku(f,m,_,x);if(w.result==="error")throw new Error(w.value.map(E=>`${E.key}: ${E.message}`).join(", "));return w.value}{let w=f;return typeof f=="string"&&m.type==="color"&&(w=sr.parse(f)),{kind:"constant",isConfigDependent:!1,evaluate:()=>w}}}(o===void 0?n.specification.default:o,n.specification,l,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,o,l){return this.property.possiblyEvaluate(this,n,o,l)}}class Ne{constructor(n,o,l){this.property=n,this.value=new ye(n,void 0,o,l)}transitioned(n,o){return new Me(this.property,this.value,o,br({},n.transition,this.transition),n.now)}untransitioned(){return new Me(this.property,this.value,null,{},0)}}class Ae{constructor(n,o,l){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=o,this._options=l,this.isConfigDependent=!1}getValue(n){return Zo(this._values[n].value.value)}setValue(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new Ne(this._values[n].property,this._scope,this._options)),this._values[n].value=new ye(this._values[n].property,o===null?void 0:Zo(o),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[n].value.expression.isConfigDependent}setTransitionOrValue(n,o){o&&(this._options=o);const l=this._properties.properties;if(n)for(const h in n){const f=n[h];if(lc(h,"-transition")){const m=h.slice(0,-11);l[m]&&this.setTransition(m,f)}else l[h]&&this.setValue(h,f)}}getTransition(n){return Zo(this._values[n].transition)}setTransition(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new Ne(this._values[n].property)),this._values[n].transition=Zo(o)||void 0}serialize(){const n={};for(const o of Object.keys(this._values)){const l=this.getValue(o);l!==void 0&&(n[o]=l);const h=this.getTransition(o);h!==void 0&&(n[`${o}-transition`]=h)}return n}transitioned(n,o){const l=new xe(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(n,o._values[h]);return l}untransitioned(){const n=new xe(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}}class Me{constructor(n,o,l,h,f){const m=h.delay||0,_=h.duration||0;f=f||0,this.property=n,this.value=o,this.begin=f+m,this.end=this.begin+_,n.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(n,o,l){const h=n.now||0,f=this.value.possiblyEvaluate(n,o,l),m=this.prior;if(m){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return m.possiblyEvaluate(n,o,l);{const _=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(n,o,l),f,si(_))}}return f}}class xe{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,l){const h=new Ve(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(n,o,l);return h}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class ze{constructor(n,o,l){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=o,this._options=l,this.isConfigDependent=!1}getValue(n){return Zo(this._values[n].value)}setValue(n,o){this._values[n]=new ye(this._values[n].property,o===null?void 0:Zo(o),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[n].expression.isConfigDependent}serialize(){const n={};for(const o of Object.keys(this._values)){const l=this.getValue(o);l!==void 0&&(n[o]=l)}return n}possiblyEvaluate(n,o,l){const h=new Ve(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(n,o,l);return h}}class ke{constructor(n,o,l){this.property=n,this.value=o,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,l,h){return this.property.evaluate(this.value,this.parameters,n,o,l,h)}}class Ve{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class ne{constructor(n){this.specification=n}possiblyEvaluate(n,o){return n.expression.evaluate(o)}interpolate(n,o,l){const h=ju[this.specification.type];return h?h(n,o,l):n}}class Te{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,l,h){return new ke(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},l,h)}:n.expression,o)}interpolate(n,o,l){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new ke(this,{kind:"constant",value:void 0},n.parameters);const h=ju[this.specification.type];return h?new ke(this,{kind:"constant",value:h(n.value.value,o.value.value,l)},n.parameters):n}evaluate(n,o,l,h,f,m){return n.kind==="constant"?n.value:n.evaluate(o,l,h,f,m)}}class Xe{constructor(n){this.specification=n}possiblyEvaluate(n,o,l,h){return!!n.expression.evaluate(o,null,{},l,h)}interpolate(){return!1}}class $e{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new de(0,{});for(const l in n){const h=n[l];h.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new ye(h,void 0),m=this.defaultTransitionablePropertyValues[l]=new Ne(h);this.defaultTransitioningPropertyValues[l]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate(o)}}}xt(Te,"DataDrivenProperty"),xt(ne,"DataConstantProperty"),xt(Xe,"ColorRampProperty");const bt="";function mt(r,n){return n?`${r}${bt}${n}`:r}const Dt="-transition";class _t extends ys{constructor(n,o,l,h){if(super(),this.id=n.id,this.fqid=mt(this.id,l),this.type=n.type,this.scope=l,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),n.slot&&(this.slot=n.slot),o.layout&&(this._unevaluatedLayout=new ze(o.layout,this.scope,h),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),o.paint)){this._transitionablePaint=new Ae(o.paint,this.scope,h);for(const f in n.paint)this.setPaintProperty(f,n.paint[f],{validate:!1});for(const f in n.layout)this.setLayoutProperty(f,n.layout[f],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ve(o.paint)}}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,o,l={}){if(o!=null&&this._validate(Cw,`layers.${this.id}.layout.${n}`,n,o,l))return;if(this.type==="custom"&&n==="visibility")return void(this.visibility=o);const h=this._unevaluatedLayout;h._properties.properties[n]&&(h.setValue(n,o),this.isConfigDependent=this.isConfigDependent||h.isConfigDependent,n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(n){return lc(n,Dt)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,o,l={}){if(o!=null&&this._validate(kw,`layers.${this.id}.paint.${n}`,n,o,l))return!1;const h=this._transitionablePaint,f=h._properties.properties;if(lc(n,Dt)){const k=n.slice(0,-11);return f[k]&&h.setTransition(k,o||void 0),!1}if(!f[n])return!1;const m=h._values[n],_=m.value.isDataDriven(),x=m.value;h.setValue(n,o),this.isConfigDependent=this.isConfigDependent||h.isConfigDependent,this._handleSpecialPaintPropertyUpdate(n);const w=h._values[n].value,E=w.isDataDriven(),I=lc(n,"pattern")||n==="line-dasharray";return E||_||I||this._handleOverridablePaintPropertyUpdate(n,x,w)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,o){return null}_handleOverridablePaintPropertyUpdate(n,o,l){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){return id({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(n,o,l,h,f={}){return(!f||f.validate!==!1)&&E0(this,n.call(Rm,{key:o,layerType:this.type,objectKey:l,value:h,styleSpec:Ie,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const o=this.paint.get(n);if(o instanceof ke&&Sa(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Fd(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}const Bt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class jt{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ct{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,o){return n._trim(),o&&(n.isTransferred=!0,o.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Mt(r,n=1){let o=0,l=0;return{members:r.map(h=>{const f=Bt[h.type].BYTES_PER_ELEMENT,m=o=yn(o,Math.max(n,f)),_=h.components||1;return l=Math.max(l,f),o+=f*_,{name:h.name,type:h.type,components:_,offset:m}}),size:yn(o,Math.max(l,n)),alignment:n}}function yn(r,n){return Math.ceil(r/n)*n}class Qt extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){const l=this.length;return this.resize(l+1),this.emplace(l,n,o)}emplace(n,o,l){const h=2*n;return this.int16[h+0]=o,this.int16[h+1]=l,n}}Qt.prototype.bytesPerElement=4,xt(Qt,"StructArrayLayout2i4");class Hn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,l)}emplace(n,o,l,h){const f=3*n;return this.int16[f+0]=o,this.int16[f+1]=l,this.int16[f+2]=h,n}}Hn.prototype.bytesPerElement=6,xt(Hn,"StructArrayLayout3i6");class Nn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,o,l,h)}emplace(n,o,l,h,f){const m=4*n;return this.int16[m+0]=o,this.int16[m+1]=l,this.int16[m+2]=h,this.int16[m+3]=f,n}}Nn.prototype.bytesPerElement=8,xt(Nn,"StructArrayLayout4i8");class Bi extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,l,h,f)}emplace(n,o,l,h,f,m){const _=5*n;return this.int16[_+0]=o,this.int16[_+1]=l,this.int16[_+2]=h,this.int16[_+3]=f,this.int16[_+4]=m,n}}Bi.prototype.bytesPerElement=10,xt(Bi,"StructArrayLayout5i10");class Do extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,n,o,l,h,f,m,_)}emplace(n,o,l,h,f,m,_,x){const w=6*n,E=12*n,I=3*n;return this.int16[w+0]=o,this.int16[w+1]=l,this.uint8[E+4]=h,this.uint8[E+5]=f,this.uint8[E+6]=m,this.uint8[E+7]=_,this.float32[I+2]=x,n}}Do.prototype.bytesPerElement=12,xt(Do,"StructArrayLayout2i4ub1f12");class Rn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,o,l,h)}emplace(n,o,l,h,f){const m=4*n;return this.float32[m+0]=o,this.float32[m+1]=l,this.float32[m+2]=h,this.float32[m+3]=f,n}}Rn.prototype.bytesPerElement=16,xt(Rn,"StructArrayLayout4f16");class wn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,l,h,f)}emplace(n,o,l,h,f,m){const _=6*n,x=3*n;return this.uint16[_+0]=o,this.uint16[_+1]=l,this.uint16[_+2]=h,this.uint16[_+3]=f,this.float32[x+2]=m,n}}wn.prototype.bytesPerElement=12,xt(wn,"StructArrayLayout4ui1f12");class Sn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,o,l,h)}emplace(n,o,l,h,f){const m=4*n;return this.uint16[m+0]=o,this.uint16[m+1]=l,this.uint16[m+2]=h,this.uint16[m+3]=f,n}}Sn.prototype.bytesPerElement=8,xt(Sn,"StructArrayLayout4ui8");class ar extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,l,h,f,m)}emplace(n,o,l,h,f,m,_){const x=6*n;return this.int16[x+0]=o,this.int16[x+1]=l,this.int16[x+2]=h,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=_,n}}ar.prototype.bytesPerElement=12,xt(ar,"StructArrayLayout6i12");class ei extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f,m,_,x,w,E,I,k){const C=this.length;return this.resize(C+1),this.emplace(C,n,o,l,h,f,m,_,x,w,E,I,k)}emplace(n,o,l,h,f,m,_,x,w,E,I,k,C){const R=12*n;return this.int16[R+0]=o,this.int16[R+1]=l,this.int16[R+2]=h,this.int16[R+3]=f,this.uint16[R+4]=m,this.uint16[R+5]=_,this.uint16[R+6]=x,this.uint16[R+7]=w,this.int16[R+8]=E,this.int16[R+9]=I,this.int16[R+10]=k,this.int16[R+11]=C,n}}ei.prototype.bytesPerElement=24,xt(ei,"StructArrayLayout4i4ui4i24");class Jn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,l,h,f,m)}emplace(n,o,l,h,f,m,_){const x=10*n,w=5*n;return this.int16[x+0]=o,this.int16[x+1]=l,this.int16[x+2]=h,this.float32[w+2]=f,this.float32[w+3]=m,this.float32[w+4]=_,n}}Jn.prototype.bytesPerElement=20,xt(Jn,"StructArrayLayout3i3f20");class xi extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}xi.prototype.bytesPerElement=4,xt(xi,"StructArrayLayout1ul4");class ji extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){const l=this.length;return this.resize(l+1),this.emplace(l,n,o)}emplace(n,o,l){const h=2*n;return this.uint16[h+0]=o,this.uint16[h+1]=l,n}}ji.prototype.bytesPerElement=4,xt(ji,"StructArrayLayout2ui4");class bi extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f,m,_,x,w,E,I,k,C){const R=this.length;return this.resize(R+1),this.emplace(R,n,o,l,h,f,m,_,x,w,E,I,k,C)}emplace(n,o,l,h,f,m,_,x,w,E,I,k,C,R){const L=20*n,N=10*n;return this.int16[L+0]=o,this.int16[L+1]=l,this.int16[L+2]=h,this.int16[L+3]=f,this.int16[L+4]=m,this.float32[N+3]=_,this.float32[N+4]=x,this.float32[N+5]=w,this.float32[N+6]=E,this.int16[L+14]=I,this.uint32[N+8]=k,this.uint16[L+18]=C,this.uint16[L+19]=R,n}}bi.prototype.bytesPerElement=40,xt(bi,"StructArrayLayout5i4f1i1ul2ui40");class Lo extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,n,o,l,h,f,m,_)}emplace(n,o,l,h,f,m,_,x){const w=8*n;return this.int16[w+0]=o,this.int16[w+1]=l,this.int16[w+2]=h,this.int16[w+4]=f,this.int16[w+5]=m,this.int16[w+6]=_,this.int16[w+7]=x,n}}Lo.prototype.bytesPerElement=16,xt(Lo,"StructArrayLayout3i2i2i16");class qs extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,l,h,f)}emplace(n,o,l,h,f,m){const _=4*n,x=8*n;return this.float32[_+0]=o,this.float32[_+1]=l,this.float32[_+2]=h,this.int16[x+6]=f,this.int16[x+7]=m,n}}qs.prototype.bytesPerElement=16,xt(qs,"StructArrayLayout2f1f2i16");class ns extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,o,l,h)}emplace(n,o,l,h,f){const m=12*n,_=3*n;return this.uint8[m+0]=o,this.uint8[m+1]=l,this.float32[_+1]=h,this.float32[_+2]=f,n}}ns.prototype.bytesPerElement=12,xt(ns,"StructArrayLayout2ub2f12");class Bn extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,l)}emplace(n,o,l,h){const f=3*n;return this.uint16[f+0]=o,this.uint16[f+1]=l,this.uint16[f+2]=h,n}}Bn.prototype.bytesPerElement=6,xt(Bn,"StructArrayLayout3ui6");class rs extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f,m,_,x,w,E,I,k,C,R,L,N,j,Z,X,J,te){const re=this.length;return this.resize(re+1),this.emplace(re,n,o,l,h,f,m,_,x,w,E,I,k,C,R,L,N,j,Z,X,J,te)}emplace(n,o,l,h,f,m,_,x,w,E,I,k,C,R,L,N,j,Z,X,J,te,re){const pe=30*n,ve=15*n,be=60*n;return this.int16[pe+0]=o,this.int16[pe+1]=l,this.int16[pe+2]=h,this.float32[ve+2]=f,this.float32[ve+3]=m,this.uint16[pe+8]=_,this.uint16[pe+9]=x,this.uint32[ve+5]=w,this.uint32[ve+6]=E,this.uint32[ve+7]=I,this.uint16[pe+16]=k,this.uint16[pe+17]=C,this.uint16[pe+18]=R,this.float32[ve+10]=L,this.float32[ve+11]=N,this.uint8[be+48]=j,this.uint8[be+49]=Z,this.uint8[be+50]=X,this.uint32[ve+13]=J,this.int16[pe+28]=te,this.uint8[be+58]=re,n}}rs.prototype.bytesPerElement=60,xt(rs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ts extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f,m,_,x,w,E,I,k,C,R,L,N,j,Z,X,J,te,re,pe,ve,be,Pe,Se,Fe,Qe,Le,He,De){const ut=this.length;return this.resize(ut+1),this.emplace(ut,n,o,l,h,f,m,_,x,w,E,I,k,C,R,L,N,j,Z,X,J,te,re,pe,ve,be,Pe,Se,Fe,Qe,Le,He,De)}emplace(n,o,l,h,f,m,_,x,w,E,I,k,C,R,L,N,j,Z,X,J,te,re,pe,ve,be,Pe,Se,Fe,Qe,Le,He,De,ut){const yt=20*n,Ke=40*n,Vt=80*n;return this.float32[yt+0]=o,this.float32[yt+1]=l,this.int16[Ke+4]=h,this.int16[Ke+5]=f,this.int16[Ke+6]=m,this.int16[Ke+7]=_,this.int16[Ke+8]=x,this.int16[Ke+9]=w,this.int16[Ke+10]=E,this.int16[Ke+11]=I,this.int16[Ke+12]=k,this.uint16[Ke+13]=C,this.uint16[Ke+14]=R,this.uint16[Ke+15]=L,this.uint16[Ke+16]=N,this.uint16[Ke+17]=j,this.uint16[Ke+18]=Z,this.uint16[Ke+19]=X,this.uint16[Ke+20]=J,this.uint16[Ke+21]=te,this.uint16[Ke+22]=re,this.uint16[Ke+23]=pe,this.uint16[Ke+24]=ve,this.uint16[Ke+25]=be,this.uint16[Ke+26]=Pe,this.uint16[Ke+27]=Se,this.uint32[yt+14]=Fe,this.float32[yt+15]=Qe,this.float32[yt+16]=Le,this.float32[yt+17]=He,this.float32[yt+18]=De,this.uint8[Vt+76]=ut,n}}Ts.prototype.bytesPerElement=80,xt(Ts,"StructArrayLayout2f9i15ui1ul4f1ub80");class Hs extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}Hs.prototype.bytesPerElement=4,xt(Hs,"StructArrayLayout1f4");class eh extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,l,h,f)}emplace(n,o,l,h,f,m){const _=5*n;return this.float32[_+0]=o,this.float32[_+1]=l,this.float32[_+2]=h,this.float32[_+3]=f,this.float32[_+4]=m,n}}eh.prototype.bytesPerElement=20,xt(eh,"StructArrayLayout5f20");class Rw extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,n,o,l,h,f,m,_)}emplace(n,o,l,h,f,m,_,x){const w=7*n;return this.float32[w+0]=o,this.float32[w+1]=l,this.float32[w+2]=h,this.float32[w+3]=f,this.float32[w+4]=m,this.float32[w+5]=_,this.float32[w+6]=x,n}}Rw.prototype.bytesPerElement=28,xt(Rw,"StructArrayLayout7f28");class Ow extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,o,l,h)}emplace(n,o,l,h,f){const m=6*n;return this.uint32[3*n+0]=o,this.uint16[m+2]=l,this.uint16[m+3]=h,this.uint16[m+4]=f,n}}Ow.prototype.bytesPerElement=12,xt(Ow,"StructArrayLayout1ul3ui12");class Om extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}Om.prototype.bytesPerElement=2,xt(Om,"StructArrayLayout1ui2");class th extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,l)}emplace(n,o,l,h){const f=3*n;return this.float32[f+0]=o,this.float32[f+1]=l,this.float32[f+2]=h,n}}th.prototype.bytesPerElement=12,xt(th,"StructArrayLayout3f12");class Dm extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){const l=this.length;return this.resize(l+1),this.emplace(l,n,o)}emplace(n,o,l){const h=2*n;return this.float32[h+0]=o,this.float32[h+1]=l,n}}Dm.prototype.bytesPerElement=8,xt(Dm,"StructArrayLayout2f8");class Dw extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f,m,_,x,w,E,I,k,C,R,L,N){const j=this.length;return this.resize(j+1),this.emplace(j,n,o,l,h,f,m,_,x,w,E,I,k,C,R,L,N)}emplace(n,o,l,h,f,m,_,x,w,E,I,k,C,R,L,N,j){const Z=16*n;return this.float32[Z+0]=o,this.float32[Z+1]=l,this.float32[Z+2]=h,this.float32[Z+3]=f,this.float32[Z+4]=m,this.float32[Z+5]=_,this.float32[Z+6]=x,this.float32[Z+7]=w,this.float32[Z+8]=E,this.float32[Z+9]=I,this.float32[Z+10]=k,this.float32[Z+11]=C,this.float32[Z+12]=R,this.float32[Z+13]=L,this.float32[Z+14]=N,this.float32[Z+15]=j,n}}Dw.prototype.bytesPerElement=64,xt(Dw,"StructArrayLayout16f64");class S0 extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,l,h,f,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,n,o,l,h,f,m,_)}emplace(n,o,l,h,f,m,_,x){const w=10*n,E=5*n;return this.uint16[w+0]=o,this.uint16[w+1]=l,this.uint16[w+2]=h,this.uint16[w+3]=f,this.float32[E+2]=m,this.float32[E+3]=_,this.float32[E+4]=x,n}}S0.prototype.bytesPerElement=20,xt(S0,"StructArrayLayout4ui3f20");class Lw extends Ct{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint8[1*n+0]=o,n}}Lw.prototype.bytesPerElement=1,xt(Lw,"StructArrayLayout1ub1");class mk extends jt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}mk.prototype.size=40;class zw extends bi{get(n){return new mk(this,n)}}xt(zw,"CollisionBoxArray");class gk extends jt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}gk.prototype.size=60;class _k extends rs{get(n){return new gk(this,n)}}xt(_k,"PlacedSymbolArray");class yk extends jt{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}yk.prototype.size=80;class vk extends Ts{get(n){return new yk(this,n)}}xt(vk,"SymbolInstanceArray");class xk extends Hs{getoffsetX(n){return this.float32[1*n+0]}}xt(xk,"GlyphOffsetArray");class bk extends Qt{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}xt(bk,"SymbolLineVertexArray");class wk extends jt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}wk.prototype.size=12;class Tk extends Ow{get(n){return new wk(this,n)}}xt(Tk,"FeatureIndexArray");class Ek extends ji{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}xt(Ek,"FillExtrusionCentroidArray");const mj=Mt([{name:"a_pos",components:2,type:"Int16"}],4),gj=Mt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class mr{constructor(n=[]){this.segments=n}_prepareSegment(n,o,l,h){let f=this.segments[this.segments.length-1];return n>mr.MAX_VERTEX_ARRAY_LENGTH&&pr(`Max vertices per segment is ${mr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!f||f.vertexLength+n>mr.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:o,primitiveOffset:l,vertexLength:0,primitiveLength:0},h!==void 0&&(f.sortKey=h),this.segments.push(f)),f}prepareSegment(n,o,l,h){return this._prepareSegment(n,o.length,l.length,h)}get(){return this.segments}destroy(){for(const n of this.segments)for(const o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,l,h){return new mr([{vertexOffset:n,primitiveOffset:o,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}function Sk(r,n){return 256*(r=Ze(Math.floor(r),0,255))+Ze(Math.floor(n),0,255)}mr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xt(mr,"SegmentVector");const _j=Mt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),yj=Mt([{name:"a_dash",components:4,type:"Uint16"}]);var I0={exports:{}},Ik={exports:{}};(function(r){r.exports=function(n,o){var l,h,f,m,_,x,w,E;for(h=n.length-(l=3&n.length),f=o,_=3432918353,x=461845907,E=0;E<h;)w=255&n.charCodeAt(E)|(255&n.charCodeAt(++E))<<8|(255&n.charCodeAt(++E))<<16|(255&n.charCodeAt(++E))<<24,++E,f=27492+(65535&(m=5*(65535&(f=(f^=w=(65535&(w=(w=(65535&w)*_+(((w>>>16)*_&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(w=0,l){case 3:w^=(255&n.charCodeAt(E+2))<<16;case 2:w^=(255&n.charCodeAt(E+1))<<8;case 1:f^=w=(65535&(w=(w=(65535&(w^=255&n.charCodeAt(E)))*_+(((w>>>16)*_&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return f^=n.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}})(Ik);var vj=Ik.exports,Ak={exports:{}};(function(r){r.exports=function(n,o){for(var l,h=n.length,f=o^h,m=0;h>=4;)l=1540483477*(65535&(l=255&n.charCodeAt(m)|(255&n.charCodeAt(++m))<<8|(255&n.charCodeAt(++m))<<16|(255&n.charCodeAt(++m))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++m;switch(h){case 3:f^=(255&n.charCodeAt(m+2))<<16;case 2:f^=(255&n.charCodeAt(m+1))<<8;case 1:f=1540483477*(65535&(f^=255&n.charCodeAt(m)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}})(Ak);var Pk=vj,xj=Ak.exports;I0.exports=Pk,I0.exports.murmur3=Pk,I0.exports.murmur2=xj;var Nw=fe(I0.exports);class Lm{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,o,l,h){this.ids.push(kk(n)),this.positions.push(o,l,h)}eachPosition(n,o){const l=kk(n);let h=0,f=this.ids.length-1;for(;h<f;){const m=h+f>>1;this.ids[m]>=l?f=m:h=m+1}for(;this.ids[h]===l;)o(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(n,o){const l=new Float64Array(n.ids),h=new Uint32Array(n.positions);return Fw(l,h,0,l.length-1),o&&(o.add(l.buffer),o.add(h.buffer)),{ids:l,positions:h}}static deserialize(n){const o=new Lm;let l;o.ids=n.ids,o.positions=n.positions;for(const h of o.ids)h!==l&&o.uniqueIds.push(h),l=h;return o.indexed=!0,o}}function kk(r){const n=+r;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:Nw(String(r))}function Fw(r,n,o,l){for(;o<l;){const h=r[o+l>>1];let f=o-1,m=l+1;for(;;){do f++;while(r[f]<h);do m--;while(r[m]>h);if(f>=m)break;A0(r,f,m),A0(n,3*f,3*m),A0(n,3*f+1,3*m+1),A0(n,3*f+2,3*m+2)}m-o<l-m?(Fw(r,n,o,m),o=m+1):(Fw(r,n,m+1,l),l=m)}}function A0(r,n,o){const l=r[n];r[n]=r[o],r[o]=l}xt(Lm,"FeaturePositionMap");class _l{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,o),this.initialized=!0),!!this.location}}class P0 extends _l{constructor(n){super(n),this.current=0}set(n,o,l){this.fetchUniformLocation(n,o)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class eo extends _l{constructor(n){super(n),this.current=0}set(n,o,l){this.fetchUniformLocation(n,o)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class nh extends _l{constructor(n){super(n),this.current=[0,0]}set(n,o,l){this.fetchUniformLocation(n,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class Bw extends _l{constructor(n){super(n),this.current=[0,0,0]}set(n,o,l){this.fetchUniformLocation(n,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class Ck extends _l{constructor(n){super(n),this.current=[0,0,0,0]}set(n,o,l){this.fetchUniformLocation(n,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class Mk extends _l{constructor(n){super(n),this.current=sr.transparent}set(n,o,l){this.fetchUniformLocation(n,o)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const bj=new Float32Array(16);class zm extends _l{constructor(n){super(n),this.current=bj}set(n,o,l){if(this.fetchUniformLocation(n,o)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const wj=new Float32Array(9),Tj=new Float32Array(4);class jw extends _l{constructor(n){super(n),this.current=Tj}set(n,o,l){if(this.fetchUniformLocation(n,o)){for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function Vw(r){return[Sk(255*r.r,255*r.g),Sk(255*r.b,255*r.a)]}class Nm{constructor(n,o,l){this.value=n,this.uniformNames=o.map(h=>`u_${h}`),this.type=l}setUniform(n,o,l,h,f){o.set(n,f,h.constantOr(this.value))}getBinding(n,o){return this.type==="color"?new Mk(n):new eo(n)}}class Gd{constructor(n,o){this.uniformNames=o.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,o,l,h,f){const m=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;m&&o.set(n,f,m)}getBinding(n,o){return o==="u_pattern"||o==="u_dash"?new Ck(n):new eo(n)}}class yl{constructor(n,o,l,h){this.expression=n,this.type=l,this.maxValue=0,this.paintVertexAttributes=o.map(f=>({name:`a_${f}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(n,o,l,h,f,m,_){const x=this.paintVertexArray.length,w=this.expression.evaluate(new de(0,{brightness:m}),o,{},f,h,_);this.paintVertexArray.resize(n),this._setPaintValue(x,n,w)}updatePaintArray(n,o,l,h,f,m,_){const x=this.expression.evaluate({zoom:0,brightness:_},l,h,void 0,f);this._setPaintValue(n,o,x)}_setPaintValue(n,o,l){if(this.type==="color"){const h=Vw(l);for(let f=n;f<o;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=n;h<o;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zs{constructor(n,o,l,h,f,m){this.expression=n,this.uniformNames=o.map(_=>`u_${_}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=o.map(_=>({name:`a_${_}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(n,o,l,h,f,m,_){const x=this.expression.evaluate(new de(this.zoom,{brightness:m}),o,{},f,h,_),w=this.expression.evaluate(new de(this.zoom+1,{brightness:m}),o,{},f,h,_),E=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(E,n,x,w)}updatePaintArray(n,o,l,h,f,m,_){const x=this.expression.evaluate({zoom:this.zoom,brightness:_},l,h,void 0,f),w=this.expression.evaluate({zoom:this.zoom+1,brightness:_},l,h,void 0,f);this._setPaintValue(n,o,x,w)}_setPaintValue(n,o,l,h){if(this.type==="color"){const f=Vw(l),m=Vw(h);for(let _=n;_<o;_++)this.paintVertexArray.emplace(_,f[0],f[1],m[0],m[1])}else{for(let f=n;f<o;f++)this.paintVertexArray.emplace(f,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o,l,h,f){const m=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,_=Ze(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);o.set(n,f,_)}getBinding(n,o){return new eo(n)}}class wc{constructor(n,o,l,h,f){this.expression=n,this.layerId=f,this.paintVertexAttributes=(l==="array"?yj:_j).members;for(let m=0;m<o.length;++m);this.paintVertexArray=new h}populatePaintArray(n,o,l){const h=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(h,n,o.patterns&&o.patterns[this.layerId],l)}updatePaintArray(n,o,l,h,f,m,_){this._setPaintValues(n,o,l.patterns&&l.patterns[this.layerId],m)}_setPaintValues(n,o,l,h){if(!h||!l)return;const f=h[l];if(!f)return;const{tl:m,br:_,pixelRatio:x}=f;for(let w=n;w<o;w++)this.paintVertexArray.emplace(w,m[0],m[1],_[0],_[1],x)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class rh{constructor(n,o,l=()=>!0){this.binders={},this._buffers=[];const h=[];for(const f in n.paint._values){const m=n.paint.get(f);if(!l(f)||!(m instanceof ke&&Sa(m.property.specification)))continue;const _=Sj(f,n.type),x=m.value,w=m.property.specification.type,E=!!m.property.useIntegerZoom,I=f==="line-dasharray"||f.endsWith("pattern"),k=f==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||k)if(x.kind==="source"||k||I){const C=Rk(f,w,"source");this.binders[f]=I?new wc(x,_,w,C,n.id):new yl(x,_,w,C),h.push(`/a_${f}`)}else{const C=Rk(f,w,"composite");this.binders[f]=new Zs(x,_,w,E,o,C),h.push(`/z_${f}`)}else this.binders[f]=I?new Gd(x.value,_):new Nm(x.value,_,w),h.push(`/u_${f}`)}this.cacheKey=h.sort().join("")}getMaxValue(n){const o=this.binders[n];return o instanceof yl||o instanceof Zs?o.maxValue:0}populatePaintArrays(n,o,l,h,f,m,_){for(const x in this.binders){const w=this.binders[x];(w instanceof yl||w instanceof Zs||w instanceof wc)&&w.populatePaintArray(n,o,l,h,f,m,_)}}setConstantPatternPositions(n){for(const o in this.binders){const l=this.binders[o];l instanceof Gd&&l.setConstantPatternPositions(n)}}updatePaintArrays(n,o,l,h,f,m,_,x){let w=!1;const E=Object.keys(n),I=E.length!==0,k=I?E:o.uniqueIds;for(const C in this.binders){const R=this.binders[C];if((R instanceof yl||R instanceof Zs||R instanceof wc)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const L=f.paint.get(C);R.expression=L.value;for(const N of k){const j=n[N.toString()];o.eachPosition(N,(Z,X,J)=>{const te=h.feature(Z);R.updatePaintArray(X,J,te,j,m,_,x)})}if(!I)for(const N of l.uniqueIds){const j=n[N.toString()];l.eachPosition(N,(Z,X,J)=>{const te=h.feature(Z);R.updatePaintArray(X,J,te,j,m,_,x)})}w=!0}}return w}defines(){const n=[];for(const o in this.binders){const l=this.binders[o];(l instanceof Nm||l instanceof Gd)&&n.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return n}getBinderAttributes(){const n=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof yl||l instanceof Zs||l instanceof wc)for(let h=0;h<l.paintVertexAttributes.length;h++)n.push(l.paintVertexAttributes[h].name)}return n}getBinderUniforms(){const n=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof Nm||l instanceof Gd||l instanceof Zs)for(const h of l.uniformNames)n.push(h)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const o=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Nm||h instanceof Gd||h instanceof Zs)for(const f of h.uniformNames)o.push({name:f,property:l,binding:h.getBinding(n,f)})}return o}setUniforms(n,o,l,h,f){for(const{name:m,property:_,binding:x}of l)this.binders[_].setUniform(n,x,f,h.get(_),m)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const o=this.binders[n];(o instanceof yl||o instanceof Zs||o instanceof wc)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(n){for(const o in this.binders){const l=this.binders[o];(l instanceof yl||l instanceof Zs||l instanceof wc)&&l.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const o=this.binders[n];(o instanceof yl||o instanceof Zs||o instanceof wc)&&o.destroy()}}}class Tc{constructor(n,o,l=()=>!0){this.programConfigurations={};for(const h of n)this.programConfigurations[h.id]=new rh(h,o,l);this.needsUpload=!1,this._featureMap=new Lm,this._featureMapWithoutIds=new Lm,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,o,l,h,f,m,_,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(n,o,h,f,m,_,x);o.id!==void 0?this._featureMap.add(o.id,l,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,l,h,f,m){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,o,_,h,f,m||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const Ej={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Sj(r,n){return Ej[r]||[r.replace(`${n}-`,"").replace(/-/g,"_")]}const Ij={"line-pattern":{source:wn,composite:wn},"fill-pattern":{source:wn,composite:wn},"fill-extrusion-pattern":{source:wn,composite:wn},"line-dasharray":{source:Sn,composite:Sn}},Aj={color:{source:Dm,composite:Rn},number:{source:Hs,composite:Dm}};function Rk(r,n,o){const l=Ij[r];return l&&l[o]||Aj[n][o]}xt(Nm,"ConstantBinder"),xt(Gd,"PatternConstantBinder"),xt(yl,"SourceExpressionBinder"),xt(wc,"PatternCompositeBinder"),xt(Zs,"CompositeExpressionBinder"),xt(rh,"ProgramConfiguration",{omit:["_buffers"]}),xt(Tc,"ProgramConfigurationSet");class Ec{constructor(n,o){n&&(o?this.setSouthWest(n).setNorthEast(o):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof On?new On(n.lng,n.lat):On.convert(n),this}setSouthWest(n){return this._sw=n instanceof On?new On(n.lng,n.lat):On.convert(n),this}extend(n){const o=this._sw,l=this._ne;let h,f;if(n instanceof On)h=n,f=n;else{if(!(n instanceof Ec))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Ec.convert(n)):this.extend(On.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(On.convert(n)):this;if(h=n._sw,f=n._ne,!h||!f)return this}return o||l?(o.lng=Math.min(h.lng,o.lng),o.lat=Math.min(h.lat,o.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new On(h.lng,h.lat),this._ne=new On(f.lng,f.lat)),this}getCenter(){return new On((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new On(this.getWest(),this.getNorth())}getSouthEast(){return new On(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:o,lat:l}=On.convert(n);let h=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(n){return!n||n instanceof Ec?n:new Ec(n)}}var ti={},ni={};Object.defineProperty(ni,"__esModule",{value:!0}),ni.setMatrixArrayType=function(r){ni.ARRAY_TYPE=Dk=r},ni.toRadian=function(r){return r*kj},ni.equals=function(r,n){return Math.abs(r-n)<=Ok*Math.max(1,Math.abs(r),Math.abs(n))},ni.RANDOM=ni.ARRAY_TYPE=ni.EPSILON=void 0;var Ok=1e-6;ni.EPSILON=Ok;var Dk=typeof Float32Array<"u"?Float32Array:Array;ni.ARRAY_TYPE=Dk;var Pj=Math.random;ni.RANDOM=Pj;var kj=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var r=0,n=arguments.length;n--;)r+=arguments[n]*arguments[n];return Math.sqrt(r)});var gr={};function Uw(r){return Uw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Uw(r)}Object.defineProperty(gr,"__esModule",{value:!0}),gr.create=function(){var r=new Sc.ARRAY_TYPE(4);return Sc.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},gr.clone=function(r){var n=new Sc.ARRAY_TYPE(4);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n},gr.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r},gr.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r},gr.fromValues=function(r,n,o,l){var h=new Sc.ARRAY_TYPE(4);return h[0]=r,h[1]=n,h[2]=o,h[3]=l,h},gr.set=function(r,n,o,l,h){return r[0]=n,r[1]=o,r[2]=l,r[3]=h,r},gr.transpose=function(r,n){if(r===n){var o=n[1];r[1]=n[2],r[2]=o}else r[0]=n[0],r[1]=n[2],r[2]=n[1],r[3]=n[3];return r},gr.invert=function(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=o*f-h*l;return m?(r[0]=f*(m=1/m),r[1]=-l*m,r[2]=-h*m,r[3]=o*m,r):null},gr.adjoint=function(r,n){var o=n[0];return r[0]=n[3],r[1]=-n[1],r[2]=-n[2],r[3]=o,r},gr.determinant=function(r){return r[0]*r[3]-r[2]*r[1]},gr.multiply=zk,gr.rotate=function(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=Math.sin(o),x=Math.cos(o);return r[0]=l*x+f*_,r[1]=h*x+m*_,r[2]=l*-_+f*x,r[3]=h*-_+m*x,r},gr.scale=function(r,n,o){var l=n[1],h=n[2],f=n[3],m=o[0],_=o[1];return r[0]=n[0]*m,r[1]=l*m,r[2]=h*_,r[3]=f*_,r},gr.fromRotation=function(r,n){var o=Math.sin(n),l=Math.cos(n);return r[0]=l,r[1]=o,r[2]=-o,r[3]=l,r},gr.fromScaling=function(r,n){return r[0]=n[0],r[1]=0,r[2]=0,r[3]=n[1],r},gr.str=function(r){return"mat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},gr.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},gr.LDU=function(r,n,o,l){return r[2]=l[2]/l[0],o[0]=l[0],o[1]=l[1],o[3]=l[3]-r[2]*o[1],[r,n,o]},gr.add=function(r,n,o){return r[0]=n[0]+o[0],r[1]=n[1]+o[1],r[2]=n[2]+o[2],r[3]=n[3]+o[3],r},gr.subtract=Nk,gr.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]},gr.equals=function(r,n){var o=r[0],l=r[1],h=r[2],f=r[3],m=n[0],_=n[1],x=n[2],w=n[3];return Math.abs(o-m)<=Sc.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-_)<=Sc.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(h-x)<=Sc.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(f-w)<=Sc.EPSILON*Math.max(1,Math.abs(f),Math.abs(w))},gr.multiplyScalar=function(r,n,o){return r[0]=n[0]*o,r[1]=n[1]*o,r[2]=n[2]*o,r[3]=n[3]*o,r},gr.multiplyScalarAndAdd=function(r,n,o,l){return r[0]=n[0]+o[0]*l,r[1]=n[1]+o[1]*l,r[2]=n[2]+o[2]*l,r[3]=n[3]+o[3]*l,r},gr.sub=gr.mul=void 0;var Sc=function(r,n){if(r&&r.__esModule)return r;if(r===null||Uw(r)!=="object"&&typeof r!="function")return{default:r};var o=Lk(void 0);if(o&&o.has(r))return o.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in r)if(f!=="default"&&Object.prototype.hasOwnProperty.call(r,f)){var m=h?Object.getOwnPropertyDescriptor(r,f):null;m&&(m.get||m.set)?Object.defineProperty(l,f,m):l[f]=r[f]}return l.default=r,o&&o.set(r,l),l}(ni);function Lk(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Lk=function(l){return l?o:n})(r)}function zk(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=o[0],x=o[1],w=o[2],E=o[3];return r[0]=l*_+f*x,r[1]=h*_+m*x,r[2]=l*w+f*E,r[3]=h*w+m*E,r}function Nk(r,n,o){return r[0]=n[0]-o[0],r[1]=n[1]-o[1],r[2]=n[2]-o[2],r[3]=n[3]-o[3],r}gr.mul=zk,gr.sub=Nk;var _r={};function $w(r){return $w=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},$w(r)}Object.defineProperty(_r,"__esModule",{value:!0}),_r.create=function(){var r=new ka.ARRAY_TYPE(6);return ka.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[4]=0,r[5]=0),r[0]=1,r[3]=1,r},_r.clone=function(r){var n=new ka.ARRAY_TYPE(6);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n},_r.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r},_r.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r},_r.fromValues=function(r,n,o,l,h,f){var m=new ka.ARRAY_TYPE(6);return m[0]=r,m[1]=n,m[2]=o,m[3]=l,m[4]=h,m[5]=f,m},_r.set=function(r,n,o,l,h,f,m){return r[0]=n,r[1]=o,r[2]=l,r[3]=h,r[4]=f,r[5]=m,r},_r.invert=function(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=n[4],_=n[5],x=o*f-l*h;return x?(r[0]=f*(x=1/x),r[1]=-l*x,r[2]=-h*x,r[3]=o*x,r[4]=(h*_-f*m)*x,r[5]=(l*m-o*_)*x,r):null},_r.determinant=function(r){return r[0]*r[3]-r[1]*r[2]},_r.multiply=Bk,_r.rotate=function(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=n[4],x=n[5],w=Math.sin(o),E=Math.cos(o);return r[0]=l*E+f*w,r[1]=h*E+m*w,r[2]=l*-w+f*E,r[3]=h*-w+m*E,r[4]=_,r[5]=x,r},_r.scale=function(r,n,o){var l=n[1],h=n[2],f=n[3],m=n[4],_=n[5],x=o[0],w=o[1];return r[0]=n[0]*x,r[1]=l*x,r[2]=h*w,r[3]=f*w,r[4]=m,r[5]=_,r},_r.translate=function(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=n[4],x=n[5],w=o[0],E=o[1];return r[0]=l,r[1]=h,r[2]=f,r[3]=m,r[4]=l*w+f*E+_,r[5]=h*w+m*E+x,r},_r.fromRotation=function(r,n){var o=Math.sin(n),l=Math.cos(n);return r[0]=l,r[1]=o,r[2]=-o,r[3]=l,r[4]=0,r[5]=0,r},_r.fromScaling=function(r,n){return r[0]=n[0],r[1]=0,r[2]=0,r[3]=n[1],r[4]=0,r[5]=0,r},_r.fromTranslation=function(r,n){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=n[0],r[5]=n[1],r},_r.str=function(r){return"mat2d("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+")"},_r.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],1)},_r.add=function(r,n,o){return r[0]=n[0]+o[0],r[1]=n[1]+o[1],r[2]=n[2]+o[2],r[3]=n[3]+o[3],r[4]=n[4]+o[4],r[5]=n[5]+o[5],r},_r.subtract=jk,_r.multiplyScalar=function(r,n,o){return r[0]=n[0]*o,r[1]=n[1]*o,r[2]=n[2]*o,r[3]=n[3]*o,r[4]=n[4]*o,r[5]=n[5]*o,r},_r.multiplyScalarAndAdd=function(r,n,o,l){return r[0]=n[0]+o[0]*l,r[1]=n[1]+o[1]*l,r[2]=n[2]+o[2]*l,r[3]=n[3]+o[3]*l,r[4]=n[4]+o[4]*l,r[5]=n[5]+o[5]*l,r},_r.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]&&r[4]===n[4]&&r[5]===n[5]},_r.equals=function(r,n){var o=r[0],l=r[1],h=r[2],f=r[3],m=r[4],_=r[5],x=n[0],w=n[1],E=n[2],I=n[3],k=n[4],C=n[5];return Math.abs(o-x)<=ka.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(l-w)<=ka.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(h-E)<=ka.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(f-I)<=ka.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(m-k)<=ka.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(_-C)<=ka.EPSILON*Math.max(1,Math.abs(_),Math.abs(C))},_r.sub=_r.mul=void 0;var ka=function(r,n){if(r&&r.__esModule)return r;if(r===null||$w(r)!=="object"&&typeof r!="function")return{default:r};var o=Fk(void 0);if(o&&o.has(r))return o.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in r)if(f!=="default"&&Object.prototype.hasOwnProperty.call(r,f)){var m=h?Object.getOwnPropertyDescriptor(r,f):null;m&&(m.get||m.set)?Object.defineProperty(l,f,m):l[f]=r[f]}return l.default=r,o&&o.set(r,l),l}(ni);function Fk(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Fk=function(l){return l?o:n})(r)}function Bk(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=n[4],x=n[5],w=o[0],E=o[1],I=o[2],k=o[3],C=o[4],R=o[5];return r[0]=l*w+f*E,r[1]=h*w+m*E,r[2]=l*I+f*k,r[3]=h*I+m*k,r[4]=l*C+f*R+_,r[5]=h*C+m*R+x,r}function jk(r,n,o){return r[0]=n[0]-o[0],r[1]=n[1]-o[1],r[2]=n[2]-o[2],r[3]=n[3]-o[3],r[4]=n[4]-o[4],r[5]=n[5]-o[5],r}_r.mul=Bk,_r.sub=jk;var jn={};function Gw(r){return Gw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Gw(r)}Object.defineProperty(jn,"__esModule",{value:!0}),jn.create=function(){var r=new is.ARRAY_TYPE(9);return is.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r},jn.fromMat4=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[4],r[4]=n[5],r[5]=n[6],r[6]=n[8],r[7]=n[9],r[8]=n[10],r},jn.clone=function(r){var n=new is.ARRAY_TYPE(9);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n},jn.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r},jn.fromValues=function(r,n,o,l,h,f,m,_,x){var w=new is.ARRAY_TYPE(9);return w[0]=r,w[1]=n,w[2]=o,w[3]=l,w[4]=h,w[5]=f,w[6]=m,w[7]=_,w[8]=x,w},jn.set=function(r,n,o,l,h,f,m,_,x,w){return r[0]=n,r[1]=o,r[2]=l,r[3]=h,r[4]=f,r[5]=m,r[6]=_,r[7]=x,r[8]=w,r},jn.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},jn.transpose=function(r,n){if(r===n){var o=n[1],l=n[2],h=n[5];r[1]=n[3],r[2]=n[6],r[3]=o,r[5]=n[7],r[6]=l,r[7]=h}else r[0]=n[0],r[1]=n[3],r[2]=n[6],r[3]=n[1],r[4]=n[4],r[5]=n[7],r[6]=n[2],r[7]=n[5],r[8]=n[8];return r},jn.invert=function(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=n[4],_=n[5],x=n[6],w=n[7],E=n[8],I=E*m-_*w,k=-E*f+_*x,C=w*f-m*x,R=o*I+l*k+h*C;return R?(r[0]=I*(R=1/R),r[1]=(-E*l+h*w)*R,r[2]=(_*l-h*m)*R,r[3]=k*R,r[4]=(E*o-h*x)*R,r[5]=(-_*o+h*f)*R,r[6]=C*R,r[7]=(-w*o+l*x)*R,r[8]=(m*o-l*f)*R,r):null},jn.adjoint=function(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=n[4],_=n[5],x=n[6],w=n[7],E=n[8];return r[0]=m*E-_*w,r[1]=h*w-l*E,r[2]=l*_-h*m,r[3]=_*x-f*E,r[4]=o*E-h*x,r[5]=h*f-o*_,r[6]=f*w-m*x,r[7]=l*x-o*w,r[8]=o*m-l*f,r},jn.determinant=function(r){var n=r[3],o=r[4],l=r[5],h=r[6],f=r[7],m=r[8];return r[0]*(m*o-l*f)+r[1]*(-m*n+l*h)+r[2]*(f*n-o*h)},jn.multiply=Uk,jn.translate=function(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=n[4],x=n[5],w=n[6],E=n[7],I=n[8],k=o[0],C=o[1];return r[0]=l,r[1]=h,r[2]=f,r[3]=m,r[4]=_,r[5]=x,r[6]=k*l+C*m+w,r[7]=k*h+C*_+E,r[8]=k*f+C*x+I,r},jn.rotate=function(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=n[4],x=n[5],w=n[6],E=n[7],I=n[8],k=Math.sin(o),C=Math.cos(o);return r[0]=C*l+k*m,r[1]=C*h+k*_,r[2]=C*f+k*x,r[3]=C*m-k*l,r[4]=C*_-k*h,r[5]=C*x-k*f,r[6]=w,r[7]=E,r[8]=I,r},jn.scale=function(r,n,o){var l=o[0],h=o[1];return r[0]=l*n[0],r[1]=l*n[1],r[2]=l*n[2],r[3]=h*n[3],r[4]=h*n[4],r[5]=h*n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r},jn.fromTranslation=function(r,n){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=n[0],r[7]=n[1],r[8]=1,r},jn.fromRotation=function(r,n){var o=Math.sin(n),l=Math.cos(n);return r[0]=l,r[1]=o,r[2]=0,r[3]=-o,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},jn.fromScaling=function(r,n){return r[0]=n[0],r[1]=0,r[2]=0,r[3]=0,r[4]=n[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},jn.fromMat2d=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=0,r[3]=n[2],r[4]=n[3],r[5]=0,r[6]=n[4],r[7]=n[5],r[8]=1,r},jn.fromQuat=function(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=o+o,_=l+l,x=h+h,w=o*m,E=l*m,I=l*_,k=h*m,C=h*_,R=h*x,L=f*m,N=f*_,j=f*x;return r[0]=1-I-R,r[3]=E-j,r[6]=k+N,r[1]=E+j,r[4]=1-w-R,r[7]=C-L,r[2]=k-N,r[5]=C+L,r[8]=1-w-I,r},jn.normalFromMat4=function(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=n[4],_=n[5],x=n[6],w=n[7],E=n[8],I=n[9],k=n[10],C=n[11],R=n[12],L=n[13],N=n[14],j=n[15],Z=o*_-l*m,X=o*x-h*m,J=o*w-f*m,te=l*x-h*_,re=l*w-f*_,pe=h*w-f*x,ve=E*L-I*R,be=E*N-k*R,Pe=E*j-C*R,Se=I*N-k*L,Fe=I*j-C*L,Qe=k*j-C*N,Le=Z*Qe-X*Fe+J*Se+te*Pe-re*be+pe*ve;return Le?(r[0]=(_*Qe-x*Fe+w*Se)*(Le=1/Le),r[1]=(x*Pe-m*Qe-w*be)*Le,r[2]=(m*Fe-_*Pe+w*ve)*Le,r[3]=(h*Fe-l*Qe-f*Se)*Le,r[4]=(o*Qe-h*Pe+f*be)*Le,r[5]=(l*Pe-o*Fe-f*ve)*Le,r[6]=(L*pe-N*re+j*te)*Le,r[7]=(N*J-R*pe-j*X)*Le,r[8]=(R*re-L*J+j*Z)*Le,r):null},jn.projection=function(r,n,o){return r[0]=2/n,r[1]=0,r[2]=0,r[3]=0,r[4]=-2/o,r[5]=0,r[6]=-1,r[7]=1,r[8]=1,r},jn.str=function(r){return"mat3("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+")"},jn.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])},jn.add=function(r,n,o){return r[0]=n[0]+o[0],r[1]=n[1]+o[1],r[2]=n[2]+o[2],r[3]=n[3]+o[3],r[4]=n[4]+o[4],r[5]=n[5]+o[5],r[6]=n[6]+o[6],r[7]=n[7]+o[7],r[8]=n[8]+o[8],r},jn.subtract=$k,jn.multiplyScalar=function(r,n,o){return r[0]=n[0]*o,r[1]=n[1]*o,r[2]=n[2]*o,r[3]=n[3]*o,r[4]=n[4]*o,r[5]=n[5]*o,r[6]=n[6]*o,r[7]=n[7]*o,r[8]=n[8]*o,r},jn.multiplyScalarAndAdd=function(r,n,o,l){return r[0]=n[0]+o[0]*l,r[1]=n[1]+o[1]*l,r[2]=n[2]+o[2]*l,r[3]=n[3]+o[3]*l,r[4]=n[4]+o[4]*l,r[5]=n[5]+o[5]*l,r[6]=n[6]+o[6]*l,r[7]=n[7]+o[7]*l,r[8]=n[8]+o[8]*l,r},jn.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]&&r[4]===n[4]&&r[5]===n[5]&&r[6]===n[6]&&r[7]===n[7]&&r[8]===n[8]},jn.equals=function(r,n){var o=r[0],l=r[1],h=r[2],f=r[3],m=r[4],_=r[5],x=r[6],w=r[7],E=r[8],I=n[0],k=n[1],C=n[2],R=n[3],L=n[4],N=n[5],j=n[6],Z=n[7],X=n[8];return Math.abs(o-I)<=is.EPSILON*Math.max(1,Math.abs(o),Math.abs(I))&&Math.abs(l-k)<=is.EPSILON*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(h-C)<=is.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(f-R)<=is.EPSILON*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(m-L)<=is.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(_-N)<=is.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(x-j)<=is.EPSILON*Math.max(1,Math.abs(x),Math.abs(j))&&Math.abs(w-Z)<=is.EPSILON*Math.max(1,Math.abs(w),Math.abs(Z))&&Math.abs(E-X)<=is.EPSILON*Math.max(1,Math.abs(E),Math.abs(X))},jn.sub=jn.mul=void 0;var is=function(r,n){if(r&&r.__esModule)return r;if(r===null||Gw(r)!=="object"&&typeof r!="function")return{default:r};var o=Vk(void 0);if(o&&o.has(r))return o.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in r)if(f!=="default"&&Object.prototype.hasOwnProperty.call(r,f)){var m=h?Object.getOwnPropertyDescriptor(r,f):null;m&&(m.get||m.set)?Object.defineProperty(l,f,m):l[f]=r[f]}return l.default=r,o&&o.set(r,l),l}(ni);function Vk(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Vk=function(l){return l?o:n})(r)}function Uk(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=n[4],x=n[5],w=n[6],E=n[7],I=n[8],k=o[0],C=o[1],R=o[2],L=o[3],N=o[4],j=o[5],Z=o[6],X=o[7],J=o[8];return r[0]=k*l+C*m+R*w,r[1]=k*h+C*_+R*E,r[2]=k*f+C*x+R*I,r[3]=L*l+N*m+j*w,r[4]=L*h+N*_+j*E,r[5]=L*f+N*x+j*I,r[6]=Z*l+X*m+J*w,r[7]=Z*h+X*_+J*E,r[8]=Z*f+X*x+J*I,r}function $k(r,n,o){return r[0]=n[0]-o[0],r[1]=n[1]-o[1],r[2]=n[2]-o[2],r[3]=n[3]-o[3],r[4]=n[4]-o[4],r[5]=n[5]-o[5],r[6]=n[6]-o[6],r[7]=n[7]-o[7],r[8]=n[8]-o[8],r}jn.mul=Uk,jn.sub=$k;var rn={};function Ww(r){return Ww=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ww(r)}Object.defineProperty(rn,"__esModule",{value:!0}),rn.create=function(){var r=new Ir.ARRAY_TYPE(16);return Ir.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},rn.clone=function(r){var n=new Ir.ARRAY_TYPE(16);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],n},rn.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r},rn.fromValues=function(r,n,o,l,h,f,m,_,x,w,E,I,k,C,R,L){var N=new Ir.ARRAY_TYPE(16);return N[0]=r,N[1]=n,N[2]=o,N[3]=l,N[4]=h,N[5]=f,N[6]=m,N[7]=_,N[8]=x,N[9]=w,N[10]=E,N[11]=I,N[12]=k,N[13]=C,N[14]=R,N[15]=L,N},rn.set=function(r,n,o,l,h,f,m,_,x,w,E,I,k,C,R,L,N){return r[0]=n,r[1]=o,r[2]=l,r[3]=h,r[4]=f,r[5]=m,r[6]=_,r[7]=x,r[8]=w,r[9]=E,r[10]=I,r[11]=k,r[12]=C,r[13]=R,r[14]=L,r[15]=N,r},rn.identity=Wk,rn.transpose=function(r,n){if(r===n){var o=n[1],l=n[2],h=n[3],f=n[6],m=n[7],_=n[11];r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=o,r[6]=n[9],r[7]=n[13],r[8]=l,r[9]=f,r[11]=n[14],r[12]=h,r[13]=m,r[14]=_}else r[0]=n[0],r[1]=n[4],r[2]=n[8],r[3]=n[12],r[4]=n[1],r[5]=n[5],r[6]=n[9],r[7]=n[13],r[8]=n[2],r[9]=n[6],r[10]=n[10],r[11]=n[14],r[12]=n[3],r[13]=n[7],r[14]=n[11],r[15]=n[15];return r},rn.invert=function(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=n[4],_=n[5],x=n[6],w=n[7],E=n[8],I=n[9],k=n[10],C=n[11],R=n[12],L=n[13],N=n[14],j=n[15],Z=o*_-l*m,X=o*x-h*m,J=o*w-f*m,te=l*x-h*_,re=l*w-f*_,pe=h*w-f*x,ve=E*L-I*R,be=E*N-k*R,Pe=E*j-C*R,Se=I*N-k*L,Fe=I*j-C*L,Qe=k*j-C*N,Le=Z*Qe-X*Fe+J*Se+te*Pe-re*be+pe*ve;return Le?(r[0]=(_*Qe-x*Fe+w*Se)*(Le=1/Le),r[1]=(h*Fe-l*Qe-f*Se)*Le,r[2]=(L*pe-N*re+j*te)*Le,r[3]=(k*re-I*pe-C*te)*Le,r[4]=(x*Pe-m*Qe-w*be)*Le,r[5]=(o*Qe-h*Pe+f*be)*Le,r[6]=(N*J-R*pe-j*X)*Le,r[7]=(E*pe-k*J+C*X)*Le,r[8]=(m*Fe-_*Pe+w*ve)*Le,r[9]=(l*Pe-o*Fe-f*ve)*Le,r[10]=(R*re-L*J+j*Z)*Le,r[11]=(I*J-E*re-C*Z)*Le,r[12]=(_*be-m*Se-x*ve)*Le,r[13]=(o*Se-l*be+h*ve)*Le,r[14]=(L*X-R*te-N*Z)*Le,r[15]=(E*te-I*X+k*Z)*Le,r):null},rn.adjoint=function(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=n[4],_=n[5],x=n[6],w=n[7],E=n[8],I=n[9],k=n[10],C=n[11],R=n[12],L=n[13],N=n[14],j=n[15];return r[0]=_*(k*j-C*N)-I*(x*j-w*N)+L*(x*C-w*k),r[1]=-(l*(k*j-C*N)-I*(h*j-f*N)+L*(h*C-f*k)),r[2]=l*(x*j-w*N)-_*(h*j-f*N)+L*(h*w-f*x),r[3]=-(l*(x*C-w*k)-_*(h*C-f*k)+I*(h*w-f*x)),r[4]=-(m*(k*j-C*N)-E*(x*j-w*N)+R*(x*C-w*k)),r[5]=o*(k*j-C*N)-E*(h*j-f*N)+R*(h*C-f*k),r[6]=-(o*(x*j-w*N)-m*(h*j-f*N)+R*(h*w-f*x)),r[7]=o*(x*C-w*k)-m*(h*C-f*k)+E*(h*w-f*x),r[8]=m*(I*j-C*L)-E*(_*j-w*L)+R*(_*C-w*I),r[9]=-(o*(I*j-C*L)-E*(l*j-f*L)+R*(l*C-f*I)),r[10]=o*(_*j-w*L)-m*(l*j-f*L)+R*(l*w-f*_),r[11]=-(o*(_*C-w*I)-m*(l*C-f*I)+E*(l*w-f*_)),r[12]=-(m*(I*N-k*L)-E*(_*N-x*L)+R*(_*k-x*I)),r[13]=o*(I*N-k*L)-E*(l*N-h*L)+R*(l*k-h*I),r[14]=-(o*(_*N-x*L)-m*(l*N-h*L)+R*(l*x-h*_)),r[15]=o*(_*k-x*I)-m*(l*k-h*I)+E*(l*x-h*_),r},rn.determinant=function(r){var n=r[0],o=r[1],l=r[2],h=r[3],f=r[4],m=r[5],_=r[6],x=r[7],w=r[8],E=r[9],I=r[10],k=r[11],C=r[12],R=r[13],L=r[14],N=r[15];return(n*m-o*f)*(I*N-k*L)-(n*_-l*f)*(E*N-k*R)+(n*x-h*f)*(E*L-I*R)+(o*_-l*m)*(w*N-k*C)-(o*x-h*m)*(w*L-I*C)+(l*x-h*_)*(w*R-E*C)},rn.multiply=qk,rn.translate=function(r,n,o){var l,h,f,m,_,x,w,E,I,k,C,R,L=o[0],N=o[1],j=o[2];return n===r?(r[12]=n[0]*L+n[4]*N+n[8]*j+n[12],r[13]=n[1]*L+n[5]*N+n[9]*j+n[13],r[14]=n[2]*L+n[6]*N+n[10]*j+n[14],r[15]=n[3]*L+n[7]*N+n[11]*j+n[15]):(h=n[1],f=n[2],m=n[3],_=n[4],x=n[5],w=n[6],E=n[7],I=n[8],k=n[9],C=n[10],R=n[11],r[0]=l=n[0],r[1]=h,r[2]=f,r[3]=m,r[4]=_,r[5]=x,r[6]=w,r[7]=E,r[8]=I,r[9]=k,r[10]=C,r[11]=R,r[12]=l*L+_*N+I*j+n[12],r[13]=h*L+x*N+k*j+n[13],r[14]=f*L+w*N+C*j+n[14],r[15]=m*L+E*N+R*j+n[15]),r},rn.scale=function(r,n,o){var l=o[0],h=o[1],f=o[2];return r[0]=n[0]*l,r[1]=n[1]*l,r[2]=n[2]*l,r[3]=n[3]*l,r[4]=n[4]*h,r[5]=n[5]*h,r[6]=n[6]*h,r[7]=n[7]*h,r[8]=n[8]*f,r[9]=n[9]*f,r[10]=n[10]*f,r[11]=n[11]*f,r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r},rn.rotate=function(r,n,o,l){var h,f,m,_,x,w,E,I,k,C,R,L,N,j,Z,X,J,te,re,pe,ve,be,Pe,Se,Fe=l[0],Qe=l[1],Le=l[2],He=Math.hypot(Fe,Qe,Le);return He<Ir.EPSILON?null:(Fe*=He=1/He,Qe*=He,Le*=He,h=Math.sin(o),f=Math.cos(o),x=n[1],w=n[2],E=n[3],k=n[5],C=n[6],R=n[7],N=n[9],j=n[10],Z=n[11],re=Fe*Qe*(m=1-f)-Le*h,pe=Qe*Qe*m+f,ve=Le*Qe*m+Fe*h,be=Fe*Le*m+Qe*h,Pe=Qe*Le*m-Fe*h,Se=Le*Le*m+f,r[0]=(_=n[0])*(X=Fe*Fe*m+f)+(I=n[4])*(J=Qe*Fe*m+Le*h)+(L=n[8])*(te=Le*Fe*m-Qe*h),r[1]=x*X+k*J+N*te,r[2]=w*X+C*J+j*te,r[3]=E*X+R*J+Z*te,r[4]=_*re+I*pe+L*ve,r[5]=x*re+k*pe+N*ve,r[6]=w*re+C*pe+j*ve,r[7]=E*re+R*pe+Z*ve,r[8]=_*be+I*Pe+L*Se,r[9]=x*be+k*Pe+N*Se,r[10]=w*be+C*Pe+j*Se,r[11]=E*be+R*Pe+Z*Se,n!==r&&(r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r)},rn.rotateX=function(r,n,o){var l=Math.sin(o),h=Math.cos(o),f=n[4],m=n[5],_=n[6],x=n[7],w=n[8],E=n[9],I=n[10],k=n[11];return n!==r&&(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[4]=f*h+w*l,r[5]=m*h+E*l,r[6]=_*h+I*l,r[7]=x*h+k*l,r[8]=w*h-f*l,r[9]=E*h-m*l,r[10]=I*h-_*l,r[11]=k*h-x*l,r},rn.rotateY=function(r,n,o){var l=Math.sin(o),h=Math.cos(o),f=n[0],m=n[1],_=n[2],x=n[3],w=n[8],E=n[9],I=n[10],k=n[11];return n!==r&&(r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[0]=f*h-w*l,r[1]=m*h-E*l,r[2]=_*h-I*l,r[3]=x*h-k*l,r[8]=f*l+w*h,r[9]=m*l+E*h,r[10]=_*l+I*h,r[11]=x*l+k*h,r},rn.rotateZ=function(r,n,o){var l=Math.sin(o),h=Math.cos(o),f=n[0],m=n[1],_=n[2],x=n[3],w=n[4],E=n[5],I=n[6],k=n[7];return n!==r&&(r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]),r[0]=f*h+w*l,r[1]=m*h+E*l,r[2]=_*h+I*l,r[3]=x*h+k*l,r[4]=w*h-f*l,r[5]=E*h-m*l,r[6]=I*h-_*l,r[7]=k*h-x*l,r},rn.fromTranslation=function(r,n){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r},rn.fromScaling=function(r,n){return r[0]=n[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=n[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rn.fromRotation=function(r,n,o){var l,h,f,m=o[0],_=o[1],x=o[2],w=Math.hypot(m,_,x);return w<Ir.EPSILON?null:(m*=w=1/w,_*=w,x*=w,l=Math.sin(n),h=Math.cos(n),r[0]=m*m*(f=1-h)+h,r[1]=_*m*f+x*l,r[2]=x*m*f-_*l,r[3]=0,r[4]=m*_*f-x*l,r[5]=_*_*f+h,r[6]=x*_*f+m*l,r[7]=0,r[8]=m*x*f+_*l,r[9]=_*x*f-m*l,r[10]=x*x*f+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)},rn.fromXRotation=function(r,n){var o=Math.sin(n),l=Math.cos(n);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=l,r[6]=o,r[7]=0,r[8]=0,r[9]=-o,r[10]=l,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rn.fromYRotation=function(r,n){var o=Math.sin(n),l=Math.cos(n);return r[0]=l,r[1]=0,r[2]=-o,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=o,r[9]=0,r[10]=l,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rn.fromZRotation=function(r,n){var o=Math.sin(n),l=Math.cos(n);return r[0]=l,r[1]=o,r[2]=0,r[3]=0,r[4]=-o,r[5]=l,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rn.fromRotationTranslation=Hk,rn.fromQuat2=function(r,n){var o=new Ir.ARRAY_TYPE(3),l=-n[0],h=-n[1],f=-n[2],m=n[3],_=n[4],x=n[5],w=n[6],E=n[7],I=l*l+h*h+f*f+m*m;return I>0?(o[0]=2*(_*m+E*l+x*f-w*h)/I,o[1]=2*(x*m+E*h+w*l-_*f)/I,o[2]=2*(w*m+E*f+_*h-x*l)/I):(o[0]=2*(_*m+E*l+x*f-w*h),o[1]=2*(x*m+E*h+w*l-_*f),o[2]=2*(w*m+E*f+_*h-x*l)),Hk(r,n,o),r},rn.getTranslation=function(r,n){return r[0]=n[12],r[1]=n[13],r[2]=n[14],r},rn.getScaling=Zk,rn.getRotation=function(r,n){var o=new Ir.ARRAY_TYPE(3);Zk(o,n);var l=1/o[0],h=1/o[1],f=1/o[2],m=n[0]*l,_=n[1]*h,x=n[2]*f,w=n[4]*l,E=n[5]*h,I=n[6]*f,k=n[8]*l,C=n[9]*h,R=n[10]*f,L=m+E+R,N=0;return L>0?(N=2*Math.sqrt(L+1),r[3]=.25*N,r[0]=(I-C)/N,r[1]=(k-x)/N,r[2]=(_-w)/N):m>E&&m>R?(N=2*Math.sqrt(1+m-E-R),r[3]=(I-C)/N,r[0]=.25*N,r[1]=(_+w)/N,r[2]=(k+x)/N):E>R?(N=2*Math.sqrt(1+E-m-R),r[3]=(k-x)/N,r[0]=(_+w)/N,r[1]=.25*N,r[2]=(I+C)/N):(N=2*Math.sqrt(1+R-m-E),r[3]=(_-w)/N,r[0]=(k+x)/N,r[1]=(I+C)/N,r[2]=.25*N),r},rn.fromRotationTranslationScale=function(r,n,o,l){var h=n[0],f=n[1],m=n[2],_=n[3],x=h+h,w=f+f,E=m+m,I=h*x,k=h*w,C=h*E,R=f*w,L=f*E,N=m*E,j=_*x,Z=_*w,X=_*E,J=l[0],te=l[1],re=l[2];return r[0]=(1-(R+N))*J,r[1]=(k+X)*J,r[2]=(C-Z)*J,r[3]=0,r[4]=(k-X)*te,r[5]=(1-(I+N))*te,r[6]=(L+j)*te,r[7]=0,r[8]=(C+Z)*re,r[9]=(L-j)*re,r[10]=(1-(I+R))*re,r[11]=0,r[12]=o[0],r[13]=o[1],r[14]=o[2],r[15]=1,r},rn.fromRotationTranslationScaleOrigin=function(r,n,o,l,h){var f=n[0],m=n[1],_=n[2],x=n[3],w=f+f,E=m+m,I=_+_,k=f*w,C=f*E,R=f*I,L=m*E,N=m*I,j=_*I,Z=x*w,X=x*E,J=x*I,te=l[0],re=l[1],pe=l[2],ve=h[0],be=h[1],Pe=h[2],Se=(1-(L+j))*te,Fe=(C+J)*te,Qe=(R-X)*te,Le=(C-J)*re,He=(1-(k+j))*re,De=(N+Z)*re,ut=(R+X)*pe,yt=(N-Z)*pe,Ke=(1-(k+L))*pe;return r[0]=Se,r[1]=Fe,r[2]=Qe,r[3]=0,r[4]=Le,r[5]=He,r[6]=De,r[7]=0,r[8]=ut,r[9]=yt,r[10]=Ke,r[11]=0,r[12]=o[0]+ve-(Se*ve+Le*be+ut*Pe),r[13]=o[1]+be-(Fe*ve+He*be+yt*Pe),r[14]=o[2]+Pe-(Qe*ve+De*be+Ke*Pe),r[15]=1,r},rn.fromQuat=function(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=o+o,_=l+l,x=h+h,w=o*m,E=l*m,I=l*_,k=h*m,C=h*_,R=h*x,L=f*m,N=f*_,j=f*x;return r[0]=1-I-R,r[1]=E+j,r[2]=k-N,r[3]=0,r[4]=E-j,r[5]=1-w-R,r[6]=C+L,r[7]=0,r[8]=k+N,r[9]=C-L,r[10]=1-w-I,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},rn.frustum=function(r,n,o,l,h,f,m){var _=1/(o-n),x=1/(h-l),w=1/(f-m);return r[0]=2*f*_,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*f*x,r[6]=0,r[7]=0,r[8]=(o+n)*_,r[9]=(h+l)*x,r[10]=(m+f)*w,r[11]=-1,r[12]=0,r[13]=0,r[14]=m*f*2*w,r[15]=0,r},rn.perspectiveNO=Xk,rn.perspectiveZO=function(r,n,o,l,h){var f,m=1/Math.tan(n/2);return r[0]=m/o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=h*(f=1/(l-h)),r[14]=h*l*f):(r[10]=-1,r[14]=-l),r},rn.perspectiveFromFieldOfView=function(r,n,o,l){var h=Math.tan(n.upDegrees*Math.PI/180),f=Math.tan(n.downDegrees*Math.PI/180),m=Math.tan(n.leftDegrees*Math.PI/180),_=Math.tan(n.rightDegrees*Math.PI/180),x=2/(m+_),w=2/(h+f);return r[0]=x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=w,r[6]=0,r[7]=0,r[8]=-(m-_)*x*.5,r[9]=(h-f)*w*.5,r[10]=l/(o-l),r[11]=-1,r[12]=0,r[13]=0,r[14]=l*o/(o-l),r[15]=0,r},rn.orthoNO=Yk,rn.orthoZO=function(r,n,o,l,h,f,m){var _=1/(n-o),x=1/(l-h),w=1/(f-m);return r[0]=-2*_,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=w,r[11]=0,r[12]=(n+o)*_,r[13]=(h+l)*x,r[14]=f*w,r[15]=1,r},rn.lookAt=function(r,n,o,l){var h,f,m,_,x,w,E,I,k,C,R=n[0],L=n[1],N=n[2],j=l[0],Z=l[1],X=l[2],J=o[0],te=o[1],re=o[2];return Math.abs(R-J)<Ir.EPSILON&&Math.abs(L-te)<Ir.EPSILON&&Math.abs(N-re)<Ir.EPSILON?Wk(r):(E=R-J,I=L-te,k=N-re,h=Z*(k*=C=1/Math.hypot(E,I,k))-X*(I*=C),f=X*(E*=C)-j*k,m=j*I-Z*E,(C=Math.hypot(h,f,m))?(h*=C=1/C,f*=C,m*=C):(h=0,f=0,m=0),_=I*m-k*f,x=k*h-E*m,w=E*f-I*h,(C=Math.hypot(_,x,w))?(_*=C=1/C,x*=C,w*=C):(_=0,x=0,w=0),r[0]=h,r[1]=_,r[2]=E,r[3]=0,r[4]=f,r[5]=x,r[6]=I,r[7]=0,r[8]=m,r[9]=w,r[10]=k,r[11]=0,r[12]=-(h*R+f*L+m*N),r[13]=-(_*R+x*L+w*N),r[14]=-(E*R+I*L+k*N),r[15]=1,r)},rn.targetTo=function(r,n,o,l){var h=n[0],f=n[1],m=n[2],_=l[0],x=l[1],w=l[2],E=h-o[0],I=f-o[1],k=m-o[2],C=E*E+I*I+k*k;C>0&&(E*=C=1/Math.sqrt(C),I*=C,k*=C);var R=x*k-w*I,L=w*E-_*k,N=_*I-x*E;return(C=R*R+L*L+N*N)>0&&(R*=C=1/Math.sqrt(C),L*=C,N*=C),r[0]=R,r[1]=L,r[2]=N,r[3]=0,r[4]=I*N-k*L,r[5]=k*R-E*N,r[6]=E*L-I*R,r[7]=0,r[8]=E,r[9]=I,r[10]=k,r[11]=0,r[12]=h,r[13]=f,r[14]=m,r[15]=1,r},rn.str=function(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"},rn.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])},rn.add=function(r,n,o){return r[0]=n[0]+o[0],r[1]=n[1]+o[1],r[2]=n[2]+o[2],r[3]=n[3]+o[3],r[4]=n[4]+o[4],r[5]=n[5]+o[5],r[6]=n[6]+o[6],r[7]=n[7]+o[7],r[8]=n[8]+o[8],r[9]=n[9]+o[9],r[10]=n[10]+o[10],r[11]=n[11]+o[11],r[12]=n[12]+o[12],r[13]=n[13]+o[13],r[14]=n[14]+o[14],r[15]=n[15]+o[15],r},rn.subtract=Kk,rn.multiplyScalar=function(r,n,o){return r[0]=n[0]*o,r[1]=n[1]*o,r[2]=n[2]*o,r[3]=n[3]*o,r[4]=n[4]*o,r[5]=n[5]*o,r[6]=n[6]*o,r[7]=n[7]*o,r[8]=n[8]*o,r[9]=n[9]*o,r[10]=n[10]*o,r[11]=n[11]*o,r[12]=n[12]*o,r[13]=n[13]*o,r[14]=n[14]*o,r[15]=n[15]*o,r},rn.multiplyScalarAndAdd=function(r,n,o,l){return r[0]=n[0]+o[0]*l,r[1]=n[1]+o[1]*l,r[2]=n[2]+o[2]*l,r[3]=n[3]+o[3]*l,r[4]=n[4]+o[4]*l,r[5]=n[5]+o[5]*l,r[6]=n[6]+o[6]*l,r[7]=n[7]+o[7]*l,r[8]=n[8]+o[8]*l,r[9]=n[9]+o[9]*l,r[10]=n[10]+o[10]*l,r[11]=n[11]+o[11]*l,r[12]=n[12]+o[12]*l,r[13]=n[13]+o[13]*l,r[14]=n[14]+o[14]*l,r[15]=n[15]+o[15]*l,r},rn.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]&&r[4]===n[4]&&r[5]===n[5]&&r[6]===n[6]&&r[7]===n[7]&&r[8]===n[8]&&r[9]===n[9]&&r[10]===n[10]&&r[11]===n[11]&&r[12]===n[12]&&r[13]===n[13]&&r[14]===n[14]&&r[15]===n[15]},rn.equals=function(r,n){var o=r[0],l=r[1],h=r[2],f=r[3],m=r[4],_=r[5],x=r[6],w=r[7],E=r[8],I=r[9],k=r[10],C=r[11],R=r[12],L=r[13],N=r[14],j=r[15],Z=n[0],X=n[1],J=n[2],te=n[3],re=n[4],pe=n[5],ve=n[6],be=n[7],Pe=n[8],Se=n[9],Fe=n[10],Qe=n[11],Le=n[12],He=n[13],De=n[14],ut=n[15];return Math.abs(o-Z)<=Ir.EPSILON*Math.max(1,Math.abs(o),Math.abs(Z))&&Math.abs(l-X)<=Ir.EPSILON*Math.max(1,Math.abs(l),Math.abs(X))&&Math.abs(h-J)<=Ir.EPSILON*Math.max(1,Math.abs(h),Math.abs(J))&&Math.abs(f-te)<=Ir.EPSILON*Math.max(1,Math.abs(f),Math.abs(te))&&Math.abs(m-re)<=Ir.EPSILON*Math.max(1,Math.abs(m),Math.abs(re))&&Math.abs(_-pe)<=Ir.EPSILON*Math.max(1,Math.abs(_),Math.abs(pe))&&Math.abs(x-ve)<=Ir.EPSILON*Math.max(1,Math.abs(x),Math.abs(ve))&&Math.abs(w-be)<=Ir.EPSILON*Math.max(1,Math.abs(w),Math.abs(be))&&Math.abs(E-Pe)<=Ir.EPSILON*Math.max(1,Math.abs(E),Math.abs(Pe))&&Math.abs(I-Se)<=Ir.EPSILON*Math.max(1,Math.abs(I),Math.abs(Se))&&Math.abs(k-Fe)<=Ir.EPSILON*Math.max(1,Math.abs(k),Math.abs(Fe))&&Math.abs(C-Qe)<=Ir.EPSILON*Math.max(1,Math.abs(C),Math.abs(Qe))&&Math.abs(R-Le)<=Ir.EPSILON*Math.max(1,Math.abs(R),Math.abs(Le))&&Math.abs(L-He)<=Ir.EPSILON*Math.max(1,Math.abs(L),Math.abs(He))&&Math.abs(N-De)<=Ir.EPSILON*Math.max(1,Math.abs(N),Math.abs(De))&&Math.abs(j-ut)<=Ir.EPSILON*Math.max(1,Math.abs(j),Math.abs(ut))},rn.sub=rn.mul=rn.ortho=rn.perspective=void 0;var Ir=function(r,n){if(r&&r.__esModule)return r;if(r===null||Ww(r)!=="object"&&typeof r!="function")return{default:r};var o=Gk(void 0);if(o&&o.has(r))return o.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in r)if(f!=="default"&&Object.prototype.hasOwnProperty.call(r,f)){var m=h?Object.getOwnPropertyDescriptor(r,f):null;m&&(m.get||m.set)?Object.defineProperty(l,f,m):l[f]=r[f]}return l.default=r,o&&o.set(r,l),l}(ni);function Gk(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Gk=function(l){return l?o:n})(r)}function Wk(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function qk(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=n[4],x=n[5],w=n[6],E=n[7],I=n[8],k=n[9],C=n[10],R=n[11],L=n[12],N=n[13],j=n[14],Z=n[15],X=o[0],J=o[1],te=o[2],re=o[3];return r[0]=X*l+J*_+te*I+re*L,r[1]=X*h+J*x+te*k+re*N,r[2]=X*f+J*w+te*C+re*j,r[3]=X*m+J*E+te*R+re*Z,r[4]=(X=o[4])*l+(J=o[5])*_+(te=o[6])*I+(re=o[7])*L,r[5]=X*h+J*x+te*k+re*N,r[6]=X*f+J*w+te*C+re*j,r[7]=X*m+J*E+te*R+re*Z,r[8]=(X=o[8])*l+(J=o[9])*_+(te=o[10])*I+(re=o[11])*L,r[9]=X*h+J*x+te*k+re*N,r[10]=X*f+J*w+te*C+re*j,r[11]=X*m+J*E+te*R+re*Z,r[12]=(X=o[12])*l+(J=o[13])*_+(te=o[14])*I+(re=o[15])*L,r[13]=X*h+J*x+te*k+re*N,r[14]=X*f+J*w+te*C+re*j,r[15]=X*m+J*E+te*R+re*Z,r}function Hk(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=l+l,x=h+h,w=f+f,E=l*_,I=l*x,k=l*w,C=h*x,R=h*w,L=f*w,N=m*_,j=m*x,Z=m*w;return r[0]=1-(C+L),r[1]=I+Z,r[2]=k-j,r[3]=0,r[4]=I-Z,r[5]=1-(E+L),r[6]=R+N,r[7]=0,r[8]=k+j,r[9]=R-N,r[10]=1-(E+C),r[11]=0,r[12]=o[0],r[13]=o[1],r[14]=o[2],r[15]=1,r}function Zk(r,n){var o=n[4],l=n[5],h=n[6],f=n[8],m=n[9],_=n[10];return r[0]=Math.hypot(n[0],n[1],n[2]),r[1]=Math.hypot(o,l,h),r[2]=Math.hypot(f,m,_),r}function Xk(r,n,o,l,h){var f,m=1/Math.tan(n/2);return r[0]=m/o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=(h+l)*(f=1/(l-h)),r[14]=2*h*l*f):(r[10]=-1,r[14]=-2*l),r}function Yk(r,n,o,l,h,f,m){var _=1/(n-o),x=1/(l-h),w=1/(f-m);return r[0]=-2*_,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*w,r[11]=0,r[12]=(n+o)*_,r[13]=(h+l)*x,r[14]=(m+f)*w,r[15]=1,r}function Kk(r,n,o){return r[0]=n[0]-o[0],r[1]=n[1]-o[1],r[2]=n[2]-o[2],r[3]=n[3]-o[3],r[4]=n[4]-o[4],r[5]=n[5]-o[5],r[6]=n[6]-o[6],r[7]=n[7]-o[7],r[8]=n[8]-o[8],r[9]=n[9]-o[9],r[10]=n[10]-o[10],r[11]=n[11]-o[11],r[12]=n[12]-o[12],r[13]=n[13]-o[13],r[14]=n[14]-o[14],r[15]=n[15]-o[15],r}rn.perspective=Xk,rn.ortho=Yk,rn.mul=qk,rn.sub=Kk;var Jt={},nn={};function qw(r){return qw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},qw(r)}Object.defineProperty(nn,"__esModule",{value:!0}),nn.create=Qk,nn.clone=function(r){var n=new vl.ARRAY_TYPE(3);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n},nn.length=eC,nn.fromValues=function(r,n,o){var l=new vl.ARRAY_TYPE(3);return l[0]=r,l[1]=n,l[2]=o,l},nn.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r},nn.set=function(r,n,o,l){return r[0]=n,r[1]=o,r[2]=l,r},nn.add=function(r,n,o){return r[0]=n[0]+o[0],r[1]=n[1]+o[1],r[2]=n[2]+o[2],r},nn.subtract=tC,nn.multiply=nC,nn.divide=rC,nn.ceil=function(r,n){return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r[2]=Math.ceil(n[2]),r},nn.floor=function(r,n){return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r[2]=Math.floor(n[2]),r},nn.min=function(r,n,o){return r[0]=Math.min(n[0],o[0]),r[1]=Math.min(n[1],o[1]),r[2]=Math.min(n[2],o[2]),r},nn.max=function(r,n,o){return r[0]=Math.max(n[0],o[0]),r[1]=Math.max(n[1],o[1]),r[2]=Math.max(n[2],o[2]),r},nn.round=function(r,n){return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r[2]=Math.round(n[2]),r},nn.scale=function(r,n,o){return r[0]=n[0]*o,r[1]=n[1]*o,r[2]=n[2]*o,r},nn.scaleAndAdd=function(r,n,o,l){return r[0]=n[0]+o[0]*l,r[1]=n[1]+o[1]*l,r[2]=n[2]+o[2]*l,r},nn.distance=iC,nn.squaredDistance=oC,nn.squaredLength=sC,nn.negate=function(r,n){return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r},nn.inverse=function(r,n){return r[0]=1/n[0],r[1]=1/n[1],r[2]=1/n[2],r},nn.normalize=function(r,n){var o=n[0],l=n[1],h=n[2],f=o*o+l*l+h*h;return f>0&&(f=1/Math.sqrt(f)),r[0]=n[0]*f,r[1]=n[1]*f,r[2]=n[2]*f,r},nn.dot=aC,nn.cross=function(r,n,o){var l=n[0],h=n[1],f=n[2],m=o[0],_=o[1],x=o[2];return r[0]=h*x-f*_,r[1]=f*m-l*x,r[2]=l*_-h*m,r},nn.lerp=function(r,n,o,l){var h=n[0],f=n[1],m=n[2];return r[0]=h+l*(o[0]-h),r[1]=f+l*(o[1]-f),r[2]=m+l*(o[2]-m),r},nn.hermite=function(r,n,o,l,h,f){var m=f*f,_=m*(2*f-3)+1,x=m*(f-2)+f,w=m*(f-1),E=m*(3-2*f);return r[0]=n[0]*_+o[0]*x+l[0]*w+h[0]*E,r[1]=n[1]*_+o[1]*x+l[1]*w+h[1]*E,r[2]=n[2]*_+o[2]*x+l[2]*w+h[2]*E,r},nn.bezier=function(r,n,o,l,h,f){var m=1-f,_=m*m,x=f*f,w=_*m,E=3*f*_,I=3*x*m,k=x*f;return r[0]=n[0]*w+o[0]*E+l[0]*I+h[0]*k,r[1]=n[1]*w+o[1]*E+l[1]*I+h[1]*k,r[2]=n[2]*w+o[2]*E+l[2]*I+h[2]*k,r},nn.random=function(r,n){n=n||1;var o=2*vl.RANDOM()*Math.PI,l=2*vl.RANDOM()-1,h=Math.sqrt(1-l*l)*n;return r[0]=Math.cos(o)*h,r[1]=Math.sin(o)*h,r[2]=l*n,r},nn.transformMat4=function(r,n,o){var l=n[0],h=n[1],f=n[2],m=o[3]*l+o[7]*h+o[11]*f+o[15];return r[0]=(o[0]*l+o[4]*h+o[8]*f+o[12])/(m=m||1),r[1]=(o[1]*l+o[5]*h+o[9]*f+o[13])/m,r[2]=(o[2]*l+o[6]*h+o[10]*f+o[14])/m,r},nn.transformMat3=function(r,n,o){var l=n[0],h=n[1],f=n[2];return r[0]=l*o[0]+h*o[3]+f*o[6],r[1]=l*o[1]+h*o[4]+f*o[7],r[2]=l*o[2]+h*o[5]+f*o[8],r},nn.transformQuat=function(r,n,o){var l=o[0],h=o[1],f=o[2],m=n[0],_=n[1],x=n[2],w=h*x-f*_,E=f*m-l*x,I=l*_-h*m,k=h*I-f*E,C=f*w-l*I,R=l*E-h*w,L=2*o[3];return E*=L,I*=L,C*=2,R*=2,r[0]=m+(w*=L)+(k*=2),r[1]=_+E+C,r[2]=x+I+R,r},nn.rotateX=function(r,n,o,l){var h=[],f=[];return h[0]=n[0]-o[0],h[1]=n[1]-o[1],h[2]=n[2]-o[2],f[0]=h[0],f[1]=h[1]*Math.cos(l)-h[2]*Math.sin(l),f[2]=h[1]*Math.sin(l)+h[2]*Math.cos(l),r[0]=f[0]+o[0],r[1]=f[1]+o[1],r[2]=f[2]+o[2],r},nn.rotateY=function(r,n,o,l){var h=[],f=[];return h[0]=n[0]-o[0],h[1]=n[1]-o[1],h[2]=n[2]-o[2],f[0]=h[2]*Math.sin(l)+h[0]*Math.cos(l),f[1]=h[1],f[2]=h[2]*Math.cos(l)-h[0]*Math.sin(l),r[0]=f[0]+o[0],r[1]=f[1]+o[1],r[2]=f[2]+o[2],r},nn.rotateZ=function(r,n,o,l){var h=[],f=[];return h[0]=n[0]-o[0],h[1]=n[1]-o[1],h[2]=n[2]-o[2],f[0]=h[0]*Math.cos(l)-h[1]*Math.sin(l),f[1]=h[0]*Math.sin(l)+h[1]*Math.cos(l),f[2]=h[2],r[0]=f[0]+o[0],r[1]=f[1]+o[1],r[2]=f[2]+o[2],r},nn.angle=function(r,n){var o=r[0],l=r[1],h=r[2],f=n[0],m=n[1],_=n[2],x=Math.sqrt(o*o+l*l+h*h)*Math.sqrt(f*f+m*m+_*_),w=x&&aC(r,n)/x;return Math.acos(Math.min(Math.max(w,-1),1))},nn.zero=function(r){return r[0]=0,r[1]=0,r[2]=0,r},nn.str=function(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"},nn.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]},nn.equals=function(r,n){var o=r[0],l=r[1],h=r[2],f=n[0],m=n[1],_=n[2];return Math.abs(o-f)<=vl.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(l-m)<=vl.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(h-_)<=vl.EPSILON*Math.max(1,Math.abs(h),Math.abs(_))},nn.forEach=nn.sqrLen=nn.len=nn.sqrDist=nn.dist=nn.div=nn.mul=nn.sub=void 0;var vl=function(r,n){if(r&&r.__esModule)return r;if(r===null||qw(r)!=="object"&&typeof r!="function")return{default:r};var o=Jk(void 0);if(o&&o.has(r))return o.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in r)if(f!=="default"&&Object.prototype.hasOwnProperty.call(r,f)){var m=h?Object.getOwnPropertyDescriptor(r,f):null;m&&(m.get||m.set)?Object.defineProperty(l,f,m):l[f]=r[f]}return l.default=r,o&&o.set(r,l),l}(ni);function Jk(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Jk=function(l){return l?o:n})(r)}function Qk(){var r=new vl.ARRAY_TYPE(3);return vl.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function eC(r){return Math.hypot(r[0],r[1],r[2])}function tC(r,n,o){return r[0]=n[0]-o[0],r[1]=n[1]-o[1],r[2]=n[2]-o[2],r}function nC(r,n,o){return r[0]=n[0]*o[0],r[1]=n[1]*o[1],r[2]=n[2]*o[2],r}function rC(r,n,o){return r[0]=n[0]/o[0],r[1]=n[1]/o[1],r[2]=n[2]/o[2],r}function iC(r,n){return Math.hypot(n[0]-r[0],n[1]-r[1],n[2]-r[2])}function oC(r,n){var o=n[0]-r[0],l=n[1]-r[1],h=n[2]-r[2];return o*o+l*l+h*h}function sC(r){var n=r[0],o=r[1],l=r[2];return n*n+o*o+l*l}function aC(r,n){return r[0]*n[0]+r[1]*n[1]+r[2]*n[2]}nn.sub=tC,nn.mul=nC,nn.div=rC,nn.dist=iC,nn.sqrDist=oC,nn.len=eC,nn.sqrLen=sC;var xl,Cj=(xl=Qk(),function(r,n,o,l,h,f){var m,_;for(n||(n=3),o||(o=0),_=l?Math.min(l*n+o,r.length):r.length,m=o;m<_;m+=n)xl[0]=r[m],xl[1]=r[m+1],xl[2]=r[m+2],h(xl,xl,f),r[m]=xl[0],r[m+1]=xl[1],r[m+2]=xl[2];return r});nn.forEach=Cj;var cn={};function Hw(r){return Hw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Hw(r)}Object.defineProperty(cn,"__esModule",{value:!0}),cn.create=cC,cn.clone=function(r){var n=new Es.ARRAY_TYPE(4);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n},cn.fromValues=function(r,n,o,l){var h=new Es.ARRAY_TYPE(4);return h[0]=r,h[1]=n,h[2]=o,h[3]=l,h},cn.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r},cn.set=function(r,n,o,l,h){return r[0]=n,r[1]=o,r[2]=l,r[3]=h,r},cn.add=function(r,n,o){return r[0]=n[0]+o[0],r[1]=n[1]+o[1],r[2]=n[2]+o[2],r[3]=n[3]+o[3],r},cn.subtract=uC,cn.multiply=hC,cn.divide=dC,cn.ceil=function(r,n){return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r[2]=Math.ceil(n[2]),r[3]=Math.ceil(n[3]),r},cn.floor=function(r,n){return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r[2]=Math.floor(n[2]),r[3]=Math.floor(n[3]),r},cn.min=function(r,n,o){return r[0]=Math.min(n[0],o[0]),r[1]=Math.min(n[1],o[1]),r[2]=Math.min(n[2],o[2]),r[3]=Math.min(n[3],o[3]),r},cn.max=function(r,n,o){return r[0]=Math.max(n[0],o[0]),r[1]=Math.max(n[1],o[1]),r[2]=Math.max(n[2],o[2]),r[3]=Math.max(n[3],o[3]),r},cn.round=function(r,n){return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r[2]=Math.round(n[2]),r[3]=Math.round(n[3]),r},cn.scale=function(r,n,o){return r[0]=n[0]*o,r[1]=n[1]*o,r[2]=n[2]*o,r[3]=n[3]*o,r},cn.scaleAndAdd=function(r,n,o,l){return r[0]=n[0]+o[0]*l,r[1]=n[1]+o[1]*l,r[2]=n[2]+o[2]*l,r[3]=n[3]+o[3]*l,r},cn.distance=fC,cn.squaredDistance=pC,cn.length=mC,cn.squaredLength=gC,cn.negate=function(r,n){return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=-n[3],r},cn.inverse=function(r,n){return r[0]=1/n[0],r[1]=1/n[1],r[2]=1/n[2],r[3]=1/n[3],r},cn.normalize=function(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=o*o+l*l+h*h+f*f;return m>0&&(m=1/Math.sqrt(m)),r[0]=o*m,r[1]=l*m,r[2]=h*m,r[3]=f*m,r},cn.dot=function(r,n){return r[0]*n[0]+r[1]*n[1]+r[2]*n[2]+r[3]*n[3]},cn.cross=function(r,n,o,l){var h=o[0]*l[1]-o[1]*l[0],f=o[0]*l[2]-o[2]*l[0],m=o[0]*l[3]-o[3]*l[0],_=o[1]*l[2]-o[2]*l[1],x=o[1]*l[3]-o[3]*l[1],w=o[2]*l[3]-o[3]*l[2],E=n[0],I=n[1],k=n[2],C=n[3];return r[0]=I*w-k*x+C*_,r[1]=-E*w+k*m-C*f,r[2]=E*x-I*m+C*h,r[3]=-E*_+I*f-k*h,r},cn.lerp=function(r,n,o,l){var h=n[0],f=n[1],m=n[2],_=n[3];return r[0]=h+l*(o[0]-h),r[1]=f+l*(o[1]-f),r[2]=m+l*(o[2]-m),r[3]=_+l*(o[3]-_),r},cn.random=function(r,n){var o,l,h,f,m,_;n=n||1;do m=(o=2*Es.RANDOM()-1)*o+(l=2*Es.RANDOM()-1)*l;while(m>=1);do _=(h=2*Es.RANDOM()-1)*h+(f=2*Es.RANDOM()-1)*f;while(_>=1);var x=Math.sqrt((1-m)/_);return r[0]=n*o,r[1]=n*l,r[2]=n*h*x,r[3]=n*f*x,r},cn.transformMat4=function(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3];return r[0]=o[0]*l+o[4]*h+o[8]*f+o[12]*m,r[1]=o[1]*l+o[5]*h+o[9]*f+o[13]*m,r[2]=o[2]*l+o[6]*h+o[10]*f+o[14]*m,r[3]=o[3]*l+o[7]*h+o[11]*f+o[15]*m,r},cn.transformQuat=function(r,n,o){var l=n[0],h=n[1],f=n[2],m=o[0],_=o[1],x=o[2],w=o[3],E=w*l+_*f-x*h,I=w*h+x*l-m*f,k=w*f+m*h-_*l,C=-m*l-_*h-x*f;return r[0]=E*w+C*-m+I*-x-k*-_,r[1]=I*w+C*-_+k*-m-E*-x,r[2]=k*w+C*-x+E*-_-I*-m,r[3]=n[3],r},cn.zero=function(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r},cn.str=function(r){return"vec4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},cn.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]},cn.equals=function(r,n){var o=r[0],l=r[1],h=r[2],f=r[3],m=n[0],_=n[1],x=n[2],w=n[3];return Math.abs(o-m)<=Es.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(l-_)<=Es.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(h-x)<=Es.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(f-w)<=Es.EPSILON*Math.max(1,Math.abs(f),Math.abs(w))},cn.forEach=cn.sqrLen=cn.len=cn.sqrDist=cn.dist=cn.div=cn.mul=cn.sub=void 0;var Es=function(r,n){if(r&&r.__esModule)return r;if(r===null||Hw(r)!=="object"&&typeof r!="function")return{default:r};var o=lC(void 0);if(o&&o.has(r))return o.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in r)if(f!=="default"&&Object.prototype.hasOwnProperty.call(r,f)){var m=h?Object.getOwnPropertyDescriptor(r,f):null;m&&(m.get||m.set)?Object.defineProperty(l,f,m):l[f]=r[f]}return l.default=r,o&&o.set(r,l),l}(ni);function lC(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(lC=function(l){return l?o:n})(r)}function cC(){var r=new Es.ARRAY_TYPE(4);return Es.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function uC(r,n,o){return r[0]=n[0]-o[0],r[1]=n[1]-o[1],r[2]=n[2]-o[2],r[3]=n[3]-o[3],r}function hC(r,n,o){return r[0]=n[0]*o[0],r[1]=n[1]*o[1],r[2]=n[2]*o[2],r[3]=n[3]*o[3],r}function dC(r,n,o){return r[0]=n[0]/o[0],r[1]=n[1]/o[1],r[2]=n[2]/o[2],r[3]=n[3]/o[3],r}function fC(r,n){return Math.hypot(n[0]-r[0],n[1]-r[1],n[2]-r[2],n[3]-r[3])}function pC(r,n){var o=n[0]-r[0],l=n[1]-r[1],h=n[2]-r[2],f=n[3]-r[3];return o*o+l*l+h*h+f*f}function mC(r){return Math.hypot(r[0],r[1],r[2],r[3])}function gC(r){var n=r[0],o=r[1],l=r[2],h=r[3];return n*n+o*o+l*l+h*h}cn.sub=uC,cn.mul=hC,cn.div=dC,cn.dist=fC,cn.sqrDist=pC,cn.len=mC,cn.sqrLen=gC;var Mj=function(){var r=cC();return function(n,o,l,h,f,m){var _,x;for(o||(o=4),l||(l=0),x=h?Math.min(h*o+l,n.length):n.length,_=l;_<x;_+=o)r[0]=n[_],r[1]=n[_+1],r[2]=n[_+2],r[3]=n[_+3],f(r,r,m),n[_]=r[0],n[_+1]=r[1],n[_+2]=r[2],n[_+3]=r[3];return n}}();function Zw(r){return Zw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Zw(r)}cn.forEach=Mj,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.create=Xw,Jt.identity=function(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r},Jt.setAxisAngle=yC,Jt.getAxisAngle=function(r,n){var o=2*Math.acos(n[3]),l=Math.sin(o/2);return l>ih.EPSILON?(r[0]=n[0]/l,r[1]=n[1]/l,r[2]=n[2]/l):(r[0]=1,r[1]=0,r[2]=0),o},Jt.getAngle=function(r,n){var o=EC(r,n);return Math.acos(2*o*o-1)},Jt.multiply=vC,Jt.rotateX=function(r,n,o){o*=.5;var l=n[0],h=n[1],f=n[2],m=n[3],_=Math.sin(o),x=Math.cos(o);return r[0]=l*x+m*_,r[1]=h*x+f*_,r[2]=f*x-h*_,r[3]=m*x-l*_,r},Jt.rotateY=function(r,n,o){o*=.5;var l=n[0],h=n[1],f=n[2],m=n[3],_=Math.sin(o),x=Math.cos(o);return r[0]=l*x-f*_,r[1]=h*x+m*_,r[2]=f*x+l*_,r[3]=m*x-h*_,r},Jt.rotateZ=function(r,n,o){o*=.5;var l=n[0],h=n[1],f=n[2],m=n[3],_=Math.sin(o),x=Math.cos(o);return r[0]=l*x+h*_,r[1]=h*x-l*_,r[2]=f*x+m*_,r[3]=m*x-f*_,r},Jt.calculateW=function(r,n){var o=n[0],l=n[1],h=n[2];return r[0]=o,r[1]=l,r[2]=h,r[3]=Math.sqrt(Math.abs(1-o*o-l*l-h*h)),r},Jt.exp=xC,Jt.ln=bC,Jt.pow=function(r,n,o){return bC(r,n),TC(r,r,o),xC(r,r),r},Jt.slerp=C0,Jt.random=function(r){var n=ih.RANDOM(),o=ih.RANDOM(),l=ih.RANDOM(),h=Math.sqrt(1-n),f=Math.sqrt(n);return r[0]=h*Math.sin(2*Math.PI*o),r[1]=h*Math.cos(2*Math.PI*o),r[2]=f*Math.sin(2*Math.PI*l),r[3]=f*Math.cos(2*Math.PI*l),r},Jt.invert=function(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=o*o+l*l+h*h+f*f,_=m?1/m:0;return r[0]=-o*_,r[1]=-l*_,r[2]=-h*_,r[3]=f*_,r},Jt.conjugate=function(r,n){return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=n[3],r},Jt.fromMat3=wC,Jt.fromEuler=function(r,n,o,l){var h=.5*Math.PI/180;n*=h,o*=h,l*=h;var f=Math.sin(n),m=Math.cos(n),_=Math.sin(o),x=Math.cos(o),w=Math.sin(l),E=Math.cos(l);return r[0]=f*x*E-m*_*w,r[1]=m*_*E+f*x*w,r[2]=m*x*w-f*_*E,r[3]=m*x*E+f*_*w,r},Jt.str=function(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},Jt.setAxes=Jt.sqlerp=Jt.rotationTo=Jt.equals=Jt.exactEquals=Jt.normalize=Jt.sqrLen=Jt.squaredLength=Jt.len=Jt.length=Jt.lerp=Jt.dot=Jt.scale=Jt.mul=Jt.add=Jt.set=Jt.copy=Jt.fromValues=Jt.clone=void 0;var ih=k0(ni),Rj=k0(jn),bl=k0(nn),os=k0(cn);function _C(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(_C=function(l){return l?o:n})(r)}function k0(r,n){if(!n&&r&&r.__esModule)return r;if(r===null||Zw(r)!=="object"&&typeof r!="function")return{default:r};var o=_C(n);if(o&&o.has(r))return o.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in r)if(f!=="default"&&Object.prototype.hasOwnProperty.call(r,f)){var m=h?Object.getOwnPropertyDescriptor(r,f):null;m&&(m.get||m.set)?Object.defineProperty(l,f,m):l[f]=r[f]}return l.default=r,o&&o.set(r,l),l}function Xw(){var r=new ih.ARRAY_TYPE(4);return ih.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function yC(r,n,o){o*=.5;var l=Math.sin(o);return r[0]=l*n[0],r[1]=l*n[1],r[2]=l*n[2],r[3]=Math.cos(o),r}function vC(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=o[0],x=o[1],w=o[2],E=o[3];return r[0]=l*E+m*_+h*w-f*x,r[1]=h*E+m*x+f*_-l*w,r[2]=f*E+m*w+l*x-h*_,r[3]=m*E-l*_-h*x-f*w,r}function xC(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=Math.sqrt(o*o+l*l+h*h),_=Math.exp(f),x=m>0?_*Math.sin(m)/m:0;return r[0]=o*x,r[1]=l*x,r[2]=h*x,r[3]=_*Math.cos(m),r}function bC(r,n){var o=n[0],l=n[1],h=n[2],f=n[3],m=Math.sqrt(o*o+l*l+h*h),_=m>0?Math.atan2(m,f)/m:0;return r[0]=o*_,r[1]=l*_,r[2]=h*_,r[3]=.5*Math.log(o*o+l*l+h*h+f*f),r}function C0(r,n,o,l){var h,f,m,_,x,w=n[0],E=n[1],I=n[2],k=n[3],C=o[0],R=o[1],L=o[2],N=o[3];return(f=w*C+E*R+I*L+k*N)<0&&(f=-f,C=-C,R=-R,L=-L,N=-N),1-f>ih.EPSILON?(h=Math.acos(f),m=Math.sin(h),_=Math.sin((1-l)*h)/m,x=Math.sin(l*h)/m):(_=1-l,x=l),r[0]=_*w+x*C,r[1]=_*E+x*R,r[2]=_*I+x*L,r[3]=_*k+x*N,r}function wC(r,n){var o,l=n[0]+n[4]+n[8];if(l>0)o=Math.sqrt(l+1),r[3]=.5*o,r[0]=(n[5]-n[7])*(o=.5/o),r[1]=(n[6]-n[2])*o,r[2]=(n[1]-n[3])*o;else{var h=0;n[4]>n[0]&&(h=1),n[8]>n[3*h+h]&&(h=2);var f=(h+1)%3,m=(h+2)%3;o=Math.sqrt(n[3*h+h]-n[3*f+f]-n[3*m+m]+1),r[h]=.5*o,r[3]=(n[3*f+m]-n[3*m+f])*(o=.5/o),r[f]=(n[3*f+h]+n[3*h+f])*o,r[m]=(n[3*m+h]+n[3*h+m])*o}return r}Jt.clone=os.clone,Jt.fromValues=os.fromValues,Jt.copy=os.copy,Jt.set=os.set,Jt.add=os.add,Jt.mul=vC;var TC=os.scale;Jt.scale=TC;var EC=os.dot;Jt.dot=EC,Jt.lerp=os.lerp;var SC=os.length;Jt.length=SC,Jt.len=SC;var IC=os.squaredLength;Jt.squaredLength=IC,Jt.sqrLen=IC;var Yw=os.normalize;Jt.normalize=Yw,Jt.exactEquals=os.exactEquals,Jt.equals=os.equals;var Xs,AC,PC,Oj=(Xs=bl.create(),AC=bl.fromValues(1,0,0),PC=bl.fromValues(0,1,0),function(r,n,o){var l=bl.dot(n,o);return l<-.999999?(bl.cross(Xs,AC,n),bl.len(Xs)<1e-6&&bl.cross(Xs,PC,n),bl.normalize(Xs,Xs),yC(r,Xs,Math.PI),r):l>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(bl.cross(Xs,n,o),r[0]=Xs[0],r[1]=Xs[1],r[2]=Xs[2],r[3]=1+l,Yw(r,r))});Jt.rotationTo=Oj;var Kw,Jw,Dj=(Kw=Xw(),Jw=Xw(),function(r,n,o,l,h,f){return C0(Kw,n,h,f),C0(Jw,o,l,f),C0(r,Kw,Jw,2*f*(1-f)),r});Jt.sqlerp=Dj;var Ys,Lj=(Ys=Rj.create(),function(r,n,o,l){return Ys[0]=o[0],Ys[3]=o[1],Ys[6]=o[2],Ys[1]=l[0],Ys[4]=l[1],Ys[7]=l[2],Ys[2]=-n[0],Ys[5]=-n[1],Ys[8]=-n[2],Yw(r,wC(r,Ys))});Jt.setAxes=Lj;var mn={};function Qw(r){return Qw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Qw(r)}Object.defineProperty(mn,"__esModule",{value:!0}),mn.create=function(){var r=new vo.ARRAY_TYPE(8);return vo.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[4]=0,r[5]=0,r[6]=0,r[7]=0),r[3]=1,r},mn.clone=function(r){var n=new vo.ARRAY_TYPE(8);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n},mn.fromValues=function(r,n,o,l,h,f,m,_){var x=new vo.ARRAY_TYPE(8);return x[0]=r,x[1]=n,x[2]=o,x[3]=l,x[4]=h,x[5]=f,x[6]=m,x[7]=_,x},mn.fromRotationTranslationValues=function(r,n,o,l,h,f,m){var _=new vo.ARRAY_TYPE(8);_[0]=r,_[1]=n,_[2]=o,_[3]=l;var x=.5*h,w=.5*f,E=.5*m;return _[4]=x*l+w*o-E*n,_[5]=w*l+E*r-x*o,_[6]=E*l+x*n-w*r,_[7]=-x*r-w*n-E*o,_},mn.fromRotationTranslation=MC,mn.fromTranslation=function(r,n){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=.5*n[0],r[5]=.5*n[1],r[6]=.5*n[2],r[7]=0,r},mn.fromRotation=function(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=0,r[5]=0,r[6]=0,r[7]=0,r},mn.fromMat4=function(r,n){var o=wl.create();kC.getRotation(o,n);var l=new vo.ARRAY_TYPE(3);return kC.getTranslation(l,n),MC(r,o,l),r},mn.copy=RC,mn.identity=function(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r[6]=0,r[7]=0,r},mn.set=function(r,n,o,l,h,f,m,_,x){return r[0]=n,r[1]=o,r[2]=l,r[3]=h,r[4]=f,r[5]=m,r[6]=_,r[7]=x,r},mn.getDual=function(r,n){return r[0]=n[4],r[1]=n[5],r[2]=n[6],r[3]=n[7],r},mn.setDual=function(r,n){return r[4]=n[0],r[5]=n[1],r[6]=n[2],r[7]=n[3],r},mn.getTranslation=function(r,n){var o=n[4],l=n[5],h=n[6],f=n[7],m=-n[0],_=-n[1],x=-n[2],w=n[3];return r[0]=2*(o*w+f*m+l*x-h*_),r[1]=2*(l*w+f*_+h*m-o*x),r[2]=2*(h*w+f*x+o*_-l*m),r},mn.translate=function(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=.5*o[0],x=.5*o[1],w=.5*o[2],E=n[4],I=n[5],k=n[6],C=n[7];return r[0]=l,r[1]=h,r[2]=f,r[3]=m,r[4]=m*_+h*w-f*x+E,r[5]=m*x+f*_-l*w+I,r[6]=m*w+l*x-h*_+k,r[7]=-l*_-h*x-f*w+C,r},mn.rotateX=function(r,n,o){var l=-n[0],h=-n[1],f=-n[2],m=n[3],_=n[4],x=n[5],w=n[6],E=n[7],I=_*m+E*l+x*f-w*h,k=x*m+E*h+w*l-_*f,C=w*m+E*f+_*h-x*l,R=E*m-_*l-x*h-w*f;return wl.rotateX(r,n,o),r[4]=I*(m=r[3])+R*(l=r[0])+k*(f=r[2])-C*(h=r[1]),r[5]=k*m+R*h+C*l-I*f,r[6]=C*m+R*f+I*h-k*l,r[7]=R*m-I*l-k*h-C*f,r},mn.rotateY=function(r,n,o){var l=-n[0],h=-n[1],f=-n[2],m=n[3],_=n[4],x=n[5],w=n[6],E=n[7],I=_*m+E*l+x*f-w*h,k=x*m+E*h+w*l-_*f,C=w*m+E*f+_*h-x*l,R=E*m-_*l-x*h-w*f;return wl.rotateY(r,n,o),r[4]=I*(m=r[3])+R*(l=r[0])+k*(f=r[2])-C*(h=r[1]),r[5]=k*m+R*h+C*l-I*f,r[6]=C*m+R*f+I*h-k*l,r[7]=R*m-I*l-k*h-C*f,r},mn.rotateZ=function(r,n,o){var l=-n[0],h=-n[1],f=-n[2],m=n[3],_=n[4],x=n[5],w=n[6],E=n[7],I=_*m+E*l+x*f-w*h,k=x*m+E*h+w*l-_*f,C=w*m+E*f+_*h-x*l,R=E*m-_*l-x*h-w*f;return wl.rotateZ(r,n,o),r[4]=I*(m=r[3])+R*(l=r[0])+k*(f=r[2])-C*(h=r[1]),r[5]=k*m+R*h+C*l-I*f,r[6]=C*m+R*f+I*h-k*l,r[7]=R*m-I*l-k*h-C*f,r},mn.rotateByQuatAppend=function(r,n,o){var l=o[0],h=o[1],f=o[2],m=o[3],_=n[0],x=n[1],w=n[2],E=n[3];return r[0]=_*m+E*l+x*f-w*h,r[1]=x*m+E*h+w*l-_*f,r[2]=w*m+E*f+_*h-x*l,r[3]=E*m-_*l-x*h-w*f,r[4]=(_=n[4])*m+(E=n[7])*l+(x=n[5])*f-(w=n[6])*h,r[5]=x*m+E*h+w*l-_*f,r[6]=w*m+E*f+_*h-x*l,r[7]=E*m-_*l-x*h-w*f,r},mn.rotateByQuatPrepend=function(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=o[0],x=o[1],w=o[2],E=o[3];return r[0]=l*E+m*_+h*w-f*x,r[1]=h*E+m*x+f*_-l*w,r[2]=f*E+m*w+l*x-h*_,r[3]=m*E-l*_-h*x-f*w,r[4]=l*(E=o[7])+m*(_=o[4])+h*(w=o[6])-f*(x=o[5]),r[5]=h*E+m*x+f*_-l*w,r[6]=f*E+m*w+l*x-h*_,r[7]=m*E-l*_-h*x-f*w,r},mn.rotateAroundAxis=function(r,n,o,l){if(Math.abs(l)<vo.EPSILON)return RC(r,n);var h=Math.hypot(o[0],o[1],o[2]);l*=.5;var f=Math.sin(l),m=f*o[0]/h,_=f*o[1]/h,x=f*o[2]/h,w=Math.cos(l),E=n[0],I=n[1],k=n[2],C=n[3];r[0]=E*w+C*m+I*x-k*_,r[1]=I*w+C*_+k*m-E*x,r[2]=k*w+C*x+E*_-I*m,r[3]=C*w-E*m-I*_-k*x;var R=n[4],L=n[5],N=n[6],j=n[7];return r[4]=R*w+j*m+L*x-N*_,r[5]=L*w+j*_+N*m-R*x,r[6]=N*w+j*x+R*_-L*m,r[7]=j*w-R*m-L*_-N*x,r},mn.add=function(r,n,o){return r[0]=n[0]+o[0],r[1]=n[1]+o[1],r[2]=n[2]+o[2],r[3]=n[3]+o[3],r[4]=n[4]+o[4],r[5]=n[5]+o[5],r[6]=n[6]+o[6],r[7]=n[7]+o[7],r},mn.multiply=OC,mn.scale=function(r,n,o){return r[0]=n[0]*o,r[1]=n[1]*o,r[2]=n[2]*o,r[3]=n[3]*o,r[4]=n[4]*o,r[5]=n[5]*o,r[6]=n[6]*o,r[7]=n[7]*o,r},mn.lerp=function(r,n,o,l){var h=1-l;return DC(n,o)<0&&(l=-l),r[0]=n[0]*h+o[0]*l,r[1]=n[1]*h+o[1]*l,r[2]=n[2]*h+o[2]*l,r[3]=n[3]*h+o[3]*l,r[4]=n[4]*h+o[4]*l,r[5]=n[5]*h+o[5]*l,r[6]=n[6]*h+o[6]*l,r[7]=n[7]*h+o[7]*l,r},mn.invert=function(r,n){var o=M0(n);return r[0]=-n[0]/o,r[1]=-n[1]/o,r[2]=-n[2]/o,r[3]=n[3]/o,r[4]=-n[4]/o,r[5]=-n[5]/o,r[6]=-n[6]/o,r[7]=n[7]/o,r},mn.conjugate=function(r,n){return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=n[3],r[4]=-n[4],r[5]=-n[5],r[6]=-n[6],r[7]=n[7],r},mn.normalize=function(r,n){var o=M0(n);if(o>0){o=Math.sqrt(o);var l=n[0]/o,h=n[1]/o,f=n[2]/o,m=n[3]/o,_=n[4],x=n[5],w=n[6],E=n[7],I=l*_+h*x+f*w+m*E;r[0]=l,r[1]=h,r[2]=f,r[3]=m,r[4]=(_-l*I)/o,r[5]=(x-h*I)/o,r[6]=(w-f*I)/o,r[7]=(E-m*I)/o}return r},mn.str=function(r){return"quat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+")"},mn.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]&&r[4]===n[4]&&r[5]===n[5]&&r[6]===n[6]&&r[7]===n[7]},mn.equals=function(r,n){var o=r[0],l=r[1],h=r[2],f=r[3],m=r[4],_=r[5],x=r[6],w=r[7],E=n[0],I=n[1],k=n[2],C=n[3],R=n[4],L=n[5],N=n[6],j=n[7];return Math.abs(o-E)<=vo.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(l-I)<=vo.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(h-k)<=vo.EPSILON*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(f-C)<=vo.EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(m-R)<=vo.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(_-L)<=vo.EPSILON*Math.max(1,Math.abs(_),Math.abs(L))&&Math.abs(x-N)<=vo.EPSILON*Math.max(1,Math.abs(x),Math.abs(N))&&Math.abs(w-j)<=vo.EPSILON*Math.max(1,Math.abs(w),Math.abs(j))},mn.sqrLen=mn.squaredLength=mn.len=mn.length=mn.dot=mn.mul=mn.setReal=mn.getReal=void 0;var vo=e2(ni),wl=e2(Jt),kC=e2(rn);function CC(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(CC=function(l){return l?o:n})(r)}function e2(r,n){if(!n&&r&&r.__esModule)return r;if(r===null||Qw(r)!=="object"&&typeof r!="function")return{default:r};var o=CC(n);if(o&&o.has(r))return o.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in r)if(f!=="default"&&Object.prototype.hasOwnProperty.call(r,f)){var m=h?Object.getOwnPropertyDescriptor(r,f):null;m&&(m.get||m.set)?Object.defineProperty(l,f,m):l[f]=r[f]}return l.default=r,o&&o.set(r,l),l}function MC(r,n,o){var l=.5*o[0],h=.5*o[1],f=.5*o[2],m=n[0],_=n[1],x=n[2],w=n[3];return r[0]=m,r[1]=_,r[2]=x,r[3]=w,r[4]=l*w+h*x-f*_,r[5]=h*w+f*m-l*x,r[6]=f*w+l*_-h*m,r[7]=-l*m-h*_-f*x,r}function RC(r,n){return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r}function OC(r,n,o){var l=n[0],h=n[1],f=n[2],m=n[3],_=o[4],x=o[5],w=o[6],E=o[7],I=n[4],k=n[5],C=n[6],R=n[7],L=o[0],N=o[1],j=o[2],Z=o[3];return r[0]=l*Z+m*L+h*j-f*N,r[1]=h*Z+m*N+f*L-l*j,r[2]=f*Z+m*j+l*N-h*L,r[3]=m*Z-l*L-h*N-f*j,r[4]=l*E+m*_+h*w-f*x+I*Z+R*L+k*j-C*N,r[5]=h*E+m*x+f*_-l*w+k*Z+R*N+C*L-I*j,r[6]=f*E+m*w+l*x-h*_+C*Z+R*j+I*N-k*L,r[7]=m*E-l*_-h*x-f*w+R*Z-I*L-k*N-C*j,r}mn.getReal=wl.copy,mn.setReal=wl.copy,mn.mul=OC;var DC=wl.dot;mn.dot=DC;var LC=wl.length;mn.length=LC,mn.len=LC;var M0=wl.squaredLength;mn.squaredLength=M0,mn.sqrLen=M0;var sn={};function t2(r){return t2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t2(r)}Object.defineProperty(sn,"__esModule",{value:!0}),sn.create=NC,sn.clone=function(r){var n=new oh.ARRAY_TYPE(2);return n[0]=r[0],n[1]=r[1],n},sn.fromValues=function(r,n){var o=new oh.ARRAY_TYPE(2);return o[0]=r,o[1]=n,o},sn.copy=function(r,n){return r[0]=n[0],r[1]=n[1],r},sn.set=function(r,n,o){return r[0]=n,r[1]=o,r},sn.add=function(r,n,o){return r[0]=n[0]+o[0],r[1]=n[1]+o[1],r},sn.subtract=FC,sn.multiply=BC,sn.divide=jC,sn.ceil=function(r,n){return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r},sn.floor=function(r,n){return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r},sn.min=function(r,n,o){return r[0]=Math.min(n[0],o[0]),r[1]=Math.min(n[1],o[1]),r},sn.max=function(r,n,o){return r[0]=Math.max(n[0],o[0]),r[1]=Math.max(n[1],o[1]),r},sn.round=function(r,n){return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r},sn.scale=function(r,n,o){return r[0]=n[0]*o,r[1]=n[1]*o,r},sn.scaleAndAdd=function(r,n,o,l){return r[0]=n[0]+o[0]*l,r[1]=n[1]+o[1]*l,r},sn.distance=VC,sn.squaredDistance=UC,sn.length=$C,sn.squaredLength=GC,sn.negate=function(r,n){return r[0]=-n[0],r[1]=-n[1],r},sn.inverse=function(r,n){return r[0]=1/n[0],r[1]=1/n[1],r},sn.normalize=function(r,n){var o=n[0],l=n[1],h=o*o+l*l;return h>0&&(h=1/Math.sqrt(h)),r[0]=n[0]*h,r[1]=n[1]*h,r},sn.dot=function(r,n){return r[0]*n[0]+r[1]*n[1]},sn.cross=function(r,n,o){var l=n[0]*o[1]-n[1]*o[0];return r[0]=r[1]=0,r[2]=l,r},sn.lerp=function(r,n,o,l){var h=n[0],f=n[1];return r[0]=h+l*(o[0]-h),r[1]=f+l*(o[1]-f),r},sn.random=function(r,n){n=n||1;var o=2*oh.RANDOM()*Math.PI;return r[0]=Math.cos(o)*n,r[1]=Math.sin(o)*n,r},sn.transformMat2=function(r,n,o){var l=n[0],h=n[1];return r[0]=o[0]*l+o[2]*h,r[1]=o[1]*l+o[3]*h,r},sn.transformMat2d=function(r,n,o){var l=n[0],h=n[1];return r[0]=o[0]*l+o[2]*h+o[4],r[1]=o[1]*l+o[3]*h+o[5],r},sn.transformMat3=function(r,n,o){var l=n[0],h=n[1];return r[0]=o[0]*l+o[3]*h+o[6],r[1]=o[1]*l+o[4]*h+o[7],r},sn.transformMat4=function(r,n,o){var l=n[0],h=n[1];return r[0]=o[0]*l+o[4]*h+o[12],r[1]=o[1]*l+o[5]*h+o[13],r},sn.rotate=function(r,n,o,l){var h=n[0]-o[0],f=n[1]-o[1],m=Math.sin(l),_=Math.cos(l);return r[0]=h*_-f*m+o[0],r[1]=h*m+f*_+o[1],r},sn.angle=function(r,n){var o=r[0],l=r[1],h=n[0],f=n[1],m=Math.sqrt(o*o+l*l)*Math.sqrt(h*h+f*f);return Math.acos(Math.min(Math.max(m&&(o*h+l*f)/m,-1),1))},sn.zero=function(r){return r[0]=0,r[1]=0,r},sn.str=function(r){return"vec2("+r[0]+", "+r[1]+")"},sn.exactEquals=function(r,n){return r[0]===n[0]&&r[1]===n[1]},sn.equals=function(r,n){var o=r[0],l=r[1],h=n[0],f=n[1];return Math.abs(o-h)<=oh.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(l-f)<=oh.EPSILON*Math.max(1,Math.abs(l),Math.abs(f))},sn.forEach=sn.sqrLen=sn.sqrDist=sn.dist=sn.div=sn.mul=sn.sub=sn.len=void 0;var oh=function(r,n){if(r&&r.__esModule)return r;if(r===null||t2(r)!=="object"&&typeof r!="function")return{default:r};var o=zC(void 0);if(o&&o.has(r))return o.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in r)if(f!=="default"&&Object.prototype.hasOwnProperty.call(r,f)){var m=h?Object.getOwnPropertyDescriptor(r,f):null;m&&(m.get||m.set)?Object.defineProperty(l,f,m):l[f]=r[f]}return l.default=r,o&&o.set(r,l),l}(ni);function zC(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(zC=function(l){return l?o:n})(r)}function NC(){var r=new oh.ARRAY_TYPE(2);return oh.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0),r}function FC(r,n,o){return r[0]=n[0]-o[0],r[1]=n[1]-o[1],r}function BC(r,n,o){return r[0]=n[0]*o[0],r[1]=n[1]*o[1],r}function jC(r,n,o){return r[0]=n[0]/o[0],r[1]=n[1]/o[1],r}function VC(r,n){return Math.hypot(n[0]-r[0],n[1]-r[1])}function UC(r,n){var o=n[0]-r[0],l=n[1]-r[1];return o*o+l*l}function $C(r){return Math.hypot(r[0],r[1])}function GC(r){var n=r[0],o=r[1];return n*n+o*o}sn.len=$C,sn.sub=FC,sn.mul=BC,sn.div=jC,sn.dist=VC,sn.sqrDist=UC,sn.sqrLen=GC;var zj=function(){var r=NC();return function(n,o,l,h,f,m){var _,x;for(o||(o=2),l||(l=0),x=h?Math.min(h*o+l,n.length):n.length,_=l;_<x;_+=o)r[0]=n[_],r[1]=n[_+1],f(r,r,m),n[_]=r[0],n[_+1]=r[1];return n}}();function n2(r){return n2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},n2(r)}sn.forEach=zj,Object.defineProperty(ti,"__esModule",{value:!0}),a.e=ti.vec4=a.v=ti.vec3=ti.vec2=ti.quat2=a.q=ti.quat=a.m=ti.mat4=a.bx=ti.mat3=ti.mat2d=a.h=ti.mat2=ti.glMatrix=void 0;var Nj=Ca(ni);ti.glMatrix=Nj;var Fj=Ca(gr);a.h=ti.mat2=Fj;var Bj=Ca(_r);ti.mat2d=Bj;var jj=Ca(jn);a.bx=ti.mat3=jj;var Vj=Ca(rn);a.m=ti.mat4=Vj;var Uj=Ca(Jt);a.q=ti.quat=Uj;var $j=Ca(mn);ti.quat2=$j;var Gj=Ca(sn);ti.vec2=Gj;var Wj=Ca(nn);a.v=ti.vec3=Wj;var qj=Ca(cn);function WC(r){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(WC=function(l){return l?o:n})(r)}function Ca(r,n){if(!n&&r&&r.__esModule)return r;if(r===null||n2(r)!=="object"&&typeof r!="function")return{default:r};var o=WC(n);if(o&&o.has(r))return o.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in r)if(f!=="default"&&Object.prototype.hasOwnProperty.call(r,f)){var m=h?Object.getOwnPropertyDescriptor(r,f):null;m&&(m.get||m.set)?Object.defineProperty(l,f,m):l[f]=r[f]}return l.default=r,o&&o.set(r,l),l}a.e=ti.vec4=qj;const Hj=Mt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:R0}=Hj,qC=Mt([{name:"a_pos_3",components:3,type:"Int16"}]);var Fm=Mt([{name:"a_pos",type:"Int16",components:2}]),HC={};(function(r,n){(function(o){function l(f,m,_){var x=h(256*f,256*(m=Math.pow(2,_)-m-1),_),w=h(256*(f+1),256*(m+1),_);return x[0]+","+x[1]+","+w[0]+","+w[1]}function h(f,m,_){var x=2*Math.PI*6378137/256/Math.pow(2,_);return[f*x-2*Math.PI*6378137/2,m*x-2*Math.PI*6378137/2]}o.getURL=function(f,m,_,x,w,E){return E=E||{},f+"?"+["bbox="+l(_,x,w),"format="+(E.format||"image/png"),"service="+(E.service||"WMS"),"version="+(E.version||"1.1.1"),"request="+(E.request||"GetMap"),"srs="+(E.srs||"EPSG:3857"),"width="+(E.width||256),"height="+(E.height||256),"layers="+m].join("&")},o.getTileBBox=l,o.getMercCoords=h,Object.defineProperty(o,"__esModule",{value:!0})})(n)})(0,HC);var Zj=HC;class sh{constructor(n,o,l){this.z=n,this.x=o,this.y=l,this.key=Bm(0,n,n,o,l)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,o){const l=Zj.getTileBBox(this.x,this.y,this.z),h=function(f,m,_){let x,w="";for(let E=f;E>0;E--)x=1<<E-1,w+=(m&x?1:0)+(_&x?2:0);return w}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ZC{constructor(n,o){this.wrap=n,this.canonical=o,this.key=Bm(n,o.z,o.z,o.x,o.y)}}class hi{constructor(n,o,l,h,f){this.overscaledZ=n,this.wrap=o,this.canonical=new sh(l,+h,+f),this.key=o===0&&n===l?this.canonical.key:Bm(o,n,l,h,f)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const o=this.canonical.z-n;return n>this.canonical.z?new hi(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hi(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o=!0){if(this.overscaledZ===n&&o)return this.key;if(n>this.canonical.z)return Bm(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-n;return Bm(this.wrap*+o,n,n,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new hi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new hi(o,this.wrap,o,l,h),new hi(o,this.wrap,o,l+1,h),new hi(o,this.wrap,o,l,h+1),new hi(o,this.wrap,o,l+1,h+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new hi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new hi(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ZC(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Bm(r,n,o,l,h){const f=1<<Math.min(o,22);let m=f*(h%f)+l%f;return r&&o<22&&(m+=f*f*((r<0?-2*r-1:2*r)%(1<<2*(22-o)))),16*(32*m+o)+(n-o)}const Xj=[r=>{let n=r.canonical.x-1,o=r.wrap;return n<0&&(n=(1<<r.canonical.z)-1,o--),new hi(r.overscaledZ,o,r.canonical.z,n,r.canonical.y)},r=>{let n=r.canonical.x+1,o=r.wrap;return n===1<<r.canonical.z&&(n=0,o++),new hi(r.overscaledZ,o,r.canonical.z,n,r.canonical.y)},r=>new hi(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new hi(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];xt(sh,"CanonicalTileID"),xt(hi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class r2{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,l){const h=a.v.dot(o,this.dir);if(Math.abs(h)<1e-6)return!1;const f=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1]+(n[2]-this.pos[2])*o[2])/h;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,l[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(n,o,l){if(a.v.equals(this.pos,n)||o===0)return l[0]=l[1]=l[2]=0,!1;const[h,f,m]=this.dir,_=this.pos[0]-n[0],x=this.pos[1]-n[1],w=this.pos[2]-n[2],E=h*h+f*f+m*m,I=2*(_*h+x*f+w*m),k=I*I-4*E*(_*_+x*x+w*w-o*o);if(k<0){const C=Math.max(-I/2,0),R=_+h*C,L=x+f*C,N=w+m*C,j=Math.hypot(R,L,N);return l[0]=R*o/j,l[1]=L*o/j,l[2]=N*o/j,!1}{const C=(-I-Math.sqrt(k))/(2*E);if(C<0){const R=Math.hypot(_,x,w);return l[0]=_*o/R,l[1]=x*o/R,l[2]=w*o/R,!1}return l[0]=_+h*C,l[1]=x+f*C,l[2]=w+m*C,!0}}}class i2{constructor(n,o,l,h,f){this.TL=n,this.TR=o,this.BR=l,this.BL=h,this.horizon=f}static fromInvProjectionMatrix(n,o,l){const h=[-1,1,1],f=[1,1,1],m=[1,-1,1],_=[-1,-1,1],x=a.v.transformMat4(h,h,n),w=a.v.transformMat4(f,f,n),E=a.v.transformMat4(m,m,n),I=a.v.transformMat4(_,_,n);return new i2(x,w,E,I,o/l)}}function jm(r,n,o){let l=1/0,h=-1/0;const f=[];for(const m of r){a.v.sub(f,m,n);const _=a.v.dot(f,o);l=Math.min(l,_),h=Math.max(h,_)}return[l,h]}function XC(r,n){let o=!0;for(let l=0;l<r.planes.length;l++){const h=r.planes[l];let f=0;for(let m=0;m<n.length;m++)f+=a.v.dot(h,n[m])+h[3]>=0;if(f===0)return 0;f!==n.length&&(o=!1)}return o?2:1}function YC(r,n){for(const o of r.projections){const l=jm(n,r.points[0],o.axis);if(o.projection[1]<l[0]||o.projection[0]>l[1])return 0}return 1}function KC(r,n){let o=0;const l=[0,0,0,0];for(let h=0;h<r.length;h++)l[0]=r[h][0],l[1]=r[h][1],l[2]=r[h][2],l[3]=1,a.e.dot(l,n)>=0&&o++;return o}class o2{constructor(n,o){this.points=n||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=Dr.fromPoints(this.points),this.projections=[],this.frustumEdges=[a.v.sub([],this.points[2],this.points[3]),a.v.sub([],this.points[0],this.points[3]),a.v.sub([],this.points[4],this.points[0]),a.v.sub([],this.points[5],this.points[1]),a.v.sub([],this.points[6],this.points[2]),a.v.sub([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const h=[0,-l[2],l[1]],f=[l[2],0,-l[0]];this.projections.push({axis:h,projection:jm(this.points,this.points[0],h)}),this.projections.push({axis:f,projection:jm(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(n,o,l,h){const f=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=a.e.transformMat4([],w,n),I=1/E[3]/o*f;return a.e.mul(E,E,[I,I,h?1/E[3]:I,I])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=a.v.sub([],m[w[0]],m[w[1]]),I=a.v.sub([],m[w[2]],m[w[1]]),k=a.v.normalize([],a.v.cross([],E,I)),C=-a.v.dot(k,m[w[1]]);return k.concat(C)}),x=[];for(let w=0;w<m.length;w++)x.push([m[w][0],m[w][1],m[w][2]]);return new o2(x,_)}intersectsPrecise(n,o,l){for(let h=0;h<o.length;h++)if(!KC(n,o[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!KC(n,this.planes[h]))return 0;for(const h of l)for(const f of this.frustumEdges){const m=a.v.cross([],h,f),_=a.v.length(m);if(_===0)continue;a.v.scale(m,m,1/_);const x=jm(this.points,this.points[0],m),w=jm(n,this.points[0],m);if(x[0]>w[1]||w[0]>x[1])return 0}return 1}}class Dr{static fromPoints(n){const o=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const h of n)a.v.min(o,o,h),a.v.max(l,l,h);return new Dr(o,l)}static fromTileIdAndHeight(n,o,l){const h=1<<n.canonical.z,f=n.canonical.x,m=n.canonical.y;return new Dr([f/h,m/h,o],[(f+1)/h,(m+1)/h,l])}static applyTransform(n,o){const l=n.getCorners();for(let h=0;h<l.length;++h)a.v.transformMat4(l[h],l[h],o);return Dr.fromPoints(l)}static projectAabbCorners(n,o){const l=n.getCorners();for(let h=0;h<l.length;++h)a.v.transformMat4(l[h],l[h],o);return l}constructor(n,o){this.min=n,this.max=o,this.center=a.v.scale([],a.v.add([],this.min,this.max),.5)}quadrant(n){const o=[n%2==0,n<2],l=a.v.clone(this.min),h=a.v.clone(this.max);for(let f=0;f<o.length;f++)l[f]=o[f]?this.min[f]:this.center[f],h[f]=o[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new Dr(l,h)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,o=this.max;return[[n[0],n[1],n[2]],[o[0],n[1],n[2]],[o[0],o[1],n[2]],[n[0],o[1],n[2]],[n[0],n[1],o[2]],[o[0],n[1],o[2]],[o[0],o[1],o[2]],[n[0],o[1],o[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?XC(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?XC(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,o){return o||this.intersects(n)?YC(n,this.getCorners()):0}intersectsPreciseFlat(n,o){return o||this.intersectsFlat(n)?YC(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let o=0;o<3;++o)if(this.min[o]>n.max[o]||n.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n.min[o]),this.max[o]=Math.max(this.max[o],n.max[o])}encapsulatePoint(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n[o]),this.max[o]=Math.max(this.max[o],n[o])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}xt(Dr,"Aabb");const s2=5,JC=6,ss=at/Math.PI/2,Yj=16383,Wd=64,a2=[Wd,32,16],Ss=-ss,Is=ss,Kj=[new Dr([Ss,Ss,Ss],[Is,Is,Is]),new Dr([Ss,Ss,Ss],[0,0,Is]),new Dr([0,Ss,Ss],[Is,0,Is]),new Dr([Ss,0,Ss],[0,Is,Is]),new Dr([0,0,Ss],[Is,Is,Is])];function O0(r){return r*ss/$m}function QC(r,n,o,l=!0){const h=a.v.scale([],r._camera.position,r.worldSize),f=[n,o,1,1];a.e.transformMat4(f,f,r.pixelMatrixInverse),a.e.scale(f,f,1/f[3]);const m=a.v.sub([],f,h),_=a.v.normalize([],m),x=r.globeMatrix,w=[x[12],x[13],x[14]],E=a.v.sub([],w,h),I=a.v.length(E),k=a.v.normalize([],E),C=r.worldSize/(2*Math.PI),R=a.v.dot(k,_),L=Math.asin(C/I);if(L<Math.acos(R)){if(!l)return null;const Se=[],Fe=[];a.v.scale(Se,_,I/R),a.v.normalize(Fe,a.v.sub(Fe,Se,E)),a.v.normalize(_,a.v.add(_,E,a.v.scale(_,Fe,Math.tan(L)*I)))}const N=[];new r2(h,_).closestPointOnSphere(w,C,N);const j=a.v.normalize([],Ot(x,0)),Z=a.v.normalize([],Ot(x,1)),X=a.v.normalize([],Ot(x,2)),J=a.v.dot(j,N),te=a.v.dot(Z,N),re=a.v.dot(X,N),pe=kn(Math.asin(-te/C));let ve=kn(Math.atan2(J,re));ve=r.center.lng+function(Se,Fe){const Qe=(Fe-Se+180)%360-180;return Qe<-180?Qe+360:Qe}(r.center.lng,ve);const be=Ra(ve),Pe=Ze(Oa(pe),0,1);return new Ai(be,Pe)}class Jj{constructor(n,o,l){this.a=a.v.sub([],n,l),this.b=a.v.sub([],o,l),this.center=l;const h=a.v.normalize([],this.a),f=a.v.normalize([],this.b);this.angle=Math.acos(a.v.dot(h,f))}}function l2(r,n){if(r.angle===0)return null;let o;return o=r.a[n]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[n]/r.a[n]/Math.sin(r.angle)-1/Math.tan(r.angle)),o<0||o>1?null:function(l,h,f,m){const _=Math.sin(f);return l*(Math.sin((1-m)*f)/_)+h*(Math.sin(m*f)/_)}(r.a[n],r.b[n],r.angle,Ze(o,0,1))+r.center[n]}function Ma(r){if(r.z<=1)return Kj[r.z+2*r.y+r.x];const n=c2(D0(r));return Dr.fromPoints(n)}function Tl(r,n,o){return a.v.scale(r,r,1-o),a.v.scaleAndAdd(r,r,n,o)}function eM(r,n){const o=El(n.zoom);if(o===0)return Ma(r);const l=D0(r),h=c2(l),f=Ra(l.getWest())*n.worldSize,m=Ra(l.getEast())*n.worldSize,_=Oa(l.getNorth())*n.worldSize,x=Oa(l.getSouth())*n.worldSize,w=[f,_,0],E=[m,_,0],I=[f,x,0],k=[m,x,0],C=a.m.invert([],n.globeMatrix);return a.v.transformMat4(w,w,C),a.v.transformMat4(E,E,C),a.v.transformMat4(I,I,C),a.v.transformMat4(k,k,C),h[0]=Tl(h[0],I,o),h[1]=Tl(h[1],k,o),h[2]=Tl(h[2],E,o),h[3]=Tl(h[3],w,o),Dr.fromPoints(h)}function tM(r,n,o){for(const l of r)a.v.transformMat4(l,l,n),a.v.scale(l,l,o)}function nM(r,n,o,l){const h=n/r.worldSize,f=r.globeMatrix;if(o.z<=1){const be=Ma(o).getCorners();return tM(be,f,h),Dr.fromPoints(be)}const m=D0(o,l),_=c2(m);tM(_,f,h);const x=Number.MAX_VALUE,w=[-x,-x,-x],E=[x,x,x];if(m.contains(r.center)){for(const Se of _)a.v.min(E,E,Se),a.v.max(w,w,Se);w[2]=0;const be=r.point,Pe=[be.x*h,be.y*h,0];return a.v.min(E,E,Pe),a.v.max(w,w,Pe),new Dr(E,w)}const I=[f[12]*h,f[13]*h,f[14]*h],k=m.getCenter(),C=Ze(r.center.lat,-Pr,Pr),R=Ze(k.lat,-Pr,Pr),L=Ra(r.center.lng),N=Oa(C);let j=L-Ra(k.lng);const Z=N-Oa(R);j>.5?j-=1:j<-.5&&(j+=1);let X=0;if(Math.abs(j)>Math.abs(Z))X=j>=0?1:3;else{X=Z>=0?0:2;const be=[f[4]*h,f[5]*h,f[6]*h],Pe=-Math.sin(pt(Z>=0?m.getSouth():m.getNorth()))*ss;a.v.scaleAndAdd(I,I,be,Pe)}const J=_[X],te=_[(X+1)%4],re=new Jj(J,te,I),pe=[l2(re,0)||J[0],l2(re,1)||J[1],l2(re,2)||J[2]],ve=El(r.zoom);if(ve>0){const be=function({x:Se,y:Fe,z:Qe},Le,He,De,ut){const yt=1/(1<<Qe);let Ke=Se*yt,Vt=Ke+yt,wt=Fe*yt,ct=wt+yt,Ut=0;const Rt=(Ke+Vt)/2-De;return Rt>.5?Ut=-1:Rt<-.5&&(Ut=1),Ke=((Ke+Ut)*Le-(De*=Le))*He+De,Vt=((Vt+Ut)*Le-De)*He+De,wt=(wt*Le-(ut*=Le))*He+ut,ct=(ct*Le-ut)*He+ut,[[Ke,ct,0],[Vt,ct,0],[Vt,wt,0],[Ke,wt,0]]}(o,n,r._pixelsPerMercatorPixel,L,N);for(let Se=0;Se<_.length;Se++)Tl(_[Se],be[Se],ve);const Pe=a.v.add([],be[X],be[(X+1)%4]);a.v.scale(Pe,Pe,.5),Tl(pe,Pe,ve)}for(const be of _)a.v.min(E,E,be),a.v.max(w,w,be);return E[2]=Math.min(J[2],te[2]),a.v.min(E,E,pe),a.v.max(w,w,pe),new Dr(E,w)}function D0({x:r,y:n,z:o},l=!1){const h=1/(1<<o),f=new On(zo(r*h),n===(1<<o)-1&&l?-90:wi((n+1)*h)),m=new On(zo((r+1)*h),n===0&&l?90:wi(n*h));return new Ec(f,m)}function c2(r){const n=pt(r.getNorth()),o=pt(r.getSouth()),l=Math.cos(n),h=Math.cos(o),f=Math.sin(n),m=Math.sin(o),_=r.getWest(),x=r.getEast();return[qd(h,m,_),qd(h,m,x),qd(l,f,x),qd(l,f,_)]}function qd(r,n,o,l=ss){return o=pt(o),[r*Math.sin(o)*l,-n*l,r*Math.cos(o)*l]}function ah(r,n,o){return qd(Math.cos(pt(r)),Math.sin(pt(r)),n,o)}function Vm(r,n,o,l){const h=1<<o.z,f=(r/at+o.x)/h;return ah(wi((n/at+o.y)/h),zo(f),l)}function L0({min:r,max:n}){return Yj/Math.max(n[0]-r[0],n[1]-r[1],n[2]-r[2])}const rM=new Float64Array(16);function Um(r){const n=L0(r),o=a.m.fromScaling(rM,[n,n,n]);return a.m.translate(o,o,a.v.negate([],r.min))}function u2(r){const n=a.m.fromTranslation(rM,r.min),o=1/L0(r);return a.m.scale(n,n,[o,o,o])}function h2(r){const n=at/(2*Math.PI);return r/(2*Math.PI)/n}function iM(r,n){return at/(512*Math.pow(2,r))*L0(Ma(n))}function oM(r,n,o,l,h){const f=h2(o),m=[r,n,-o/(2*Math.PI)],_=a.m.identity(new Float64Array(16));return a.m.translate(_,_,m),a.m.scale(_,_,[f,f,f]),a.m.rotateX(_,_,pt(-h)),a.m.rotateY(_,_,pt(-l)),_}function El(r){return St(s2,JC,r)}function sM(r,n){const o=ah(n.lat,n.lng),l=function(f){const m=ah(f._center.lat,f._center.lng),_=a.v.fromValues(0,1,0);let x=a.v.cross([],_,m);const w=a.m.fromRotation([],-f.angle,m);x=a.v.transformMat4(x,x,w),a.m.fromRotation(w,-f._pitch,x);const E=a.v.normalize([],m);return a.v.scale(E,E,O0(f.cameraToCenterDistance/f.pixelsPerMeter)),a.v.transformMat4(E,E,w),a.v.add([],m,E)}(r),h=a.v.subtract([],l,o);return a.v.angle(h,o)}function d2(r,n){return sM(r,n)>Math.PI/2*1.01}const aM=pt(85),Qj=Math.cos(aM),eV=Math.sin(aM),$m=63710088e-1,f2=2*Math.PI*$m;class Ic{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ic(Lt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const o=Math.PI/180,l=this.lat*o,h=n.lat*o,f=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((n.lng-this.lng)*o);return $m*Math.acos(Math.min(f,1))}toBounds(n=0){const o=360*n/40075017,l=o/Math.cos(Math.PI/180*this.lat);return new Ec(new Ic(this.lng-l,this.lat-o),new Ic(this.lng+l,this.lat+o))}toEcef(n){const o=O0(n);return ah(this.lat,this.lng,ss+o)}static convert(n){if(n instanceof Ic)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Ic(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Ic(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var On=Ic;const tV=0,nV=25.5;function p2(r){return f2*Math.cos(r*Math.PI/180)}function Ra(r){return(180+r)/360}function Oa(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function to(r,n){return r/p2(n)}function zo(r){return 360*r-180}function wi(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function lM(r,n){return r*p2(wi(n))}const Pr=85.051129;function cM(r){return Math.cos(pt(Ze(r,-Pr,Pr)))}function lh(r,n){const o=Ze(n,tV,nV),l=Math.pow(2,o);return cM(r)*f2/(512*l)}function uM(r){return 1/Math.cos(r*Math.PI/180)}function z0(r,n=0){const o=Math.exp(Math.PI*(1-(r.y+n/at)/(1<<r.z)*2));return 80150034*o/(o*o+1)/at/(1<<r.z)}class Ai{constructor(n,o,l=0){this.x=+n,this.y=+o,this.z=+l}static fromLngLat(n,o=0){const l=On.convert(n);return new Ai(Ra(l.lng),Oa(l.lat),to(o,l.lat))}toLngLat(){return new On(zo(this.x),wi(this.y))}toAltitude(){return lM(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/f2*uM(wi(this.y))}}function m2(r,n,o,l,h,f,m,_,x){const w=(n+l)/2,E=(o+h)/2,I=new Oe(w,E);_(I),function(k,C,R,L,N,j){const Z=R-N,X=L-j;return Math.abs((L-C)*Z-(R-k)*X)/Math.hypot(Z,X)}(I.x,I.y,f.x,f.y,m.x,m.y)>=x?(m2(r,n,o,w,E,f,I,_,x),m2(r,w,E,l,h,I,m,_,x)):r.push(m)}function hM(r,n,o){let l=r[0],h=l.x,f=l.y;n(l);const m=[l];for(let _=1;_<r.length;_++){const x=r[_],{x:w,y:E}=x;n(x),m2(m,h,f,w,E,l,x,n,o),h=w,f=E,l=x}return m}function g2(r,n,o,l){if(l(n,o)){const h=n.add(o)._mult(.5);g2(r,n,h,l),g2(r,h,o,l)}else r.push(o)}function rV(r,n){let o=r[0];const l=[o];for(let h=1;h<r.length;h++){const f=r[h];g2(l,o,f,n),o=f}return l}const _2=Math.pow(2,14)-1,dM=-_2-1;function iV(r,n){const o=Math.round(r.x*n),l=Math.round(r.y*n);return r.x=Ze(o,dM,_2),r.y=Ze(l,dM,_2),(o<r.x||o>r.x+1||l<r.y||l>r.y+1)&&pr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Da(r,n,o){const l=r.loadGeometry(),h=r.extent,f=at/h;if(n&&o&&o.projection.isReprojectedInTileSpace){const m=1<<n.z,{scale:_,x,y:w,projection:E}=o,I=k=>{const C=zo((n.x+k.x/h)/m),R=wi((n.y+k.y/h)/m),L=E.project(C,R);k.x=(L.x*_-x)*h,k.y=(L.y*_-w)*h};for(let k=0;k<l.length;k++)if(r.type!==1)l[k]=hM(l[k],I,1);else{const C=[];for(const R of l[k])R.x<0||R.x>=h||R.y<0||R.y>=h||(I(R),C.push(R));l[k]=C}}for(const m of l)for(const _ of m)iV(_,f);return l}function Ac(r,n){return{type:r.type,id:r.id,properties:r.properties,geometry:n?Da(r):[]}}function N0(r,n,o,l,h){r.emplaceBack(2*n+(l+1)/2,2*o+(h+1)/2)}function F0(r,n,o){r.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class y2{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new Qt,this.indexArray=new Bn,this.segments=new mr,this.programConfigurations=new Tc(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,l,h){const f=this.layers[0],m=[];let _=null;f.type==="circle"&&(_=f.layout.get("circle-sort-key"));for(const{feature:w,id:E,index:I,sourceLayerIndex:k}of n){const C=this.layers[0]._featureFilter.needGeometry,R=Ac(w,C);if(!this.layers[0]._featureFilter.filter(new de(this.zoom),R,l))continue;const L=_?_.evaluate(R,{},l):void 0,N={id:E,properties:w.properties,type:w.type,sourceLayerIndex:k,index:I,geometry:C?R.geometry:Da(w,l,h),patterns:{},sortKey:L};m.push(N)}_&&m.sort((w,E)=>w.sortKey-E.sortKey);let x=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new ar,x=h.projection);for(const w of m){const{geometry:E,index:I,sourceLayerIndex:k}=w,C=n[I].feature;this.addFeature(w,E,I,o.availableImages,l,x,o.brightness),o.featureIndex.insert(C,E,I,k,this.index)}}update(n,o,l,h,f){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,o,m?this.stateDependentLayers:this.layers,l,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,mj.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,gj.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,o,l,h,f,m,_){for(const x of o)for(const w of x){const E=w.x,I=w.y;if(E<0||E>=at||I<0||I>=at)continue;if(m){const R=m.projectTilePoint(E,I,f),L=m.upVector(f,E,I),N=this.globeExtVertexArray;F0(N,R,L),F0(N,R,L),F0(N,R,L),F0(N,R,L)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),C=k.vertexLength;N0(this.layoutVertexArray,E,I,-1,-1),N0(this.layoutVertexArray,E,I,1,-1),N0(this.layoutVertexArray,E,I,1,1),N0(this.layoutVertexArray,E,I,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+2,C+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,{},h,f,_)}}function fM(r,n){for(let o=0;o<r.length;o++)if(ch(n,r[o]))return!0;for(let o=0;o<n.length;o++)if(ch(r,n[o]))return!0;return!!v2(r,n)}function oV(r,n,o){return!!ch(r,n)||!!x2(n,r,o)}function pM(r,n){if(r.length===1)return gM(n,r[0]);for(let o=0;o<n.length;o++){const l=n[o];for(let h=0;h<l.length;h++)if(ch(r,l[h]))return!0}for(let o=0;o<r.length;o++)if(gM(n,r[o]))return!0;for(let o=0;o<n.length;o++)if(v2(r,n[o]))return!0;return!1}function sV(r,n,o){if(r.length>1){if(v2(r,n))return!0;for(let l=0;l<n.length;l++)if(x2(n[l],r,o))return!0}for(let l=0;l<r.length;l++)if(x2(r[l],n,o))return!0;return!1}function v2(r,n){if(r.length===0||n.length===0)return!1;for(let o=0;o<r.length-1;o++){const l=r[o],h=r[o+1];for(let f=0;f<n.length-1;f++)if(aV(l,h,n[f],n[f+1]))return!0}return!1}function aV(r,n,o,l){return nt(r,o,l)!==nt(n,o,l)&&nt(r,n,o)!==nt(r,n,l)}function x2(r,n,o){const l=o*o;if(n.length===1)return r.distSqr(n[0])<l;for(let h=1;h<n.length;h++)if(mM(r,n[h-1],n[h])<l)return!0;return!1}function mM(r,n,o){const l=n.distSqr(o);if(l===0)return r.distSqr(n);const h=((r.x-n.x)*(o.x-n.x)+(r.y-n.y)*(o.y-n.y))/l;return r.distSqr(h<0?n:h>1?o:o.sub(n)._mult(h)._add(n))}function gM(r,n){let o,l,h,f=!1;for(let m=0;m<r.length;m++){o=r[m];for(let _=0,x=o.length-1;_<o.length;x=_++)l=o[_],h=o[x],l.y>n.y!=h.y>n.y&&n.x<(h.x-l.x)*(n.y-l.y)/(h.y-l.y)+l.x&&(f=!f)}return f}function ch(r,n){let o=!1;for(let l=0,h=r.length-1;l<r.length;h=l++){const f=r[l],m=r[h];f.y>n.y!=m.y>n.y&&n.x<(m.x-f.x)*(n.y-f.y)/(m.y-f.y)+f.x&&(o=!o)}return o}function _M(r,n,o,l,h){for(const m of r)if(n<=m.x&&o<=m.y&&l>=m.x&&h>=m.y)return!0;const f=[new Oe(n,o),new Oe(n,h),new Oe(l,h),new Oe(l,o)];if(r.length>2){for(const m of f)if(ch(r,m))return!0}for(let m=0;m<r.length-1;m++)if(lV(r[m],r[m+1],f))return!0;return!1}function lV(r,n,o){const l=o[0],h=o[2];if(r.x<l.x&&n.x<l.x||r.x>h.x&&n.x>h.x||r.y<l.y&&n.y<l.y||r.y>h.y&&n.y>h.y)return!1;const f=nt(r,n,o[0]);return f!==nt(r,n,o[1])||f!==nt(r,n,o[2])||f!==nt(r,n,o[3])}function Hd(r,n,o,l,h,f){let m=n.y-r.y,_=r.x-n.x;if(f=f||0){const x=m*m+_*_;if(x===0)return!0;const w=Math.sqrt(x);m/=w,_/=w}return!((o.x-r.x)*m+(o.y-r.y)*_-f<0||(l.x-r.x)*m+(l.y-r.y)*_-f<0||(h.x-r.x)*m+(h.y-r.y)*_-f<0)}function b2(r,n,o,l,h,f,m){return!(Hd(r,n,l,h,f,m)||Hd(n,o,l,h,f,m)||Hd(o,r,l,h,f,m)||Hd(l,h,r,n,o,m)||Hd(h,f,r,n,o,m)||Hd(f,l,r,n,o,m))}function Zd(r,n,o){const l=n.paint.get(r).value;return l.kind==="constant"?l.value:o.programConfigurations.get(n.id).getMaxValue(r)}function B0(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function yM(r,n,o,l,h){if(!n[0]&&!n[1])return r;const f=Oe.convert(n)._mult(h);o==="viewport"&&f._rotate(-l);const m=[];for(let _=0;_<r.length;_++)m.push(r[_].sub(f));return m}function vM(r,n,o,l){const h=Oe.convert(r)._mult(l);return n==="viewport"&&h._rotate(-o),h}xt(y2,"CircleBucket",{omit:["layers"]});const cV=new $e({"circle-sort-key":new Te(Ie.layout_circle["circle-sort-key"]),visibility:new ne(Ie.layout_circle.visibility)});var uV={paint:new $e({"circle-radius":new Te(Ie.paint_circle["circle-radius"]),"circle-color":new Te(Ie.paint_circle["circle-color"]),"circle-blur":new Te(Ie.paint_circle["circle-blur"]),"circle-opacity":new Te(Ie.paint_circle["circle-opacity"]),"circle-translate":new ne(Ie.paint_circle["circle-translate"]),"circle-translate-anchor":new ne(Ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ne(Ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ne(Ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Te(Ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Te(Ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Te(Ie.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ne(Ie.paint_circle["circle-emissive-strength"])}),layout:cV};const hV=a.m.create(),xM=r=>{const n=[];return r.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function bM(r,n,o,l,h,f,m,_,x){if(f&&r.queryGeometry.isAboveHorizon)return!1;f&&(x*=r.pixelToTileUnitsFactor);const w=r.tileID.canonical,E=o.projection.upVectorScale(w,o.center.lat,o.worldSize).metersToTile;for(const I of n)for(const k of I){const C=k.add(_),R=h&&o.elevation?o.elevation.exaggeration()*h.getElevationAt(C.x,C.y,!0):0,L=o.projection.projectTilePoint(C.x,C.y,w);if(R>0){const X=o.projection.upVector(w,C.x,C.y);L.x+=X[0]*E*R,L.y+=X[1]*E*R,L.z+=X[2]*E*R}const N=f?C:dV(L.x,L.y,L.z,l),j=f?r.tilespaceRays.map(X=>pV(X,R)):r.queryGeometry.screenGeometry,Z=a.e.transformMat4([],[L.x,L.y,L.z,1],l);if(!m&&f?x*=Z[3]/o.cameraToCenterDistance:m&&!f&&(x*=o.cameraToCenterDistance/Z[3]),f){const X=wi((k.y/at+w.y)/(1<<w.z));x/=o.projection.pixelsPerMeter(X,1)/to(1,X)}if(oV(j,N,x))return!0}return!1}function dV(r,n,o,l){const h=a.e.transformMat4([],[r,n,o,1],l);return new Oe(h[0]/h[3],h[1]/h[3])}const wM=a.v.fromValues(0,0,0),fV=a.v.fromValues(0,0,1);function pV(r,n){const o=a.v.create();return wM[2]=n,r.intersectsPlane(wM,fV,o),new Oe(o[0],o[1])}class TM extends y2{}function EM(r,{width:n,height:o},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==n*o*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(n*o*l);return r.width=n,r.height=o,r.data=h,r}function SM(r,n,o){const{width:l,height:h}=n;l===r.width&&h===r.height||(w2(r,n,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,l),height:Math.min(r.height,h)},o),r.width=l,r.height=h,r.data=n.data)}function w2(r,n,o,l,h,f,m){if(h.width===0||h.height===0)return n;if(h.width>r.width||h.height>r.height||o.x>r.width-h.width||o.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>n.width||h.height>n.height||l.x>n.width-h.width||l.y>n.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=r.data,x=n.data,w=f===4&&m;for(let E=0;E<h.height;E++){const I=((o.y+E)*r.width+o.x)*f,k=((l.y+E)*n.width+l.x)*f;if(w)for(let C=0;C<h.width;C++){const R=I+C*f+3,L=k+C*f;x[L+0]=255,x[L+1]=255,x[L+2]=255,x[L+3]=_[R]}else for(let C=0;C<h.width*f;C++)x[k+C]=_[I+C]}return n}xt(TM,"HeatmapBucket",{omit:["layers"]});class Sl{constructor(n,o){EM(this,n,1,o)}resize(n){SM(this,new Sl(n),1)}clone(){return new Sl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,l,h,f){w2(n,o,l,h,f,1)}}class as{constructor(n,o){EM(this,n,4,o)}resize(n){SM(this,new as(n),4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new as({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,l,h,f,m){w2(n,o,l,h,f,4,m)}}class IM{constructor(n,o){this.width=n.width,this.height=n.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}xt(Sl,"AlphaImage"),xt(as,"RGBAImage");const mV=new $e({visibility:new ne(Ie.layout_heatmap.visibility)});var gV={paint:new $e({"heatmap-radius":new Te(Ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Te(Ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ne(Ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xe(Ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ne(Ie.paint_heatmap["heatmap-opacity"])}),layout:mV};function j0(r){const n={},o=r.resolution||256,l=r.clips?r.clips.length:1,h=r.image||new as({width:o,height:l}),f=(m,_,x)=>{n[r.evaluationKey]=x;const w=r.expression.evaluate(n);w&&(h.data[m+_+0]=Math.floor(255*w.r/w.a),h.data[m+_+1]=Math.floor(255*w.g/w.a),h.data[m+_+2]=Math.floor(255*w.b/w.a),h.data[m+_+3]=Math.floor(255*w.a))};if(r.clips)for(let m=0,_=0;m<l;++m,_+=4*o)for(let x=0,w=0;x<o;x++,w+=4){const E=x/(o-1),{start:I,end:k}=r.clips[m];f(_,w,I*(1-E)+k*E)}else for(let m=0,_=0;m<o;m++,_+=4)f(0,_,m/(o-1));return h}const _V=new $e({visibility:new ne(Ie.layout_hillshade.visibility)});var yV={paint:new $e({"hillshade-illumination-direction":new ne(Ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ne(Ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ne(Ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ne(Ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ne(Ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ne(Ie.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ne(Ie.paint_hillshade["hillshade-emissive-strength"])}),layout:_V};const vV=Mt([{name:"a_pos",components:2,type:"Int16"}],4),{members:xV}=vV;var T2={exports:{}};function V0(r,n,o){o=o||2;var l,h,f,m,_,x,w,E=n&&n.length,I=E?n[0]*o:r.length,k=AM(r,0,I,o,!0),C=[];if(!k||k.next===k.prev)return C;if(E&&(k=function(L,N,j,Z){var X,J,te,re=[];for(X=0,J=N.length;X<J;X++)(te=AM(L,N[X]*Z,X<J-1?N[X+1]*Z:L.length,Z,!1))===te.next&&(te.steiner=!0),re.push(PV(te));for(re.sort(SV),X=0;X<re.length;X++)j=IV(re[X],j);return j}(r,n,k,o)),r.length>80*o){l=f=r[0],h=m=r[1];for(var R=o;R<I;R+=o)(_=r[R])<l&&(l=_),(x=r[R+1])<h&&(h=x),_>f&&(f=_),x>m&&(m=x);w=(w=Math.max(f-l,m-h))!==0?32767/w:0}return Gm(k,C,o,l,h,w,0),C}function AM(r,n,o,l,h){var f,m;if(h===I2(r,n,o,l)>0)for(f=n;f<o;f+=l)m=CM(f,r[f],r[f+1],m);else for(f=o-l;f>=n;f-=l)m=CM(f,r[f],r[f+1],m);return m&&U0(m,m.next)&&(qm(m),m=m.next),m}function uh(r,n){if(!r)return r;n||(n=r);var o,l=r;do if(o=!1,l.steiner||!U0(l,l.next)&&Wr(l.prev,l,l.next)!==0)l=l.next;else{if(qm(l),(l=n=l.prev)===l.next)break;o=!0}while(o||l!==n);return n}function Gm(r,n,o,l,h,f,m){if(r){!m&&f&&function(E,I,k,C){var R=E;do R.z===0&&(R.z=E2(R.x,R.y,I,k,C)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==E);R.prevZ.nextZ=null,R.prevZ=null,function(L){var N,j,Z,X,J,te,re,pe,ve=1;do{for(j=L,L=null,J=null,te=0;j;){for(te++,Z=j,re=0,N=0;N<ve&&(re++,Z=Z.nextZ);N++);for(pe=ve;re>0||pe>0&&Z;)re!==0&&(pe===0||!Z||j.z<=Z.z)?(X=j,j=j.nextZ,re--):(X=Z,Z=Z.nextZ,pe--),J?J.nextZ=X:L=X,X.prevZ=J,J=X;j=Z}J.nextZ=null,ve*=2}while(te>1)}(R)}(r,l,h,f);for(var _,x,w=r;r.prev!==r.next;)if(_=r.prev,x=r.next,f?wV(r,l,h,f):bV(r))n.push(_.i/o|0),n.push(r.i/o|0),n.push(x.i/o|0),qm(r),r=x.next,w=x.next;else if((r=x)===w){m?m===1?Gm(r=TV(uh(r),n,o),n,o,l,h,f,2):m===2&&EV(r,n,o,l,h,f):Gm(uh(r),n,o,l,h,f,1);break}}}function bV(r){var n=r.prev,o=r,l=r.next;if(Wr(n,o,l)>=0)return!1;for(var h=n.x,f=o.x,m=l.x,_=n.y,x=o.y,w=l.y,E=h<f?h<m?h:m:f<m?f:m,I=_<x?_<w?_:w:x<w?x:w,k=h>f?h>m?h:m:f>m?f:m,C=_>x?_>w?_:w:x>w?x:w,R=l.next;R!==n;){if(R.x>=E&&R.x<=k&&R.y>=I&&R.y<=C&&Xd(h,_,f,x,m,w,R.x,R.y)&&Wr(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function wV(r,n,o,l){var h=r.prev,f=r,m=r.next;if(Wr(h,f,m)>=0)return!1;for(var _=h.x,x=f.x,w=m.x,E=h.y,I=f.y,k=m.y,C=_<x?_<w?_:w:x<w?x:w,R=E<I?E<k?E:k:I<k?I:k,L=_>x?_>w?_:w:x>w?x:w,N=E>I?E>k?E:k:I>k?I:k,j=E2(C,R,n,o,l),Z=E2(L,N,n,o,l),X=r.prevZ,J=r.nextZ;X&&X.z>=j&&J&&J.z<=Z;){if(X.x>=C&&X.x<=L&&X.y>=R&&X.y<=N&&X!==h&&X!==m&&Xd(_,E,x,I,w,k,X.x,X.y)&&Wr(X.prev,X,X.next)>=0||(X=X.prevZ,J.x>=C&&J.x<=L&&J.y>=R&&J.y<=N&&J!==h&&J!==m&&Xd(_,E,x,I,w,k,J.x,J.y)&&Wr(J.prev,J,J.next)>=0))return!1;J=J.nextZ}for(;X&&X.z>=j;){if(X.x>=C&&X.x<=L&&X.y>=R&&X.y<=N&&X!==h&&X!==m&&Xd(_,E,x,I,w,k,X.x,X.y)&&Wr(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;J&&J.z<=Z;){if(J.x>=C&&J.x<=L&&J.y>=R&&J.y<=N&&J!==h&&J!==m&&Xd(_,E,x,I,w,k,J.x,J.y)&&Wr(J.prev,J,J.next)>=0)return!1;J=J.nextZ}return!0}function TV(r,n,o){var l=r;do{var h=l.prev,f=l.next.next;!U0(h,f)&&PM(h,l,l.next,f)&&Wm(h,f)&&Wm(f,h)&&(n.push(h.i/o|0),n.push(l.i/o|0),n.push(f.i/o|0),qm(l),qm(l.next),l=r=f),l=l.next}while(l!==r);return uh(l)}function EV(r,n,o,l,h,f){var m=r;do{for(var _=m.next.next;_!==m.prev;){if(m.i!==_.i&&kV(m,_)){var x=kM(m,_);return m=uh(m,m.next),x=uh(x,x.next),Gm(m,n,o,l,h,f,0),void Gm(x,n,o,l,h,f,0)}_=_.next}m=m.next}while(m!==r)}function SV(r,n){return r.x-n.x}function IV(r,n){var o=function(h,f){var m,_=f,x=h.x,w=h.y,E=-1/0;do{if(w<=_.y&&w>=_.next.y&&_.next.y!==_.y){var I=_.x+(w-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(I<=x&&I>E&&(E=I,m=_.x<_.next.x?_:_.next,I===x))return m}_=_.next}while(_!==f);if(!m)return null;var k,C=m,R=m.x,L=m.y,N=1/0;_=m;do x>=_.x&&_.x>=R&&x!==_.x&&Xd(w<L?x:E,w,R,L,w<L?E:x,w,_.x,_.y)&&(k=Math.abs(w-_.y)/(x-_.x),Wm(_,h)&&(k<N||k===N&&(_.x>m.x||_.x===m.x&&AV(m,_)))&&(m=_,N=k)),_=_.next;while(_!==C);return m}(r,n);if(!o)return n;var l=kM(o,r);return uh(l,l.next),uh(o,o.next)}function AV(r,n){return Wr(r.prev,r,n.prev)<0&&Wr(n.next,r,r.next)<0}function E2(r,n,o,l,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-o)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-l)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function PV(r){var n=r,o=r;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==r);return o}function Xd(r,n,o,l,h,f,m,_){return(h-m)*(n-_)>=(r-m)*(f-_)&&(r-m)*(l-_)>=(o-m)*(n-_)&&(o-m)*(f-_)>=(h-m)*(l-_)}function kV(r,n){return r.next.i!==n.i&&r.prev.i!==n.i&&!function(o,l){var h=o;do{if(h.i!==o.i&&h.next.i!==o.i&&h.i!==l.i&&h.next.i!==l.i&&PM(h,h.next,o,l))return!0;h=h.next}while(h!==o);return!1}(r,n)&&(Wm(r,n)&&Wm(n,r)&&function(o,l){var h=o,f=!1,m=(o.x+l.x)/2,_=(o.y+l.y)/2;do h.y>_!=h.next.y>_&&h.next.y!==h.y&&m<(h.next.x-h.x)*(_-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next;while(h!==o);return f}(r,n)&&(Wr(r.prev,r,n.prev)||Wr(r,n.prev,n))||U0(r,n)&&Wr(r.prev,r,r.next)>0&&Wr(n.prev,n,n.next)>0)}function Wr(r,n,o){return(n.y-r.y)*(o.x-n.x)-(n.x-r.x)*(o.y-n.y)}function U0(r,n){return r.x===n.x&&r.y===n.y}function PM(r,n,o,l){var h=G0(Wr(r,n,o)),f=G0(Wr(r,n,l)),m=G0(Wr(o,l,r)),_=G0(Wr(o,l,n));return h!==f&&m!==_||!(h!==0||!$0(r,o,n))||!(f!==0||!$0(r,l,n))||!(m!==0||!$0(o,r,l))||!(_!==0||!$0(o,n,l))}function $0(r,n,o){return n.x<=Math.max(r.x,o.x)&&n.x>=Math.min(r.x,o.x)&&n.y<=Math.max(r.y,o.y)&&n.y>=Math.min(r.y,o.y)}function G0(r){return r>0?1:r<0?-1:0}function Wm(r,n){return Wr(r.prev,r,r.next)<0?Wr(r,n,r.next)>=0&&Wr(r,r.prev,n)>=0:Wr(r,n,r.prev)<0||Wr(r,r.next,n)<0}function kM(r,n){var o=new S2(r.i,r.x,r.y),l=new S2(n.i,n.x,n.y),h=r.next,f=n.prev;return r.next=n,n.prev=r,o.next=h,h.prev=o,l.next=o,o.prev=l,f.next=l,l.prev=f,l}function CM(r,n,o,l){var h=new S2(r,n,o);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function qm(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function S2(r,n,o){this.i=r,this.x=n,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I2(r,n,o,l){for(var h=0,f=n,m=o-l;f<o;f+=l)h+=(r[m]-r[f])*(r[f+1]+r[m+1]),m=f;return h}T2.exports=V0,T2.exports.default=V0,V0.deviation=function(r,n,o,l){var h=n&&n.length,f=Math.abs(I2(r,0,h?n[0]*o:r.length,o));if(h)for(var m=0,_=n.length;m<_;m++)f-=Math.abs(I2(r,n[m]*o,m<_-1?n[m+1]*o:r.length,o));var x=0;for(m=0;m<l.length;m+=3){var w=l[m]*o,E=l[m+1]*o,I=l[m+2]*o;x+=Math.abs((r[w]-r[I])*(r[E+1]-r[w+1])-(r[w]-r[E])*(r[I+1]-r[w+1]))}return f===0&&x===0?0:Math.abs((x-f)/f)},V0.flatten=function(r){for(var n=r[0][0].length,o={vertices:[],holes:[],dimensions:n},l=0,h=0;h<r.length;h++){for(var f=0;f<r[h].length;f++)for(var m=0;m<n;m++)o.vertices.push(r[h][f][m]);h>0&&o.holes.push(l+=r[h-1].length)}return o};var W0=fe(T2.exports);function A2(r,n){const o=r.length;if(o<=1)return[r];const l=[];let h,f;for(let m=0;m<o;m++){const _=ie(r[m]);_!==0&&(r[m].area=Math.abs(_),f===void 0&&(f=_<0),f===_<0?(h&&l.push(h),h=[r[m]]):h.push(r[m]))}if(h&&l.push(h),n>1)for(let m=0;m<l.length;m++)l[m].length<=n||(Fy(l[m],n,1,l[m].length-1,CV),l[m]=l[m].slice(0,n));return l}function CV(r,n){return n.area-r.area}function P2(r,n,o){const l=o.patternDependencies;let h=!1;for(const f of n){const m=f.paint.get(`${r}-pattern`);m.isConstant()||(h=!0);const _=m.constantOr(null);_&&(h=!0,l[_]=!0)}return h}function k2(r,n,o,l,h){const f=h.patternDependencies;for(const m of n){const _=m.paint.get(`${r}-pattern`).value;if(_.kind!=="constant"){let x=_.evaluate({zoom:l},o,{},h.availableImages);x=x&&x.name?x.name:x,f[x]=!0,o.patterns[m.id]=x}}return o}class q0{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Qt,this.indexArray=new Bn,this.indexArray2=new ji,this.programConfigurations=new Tc(n.layers,n.zoom),this.segments=new mr,this.segments2=new mr,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=n.projection}populate(n,o,l,h){this.hasPattern=P2("fill",this.layers,o);const f=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:_,id:x,index:w,sourceLayerIndex:E}of n){const I=this.layers[0]._featureFilter.needGeometry,k=Ac(_,I);if(!this.layers[0]._featureFilter.filter(new de(this.zoom),k,l))continue;const C=f?f.evaluate(k,{},l,o.availableImages):void 0,R={id:x,properties:_.properties,type:_.type,sourceLayerIndex:E,index:w,geometry:I?k.geometry:Da(_,l,h),patterns:{},sortKey:C};m.push(R)}f&&m.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of m){const{geometry:x,index:w,sourceLayerIndex:E}=_;if(this.hasPattern){const I=k2("fill",this.layers,_,this.zoom,o);this.patternFeatures.push(I)}else this.addFeature(_,x,w,l,{},o.availableImages,o.brightness);o.featureIndex.insert(n[w].feature,x,w,E,this.index)}}update(n,o,l,h,f){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,o,m?this.stateDependentLayers:this.layers,l,h,f)}addFeatures(n,o,l,h,f,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,o,l,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,xV),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,o,l,h,f,m=[],_){for(const x of A2(o,500)){let w=0;for(const L of x)w+=L.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=E.vertexLength,k=[],C=[];for(const L of x){if(L.length===0)continue;L!==x[0]&&C.push(k.length/2);const N=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),j=N.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(j+L.length-1,j),k.push(L[0].x),k.push(L[0].y);for(let Z=1;Z<L.length;Z++)this.layoutVertexArray.emplaceBack(L[Z].x,L[Z].y),this.indexArray2.emplaceBack(j+Z-1,j+Z),k.push(L[Z].x),k.push(L[Z].y);N.vertexLength+=L.length,N.primitiveLength+=L.length}const R=W0(k,C);for(let L=0;L<R.length;L+=3)this.indexArray.emplaceBack(I+R[L],I+R[L+1],I+R[L+2]);E.vertexLength+=w,E.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,f,m,h,_)}}xt(q0,"FillBucket",{omit:["layers","patternFeatures"]});const MV=new $e({"fill-sort-key":new Te(Ie.layout_fill["fill-sort-key"]),visibility:new ne(Ie.layout_fill.visibility)});var RV={paint:new $e({"fill-antialias":new ne(Ie.paint_fill["fill-antialias"]),"fill-opacity":new Te(Ie.paint_fill["fill-opacity"]),"fill-color":new Te(Ie.paint_fill["fill-color"]),"fill-outline-color":new Te(Ie.paint_fill["fill-outline-color"]),"fill-translate":new ne(Ie.paint_fill["fill-translate"]),"fill-translate-anchor":new ne(Ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new Te(Ie.paint_fill["fill-pattern"]),"fill-emissive-strength":new ne(Ie.paint_fill["fill-emissive-strength"])}),layout:MV};const OV=Mt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),DV=Mt([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),LV=Mt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),zV=Mt([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),NV=Mt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:FV}=OV;var H0={},BV=It,MM=Yd;function Yd(r,n,o,l,h){this.properties={},this.extent=o,this.type=0,this._pbf=r,this._geometry=-1,this._keys=l,this._values=h,r.readFields(jV,this,n)}function jV(r,n,o){r==1?n.id=o.readVarint():r==2?function(l,h){for(var f=l.readVarint()+l.pos;l.pos<f;){var m=h._keys[l.readVarint()],_=h._values[l.readVarint()];h.properties[m]=_}}(o,n):r==3?n.type=o.readVarint():r==4&&(n._geometry=o.pos)}function VV(r){for(var n,o,l=0,h=0,f=r.length,m=f-1;h<f;m=h++)l+=((o=r[m]).x-(n=r[h]).x)*(n.y+o.y);return l}Yd.types=["Unknown","Point","LineString","Polygon"],Yd.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var n,o=r.readVarint()+r.pos,l=1,h=0,f=0,m=0,_=[];r.pos<o;){if(h<=0){var x=r.readVarint();l=7&x,h=x>>3}if(h--,l===1||l===2)f+=r.readSVarint(),m+=r.readSVarint(),l===1&&(n&&_.push(n),n=[]),n.push(new BV(f,m));else{if(l!==7)throw new Error("unknown command "+l);n&&n.push(n[0].clone())}}return n&&_.push(n),_},Yd.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var n=r.readVarint()+r.pos,o=1,l=0,h=0,f=0,m=1/0,_=-1/0,x=1/0,w=-1/0;r.pos<n;){if(l<=0){var E=r.readVarint();o=7&E,l=E>>3}if(l--,o===1||o===2)(h+=r.readSVarint())<m&&(m=h),h>_&&(_=h),(f+=r.readSVarint())<x&&(x=f),f>w&&(w=f);else if(o!==7)throw new Error("unknown command "+o)}return[m,x,_,w]},Yd.prototype.toGeoJSON=function(r,n,o){var l,h,f=this.extent*Math.pow(2,o),m=this.extent*r,_=this.extent*n,x=this.loadGeometry(),w=Yd.types[this.type];function E(C){for(var R=0;R<C.length;R++){var L=C[R];C[R]=[360*(L.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(L.y+_)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(l=0;l<x.length;l++)I[l]=x[l][0];E(x=I);break;case 2:for(l=0;l<x.length;l++)E(x[l]);break;case 3:for(x=function(C){var R=C.length;if(R<=1)return[C];for(var L,N,j=[],Z=0;Z<R;Z++){var X=VV(C[Z]);X!==0&&(N===void 0&&(N=X<0),N===X<0?(L&&j.push(L),L=[C[Z]]):L.push(C[Z]))}return L&&j.push(L),j}(x),l=0;l<x.length;l++)for(h=0;h<x[l].length;h++)E(x[l][h])}x.length===1?x=x[0]:w="Multi"+w;var k={type:"Feature",geometry:{type:w,coordinates:x},properties:this.properties};return"id"in this&&(k.id=this.id),k};var UV=MM,RM=OM;function OM(r,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields($V,this,n),this.length=this._features.length}function $V(r,n,o){r===15?n.version=o.readVarint():r===1?n.name=o.readString():r===5?n.extent=o.readVarint():r===2?n._features.push(o.pos):r===3?n._keys.push(o.readString()):r===4&&n._values.push(function(l){for(var h=null,f=l.readVarint()+l.pos;l.pos<f;){var m=l.readVarint()>>3;h=m===1?l.readString():m===2?l.readFloat():m===3?l.readDouble():m===4?l.readVarint64():m===5?l.readVarint():m===6?l.readSVarint():m===7?l.readBoolean():null}return h}(o))}OM.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var n=this._pbf.readVarint()+this._pbf.pos;return new UV(this._pbf,n,this.extent,this._keys,this._values)};var GV=RM;function WV(r,n,o){if(r===3){var l=new GV(o,o.readVarint()+o.pos);l.length&&(n[l.name]=l)}}var C2=H0.VectorTile=function(r,n){this.layers=r.readFields(WV,{},n)},Z0=H0.VectorTileFeature=MM;function X0(r,n,o,l){const h=[],f=l===0?(m,_,x,w,E,I)=>{m.push(new Oe(I,x+(I-_)/(w-_)*(E-x)))}:(m,_,x,w,E,I)=>{m.push(new Oe(_+(I-x)/(E-x)*(w-_),I))};for(const m of r){const _=[];for(const x of m){if(x.length<=2)continue;const w=[];for(let k=0;k<x.length-1;k++){const C=x[k].x,R=x[k].y,L=x[k+1].x,N=x[k+1].y,j=l===0?C:R,Z=l===0?L:N;j<n?Z>n&&f(w,C,R,L,N,n):j>o?Z<o&&f(w,C,R,L,N,o):w.push(x[k]),Z<n&&j>=n&&f(w,C,R,L,N,n),Z>o&&j<=o&&f(w,C,R,L,N,o)}let E=x[x.length-1];const I=l===0?E.x:E.y;I>=n&&I<=o&&w.push(E),w.length&&(E=w[w.length-1],w[0].x===E.x&&w[0].y===E.y||w.push(w[0]),_.push(w))}_.length&&h.push(_)}return h}H0.VectorTileLayer=RM;class DM{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){const l=n[o];this._stringToNumber[l]=o,this._numberToString[o]=l}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}var qV={read:function(r,n,o,l,h){var f,m,_=8*h-l-1,x=(1<<_)-1,w=x>>1,E=-7,I=o?h-1:0,k=o?-1:1,C=r[n+I];for(I+=k,f=C&(1<<-E)-1,C>>=-E,E+=_;E>0;f=256*f+r[n+I],I+=k,E-=8);for(m=f&(1<<-E)-1,f>>=-E,E+=l;E>0;m=256*m+r[n+I],I+=k,E-=8);if(f===0)f=1-w;else{if(f===x)return m?NaN:1/0*(C?-1:1);m+=Math.pow(2,l),f-=w}return(C?-1:1)*m*Math.pow(2,f-l)},write:function(r,n,o,l,h,f){var m,_,x,w=8*f-h-1,E=(1<<w)-1,I=E>>1,k=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=l?0:f-1,R=l?1:-1,L=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(_=isNaN(n)?1:0,m=E):(m=Math.floor(Math.log(n)/Math.LN2),n*(x=Math.pow(2,-m))<1&&(m--,x*=2),(n+=m+I>=1?k/x:k*Math.pow(2,1-I))*x>=2&&(m++,x/=2),m+I>=E?(_=0,m=E):m+I>=1?(_=(n*x-1)*Math.pow(2,h),m+=I):(_=n*Math.pow(2,I-1)*Math.pow(2,h),m=0));h>=8;r[o+C]=255&_,C+=R,_/=256,h-=8);for(m=m<<h|_,w+=h;w>0;r[o+C]=255&m,C+=R,m/=256,w-=8);r[o+C-R]|=128*L}},LM=lr,Y0=qV;function lr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}lr.Varint=0,lr.Fixed64=1,lr.Bytes=2,lr.Fixed32=5;var M2=4294967296,zM=1/M2,NM=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Il(r){return r.type===lr.Bytes?r.readVarint()+r.pos:r.pos+1}function Kd(r,n,o){return o?4294967296*n+(r>>>0):4294967296*(n>>>0)+(r>>>0)}function FM(r,n,o){var l=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));o.realloc(l);for(var h=o.pos-1;h>=r;h--)o.buf[h+l]=o.buf[h]}function HV(r,n){for(var o=0;o<r.length;o++)n.writeVarint(r[o])}function ZV(r,n){for(var o=0;o<r.length;o++)n.writeSVarint(r[o])}function XV(r,n){for(var o=0;o<r.length;o++)n.writeFloat(r[o])}function YV(r,n){for(var o=0;o<r.length;o++)n.writeDouble(r[o])}function KV(r,n){for(var o=0;o<r.length;o++)n.writeBoolean(r[o])}function JV(r,n){for(var o=0;o<r.length;o++)n.writeFixed32(r[o])}function QV(r,n){for(var o=0;o<r.length;o++)n.writeSFixed32(r[o])}function eU(r,n){for(var o=0;o<r.length;o++)n.writeFixed64(r[o])}function tU(r,n){for(var o=0;o<r.length;o++)n.writeSFixed64(r[o])}function K0(r,n){return(r[n]|r[n+1]<<8|r[n+2]<<16)+16777216*r[n+3]}function Jd(r,n,o){r[o]=n,r[o+1]=n>>>8,r[o+2]=n>>>16,r[o+3]=n>>>24}function BM(r,n){return(r[n]|r[n+1]<<8|r[n+2]<<16)+(r[n+3]<<24)}lr.prototype={destroy:function(){this.buf=null},readFields:function(r,n,o){for(o=o||this.length;this.pos<o;){var l=this.readVarint(),h=l>>3,f=this.pos;this.type=7&l,r(h,n,this),this.pos===f&&this.skip(l)}return n},readMessage:function(r,n){return this.readFields(r,n,this.readVarint()+this.pos)},readFixed32:function(){var r=K0(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=BM(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=K0(this.buf,this.pos)+K0(this.buf,this.pos+4)*M2;return this.pos+=8,r},readSFixed64:function(){var r=K0(this.buf,this.pos)+BM(this.buf,this.pos+4)*M2;return this.pos+=8,r},readFloat:function(){var r=Y0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Y0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var n,o,l=this.buf;return n=127&(o=l[this.pos++]),o<128?n:(n|=(127&(o=l[this.pos++]))<<7,o<128?n:(n|=(127&(o=l[this.pos++]))<<14,o<128?n:(n|=(127&(o=l[this.pos++]))<<21,o<128?n:function(h,f,m){var _,x,w=m.buf;if(_=(112&(x=w[m.pos++]))>>4,x<128||(_|=(127&(x=w[m.pos++]))<<3,x<128)||(_|=(127&(x=w[m.pos++]))<<10,x<128)||(_|=(127&(x=w[m.pos++]))<<17,x<128)||(_|=(127&(x=w[m.pos++]))<<24,x<128)||(_|=(1&(x=w[m.pos++]))<<31,x<128))return Kd(h,_,f);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(o=l[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,n=this.pos;return this.pos=r,r-n>=12&&NM?function(o,l,h){return NM.decode(o.subarray(l,h))}(this.buf,n,r):function(o,l,h){for(var f="",m=l;m<h;){var _,x,w,E=o[m],I=null,k=E>239?4:E>223?3:E>191?2:1;if(m+k>h)break;k===1?E<128&&(I=E):k===2?(192&(_=o[m+1]))==128&&(I=(31&E)<<6|63&_)<=127&&(I=null):k===3?(x=o[m+2],(192&(_=o[m+1]))==128&&(192&x)==128&&((I=(15&E)<<12|(63&_)<<6|63&x)<=2047||I>=55296&&I<=57343)&&(I=null)):k===4&&(x=o[m+2],w=o[m+3],(192&(_=o[m+1]))==128&&(192&x)==128&&(192&w)==128&&((I=(15&E)<<18|(63&_)<<12|(63&x)<<6|63&w)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,k=1):I>65535&&(I-=65536,f+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),f+=String.fromCharCode(I),m+=k}return f}(this.buf,n,r)},readBytes:function(){var r=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,r);return this.pos=r,n},readPackedVarint:function(r,n){if(this.type!==lr.Bytes)return r.push(this.readVarint(n));var o=Il(this);for(r=r||[];this.pos<o;)r.push(this.readVarint(n));return r},readPackedSVarint:function(r){if(this.type!==lr.Bytes)return r.push(this.readSVarint());var n=Il(this);for(r=r||[];this.pos<n;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==lr.Bytes)return r.push(this.readBoolean());var n=Il(this);for(r=r||[];this.pos<n;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==lr.Bytes)return r.push(this.readFloat());var n=Il(this);for(r=r||[];this.pos<n;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==lr.Bytes)return r.push(this.readDouble());var n=Il(this);for(r=r||[];this.pos<n;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==lr.Bytes)return r.push(this.readFixed32());var n=Il(this);for(r=r||[];this.pos<n;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==lr.Bytes)return r.push(this.readSFixed32());var n=Il(this);for(r=r||[];this.pos<n;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==lr.Bytes)return r.push(this.readFixed64());var n=Il(this);for(r=r||[];this.pos<n;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==lr.Bytes)return r.push(this.readSFixed64());var n=Il(this);for(r=r||[];this.pos<n;)r.push(this.readSFixed64());return r},skip:function(r){var n=7&r;if(n===lr.Varint)for(;this.buf[this.pos++]>127;);else if(n===lr.Bytes)this.pos=this.readVarint()+this.pos;else if(n===lr.Fixed32)this.pos+=4;else{if(n!==lr.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(r,n){this.writeVarint(r<<3|n)},realloc:function(r){for(var n=this.length||16;n<this.pos+r;)n*=2;if(n!==this.length){var o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Jd(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Jd(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Jd(this.buf,-1&r,this.pos),Jd(this.buf,Math.floor(r*zM),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Jd(this.buf,-1&r,this.pos),Jd(this.buf,Math.floor(r*zM),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(n,o){var l,h;if(n>=0?(l=n%4294967296|0,h=n/4294967296|0):(h=~(-n/4294967296),4294967295^(l=~(-n%4294967296))?l=l+1|0:(l=0,h=h+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(f,m,_){_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,_.buf[_.pos]=127&(f>>>=7)}(l,0,o),function(f,m){var _=(7&f)<<4;m.buf[m.pos++]|=_|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(h,o)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var n=this.pos;this.pos=function(l,h,f){for(var m,_,x=0;x<h.length;x++){if((m=h.charCodeAt(x))>55295&&m<57344){if(!_){m>56319||x+1===h.length?(l[f++]=239,l[f++]=191,l[f++]=189):_=m;continue}if(m<56320){l[f++]=239,l[f++]=191,l[f++]=189,_=m;continue}m=_-55296<<10|m-56320|65536,_=null}else _&&(l[f++]=239,l[f++]=191,l[f++]=189,_=null);m<128?l[f++]=m:(m<2048?l[f++]=m>>6|192:(m<65536?l[f++]=m>>12|224:(l[f++]=m>>18|240,l[f++]=m>>12&63|128),l[f++]=m>>6&63|128),l[f++]=63&m|128)}return f}(this.buf,r,this.pos);var o=this.pos-n;o>=128&&FM(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeFloat:function(r){this.realloc(4),Y0.write(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Y0.write(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var n=r.length;this.writeVarint(n),this.realloc(n);for(var o=0;o<n;o++)this.buf[this.pos++]=r[o]},writeRawMessage:function(r,n){this.pos++;var o=this.pos;r(n,this);var l=this.pos-o;l>=128&&FM(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeMessage:function(r,n,o){this.writeTag(r,lr.Bytes),this.writeRawMessage(n,o)},writePackedVarint:function(r,n){n.length&&this.writeMessage(r,HV,n)},writePackedSVarint:function(r,n){n.length&&this.writeMessage(r,ZV,n)},writePackedBoolean:function(r,n){n.length&&this.writeMessage(r,KV,n)},writePackedFloat:function(r,n){n.length&&this.writeMessage(r,XV,n)},writePackedDouble:function(r,n){n.length&&this.writeMessage(r,YV,n)},writePackedFixed32:function(r,n){n.length&&this.writeMessage(r,JV,n)},writePackedSFixed32:function(r,n){n.length&&this.writeMessage(r,QV,n)},writePackedFixed64:function(r,n){n.length&&this.writeMessage(r,eU,n)},writePackedSFixed64:function(r,n){n.length&&this.writeMessage(r,tU,n)},writeBytesField:function(r,n){this.writeTag(r,lr.Bytes),this.writeBytes(n)},writeFixed32Field:function(r,n){this.writeTag(r,lr.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(r,n){this.writeTag(r,lr.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(r,n){this.writeTag(r,lr.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(r,n){this.writeTag(r,lr.Fixed64),this.writeSFixed64(n)},writeVarintField:function(r,n){this.writeTag(r,lr.Varint),this.writeVarint(n)},writeSVarintField:function(r,n){this.writeTag(r,lr.Varint),this.writeSVarint(n)},writeStringField:function(r,n){this.writeTag(r,lr.Bytes),this.writeString(n)},writeFloatField:function(r,n){this.writeTag(r,lr.Fixed32),this.writeFloat(n)},writeDoubleField:function(r,n){this.writeTag(r,lr.Fixed64),this.writeDouble(n)},writeBooleanField:function(r,n){this.writeVarintField(r,!!n)}};var J0=fe(LM);const nU=["tile","layer","source","sourceLayer","state"];class jM{constructor(n,o,l,h,f){this.type="Feature",this._vectorTileFeature=n,this._z=o,this._x=l,this._y=h,this.properties=n.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(n.id=this.id);for(const o of nU)this[o]!==void 0&&(n[o]=this[o]);return n}}class rU{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,o,l){const h=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][h]=this.stateChanges[n][h]||{},br(this.stateChanges[n][h],l),this.deletedStates[n]===null){this.deletedStates[n]={};for(const f in this.state[n])f!==h&&(this.deletedStates[n][f]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][h]===null){this.deletedStates[n][h]={};for(const f in this.state[n][h])l[f]||(this.deletedStates[n][h][f]=null)}else for(const f in l)this.deletedStates[n]&&this.deletedStates[n][h]&&this.deletedStates[n][h][f]===null&&delete this.deletedStates[n][h][f]}removeFeatureState(n,o,l){if(this.deletedStates[n]===null)return;const h=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},l&&o!==void 0)this.deletedStates[n][h]!==null&&(this.deletedStates[n][h]=this.deletedStates[n][h]||{},this.deletedStates[n][h][l]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][h])for(l in this.deletedStates[n][h]={},this.stateChanges[n][h])this.deletedStates[n][h][l]=null;else this.deletedStates[n][h]=null;else this.deletedStates[n]=null}getState(n,o){const l=String(o),h=br({},(this.state[n]||{})[l],(this.stateChanges[n]||{})[l]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const f=this.deletedStates[n][o];if(f===null)return{};for(const m in f)delete h[m]}return h}initializeTileState(n,o){n.setFeatureState(this.state,o)}coalesceChanges(n,o){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const f={};for(const m in this.stateChanges[h])this.state[h][m]||(this.state[h][m]={}),br(this.state[h][m],this.stateChanges[h][m]),f[m]=this.state[h][m];l[h]=f}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const f={};if(this.deletedStates[h]===null)for(const m in this.state[h])f[m]={},this.state[h][m]={};else for(const m in this.deletedStates[h]){if(this.deletedStates[h][m]===null)this.state[h][m]={};else if(this.state[h][m])for(const _ of Object.keys(this.deletedStates[h][m]))delete this.state[h][m][_];f[m]=this.state[h][m]}l[h]=l[h]||{},br(l[h],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in n)n[h].setFeatureState(l,o)}}class VM{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,o){const l=this.toIdx(n,o);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(n,o){return this.leaves[this.toIdx(n,o)]}toIdx(n,o){return o*this.size+n}}function UM(r,n,o,l){let h=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(l[m])<1e-15){if(o[m]<r[m]||o[m]>n[m])return null}else{const _=1/l[m];let x=(r[m]-o[m])*_,w=(n[m]-o[m])*_;if(x>w){const E=x;x=w,w=E}if(x>h&&(h=x),w<f&&(f=w),h>f)return null}return h}function $M(r,n,o,l,h,f,m,_,x,w,E){const I=l-r,k=h-n,C=f-o,R=m-r,L=_-n,N=x-o,j=E[1]*N-E[2]*L,Z=E[2]*R-E[0]*N,X=E[0]*L-E[1]*R,J=I*j+k*Z+C*X;if(Math.abs(J)<1e-15)return null;const te=1/J,re=w[0]-r,pe=w[1]-n,ve=w[2]-o,be=(re*j+pe*Z+ve*X)*te;if(be<0||be>1)return null;const Pe=pe*C-ve*k,Se=ve*I-re*C,Fe=re*k-pe*I,Qe=(E[0]*Pe+E[1]*Se+E[2]*Fe)*te;return Qe<0||be+Qe>1?null:(R*Pe+L*Se+N*Fe)*te}function GM(r,n,o){return(r-n)/(o-n)}function WM(r,n,o,l,h,f,m,_,x){const w=1<<o,E=f-l,I=m-h,k=(r+1)/w*E+l,C=(n+0)/w*I+h,R=(n+1)/w*I+h;_[0]=(r+0)/w*E+l,_[1]=C,x[0]=k,x[1]=R}class qM{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(f){const m=Math.ceil(Math.log2(f.dim/8)),_=[];let x=Math.ceil(Math.pow(2,m));const w=1/x,E=(C,R,L,N,j)=>{const Z=N?1:0,X=(C+1)*L-Z,J=R*L,te=(R+1)*L-Z;j[0]=C*L,j[1]=J,j[2]=X,j[3]=te};let I=new VM(x);const k=[];for(let C=0;C<x*x;C++){E(C%x,Math.floor(C/x),w,!1,k);const R=Pc(k[0],k[1],f),L=Pc(k[2],k[1],f),N=Pc(k[2],k[3],f),j=Pc(k[0],k[3],f);I.minimums.push(Math.min(R,L,N,j)),I.maximums.push(Math.max(R,L,N,j)),I.leaves.push(1)}for(_.push(I),x/=2;x>=1;x/=2){const C=_[_.length-1];I=new VM(x);for(let R=0;R<x*x;R++){E(R%x,Math.floor(R/x),2,!0,k);const L=C.getElevation(k[0],k[1]),N=C.getElevation(k[2],k[1]),j=C.getElevation(k[2],k[3]),Z=C.getElevation(k[0],k[3]),X=C.isLeaf(k[0],k[1]),J=C.isLeaf(k[2],k[1]),te=C.isLeaf(k[2],k[3]),re=C.isLeaf(k[0],k[3]),pe=Math.min(L.min,N.min,j.min,Z.min),ve=Math.max(L.max,N.max,j.max,Z.max),be=X&&J&&te&&re;I.maximums.push(ve),I.minimums.push(pe),I.leaves.push(ve-pe<=5&&be?1:0)}_.push(I)}return _}(this.dem),l=o.length-1,h=o[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(o,0,0,l,0)}raycastRoot(n,o,l,h,f,m,_=1){return UM([n,o,-100],[l,h,this.maximums[0]*_],f,m)}raycast(n,o,l,h,f,m,_=1){if(!this.nodeCount)return null;const x=this.raycastRoot(n,o,l,h,f,m,_);if(x==null)return null;const w=[],E=[],I=[],k=[],C=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;C.length>0;){const{idx:R,t:L,nodex:N,nodey:j,depth:Z}=C.pop();if(this.leaves[R]){WM(N,j,Z,n,o,l,h,I,k);const J=1<<Z,te=(N+0)/J,re=(N+1)/J,pe=(j+0)/J,ve=(j+1)/J,be=Pc(te,pe,this.dem)*_,Pe=Pc(re,pe,this.dem)*_,Se=Pc(re,ve,this.dem)*_,Fe=Pc(te,ve,this.dem)*_,Qe=$M(I[0],I[1],be,k[0],I[1],Pe,k[0],k[1],Se,f,m),Le=$M(k[0],k[1],Se,I[0],k[1],Fe,I[0],I[1],be,f,m),He=Math.min(Qe!==null?Qe:Number.MAX_VALUE,Le!==null?Le:Number.MAX_VALUE);if(He!==Number.MAX_VALUE)return He;{const De=a.v.scaleAndAdd([],f,m,L);if(HM(be,Pe,Fe,Se,GM(De[0],I[0],k[0]),GM(De[1],I[1],k[1]))>=De[2])return L}continue}let X=0;for(let J=0;J<this._siblingOffset.length;J++){WM((N<<1)+this._siblingOffset[J][0],(j<<1)+this._siblingOffset[J][1],Z+1,n,o,l,h,I,k),I[2]=-100,k[2]=this.maximums[this.childOffsets[R]+J]*_;const te=UM(I,k,f,m);if(te!=null){const re=te;w[J]=re;let pe=!1;for(let ve=0;ve<X&&!pe;ve++)re>=w[E[ve]]&&(E.splice(ve,0,J),pe=!0);pe||(E[X]=J),X++}}for(let J=0;J<X;J++){const te=E[J];C.push({idx:this.childOffsets[R]+te,t:w[te],nodex:(N<<1)+this._siblingOffset[te][0],nodey:(j<<1)+this._siblingOffset[te][1],depth:Z+1})}}return null}_addNode(n,o,l){return this.minimums.push(n),this.maximums.push(o),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(n,o,l,h,f){if(n[h].isLeaf(o,l)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const m=h-1,_=n[m];let x=0,w=0;for(let E=0;E<this._siblingOffset.length;E++){const I=2*o+this._siblingOffset[E][0],k=2*l+this._siblingOffset[E][1],C=_.getElevation(I,k),R=_.isLeaf(I,k),L=this._addNode(C.min,C.max,R);R&&(x|=1<<E),w||(w=L)}for(let E=0;E<this._siblingOffset.length;E++)x&1<<E||this._construct(n,2*o+this._siblingOffset[E][0],2*l+this._siblingOffset[E][1],m,w+E)}}function HM(r,n,o,l,h,f){return ln(ln(r,o,f),ln(n,l,f),h)}function Pc(r,n,o){const l=o.dim,h=Ze(r*l-.5,0,l-1),f=Ze(n*l-.5,0,l-1),m=Math.floor(h),_=Math.floor(f),x=Math.min(m+1,l-1),w=Math.min(_+1,l-1);return HM(o.get(m,_),o.get(x,_),o.get(m,w),o.get(x,w),h-m,f-_)}const iU={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function oU(r,n,o){return(256*r*256+256*n+o)/10-1e4}function sU(r,n,o){return 256*r+n+o/256-32768}class Q0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,o,l,h=!1){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return pr(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const f=this.dim=o.height-2,m=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let x=0;x<f;x++)m[this._idx(-1,x)]=m[this._idx(0,x)],m[this._idx(f,x)]=m[this._idx(f-1,x)],m[this._idx(x,-1)]=m[this._idx(x,0)],m[this._idx(x,f)]=m[this._idx(x,f-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(f,-1)]=m[this._idx(f-1,0)],m[this._idx(-1,f)]=m[this._idx(0,f-1)],m[this._idx(f,f)]=m[this._idx(f-1,f-1)]}const _=l==="terrarium"?sU:oU;for(let x=0;x<m.length;++x){const w=4*x;this.floatView[x]=_(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=Li.now()}_buildQuadTree(){this._tree=new qM(this)}get(n,o,l=!1){l&&(n=Ze(n,-1,this.dim),o=Ze(o,-1,this.dim));const h=this._idx(n,o);return this.floatView[h]}set(n,o,l){const h=this._idx(n,o),f=this.floatView[h];return this.floatView[h]=l,l-f}static getUnpackVector(n){return iU[n]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}static pack(n,o){const l=[0,0,0,0],h=Q0.getUnpackVector(o);let f=Math.floor((n+h[3])/h[2]);return l[2]=f%256,f=Math.floor(f/256),l[1]=f%256,f=Math.floor(f/256),l[0]=f,l}getPixels(){return new IM({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,o,l){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let h=o*this.dim,f=o*this.dim+this.dim,m=l*this.dim,_=l*this.dim+this.dim;switch(o){case-1:h=f-1;break;case 1:f=h+1}switch(l){case-1:m=_-1;break;case 1:_=m+1}const x=-o*this.dim,w=-l*this.dim;for(let E=m;E<_;E++)for(let I=h;I<f;I++){const k=4*this._idx(I,E),C=4*this._idx(I+x,E+w);this.pixels[k+0]=n.pixels[C+0],this.pixels[k+1]=n.pixels[C+1],this.pixels[k+2]=n.pixels[C+2],this.pixels[k+3]=n.pixels[C+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}xt(Q0,"DEMData"),xt(qM,"DemMinMaxQuadTree",{omit:["dem"]});class Qd{constructor(n,o,l){this._demTile=n,this._dem=this._demTile.dem,this._scale=o,this._offset=l}static create(n,o,l){const h=l||n.findDEMTileFor(o);if(!h||!h.dem)return;const f=h.dem,m=h.tileID,_=1<<o.canonical.z-m.canonical.z;return new Qd(h,f.dim/at/_,[(o.canonical.x/_-m.canonical.x)*f.dim,(o.canonical.y/_-m.canonical.y)*f.dim])}tileCoordToPixel(n,o){const l=o*this._scale+this._offset[1],h=Math.floor(n*this._scale+this._offset[0]),f=Math.floor(l);return new Oe(h,f)}getElevationAt(n,o,l,h){const f=n*this._scale+this._offset[0],m=o*this._scale+this._offset[1],_=Math.floor(f),x=Math.floor(m),w=this._dem;return h=!!h,l?ln(ln(w.get(_,x,h),w.get(_,x+1,h),m-x),ln(w.get(_+1,x,h),w.get(_+1,x+1,h),m-x),f-_):w.get(_,x,h)}getElevationAtPixel(n,o,l){return this._dem.get(n,o,!!l)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*to(1,n)*this._dem.stride}}class R2{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new bc(at,16,0),this.featureIndexArray=new Tk,this.promoteId=o}insert(n,o,l,h,f,m=0){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,f,m);const x=this.grid;for(let w=0;w<o.length;w++){const E=o[w],I=[1/0,1/0,-1/0,-1/0];for(let k=0;k<E.length;k++){const C=E[k];I[0]=Math.min(I[0],C.x),I[1]=Math.min(I[1],C.y),I[2]=Math.max(I[2],C.x),I[3]=Math.max(I[3],C.y)}I[0]<at&&I[1]<at&&I[2]>=0&&I[3]>=0&&x.insert(_,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new C2(new J0(this.rawTileData)).layers,this.sourceLayerCoder=new DM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,o,l,h){this.loadVTLayers();const f=n.params||{},m=Fd(f.filter),_=n.tileResult,x=n.transform,w=_.bufferedTilespaceBounds,E=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(R,L,N,j)=>_M(_.bufferedTilespaceGeometry,R,L,N,j));E.sort(aU);let I=null;x.elevation&&E.length>0&&(I=Qd.create(x.elevation,this.tileID));const k={};let C;for(let R=0;R<E.length;R++){const L=E[R];if(L===C)continue;C=L;const N=this.featureIndexArray.get(L);let j=null;this.loadMatchingFeature(k,N,m,f.layers,f.availableImages,o,l,h,(Z,X,J,te=0)=>(j||(j=Da(Z,this.tileID.canonical,n.tileTransform)),X.queryIntersectsFeature(_,Z,J,j,this.z,n.transform,n.pixelPosMatrix,I,te)))}return k}loadMatchingFeature(n,o,l,h,f,m,_,x,w){const{featureIndex:E,bucketIndex:I,sourceLayerIndex:k,layoutVertexArrayOffset:C}=o,R=this.bucketLayerIDs[I];if(h&&!function(Z,X){for(let J=0;J<Z.length;J++)if(X.indexOf(Z[J])>=0)return!0;return!1}(h,R))return;const L=this.sourceLayerCoder.decode(k),N=this.vtLayers[L].feature(E);if(l.needGeometry){const Z=Ac(N,!0);if(!l.filter(new de(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!l.filter(new de(this.tileID.overscaledZ),N))return;const j=this.getId(N,L);for(let Z=0;Z<R.length;Z++){const X=R[Z];if(h&&h.indexOf(X)<0)continue;const J=m[X];if(!J)continue;let te={};j!==void 0&&x&&(te=x.getState(J.sourceLayer||"_geojsonTileLayer",j));const re=br({},_[X]);re.paint=ZM(re.paint,J.paint,N,te,f),re.layout=ZM(re.layout,J.layout,N,te,f);const pe=!w||w(N,J,te,C);if(!pe)continue;const ve=new jM(N,this.z,this.x,this.y,j);ve.layer=re;let be=n[X];be===void 0&&(be=n[X]=[]),be.push({featureIndex:E,feature:ve,intersectionZ:pe})}}lookupSymbolFeatures(n,o,l,h,f,m,_,x){const w={};this.loadVTLayers();const E=Fd(f);for(const I of n)this.loadMatchingFeature(w,{bucketIndex:l,sourceLayerIndex:h,featureIndex:I,layoutVertexArrayOffset:0},E,m,_,x,o);return w}loadFeature(n){const{featureIndex:o,sourceLayerIndex:l}=n;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),f=this.vtFeatures[h];if(f[o])return f[o];const m=this.vtLayers[h].feature(o);return f[o]=m,m}hasLayer(n){for(const o of this.bucketLayerIDs)for(const l of o)if(n===l)return!0;return!1}getId(n,o){let l=n.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];h!=null&&(l=n.properties[h]),typeof l=="boolean"&&(l=Number(l))}return l}}function ZM(r,n,o,l,h){return Cu(r,(f,m)=>{const _=n instanceof Ve?n.get(m):null;return _&&_.evaluate?_.evaluate(o,l,h):_})}function aU(r,n){return n-r}xt(R2,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const lU=Mt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),cU=Mt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),uU=Mt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Mt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const hU=Mt([{name:"a_z_offset",components:1,type:"Float32"}],4),dU=Mt([{name:"a_texb",components:2,type:"Uint16"}]),fU=Mt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),pU=Mt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const XM=Mt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),mU=Mt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Mt([{name:"triangle",components:3,type:"Uint16"}]),Mt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Mt([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Mt([{type:"Float32",name:"offsetX"}]),Mt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ti=24;const Ks=128;function O2(r,n){const{expression:o}=n;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new de(r+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:h}=o;let f=0;for(;f<l.length&&l[f]<=r;)f++;f=Math.max(0,f-1);let m=f;for(;m<l.length&&l[m]<r+1;)m++;m=Math.min(l.length-1,m);const _=l[f],x=l[m];return o.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:h}:{kind:"camera",minZoom:_,maxZoom:x,minSize:o.evaluate(new de(_)),maxSize:o.evaluate(new de(x)),interpolationType:h}}}function ev(r,{uSize:n,uSizeT:o},{lowerSize:l,upperSize:h}){return r.kind==="source"?l/Ks:r.kind==="composite"?ln(l/Ks,h/Ks,o):n}function ef(r,n){let o=0,l=0;if(r.kind==="constant")l=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:h,minZoom:f,maxZoom:m}=r,_=h?Ze(es.interpolationFactor(h,n,f,m),0,1):0;r.kind==="camera"?l=ln(r.minSize,r.maxSize,_):o=_}return{uSizeT:o,uSize:l}}var gU=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ks,evaluateSizeForFeature:ev,evaluateSizeForZoom:ef,getSizeData:O2});function _U(r,n,o){return r.sections.forEach(l=>{l.text=function(h,f,m){const _=f.layout.get("text-transform").evaluate(m,{});return _==="uppercase"?h=h.toLocaleUpperCase():_==="lowercase"&&(h=h.toLocaleLowerCase()),ge.applyArabicShaping&&(h=ge.applyArabicShaping(h)),h}(l.text,n,o)}),r}const Hm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function yU(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function vU(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}const D2=3;function xU(r,n,o){n.glyphs=[],r===1&&o.readMessage(bU,n)}function bU(r,n,o){if(r===3){const{id:l,bitmap:h,width:f,height:m,left:_,top:x,advance:w}=o.readMessage(wU,{});n.glyphs.push({id:l,bitmap:new Sl({width:f+2*D2,height:m+2*D2},h),metrics:{width:f,height:m,left:_,top:x,advance:w}})}else r===4?n.ascender=o.readSVarint():r===5&&(n.descender=o.readSVarint())}function wU(r,n,o){r===1?n.id=o.readVarint():r===2?n.bitmap=o.readBytes():r===3?n.width=o.readVarint():r===4?n.height=o.readVarint():r===5?n.left=o.readSVarint():r===6?n.top=o.readSVarint():r===7&&(n.advance=o.readVarint())}const YM=D2,ls={horizontal:1,vertical:2,horizontalOnly:3},KM=-17;class Zm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,o){const l=new Zm;return l.scale=n||1,l.fontStack=o,l}static forImage(n){const o=new Zm;return o.imageName=n,o}}class tf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o){const l=new tf;for(let h=0;h<n.sections.length;h++){const f=n.sections[h];f.image?l.addImageSection(f):l.addTextSection(f,o)}return l}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(o,l){let h="";for(let f=0;f<o.length;f++){const m=o.charCodeAt(f+1)||null,_=o.charCodeAt(f-1)||null;h+=!l&&(m&&D(m)&&!Hm[o[f+1]]||_&&D(_)&&!Hm[o[f-1]])||!Hm[o[f]]?o[f]:Hm[o[f]]}return h}(this.text,n)}trim(){let n=0;for(let l=0;l<this.text.length&&tv[this.text.charCodeAt(l)];l++)n++;let o=this.text.length;for(let l=this.text.length-1;l>=0&&l>=n&&tv[this.text.charCodeAt(l)];l--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){const l=new tf;return l.text=this.text.substring(n,o),l.sectionIndex=this.sectionIndex.slice(n,o),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,o)=>Math.max(n,this.sections[o].scale),0)}addTextSection(n,o){this.text+=n.text,this.sections.push(Zm.forText(n.scale,n.fontStack||o));const l=this.sections.length-1;for(let h=0;h<n.text.length;++h)this.sectionIndex.push(l)}addImageSection(n){const o=n.image?n.image.namePrimary:"";if(o.length===0)return void pr("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCodePoint(l),this.sections.push(Zm.forImage(o)),this.sectionIndex.push(this.sections.length-1)):pr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function L2(r,n,o,l,h,f,m,_,x,w,E,I,k,C,R){const L=tf.fromFeature(r,h);I===ls.vertical&&L.verticalizePunctuation(k);let N=[];const j=function(re,pe,ve,be,Pe,Se){if(!re)return[];const Fe=[],Qe=function(ut,yt,Ke,Vt,wt,ct){let Ut=0;for(let Rt=0;Rt<ut.length();Rt++){const Nt=ut.getSection(Rt);Ut+=JM(ut.getCodePoint(Rt),Nt,Vt,wt,yt,ct)}return Ut/Math.max(1,Math.ceil(Ut/Ke))}(re,pe,ve,be,Pe,Se),Le=re.text.indexOf("")>=0;let He=0;for(let ut=0;ut<re.length();ut++){const yt=re.getSection(ut),Ke=re.getCodePoint(ut);if(tv[Ke]||(He+=JM(Ke,yt,be,Pe,pe,Se)),ut<re.length()-1){const Vt=!((De=Ke)<11904||!(b["Bopomofo Extended"](De)||b.Bopomofo(De)||b["CJK Compatibility Forms"](De)||b["CJK Compatibility Ideographs"](De)||b["CJK Compatibility"](De)||b["CJK Radicals Supplement"](De)||b["CJK Strokes"](De)||b["CJK Symbols and Punctuation"](De)||b["CJK Unified Ideographs Extension A"](De)||b["CJK Unified Ideographs"](De)||b["Enclosed CJK Letters and Months"](De)||b["Halfwidth and Fullwidth Forms"](De)||b.Hiragana(De)||b["Ideographic Description Characters"](De)||b["Kangxi Radicals"](De)||b["Katakana Phonetic Extensions"](De)||b.Katakana(De)||b["Vertical Forms"](De)||b["Yi Radicals"](De)||b["Yi Syllables"](De)));(TU[Ke]||Vt||yt.imageName)&&Fe.push(eR(ut+1,He,Qe,Fe,EU(Ke,re.getCodePoint(ut+1),Vt&&Le),!1))}}var De;return tR(eR(re.length(),He,Qe,Fe,0,!0))}(L,w,f,n,l,C),{processBidirectionalText:Z,processStyledBidirectionalText:X}=ge;if(Z&&L.sections.length===1){const re=Z(L.toString(),j);for(const pe of re){const ve=new tf;ve.text=pe,ve.sections=L.sections;for(let be=0;be<pe.length;be++)ve.sectionIndex.push(0);N.push(ve)}}else if(X){const re=X(L.text,L.sectionIndex,j);for(const pe of re){const ve=new tf;ve.text=pe[0],ve.sectionIndex=pe[1],ve.sections=L.sections,N.push(ve)}}else N=function(re,pe){const ve=[],be=re.text;let Pe=0;for(const Se of pe)ve.push(re.substring(Pe,Se)),Pe=Se;return Pe<be.length&&ve.push(re.substring(Pe,be.length)),ve}(L,j);const J=[],te={positionedLines:J,text:L.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(re,pe,ve,be,Pe,Se,Fe,Qe,Le,He,De,ut){let yt=0,Ke=0,Vt=0;const wt=Qe==="right"?1:Qe==="left"?0:.5;let ct=!1;for(const gn of Pe){const en=gn.getSections();for(const un of en){if(un.imageName)continue;const In=pe[un.fontStack];if(In&&(ct=In.ascender!==void 0&&In.descender!==void 0,!ct))break}if(!ct)break}let Ut=0;for(const gn of Pe){gn.trim();const en=gn.getMaxScale(),un=(en-1)*Ti,In={positionedGlyphs:[],lineOffset:0};re.positionedLines[Ut]=In;const Zn=In.positionedGlyphs;let on=0;if(!gn.length()){Ke+=Se,++Ut;continue}let cr=0,Xn=0;for(let Fn=0;Fn<gn.length();Fn++){const An=gn.getSection(Fn),Tr=gn.getSectionIndex(Fn),ur=gn.getCodePoint(Fn);let kr=An.scale,ri=null,no=null,Lr=null,Ar=Ti,Vi=0;const Ui=!(Le===ls.horizontal||!De&&!M(ur)||De&&(tv[ur]||(Rt=ur,b.Arabic(Rt)||b["Arabic Supplement"](Rt)||b["Arabic Extended-A"](Rt)||b["Arabic Presentation Forms-A"](Rt)||b["Arabic Presentation Forms-B"](Rt))));if(An.imageName){const ro=be[An.imageName];if(!ro)continue;Lr=An.imageName,re.iconsInText=re.iconsInText||!0,no=ro.paddedRect;const hr=ro.displaySize;kr=kr*Ti/ut,ri={width:hr[0],height:hr[1],left:0,top:-YM,advance:Ui?hr[1]:hr[0],localGlyph:!1},Vi=ct?-ri.height*kr:KM+en*Ti-hr[1]*kr,Ar=ri.advance;const ta=(Ui?hr[0]:hr[1])*kr-Ti*en;ta>0&&ta>on&&(on=ta)}else{const ro=ve[An.fontStack];if(!ro)continue;ro[ur]&&(no=ro[ur]);const hr=pe[An.fontStack];if(!hr)continue;const ta=hr.glyphs[ur];if(!ta)continue;if(ri=ta.metrics,Ar=ur!==8203?Ti:0,ct){const cf=hr.ascender!==void 0?Math.abs(hr.ascender):0,kl=hr.descender!==void 0?Math.abs(hr.descender):0,Cl=(cf+kl)*kr;cr<Cl&&(cr=Cl,Xn=(cf-kl)/2*kr),Vi=-cf*kr}else Vi=KM+(en-kr)*Ti}Ui?(re.verticalizable=!0,Zn.push({glyph:ur,imageName:Lr,x:yt,y:Ke+Vi,vertical:Ui,scale:kr,localGlyph:ri.localGlyph,fontStack:An.fontStack,sectionIndex:Tr,metrics:ri,rect:no}),yt+=Ar*kr+He):(Zn.push({glyph:ur,imageName:Lr,x:yt,y:Ke+Vi,vertical:Ui,scale:kr,localGlyph:ri.localGlyph,fontStack:An.fontStack,sectionIndex:Tr,metrics:ri,rect:no}),yt+=ri.advance*kr+He)}Zn.length!==0&&(Vt=Math.max(yt-He,Vt),ct?nR(Zn,wt,on,Xn,Se*en/2):nR(Zn,wt,on,0,Se/2)),yt=0;const Dn=Se*en+on;In.lineOffset=Math.max(on,un),Ke+=Dn,++Ut}var Rt;const Nt=Ke,{horizontalAlign:it,verticalAlign:Xt}=z2(Fe);(function(gn,en,un,In,Zn,on){const cr=(en-un)*Zn,Xn=-on*In;for(const Dn of gn)for(const Fn of Dn.positionedGlyphs)Fn.x+=cr,Fn.y+=Xn})(re.positionedLines,wt,it,Xt,Vt,Nt),re.top+=-Xt*Nt,re.bottom=re.top+Nt,re.left+=-it*Vt,re.right=re.left+Vt,re.hasBaseline=ct}(te,n,o,l,N,m,_,x,I,w,k,R),!function(re){for(const pe of re)if(pe.positionedGlyphs.length!==0)return!1;return!0}(J)&&te}const tv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},TU={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function JM(r,n,o,l,h,f){if(n.imageName){const m=l[n.imageName];return m?m.displaySize[0]*n.scale*Ti/f+h:0}{const m=o[n.fontStack],_=m&&m.glyphs[r];return _?_.metrics.advance*n.scale+h:0}}function QM(r,n,o,l){const h=Math.pow(r-n,2);return l?r<n?h/2:2*h:h+Math.abs(o)*o}function EU(r,n,o){let l=0;return r===10&&(l-=1e4),o&&(l+=150),r!==40&&r!==65288||(l+=50),n!==41&&n!==65289||(l+=50),l}function eR(r,n,o,l,h,f){let m=null,_=QM(n,o,h,f);for(const x of l){const w=QM(n-x.x,o,h,f)+x.badness;w<=_&&(m=x,_=w)}return{index:r,x:n,priorBreak:m,badness:_}}function tR(r){return r?tR(r.priorBreak).concat(r.index):[]}function z2(r){let n=.5,o=.5;switch(r){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function nR(r,n,o,l,h){if(!(n||o||l||h))return;const f=r.length-1,m=r[f],_=(m.x+m.metrics.advance*m.scale)*n;for(let x=0;x<=f;x++)r[x].x-=_,r[x].y+=o+l+h}function SU(r,n,o,l){const{horizontalAlign:h,verticalAlign:f}=z2(l),m=o[0]-r.displaySize[0]*h,_=o[1]-r.displaySize[1]*f;return{imagePrimary:r,imageSecondary:n,top:_,bottom:_+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function rR(r,n,o,l,h,f){const m=r.imagePrimary;let _;if(m.content){const N=m.content,j=m.pixelRatio||1;_=[N[0]/j,N[1]/j,m.displaySize[0]-N[2]/j,m.displaySize[1]-N[3]/j]}const x=n.left*f,w=n.right*f;let E,I,k,C;o==="width"||o==="both"?(C=h[0]+x-l[3],I=h[0]+w+l[1]):(C=h[0]+(x+w-m.displaySize[0])/2,I=C+m.displaySize[0]);const R=n.top*f,L=n.bottom*f;return o==="height"||o==="both"?(E=h[1]+R-l[0],k=h[1]+L+l[2]):(E=h[1]+(R+L-m.displaySize[1])/2,k=E+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:E,right:I,bottom:k,left:C,collisionPadding:_}}class Al extends Oe{constructor(n,o,l,h,f){super(n,o),this.angle=h,this.z=l,f!==void 0&&(this.segment=f)}clone(){return new Al(this.x,this.y,this.z,this.angle,this.segment)}}function iR(r,n,o,l,h){if(n.segment===void 0)return!0;let f=n,m=n.segment+1,_=0;for(;_>-o/2;){if(m--,m<0)return!1;_-=r[m].dist(f),f=r[m]}_+=r[m].dist(r[m+1]),m++;const x=[];let w=0;for(;_<o/2;){const E=r[m],I=r[m+1];if(!I)return!1;let k=r[m-1].angleTo(E)-E.angleTo(I);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:k}),w+=k;_-x[0].distance>l;)w-=x.shift().angleDelta;if(w>h)return!1;m++,_+=E.dist(I)}return!0}function oR(r){let n=0;for(let o=0;o<r.length-1;o++)n+=r[o].dist(r[o+1]);return n}function sR(r,n,o){return r?.6*n*o:0}function aR(r,n){return Math.max(r?r.right-r.left:0,n?n.right-n.left:0)}function IU(r,n,o,l,h,f){const m=sR(o,h,f),_=aR(o,l)*f;let x=0;const w=oR(r)/2;for(let E=0;E<r.length-1;E++){const I=r[E],k=r[E+1],C=I.dist(k);if(x+C>w){const R=(w-x)/C,L=ln(I.x,k.x,R),N=ln(I.y,k.y,R),j=new Al(L,N,0,k.angleTo(I),E);return!m||iR(r,j,_,m,n)?j:void 0}x+=C}}function AU(r,n,o,l,h,f,m,_,x){const w=sR(l,f,m),E=aR(l,h),I=E*m,k=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return n-I<n/4&&(n=I+n/4),lR(r,k?n/2*_%n:(E/2+2*f)*m*_%n,n,w,o,I,k,!1,x)}function lR(r,n,o,l,h,f,m,_,x){const w=f/2,E=oR(r);let I=0,k=n-o,C=[];for(let R=0;R<r.length-1;R++){const L=r[R],N=r[R+1],j=L.dist(N),Z=N.angleTo(L);for(;k+o<I+j;){k+=o;const X=(k-I)/j,J=ln(L.x,N.x,X),te=ln(L.y,N.y,X);if(J>=0&&J<x&&te>=0&&te<x&&k-w>=0&&k+w<=E){const re=new Al(J,te,0,Z,R);l&&!iR(r,re,f,l,h)||C.push(re)}}I+=j}return _||C.length||m||(C=lR(r,I/2,o,l,h,f,m,!0,x)),C}function cR(r,n,o,l,h){const f=[];for(let m=0;m<r.length;m++){const _=r[m];let x;for(let w=0;w<_.length-1;w++){let E=_[w],I=_[w+1];E.x<n&&I.x<n||(E.x<n?E=new Oe(n,E.y+(n-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x<n&&(I=new Oe(n,E.y+(n-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y<o&&I.y<o||(E.y<o?E=new Oe(E.x+(o-E.y)/(I.y-E.y)*(I.x-E.x),o)._round():I.y<o&&(I=new Oe(E.x+(o-E.y)/(I.y-E.y)*(I.x-E.x),o)._round()),E.x>=l&&I.x>=l||(E.x>=l?E=new Oe(l,E.y+(l-E.x)/(I.x-E.x)*(I.y-E.y))._round():I.x>=l&&(I=new Oe(l,E.y+(l-E.x)/(I.x-E.x)*(I.y-E.y))._round()),E.y>=h&&I.y>=h||(E.y>=h?E=new Oe(E.x+(h-E.y)/(I.y-E.y)*(I.x-E.x),h)._round():I.y>=h&&(I=new Oe(E.x+(h-E.y)/(I.y-E.y)*(I.x-E.x),h)._round()),x&&E.equals(x[x.length-1])||(x=[E],f.push(x)),x.push(I)))))}}return f}function N2(r){let n=0,o=0;for(const m of r)n+=m.w*m.h,o=Math.max(o,m.w);r.sort((m,_)=>_.h-m.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}];let h=0,f=0;for(const m of r)for(let _=l.length-1;_>=0;_--){const x=l[_];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,f=Math.max(f,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===x.w&&m.h===x.h){const w=l.pop();_<l.length&&(l[_]=w)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(l.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:h,h:f,fill:n/(h*f)||0}}xt(Al,"Anchor");const No=1;class F2{constructor(n,{pixelRatio:o,version:l,stretchX:h,stretchY:f,content:m}){this.paddedRect=n,this.pixelRatio=o,this.stretchX=h,this.stretchY=f,this.content=m,this.version=l}get tl(){return[this.paddedRect.x+No,this.paddedRect.y+No]}get br(){return[this.paddedRect.x+this.paddedRect.w-No,this.paddedRect.y+this.paddedRect.h-No]}get displaySize(){return[(this.paddedRect.w-2*No)/this.pixelRatio,(this.paddedRect.h-2*No)/this.pixelRatio]}}class uR{constructor(n,o){const l={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(n,l,f),this.addImages(o,h,f);const{w:m,h:_}=N2(f),x=new as({width:m||1,height:_||1});for(const w in n){const E=n[w],I=l[w].paddedRect;as.copy(E.data,x,{x:0,y:0},{x:I.x+No,y:I.y+No},E.data,E.sdf)}for(const w in o){const E=o[w],I=h[w].paddedRect,k=I.x+No,C=I.y+No,R=E.data.width,L=E.data.height;as.copy(E.data,x,{x:0,y:0},{x:k,y:C},E.data),as.copy(E.data,x,{x:0,y:L-1},{x:k,y:C-1},{width:R,height:1}),as.copy(E.data,x,{x:0,y:0},{x:k,y:C+L},{width:R,height:1}),as.copy(E.data,x,{x:R-1,y:0},{x:k-1,y:C},{width:1,height:L}),as.copy(E.data,x,{x:0,y:0},{x:k+R,y:C},{width:1,height:L})}this.image=x,this.iconPositions=l,this.patternPositions=h}addImages(n,o,l){for(const h in n){const f=n[h],m={x:0,y:0,w:f.data.width+2*No,h:f.data.height+2*No};l.push(m),o[h]=new F2(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(n,o,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>n.hasImage(h,l)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const h in n.getUpdatedImages(l))this.patchUpdatedImage(this.iconPositions[h],n.getImage(h,l),o),this.patchUpdatedImage(this.patternPositions[h],n.getImage(h,l),o)}patchUpdatedImage(n,o,l){if(!n||!o||n.version===o.version)return;n.version=o.version;const[h,f]=n.tl,m=!!Object.keys(this.patternPositions).length;l.update(o.data,{useMipmap:m},{x:h,y:f})}}xt(F2,"ImagePosition"),xt(uR,"ImageAtlas");const Xm=1e20;function hR(r,n,o,l,h,f,m,_,x){for(let w=n;w<n+l;w++)dR(r,o*f+w,f,h,m,_,x);for(let w=o;w<o+h;w++)dR(r,w*f+n,1,l,m,_,x)}function dR(r,n,o,l,h,f,m){f[0]=0,m[0]=-Xm,m[1]=Xm,h[0]=r[n];for(let _=1,x=0,w=0;_<l;_++){h[_]=r[n+_*o];const E=_*_;do{const I=f[x];w=(h[_]-h[I]+E-I*I)/(_-I)/2}while(w<=m[x]&&--x>-1);x++,f[x]=_,m[x]=w,m[x+1]=Xm}for(let _=0,x=0;_<l;_++){for(;m[x+1]<_;)x++;const w=f[x],E=_-w;r[n+_*o]=h[w]+E*E}}const Js=2,B2={none:0,ideographs:1,all:2};class nf{constructor(n,o,l){this.requestManager=n,this.localGlyphMode=o,this.localFontFamily=l,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,o){this.urls[o]=n}getGlyphs(n,o,l){const h=[],f=this.urls[o]||B.GLYPHS_URL;for(const m in n)for(const _ of n[m])h.push({stack:m,id:_});vn(h,({stack:m,id:_},x)=>{let w=this.entries[m];w||(w=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=w.glyphs[_];if(E!==void 0)return void x(null,{stack:m,id:_,glyph:E});if(E=this._tinySDF(w,m,_),E)return w.glyphs[_]=E,void x(null,{stack:m,id:_,glyph:E});const I=Math.floor(_/256);if(256*I>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[I])return void x(null,{stack:m,id:_,glyph:E});let k=w.requests[I];k||(k=w.requests[I]=[],nf.loadGlyphRange(m,I,f,this.requestManager,(C,R)=>{if(R){w.ascender=R.ascender,w.descender=R.descender;for(const L in R.glyphs)this._doesCharSupportLocalGlyph(+L)||(w.glyphs[+L]=R.glyphs[+L]);w.ranges[I]=!0}for(const L of k)L(C,R);delete w.requests[I]})),k.push((C,R)=>{C?x(C):R&&x(null,{stack:m,id:_,glyph:R.glyphs[_]||null})})},(m,_)=>{if(m)l(m);else if(_){const x={};for(const{stack:w,id:E,glyph:I}of _)x[w]===void 0&&(x[w]={}),x[w].glyphs===void 0&&(x[w].glyphs={}),x[w].glyphs[E]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},x[w].ascender=this.entries[w].ascender,x[w].descender=this.entries[w].descender;l(null,x)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==B2.none&&(this.localGlyphMode===B2.all?!!this.localFontFamily:!!this.localFontFamily&&(b["CJK Unified Ideographs"](n)||b["Hangul Syllables"](n)||b.Hiragana(n)||b.Katakana(n)||b["CJK Symbols and Punctuation"](n)||b["CJK Unified Ideographs Extension A"](n)||b["CJK Unified Ideographs Extension B"](n)))}_tinySDF(n,o,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let f=n.tinySDF;if(!f){let L="400";/bold/i.test(o)?L="900":/medium/i.test(o)?L="500":/light/i.test(o)&&(L="200"),f=n.tinySDF=new nf.TinySDF({fontFamily:h,fontWeight:L,fontSize:24*Js,buffer:3*Js,radius:8*Js}),f.fontWeight=L}if(this.localGlyphs[f.fontWeight][l])return this.localGlyphs[f.fontWeight][l];const m=String.fromCodePoint(l),{data:_,width:x,height:w,glyphWidth:E,glyphHeight:I,glyphLeft:k,glyphTop:C,glyphAdvance:R}=f.draw(m);return this.localGlyphs[f.fontWeight][l]={id:l,bitmap:new Sl({width:x,height:w},_),metrics:{width:E/Js,height:I/Js,left:k/Js,top:C/Js-27,advance:R/Js,localGlyph:!0}}}}nf.loadGlyphRange=function(r,n,o,l,h){const f=256*n,m=f+255,_=l.transformRequest(l.normalizeGlyphsURL(o).replace("{fontstack}",r).replace("{range}",`${f}-${m}`),ai.Glyphs);li(_,(x,w)=>{if(x)h(x);else if(w){const E={},I=function(k){return new J0(k).readFields(xU,{})}(w);for(const k of I.glyphs)E[k.id]=k;h(null,{glyphs:E,ascender:I.ascender,descender:I.descender})}})},nf.TinySDF=class{constructor({fontSize:r=24,buffer:n=3,radius:o=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:m="normal"}={}){this.buffer=n,this.cutoff=l,this.radius=o;const _=this.size=r+4*n,x=this._createCanvas(_),w=this.ctx=x.getContext("2d",{willReadFrequently:!0});w.font=`${m} ${f} ${r}px ${h}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(r){const n=document.createElement("canvas");return n.width=n.height=r,n}draw(r){const{width:n,actualBoundingBoxAscent:o,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(r),m=Math.ceil(o),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-h))),x=Math.min(this.size-this.buffer,m+Math.ceil(l)),w=_+2*this.buffer,E=x+2*this.buffer,I=Math.max(w*E,0),k=new Uint8ClampedArray(I),C={data:k,width:w,height:E,glyphWidth:_,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:n};if(_===0||x===0)return C;const{ctx:R,buffer:L,gridInner:N,gridOuter:j}=this;R.clearRect(L,L,_,x),R.fillText(r,L,L+m);const Z=R.getImageData(L,L,_,x);j.fill(Xm,0,I),N.fill(0,0,I);for(let X=0;X<x;X++)for(let J=0;J<_;J++){const te=Z.data[4*(X*_+J)+3]/255;if(te===0)continue;const re=(X+L)*w+J+L;if(te===1)j[re]=0,N[re]=Xm;else{const pe=.5-te;j[re]=pe>0?pe*pe:0,N[re]=pe<0?pe*pe:0}}hR(j,0,0,w,E,w,this.f,this.v,this.z),hR(N,L,L,_,x,w,this.f,this.v,this.z);for(let X=0;X<I;X++){const J=Math.sqrt(j[X])-Math.sqrt(N[X]);k[X]=Math.round(255-255*(J/this.radius+this.cutoff))}return C}};const kc=No;function fR(r,n,o,l){const h=[],f=r.imagePrimary,m=f.pixelRatio,_=f.paddedRect.w-2*kc,x=f.paddedRect.h-2*kc,w=r.right-r.left,E=r.bottom-r.top,I=f.stretchX||[[0,_]],k=f.stretchY||[[0,x]],C=(Se,Fe)=>Se+Fe[1]-Fe[0],R=I.reduce(C,0),L=k.reduce(C,0),N=_-R,j=x-L;let Z=0,X=R,J=0,te=L,re=0,pe=N,ve=0,be=j;if(f.content&&l){const Se=f.content;Z=nv(I,0,Se[0]),J=nv(k,0,Se[1]),X=nv(I,Se[0],Se[2]),te=nv(k,Se[1],Se[3]),re=Se[0]-Z,ve=Se[1]-J,pe=Se[2]-Se[0]-X,be=Se[3]-Se[1]-te}const Pe=(Se,Fe,Qe,Le)=>{const He=rv(Se.stretch-Z,X,w,r.left),De=iv(Se.fixed-re,pe,Se.stretch,R),ut=rv(Fe.stretch-J,te,E,r.top),yt=iv(Fe.fixed-ve,be,Fe.stretch,L),Ke=rv(Qe.stretch-Z,X,w,r.left),Vt=iv(Qe.fixed-re,pe,Qe.stretch,R),wt=rv(Le.stretch-J,te,E,r.top),ct=iv(Le.fixed-ve,be,Le.stretch,L),Ut=new Oe(He,ut),Rt=new Oe(Ke,ut),Nt=new Oe(Ke,wt),it=new Oe(He,wt),Xt=new Oe(De/m,yt/m),gn=new Oe(Vt/m,ct/m),en=n*Math.PI/180;if(en){const Xn=Math.sin(en),Dn=Math.cos(en),Fn=[Dn,-Xn,Xn,Dn];Ut._matMult(Fn),Rt._matMult(Fn),it._matMult(Fn),Nt._matMult(Fn)}const un=Se.stretch+Se.fixed,In=Qe.stretch+Qe.fixed,Zn=Fe.stretch+Fe.fixed,on=Le.stretch+Le.fixed,cr=r.imageSecondary;return{tl:Ut,tr:Rt,bl:it,br:Nt,texPrimary:{x:f.paddedRect.x+kc+un,y:f.paddedRect.y+kc+Zn,w:In-un,h:on-Zn},texSecondary:cr?{x:cr.paddedRect.x+kc+un,y:cr.paddedRect.y+kc+Zn,w:In-un,h:on-Zn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xt,pixelOffsetBR:gn,minFontScaleX:pe/m/w,minFontScaleY:be/m/E,isSDF:o}};if(l&&(f.stretchX||f.stretchY)){const Se=pR(I,N,R),Fe=pR(k,j,L);for(let Qe=0;Qe<Se.length-1;Qe++){const Le=Se[Qe],He=Se[Qe+1];for(let De=0;De<Fe.length-1;De++)h.push(Pe(Le,Fe[De],He,Fe[De+1]))}}else h.push(Pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return h}function nv(r,n,o){let l=0;for(const h of r)l+=Math.max(n,Math.min(o,h[1]))-Math.max(n,Math.min(o,h[0]));return l}function pR(r,n,o){const l=[{fixed:-kc,stretch:0}];for(const[h,f]of r){const m=l[l.length-1];l.push({fixed:h-m.stretch,stretch:m.stretch}),l.push({fixed:h-m.stretch,stretch:m.stretch+(f-h)})}return l.push({fixed:n+kc,stretch:o}),l}function rv(r,n,o,l){return r/n*o+l}function iv(r,n,o,l){return r-n*o/l}function PU(r,n,o,l){const h=n+r.positionedLines[l].lineOffset;return l===0?o+h/2:o+(h+(n+r.positionedLines[l-1].lineOffset))/2}function kU(r,n=1,o=!1){let l=1/0,h=1/0,f=-1/0,m=-1/0;const _=r[0];for(let C=0;C<_.length;C++){const R=_[C];(!C||R.x<l)&&(l=R.x),(!C||R.y<h)&&(h=R.y),(!C||R.x>f)&&(f=R.x),(!C||R.y>m)&&(m=R.y)}const x=Math.min(f-l,m-h);let w=x/2;const E=new gd([],CU);if(x===0)return new Oe(l,h);for(let C=l;C<f;C+=x)for(let R=h;R<m;R+=x)E.push(new rf(C+w,R+w,w,r));let I=function(C){let R=0,L=0,N=0;const j=C[0];for(let Z=0,X=j.length,J=X-1;Z<X;J=Z++){const te=j[Z],re=j[J],pe=te.x*re.y-re.x*te.y;L+=(te.x+re.x)*pe,N+=(te.y+re.y)*pe,R+=3*pe}return new rf(L/R,N/R,0,C)}(r),k=E.length;for(;E.length;){const C=E.pop();(C.d>I.d||!I.d)&&(I=C,o&&console.log("found best %d after %d probes",Math.round(1e4*C.d)/1e4,k)),C.max-I.d<=n||(w=C.h/2,E.push(new rf(C.p.x-w,C.p.y-w,w,r)),E.push(new rf(C.p.x+w,C.p.y-w,w,r)),E.push(new rf(C.p.x-w,C.p.y+w,w,r)),E.push(new rf(C.p.x+w,C.p.y+w,w,r)),k+=4)}return o&&(console.log(`num probes: ${k}`),console.log(`best distance: ${I.d}`)),I.p}function CU(r,n){return n.max-r.max}class rf{constructor(n,o,l,h){this.p=new Oe(n,o),this.h=l,this.d=function(f,m){let _=!1,x=1/0;for(let w=0;w<m.length;w++){const E=m[w];for(let I=0,k=E.length,C=k-1;I<k;C=I++){const R=E[I],L=E[C];R.y>f.y!=L.y>f.y&&f.x<(L.x-R.x)*(f.y-R.y)/(L.y-R.y)+R.x&&(_=!_),x=Math.min(x,mM(f,R,L))}}return(_?1:-1)*Math.sqrt(x)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const of=7,j2=Number.POSITIVE_INFINITY,MU=Math.sqrt(2);function mR(r,[n,o]){let l=0,h=0;if(o===j2){n<0&&(n=0);const f=n/MU;switch(r){case"top-right":case"top-left":h=f-of;break;case"bottom-right":case"bottom-left":h=-f+of;break;case"bottom":h=-n+of;break;case"top":h=n-of}switch(r){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=n;break;case"right":l=-n}}else{switch(n=Math.abs(n),o=Math.abs(o),r){case"top-right":case"top-left":case"top":h=o-of;break;case"bottom-right":case"bottom-left":case"bottom":h=-o+of}switch(r){case"top-right":case"bottom-right":case"right":l=-n;break;case"top-left":case"bottom-left":case"left":l=n}}return[l,h]}function RU(r,n,o,l,h,f,m,_,x,w,E){r.createArrays(),r.tilePixelRatio=at/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const I=r.layers[0].layout,k=r.layers[0]._unevaluatedLayout._values,C={};if(r.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:Z}=r.textSizeData;C.compositeTextSizes=[k["text-size"].possiblyEvaluate(new de(j),_),k["text-size"].possiblyEvaluate(new de(Z),_)]}if(r.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:Z}=r.iconSizeData;C.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new de(j),_),k["icon-size"].possiblyEvaluate(new de(Z),_)]}C.layoutTextSize=k["text-size"].possiblyEvaluate(new de(x+1),_),C.layoutIconSize=k["icon-size"].possiblyEvaluate(new de(x+1),_),C.textMaxSize=k["text-size"].possiblyEvaluate(new de(18),_);const R=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",L=I.get("text-size");let N=!1;for(const j of r.features)if(j.icon&&j.icon.nameSecondary){N=!0;break}for(const j of r.features){const Z=I.get("text-font").evaluate(j,{},_).join(","),X=L.evaluate(j,{},_),J=C.layoutTextSize.evaluate(j,{},_),te=(C.layoutIconSize.evaluate(j,{},_),{horizontal:{},vertical:void 0}),re=j.text;let pe,ve=[0,0];if(re){const Se=re.toString(),Fe=I.get("text-letter-spacing").evaluate(j,{},_)*Ti,Qe=I.get("text-line-height").evaluate(j,{},_)*Ti,Le=S(Se)?Fe:0,He=I.get("text-anchor").evaluate(j,{},_),De=I.get("text-variable-anchor");if(!De){const wt=I.get("text-radial-offset").evaluate(j,{},_);ve=wt?mR(He,[wt*Ti,j2]):I.get("text-offset").evaluate(j,{},_).map(ct=>ct*Ti)}let ut=R?"center":I.get("text-justify").evaluate(j,{},_);const yt=I.get("symbol-placement")==="point",Ke=yt?I.get("text-max-width").evaluate(j,{},_)*Ti:1/0,Vt=wt=>{r.allowVerticalPlacement&&T(Se)&&(te.vertical=L2(re,n,o,h,Z,Ke,Qe,He,wt,Le,ve,ls.vertical,!0,J,X))};if(!R&&De){const wt=ut==="auto"?De.map(Ut=>V2(Ut)):[ut];let ct=!1;for(let Ut=0;Ut<wt.length;Ut++){const Rt=wt[Ut];if(!te.horizontal[Rt])if(ct)te.horizontal[Rt]=te.horizontal[0];else{const Nt=L2(re,n,o,h,Z,Ke,Qe,"center",Rt,Le,ve,ls.horizontal,!1,J,X);Nt&&(te.horizontal[Rt]=Nt,ct=Nt.positionedLines.length===1)}}Vt("left")}else{if(ut==="auto"&&(ut=V2(He)),yt||I.get("text-writing-mode").indexOf("horizontal")>=0||!T(Se)){const wt=L2(re,n,o,h,Z,Ke,Qe,He,ut,Le,ve,ls.horizontal,!1,J,X);wt&&(te.horizontal[ut]=wt)}Vt(yt?"left":ut)}}let be=!1;if(j.icon&&j.icon.namePrimary){const Se=l[j.icon.namePrimary];Se&&(pe=SU(h[j.icon.namePrimary],j.icon.nameSecondary?h[j.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(j,{},_),I.get("icon-anchor").evaluate(j,{},_)),be=Se.sdf,r.sdfIcons===void 0?r.sdfIcons=Se.sdf:r.sdfIcons!==Se.sdf&&pr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Se.pixelRatio!==r.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}const Pe=_R(te.horizontal)||te.vertical;r.iconsInText||(r.iconsInText=!!Pe&&Pe.iconsInText),(Pe||pe)&&OU(r,j,te,pe,l,C,J,0,ve,be,m,_,w,E,N)}f&&r.generateCollisionDebugBuffers(x,r.collisionBoxArray)}function V2(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function OU(r,n,o,l,h,f,m,_,x,w,E,I,k,C,R){let L=f.textMaxSize.evaluate(n,{},I);L===void 0&&(L=m);const N=r.layers[0].layout,j=N.get("icon-offset").evaluate(n,{},I),Z=_R(o.horizontal)||o.vertical,X=k.name==="globe",J=Ti,te=m/J,re=r.tilePixelRatio*L/J,pe=(He=r.overscaling,r.zoom>18&&He>2&&(He>>=1),Math.max(at/(512*He),1)*N.get("symbol-spacing")),ve=N.get("text-padding")*r.tilePixelRatio,be=N.get("icon-padding")*r.tilePixelRatio,Pe=pt(N.get("text-max-angle")),Se=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Fe=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Qe=N.get("symbol-placement"),Le=pe/2;var He;const De=N.get("icon-text-fit").evaluate(n,{},I),ut=N.get("icon-text-fit-padding").evaluate(n,{},I),yt=De!=="none";let Ke;r.hasAnyIconTextFit===!1&&yt&&(r.hasAnyIconTextFit=!0),l&&yt&&(r.allowVerticalPlacement&&o.vertical&&(Ke=rR(l,o.vertical,De,ut,j,te)),Z&&(l=rR(l,Z,De,ut,j,te)));const Vt=(wt,ct,Ut)=>{if(ct.x<0||ct.x>=at||ct.y<0||ct.y>=at)return;let Rt=null;if(X){const{x:Nt,y:it,z:Xt}=k.projectTilePoint(ct.x,ct.y,Ut);Rt={anchor:new Al(Nt,it,Xt,0,void 0),up:k.upVector(Ut,ct.x,ct.y)}}(function(Nt,it,Xt,gn,en,un,In,Zn,on,cr,Xn,Dn,Fn,An,Tr,ur,kr,ri,no,Lr,Ar,Vi,Ui,ro,hr,ta,cf){const kl=Nt.addToLineVertexArray(it,gn);let Cl,pg,mg,Pv,NO,FO,BO,jO=0,VO=0,UO=0,$O=0,mT=-1,gT=-1;const Na={};let GO=Nw("");const gh=Xt?Xt.anchor:it,_T=on.layout.get("icon-text-fit").evaluate(Ar,{},hr)!=="none";let yT=0,vT=0;if(on._unevaluatedLayout.getValue("text-radial-offset")===void 0?[yT,vT]=on.layout.get("text-offset").evaluate(Ar,{},hr).map(Fo=>Fo*Ti):(yT=on.layout.get("text-radial-offset").evaluate(Ar,{},hr)*Ti,vT=j2),Nt.allowVerticalPlacement&&en.vertical){const Fo=en.vertical;if(Tr)FO=U2(Fo),Zn&&(BO=U2(Zn));else{const Bo=on.layout.get("text-rotate").evaluate(Ar,{},hr)+90;mg=ov(cr,gh,it,Xn,Dn,Fn,Fo,An,Bo,ur),Zn&&(Pv=ov(cr,gh,it,Xn,Dn,Fn,Zn,ri,Bo))}}if(un){const Fo=on.layout.get("icon-rotate").evaluate(Ar,{},hr),Bo=fR(un,Fo,Ui,_T),uf=Zn?fR(Zn,Fo,Ui,_T):void 0;pg=ov(cr,gh,it,Xn,Dn,Fn,un,ri,Fo),jO=4*Bo.length;const WO=Nt.iconSizeData;let _h=null;WO.kind==="source"?(_h=[Ks*on.layout.get("icon-size").evaluate(Ar,{},hr)],_h[0]>Cc&&pr(`${Nt.layerIds[0]}: Value for "icon-size" is >= ${Ym}. Reduce your "icon-size".`)):WO.kind==="composite"&&(_h=[Ks*Vi.compositeIconSizes[0].evaluate(Ar,{},hr),Ks*Vi.compositeIconSizes[1].evaluate(Ar,{},hr)],(_h[0]>Cc||_h[1]>Cc)&&pr(`${Nt.layerIds[0]}: Value for "icon-size" is >= ${Ym}. Reduce your "icon-size".`)),Nt.addSymbols(Nt.icon,Bo,_h,Lr,no,Ar,!1,Xt,it,kl.lineStartIndex,kl.lineLength,-1,ro,hr,ta,cf),mT=Nt.icon.placedSymbolArray.length-1,uf&&(VO=4*uf.length,Nt.addSymbols(Nt.icon,uf,_h,Lr,no,Ar,ls.vertical,Xt,it,kl.lineStartIndex,kl.lineLength,-1,ro,hr,ta,cf),gT=Nt.icon.placedSymbolArray.length-1)}for(const Fo in en.horizontal){const Bo=en.horizontal[Fo];Cl||(GO=Nw(Bo.text),Tr?NO=U2(Bo):Cl=ov(cr,gh,it,Xn,Dn,Fn,Bo,An,on.layout.get("text-rotate").evaluate(Ar,{},hr),ur));const uf=Bo.positionedLines.length===1;if(UO+=gR(Nt,Xt,it,Bo,In,on,Tr,Ar,ur,kl,en.vertical?ls.horizontal:ls.horizontalOnly,uf?Object.keys(en.horizontal):[Fo],Na,mT,Vi,ro,hr,ta),uf)break}en.vertical&&($O+=gR(Nt,Xt,it,en.vertical,In,on,Tr,Ar,ur,kl,ls.vertical,["vertical"],Na,gT,Vi,ro,hr,ta));let Fc=-1;const xT=(Fo,Bo)=>Fo?Math.max(Fo,Bo):Bo;Fc=xT(NO,Fc),Fc=xT(FO,Fc),Fc=xT(BO,Fc);const Z8=Fc>-1?1:0;Nt.glyphOffsetArray.length>=tg.MAX_GLYPHS&&pr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ar.sortKey!==void 0&&Nt.addToSortKeyRanges(Nt.symbolInstances.length,Ar.sortKey),Nt.symbolInstances.emplaceBack(it.x,it.y,gh.x,gh.y,gh.z,Na.right>=0?Na.right:-1,Na.center>=0?Na.center:-1,Na.left>=0?Na.left:-1,Na.vertical>=0?Na.vertical:-1,mT,gT,GO,Cl!==void 0?Cl:Nt.collisionBoxArray.length,Cl!==void 0?Cl+1:Nt.collisionBoxArray.length,mg!==void 0?mg:Nt.collisionBoxArray.length,mg!==void 0?mg+1:Nt.collisionBoxArray.length,pg!==void 0?pg:Nt.collisionBoxArray.length,pg!==void 0?pg+1:Nt.collisionBoxArray.length,Pv||Nt.collisionBoxArray.length,Pv?Pv+1:Nt.collisionBoxArray.length,Xn,UO,$O,jO,VO,Z8,0,yT,vT,Fc,0,_T?1:0)})(r,ct,Rt,wt,o,l,h,Ke,r.layers[0],r.collisionBoxArray,n.index,n.sourceLayerIndex,r.index,ve,Se,x,0,be,Fe,j,n,f,w,E,I,C,R)};if(Qe==="line")for(const wt of cR(n.geometry,0,0,at,at)){const ct=AU(wt,pe,Pe,o.vertical||Z,l,J,re,r.overscaling,at);for(const Ut of ct)Z&&DU(r,Z.text,Le,Ut)||Vt(wt,Ut,I)}else if(Qe==="line-center"){for(const wt of n.geometry)if(wt.length>1){const ct=IU(wt,Pe,o.vertical||Z,l,J,re);ct&&Vt(wt,ct,I)}}else if(n.type==="Polygon")for(const wt of A2(n.geometry,0)){const ct=kU(wt,16);Vt(wt[0],new Al(ct.x,ct.y,0,0,void 0),I)}else if(n.type==="LineString")for(const wt of n.geometry)Vt(wt,new Al(wt[0].x,wt[0].y,0,0,void 0),I);else if(n.type==="Point")for(const wt of n.geometry)for(const ct of wt)Vt([ct],new Al(ct.x,ct.y,0,0,void 0),I)}const Ym=255,Cc=Ym*Ks;function gR(r,n,o,l,h,f,m,_,x,w,E,I,k,C,R,L,N,j){const Z=function(te,re,pe,ve,be,Pe,Se,Fe){const Qe=[];if(re.positionedLines.length===0)return Qe;const Le=ve.layout.get("text-rotate").evaluate(Pe,{})*Math.PI/180,He=function(Vt){const wt=Vt[0],ct=Vt[1],Ut=wt*ct;return Ut>0?[wt,-ct]:Ut<0?[-wt,ct]:wt===0?[ct,wt]:[ct,-wt]}(pe);let De=Math.abs(re.top-re.bottom);for(const Vt of re.positionedLines)De-=Vt.lineOffset;const ut=re.positionedLines.length,yt=De/ut;let Ke=re.top-pe[1];for(let Vt=0;Vt<ut;++Vt){const wt=re.positionedLines[Vt];Ke=PU(re,yt,Ke,Vt);for(const ct of wt.positionedGlyphs){if(!ct.rect)continue;const Ut=ct.rect||{};let Rt=YM+1,Nt=!0,it=1,Xt=0;if(ct.imageName){const Lr=Se[ct.imageName];if(!Lr)continue;if(Lr.sdf){pr("SDF images are not supported in formatted text and will be ignored.");continue}Nt=!1,it=Lr.pixelRatio,Rt=No/it}const gn=(be||Fe)&&ct.vertical,en=ct.metrics.advance*ct.scale/2,un=ct.metrics,In=ct.rect;if(In===null)continue;Fe&&re.verticalizable&&(Xt=ct.imageName?en-ct.metrics.width*ct.scale/2:0);const Zn=be?[ct.x+en,ct.y]:[0,0];let on=[0,0],cr=[0,0],Xn=!1;be||(gn?(cr=[ct.x+en+He[0],ct.y+He[1]-Xt],Xn=!0):on=[ct.x+en+pe[0],ct.y+pe[1]-Xt]);const Dn=In.w*ct.scale/(it*(ct.localGlyph?Js:1)),Fn=In.h*ct.scale/(it*(ct.localGlyph?Js:1));let An,Tr,ur,kr;if(gn){const Lr=ct.y-Ke,Ar=new Oe(-en,en-Lr),Vi=-Math.PI/2,Ui=new Oe(...cr);An=new Oe(-en+on[0],on[1]),An._rotateAround(Vi,Ar)._add(Ui),An.x+=-Lr+en,An.y-=(un.left-Rt)*ct.scale;const ro=ct.imageName?un.advance*ct.scale:Ti*ct.scale,hr=String.fromCodePoint(ct.glyph);yU(hr)?An.x+=(1-Rt)*ct.scale:vU(hr)?An.x+=ro-un.height*ct.scale+(-Rt-1)*ct.scale:An.x+=ct.imageName||un.width+2*Rt===In.w&&un.height+2*Rt===In.h?(ro-Fn)/2:(ro-(un.height+2*Rt)*ct.scale)/2,Tr=new Oe(An.x,An.y-Dn),ur=new Oe(An.x+Fn,An.y),kr=new Oe(An.x+Fn,An.y-Dn)}else{const Lr=(un.left-Rt)*ct.scale-en+on[0],Ar=(-un.top-Rt)*ct.scale+on[1],Vi=Lr+Dn,Ui=Ar+Fn;An=new Oe(Lr,Ar),Tr=new Oe(Vi,Ar),ur=new Oe(Lr,Ui),kr=new Oe(Vi,Ui)}if(Le){let Lr;Lr=be?new Oe(0,0):Xn?new Oe(He[0],He[1]):new Oe(pe[0],pe[1]),An._rotateAround(Le,Lr),Tr._rotateAround(Le,Lr),ur._rotateAround(Le,Lr),kr._rotateAround(Le,Lr)}const ri=new Oe(0,0),no=new Oe(0,0);Qe.push({tl:An,tr:Tr,bl:ur,br:kr,texPrimary:Ut,texSecondary:void 0,writingMode:re.writingMode,glyphOffset:Zn,sectionIndex:ct.sectionIndex,isSDF:Nt,pixelOffsetTL:ri,pixelOffsetBR:no,minFontScaleX:0,minFontScaleY:0})}}return Qe}(0,l,x,f,m,_,h,r.allowVerticalPlacement),X=r.textSizeData;let J=null;X.kind==="source"?(J=[Ks*f.layout.get("text-size").evaluate(_,{},N)],J[0]>Cc&&pr(`${r.layerIds[0]}: Value for "text-size" is >= ${Ym}. Reduce your "text-size".`)):X.kind==="composite"&&(J=[Ks*R.compositeTextSizes[0].evaluate(_,{},N),Ks*R.compositeTextSizes[1].evaluate(_,{},N)],(J[0]>Cc||J[1]>Cc)&&pr(`${r.layerIds[0]}: Value for "text-size" is >= ${Ym}. Reduce your "text-size".`)),r.addSymbols(r.text,Z,J,x,m,_,E,n,o,w.lineStartIndex,w.lineLength,C,L,N,j,!1);for(const te of I)k[te]=r.text.placedSymbolArray.length-1;return 4*Z.length}function _R(r){for(const n in r)return r[n];return null}function ov(r,n,o,l,h,f,m,_,x,w){let E=m.top,I=m.bottom,k=m.left,C=m.right;const R=m.collisionPadding;if(R&&(k-=R[0],E-=R[1],C+=R[2],I+=R[3]),x){const L=new Oe(k,E),N=new Oe(C,E),j=new Oe(k,I),Z=new Oe(C,I),X=pt(x);let J=new Oe(0,0);w&&(J=new Oe(w[0],w[1])),L._rotateAround(X,J),N._rotateAround(X,J),j._rotateAround(X,J),Z._rotateAround(X,J),k=Math.min(L.x,N.x,j.x,Z.x),C=Math.max(L.x,N.x,j.x,Z.x),E=Math.min(L.y,N.y,j.y,Z.y),I=Math.max(L.y,N.y,j.y,Z.y)}return r.emplaceBack(n.x,n.y,n.z,o.x,o.y,k,E,C,I,_,l,h,f),r.length-1}function U2(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const n=r.bottom-r.top;return n>0?Math.max(10,n):null}function DU(r,n,o,l){const h=r.compareText;if(n in h){const f=h[n];for(let m=f.length-1;m>=0;m--)if(l.dist(f[m])<o)return!0}else h[n]=[];return h[n].push(l),!1}function yR(r,n){const o=r.fovAboveCenter,l=r.elevation?r.elevation.getMinElevationBelowMSL()*n:0,h=(r._camera.position[2]*r.worldSize-l)/Math.cos(r._pitch),f=Math.sin(o)*h/Math.sin(Math.max(Math.PI/2-r._pitch-o,.01)),m=Math.sin(r._pitch)*f+h;return Math.min(1.01*m,h*(1/r._horizonShift))}function Mc(r,n){if(!n.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:n};const o=Math.pow(2,-r.z),l=r.x*o,h=(r.x+1)*o,f=r.y*o,m=(r.y+1)*o,_=zo(l),x=zo(h),w=wi(f),E=wi(m),I=n.project(_,w),k=n.project(x,w),C=n.project(x,E),R=n.project(_,E);let L=Math.min(I.x,k.x,C.x,R.x),N=Math.min(I.y,k.y,C.y,R.y),j=Math.max(I.x,k.x,C.x,R.x),Z=Math.max(I.y,k.y,C.y,R.y);const X=o/16;function J(re,pe,ve,be,Pe,Se){const Fe=(ve+Pe)/2,Qe=(be+Se)/2,Le=n.project(zo(Fe),wi(Qe)),He=Math.max(0,L-Le.x,N-Le.y,Le.x-j,Le.y-Z);L=Math.min(L,Le.x),j=Math.max(j,Le.x),N=Math.min(N,Le.y),Z=Math.max(Z,Le.y),He>X&&(J(re,Le,ve,be,Fe,Qe),J(Le,pe,Fe,Qe,Pe,Se))}J(I,k,l,f,h,f),J(k,C,h,f,h,m),J(C,R,h,m,l,m),J(R,I,l,m,l,f),L-=X,N-=X,j+=X,Z+=X;const te=1/Math.max(j-L,Z-N);return{scale:te,x:L*te,y:N*te,x2:j*te,y2:Z*te,projection:n}}function vR(r,{x:n,y:o},l=0){return new Oe(((n-l)*r.scale-r.x)*at,(o*r.scale-r.y)*at)}const LU=a.m.identity(new Float32Array(16));class Rc{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,o){return{x:0,y:0,z:0}}unproject(n,o){return new On(0,0)}projectTilePoint(n,o,l){return{x:n,y:o,z:0}}locationPoint(n,o,l=!0){return n._coordinatePoint(n.locationCoordinate(o),l)}pixelsPerMeter(n,o){return to(1,n)*o}pixelSpaceConversion(n,o,l){return 1}farthestPixelDistance(n){return yR(n,n.pixelsPerMeter)}pointCoordinate(n,o,l,h){const f=n.horizonLineFromTop(!1),m=new Oe(o,Math.max(f,l));return n.rayIntersectionCoordinate(n.pointRayIntersection(m,h))}pointCoordinate3D(n,o,l){const h=new Oe(o,l);if(n.elevation)return n.elevation.pointCoordinate(h);{const f=this.pointCoordinate(n,h.x,h.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(n,o){if(n.elevation)return!this.pointCoordinate3D(n,o.x,o.y);const l=n.horizonLineFromTop();return o.y<l}createInversionMatrix(n,o){return LU}createTileMatrix(n,o,l){let h,f,m;const _=l.canonical,x=a.m.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=Mc(_,this);h=1,f=w.x+l.wrap*w.scale,m=w.y,a.m.scale(x,x,[h/w.scale,h/w.scale,n.pixelsPerMeter/o])}else h=o/n.zoomScale(_.z),f=(_.x+Math.pow(2,_.z)*l.wrap)*h,m=_.y*h;return a.m.translate(x,x,[f,m,0]),a.m.scale(x,x,[h/at,h/at,1]),x}upVector(n,o,l){return[0,0,1]}upVectorScale(n,o,l){return{metersToTile:1}}}class zU extends Rc{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[o,l]=this.parallels=n.parallels||[29.5,45.5],h=Math.sin(pt(o));this.n=(h+Math.sin(pt(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(n,o){const{n:l,c:h,r0:f}=this,m=pt(n-this.center[0]),_=pt(o),x=Math.sqrt(h-2*l*Math.sin(_))/l;return{x:x*Math.sin(m*l),y:x*Math.cos(m*l)-f,z:0}}unproject(n,o){const{n:l,c:h,r0:f}=this,m=f+o;let _=Math.atan2(n,Math.abs(m))*Math.sign(m);m*l<0&&(_-=Math.PI*Math.sign(n)*Math.sign(m));const x=pt(this.center[0])*l;_=Lt(_,-Math.PI-x,Math.PI-x);const w=Ze(kn(_/l)+this.center[0],-180,180),E=Math.asin(Ze((h-(n*n+m*m)*l*l)/(2*l),-1,1)),I=Ze(kn(E),-Pr,Pr);return new On(w,I)}}const Km=1.340264,Jm=-.081106,Qm=893e-6,eg=.003796,sv=Math.sqrt(3)/2;class NU extends Rc{project(n,o){o=o/180*Math.PI,n=n/180*Math.PI;const l=Math.asin(sv*Math.sin(o)),h=l*l,f=h*h*h;return{x:.5*(n*Math.cos(l)/(sv*(Km+3*Jm*h+f*(7*Qm+9*eg*h)))/Math.PI+.5),y:1-.5*(l*(Km+Jm*h+f*(Qm+eg*h))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let l=o=(2*(1-o)-1)*Math.PI,h=l*l,f=h*h*h;for(let E,I,k,C=0;C<12&&(I=l*(Km+Jm*h+f*(Qm+eg*h))-o,k=Km+3*Jm*h+f*(7*Qm+9*eg*h),E=I/k,l=Ze(l-E,-Math.PI/3,Math.PI/3),h=l*l,f=h*h*h,!(Math.abs(E)<1e-12));++C);const m=sv*n*(Km+3*Jm*h+f*(7*Qm+9*eg*h))/Math.cos(l),_=Math.asin(Math.sin(l)/sv),x=Ze(180*m/Math.PI,-180,180),w=Ze(180*_/Math.PI,-Pr,Pr);return new On(x,w)}}class FU extends Rc{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){return{x:.5+n/360,y:.5-o/360,z:0}}unproject(n,o){const l=360*(n-.5),h=Ze(360*(.5-o),-Pr,Pr);return new On(l,h)}}const sf=Math.PI/2;function av(r){return Math.tan((sf+r)/2)}class BU extends Rc{constructor(n){super(n),this.center=n.center||[0,30];const[o,l]=this.parallels=n.parallels||[30,30];let h=pt(o),f=pt(l);this.southernCenter=h+f<0,this.southernCenter&&(h=-h,f=-f);const m=Math.cos(h),_=av(h);this.n=h===f?Math.sin(h):Math.log(m/Math.cos(f))/Math.log(av(f)/_),this.f=m*Math.pow(av(h),this.n)/this.n}project(n,o){o=pt(o),this.southernCenter&&(o=-o),n=pt(n-this.center[0]);const l=1e-6,{n:h,f}=this;f>0?o<-sf+l&&(o=-sf+l):o>sf-l&&(o=sf-l);const m=f/Math.pow(av(o),h);let _=m*Math.sin(h*n),x=f-m*Math.cos(h*n);return _=.5*(_/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:_,y:this.southernCenter?x:1-x,z:0}}unproject(n,o){n=(2*n-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:l,f:h}=this,f=h-o,m=Math.sign(f),_=Math.sign(l)*Math.sqrt(n*n+f*f);let x=Math.atan2(n,Math.abs(f))*m;f*l<0&&(x-=Math.PI*Math.sign(n)*m);const w=Ze(kn(x/l)+this.center[0],-180,180),E=Ze(kn(2*Math.atan(Math.pow(h/_,1/l))-sf),-Pr,Pr);return new On(w,this.southernCenter?-E:E)}}class xR extends Rc{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,o){return{x:Ra(n),y:Oa(o),z:0}}unproject(n,o){const l=zo(n),h=wi(o);return new On(l,h)}}const bR=pt(Pr);class jU extends Rc{project(n,o){const l=(o=pt(o))*o,h=l*l;return{x:.5*((n=pt(n))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let l=o=(2*(1-o)-1)*Math.PI,h=25,f=0,m=l*l;do{m=l*l;const w=m*m;f=(l*(1.007226+m*(.015085+w*(.028874*m-.044475-.005916*w)))-o)/(1.007226+m*(.045255+w*(.259866*m-.311325-.005916*11*w))),l=Ze(l-f,-bR,bR)}while(Math.abs(f)>1e-6&&--h>0);m=l*l;const _=Ze(kn(n/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),x=kn(l);return new On(_,x)}}const wR=pt(Pr);class VU extends Rc{project(n,o){o=pt(o),n=pt(n);const l=Math.cos(o),h=2/Math.PI,f=Math.acos(l*Math.cos(n/2)),m=Math.sin(f)/f,_=.5*(n*h+2*l*Math.sin(n/2)/m)||0,x=.5*(o+Math.sin(o)/m)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(n,o){let l=n=(2*n-.5)*Math.PI,h=o=(2*(1-o)-1)*Math.PI,f=25;const m=1e-6;let _=0,x=0;do{const w=Math.cos(h),E=Math.sin(h),I=2*E*w,k=E*E,C=w*w,R=Math.cos(l/2),L=Math.sin(l/2),N=2*R*L,j=L*L,Z=1-C*R*R,X=Z?1/Z:0,J=Z?Math.acos(w*R)*Math.sqrt(1/Z):0,te=.5*(2*J*w*L+2*l/Math.PI)-n,re=.5*(J*E+h)-o,pe=.5*X*(C*j+J*w*R*k)+1/Math.PI,ve=X*(N*I/4-J*E*L),be=.125*X*(I*L-J*E*C*N),Pe=.5*X*(k*R+J*j*w)+.5,Se=ve*be-Pe*pe;_=(re*ve-te*Pe)/Se,x=(te*be-re*pe)/Se,l=Ze(l-_,-Math.PI,Math.PI),h=Ze(h-x,-wR,wR)}while((Math.abs(_)>m||Math.abs(x)>m)&&--f>0);return new On(kn(l),kn(h))}}class TR extends Rc{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(pt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){const{scale:l,cosPhi:h}=this;return{x:pt(n)*h*l+.5,y:-Math.sin(pt(o))/h*l+.5,z:0}}unproject(n,o){const{scale:l,cosPhi:h}=this,f=-(o-.5)/l,m=Ze(kn((n-.5)/l)/h,-180,180),_=Math.asin(Ze(f*h,-1,1)),x=Ze(kn(_),-Pr,Pr);return new On(m,x)}}class UU extends xR{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,o,l){const h=Vm(n,o,l),f=Um(Ma(l));return a.v.transformMat4(h,h,f),{x:h[0],y:h[1],z:h[2]}}locationPoint(n,o){const l=ah(o.lat,o.lng),h=a.v.normalize([],l),f=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(o),n._centerAltitude):n._centerAltitude,m=to(1,0)*at*f;a.v.scaleAndAdd(l,l,h,m);const _=a.m.identity(new Float64Array(16));return a.m.multiply(_,n.pixelMatrix,n.globeMatrix),a.v.transformMat4(l,l,_),new Oe(l[0],l[1])}pixelsPerMeter(n,o){return to(1,0)*o}pixelSpaceConversion(n,o,l){const h=to(1,n)*o,f=ln(to(1,45)*o,h,l);return this.pixelsPerMeter(n,o)/f}createTileMatrix(n,o,l){const h=u2(Ma(l.canonical));return a.m.multiply(new Float64Array(16),n.globeMatrix,h)}createInversionMatrix(n,o){const{center:l}=n,h=Um(Ma(o));return a.m.rotateY(h,h,pt(l.lng)),a.m.rotateX(h,h,pt(l.lat)),a.m.scale(h,h,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(n,o,l,h){return QC(n,o,l,!0)||new Ai(0,0)}pointCoordinate3D(n,o,l){const h=this.pointCoordinate(n,o,l,0);return[h.x,h.y,h.z]}isPointAboveHorizon(n,o){return!QC(n,o.x,o.y,!1)}farthestPixelDistance(n){const o=function(h,f){const m=h.cameraToCenterDistance,_=h._centerAltitude*f,x=h._camera,w=h._camera.forward(),E=a.v.add([],a.v.scale([],w,-m),[0,0,_]),I=h.worldSize/(2*Math.PI),k=[0,0,-I],C=h.width/h.height,R=Math.tan(h.fovAboveCenter),L=a.v.scale([],x.up(),R),N=a.v.scale([],x.right(),R*C),j=a.v.normalize([],a.v.add([],a.v.add([],w,L),N)),Z=[];let X;if(new r2(E,j).closestPointOnSphere(k,I,Z)){const J=a.v.add([],Z,k),te=a.v.sub([],J,E);X=Math.cos(h.fovAboveCenter)*a.v.length(te)}else{const J=a.v.sub([],E,k),te=a.v.sub([],k,E);a.v.normalize(te,te);const re=a.v.length(J)-I;X=Math.sqrt(re*(re+2*I));const pe=Math.acos(X/(I+re))-Math.acos(a.v.dot(w,te));X*=Math.cos(pe)}return 1.01*X}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),l=El(n.zoom);if(l>0){const h=yR(n,to(1,n.center.lat)*n.worldSize),f=n.worldSize/(2*Math.PI),m=Math.max(n.width,n.height)/n.worldSize*Math.PI;return ln(o,h+f*(1-Math.cos(m)),Math.pow(l,10))}return o}upVector(n,o,l){return Vm(o,l,n,1)}upVectorScale(n){return{metersToTile:O0(L0(Ma(n)))}}}function ER(r){const n=r.parallels,o=!!n&&Math.abs(n[0]+n[1])<.01;switch(r.name){case"mercator":return new xR(r);case"equirectangular":return new FU(r);case"naturalEarth":return new jU(r);case"equalEarth":return new NU(r);case"winkelTripel":return new VU(r);case"albers":return o?new TR(r):new zU(r);case"lambertConformalConic":return o?new TR(r):new BU(r);case"globe":return new UU(r)}throw new Error(`Invalid projection name: ${r.name}`)}const $U=new $e({"symbol-placement":new ne(Ie.layout_symbol["symbol-placement"]),"symbol-spacing":new ne(Ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ne(Ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Te(Ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ne(Ie.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ne(Ie.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ne(Ie.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ne(Ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new ne(Ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ne(Ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new Te(Ie.layout_symbol["icon-size"]),"icon-text-fit":new Te(Ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Te(Ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new Te(Ie.layout_symbol["icon-image"]),"icon-rotate":new Te(Ie.layout_symbol["icon-rotate"]),"icon-padding":new ne(Ie.layout_symbol["icon-padding"]),"icon-keep-upright":new ne(Ie.layout_symbol["icon-keep-upright"]),"icon-offset":new Te(Ie.layout_symbol["icon-offset"]),"icon-anchor":new Te(Ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ne(Ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ne(Ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ne(Ie.layout_symbol["text-rotation-alignment"]),"text-field":new Te(Ie.layout_symbol["text-field"]),"text-font":new Te(Ie.layout_symbol["text-font"]),"text-size":new Te(Ie.layout_symbol["text-size"]),"text-max-width":new Te(Ie.layout_symbol["text-max-width"]),"text-line-height":new Te(Ie.layout_symbol["text-line-height"]),"text-letter-spacing":new Te(Ie.layout_symbol["text-letter-spacing"]),"text-justify":new Te(Ie.layout_symbol["text-justify"]),"text-radial-offset":new Te(Ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ne(Ie.layout_symbol["text-variable-anchor"]),"text-anchor":new Te(Ie.layout_symbol["text-anchor"]),"text-max-angle":new ne(Ie.layout_symbol["text-max-angle"]),"text-writing-mode":new ne(Ie.layout_symbol["text-writing-mode"]),"text-rotate":new Te(Ie.layout_symbol["text-rotate"]),"text-padding":new ne(Ie.layout_symbol["text-padding"]),"text-keep-upright":new ne(Ie.layout_symbol["text-keep-upright"]),"text-transform":new Te(Ie.layout_symbol["text-transform"]),"text-offset":new Te(Ie.layout_symbol["text-offset"]),"text-allow-overlap":new ne(Ie.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ne(Ie.layout_symbol["text-ignore-placement"]),"text-optional":new ne(Ie.layout_symbol["text-optional"]),visibility:new ne(Ie.layout_symbol.visibility)});var $2={paint:new $e({"icon-opacity":new Te(Ie.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Te(Ie.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Te(Ie.paint_symbol["text-emissive-strength"]),"icon-color":new Te(Ie.paint_symbol["icon-color"]),"icon-halo-color":new Te(Ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new Te(Ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Te(Ie.paint_symbol["icon-halo-blur"]),"icon-translate":new ne(Ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new ne(Ie.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Te(Ie.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Te(Ie.paint_symbol["text-opacity"]),"text-color":new Te(Ie.paint_symbol["text-color"],{runtimeType:Co,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Te(Ie.paint_symbol["text-halo-color"]),"text-halo-width":new Te(Ie.paint_symbol["text-halo-width"]),"text-halo-blur":new Te(Ie.paint_symbol["text-halo-blur"]),"text-translate":new ne(Ie.paint_symbol["text-translate"]),"text-translate-anchor":new ne(Ie.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ne(Ie.paint_symbol["icon-color-saturation"])}),layout:$U};class SR{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:nl,this.defaultValue=n}evaluate(n){if(n.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xt(SR,"FormatSectionOverride",{omit:["defaultValue"]});class lv extends _t{constructor(n,o,l){super(n,$2,o,l)}recalculate(n,o){super.recalculate(n,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const f of l)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(n,o,l,h){const f=this.layout.get(n).evaluate(o,{},l,h),m=this._unevaluatedLayout._values[n];return m.isDataDriven()||Od(m.value)||!f?f:function(_,x){return x.replace(/{([^{}]+)}/g,(w,E)=>E in _?String(_[E]):"")}(o.properties,f)}createBucket(n){return new tg(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of $2.paint.overridableProperties){if(!lv.hasPaintOverride(this.layout,n))continue;const o=this.paint.get(n),l=new SR(o),h=new Tm(l,o.property.specification,this.scope,this.options);let f=null;f=o.value.kind==="constant"||o.value.kind==="source"?new Xu("source",h):new Yu("composite",h,o.value.zoomStops,o.value._interpolationType),this.paint._values[n]=new ke(o.property,f,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven())&&lv.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){const l=n.get("text-field"),h=$2.paint.properties[o];let f=!1;const m=_=>{for(const x of _)if(h.overrides&&h.overrides.hasOverride(x))return void(f=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Fi)m(l.value.value.sections);else if(l.value.kind==="source"){const _=w=>{f||(w instanceof pc&&$r(w.value)===ma?m(w.value.sections):w instanceof Du?m(w.sections):w.eachChild(_))},x=l.value;x._styleExpression&&_(x._styleExpression.expression)}return f}getProgramIds(){const n=this.paint.get("icon-opacity").constantOr(1)!==0,o=this.paint.get("text-opacity").constantOr(1)!==0,l=[];return n&&l.push("symbolIcon"),o&&l.push("symbolSDF"),l}getDefaultProgramParams(n,o){return{config:new rh(this,o),overrideFog:!1}}}const GU=Z0.types,WU=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cv(r,n,o,l,h,f,m,_,x,w,E,I,k){const C=_?Math.min(Cc,Math.round(_[0])):0,R=_?Math.min(Cc,Math.round(_[1])):0;r.emplaceBack(n,o,Math.round(32*l),Math.round(32*h),f,m,(C<<1)+(x?1:0),R,16*w,16*E,256*I,256*k)}function uv(r,n,o){r.emplaceBack(n,o)}function hv(r,n,o,l,h,f,m){r.emplaceBack(n,o,l,h,f,m)}function dv(r,n,o,l,h){r.emplaceBack(n,o,l,h),r.emplaceBack(n,o,l,h),r.emplaceBack(n,o,l,h),r.emplaceBack(n,o,l,h)}function qU(r){for(const n of r.sections)if(V(n.text))return!0;return!1}class G2{constructor(n){this.layoutVertexArray=new ei,this.indexArray=new Bn,this.programConfigurations=n,this.segments=new mr,this.dynamicLayoutVertexArray=new Rn,this.opacityVertexArray=new xi,this.placedSymbolArray=new _k,this.iconTransitioningVertexArray=new ji,this.globeExtVertexArray=new Jn,this.zOffsetVertexArray=new Hs}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,o,l,h,f){this.isEmpty()||(l&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,lU.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,uU.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,WU,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,dU.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,cU.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,hU.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}xt(G2,"SymbolBuffers");class W2{constructor(n,o,l){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new l,this.segments=new mr,this.collisionVertexArray=new ns,this.collisionVertexArrayExt=new Rn}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,fU.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,pU.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}xt(W2,"CollisionBuffers");class fv{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=a.m.identity([]),this.placementViewportMatrix=a.m.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=O2(this.zoom,o["text-size"]),this.iconSizeData=O2(this.zoom,o["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),f=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(m=>ls[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=l.get("symbol-z-elevate")}createArrays(){this.text=new G2(new Tc(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new G2(new Tc(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new xk,this.lineVertexArray=new bk,this.symbolInstances=new vk}calculateGlyphDependencies(n,o,l,h,f){for(let m=0;m<n.length;m++){const _=n.codePointAt(m);if(_===void 0)break;if(o[_]=!0,h&&f&&_<=65535){const x=Hm[n.charAt(m)];x&&(o[x.charCodeAt(0)]=!0)}}}populate(n,o,l,h){const f=this.layers[0],m=f.layout,_=this.projection.name==="globe",x=m.get("text-font"),w=m.get("text-field"),E=m.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof Fi&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),k=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,C=m.get("symbol-sort-key");if(this.features=[],!I&&!k)return;const R=o.iconDependencies,L=o.glyphDependencies,N=o.availableImages,j=new de(this.zoom);for(const{feature:Z,id:X,index:J,sourceLayerIndex:te}of n){const re=f._featureFilter.needGeometry,pe=Ac(Z,re);if(!f._featureFilter.filter(j,pe,l))continue;if(re||(pe.geometry=Da(Z,l,h)),_&&Z.type!==1&&l.z<=5){const Se=pe.geometry,Fe=.98078528056,Qe=(Le,He)=>{const De=Vm(Le.x,Le.y,l,1),ut=Vm(He.x,He.y,l,1);return a.v.dot(De,ut)<Fe};for(let Le=0;Le<Se.length;Le++)Se[Le]=rV(Se[Le],Qe)}let ve,be;if(I){const Se=f.getValueAndResolveTokens("text-field",pe,l,N),Fe=Fi.factory(Se);qU(Fe)&&(this.hasRTLText=!0),(!this.hasRTLText||ee()==="unavailable"||this.hasRTLText&&ge.isParsed())&&(ve=_U(Fe,f,pe))}if(k){const Se=f.getValueAndResolveTokens("icon-image",pe,l,N);be=Se instanceof Mo?Se:Mo.fromString(Se)}if(!ve&&!be)continue;const Pe=this.sortFeaturesByKey?C.evaluate(pe,{},l):void 0;if(this.features.push({id:X,text:ve,icon:be,index:J,sourceLayerIndex:te,geometry:pe.geometry,properties:Z.properties,type:GU[Z.type],sortKey:Pe}),be&&(R[be.namePrimary]=!0,be.nameSecondary&&(R[be.nameSecondary]=!0)),ve){const Se=x.evaluate(pe,{},l).join(","),Fe=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ls.vertical)>=0;for(const Qe of ve.sections)if(Qe.image)R[Qe.image.namePrimary]=!0;else{const Le=T(ve.toString()),He=Qe.fontStack||Se,De=L[He]=L[He]||{};this.calculateGlyphDependencies(Qe.text,De,Fe,this.allowVerticalPlacement,Le)}}}m.get("symbol-placement")==="line"&&(this.features=function(Z){const X={},J={},te=[];let re=0;function pe(Se){te.push(Z[Se]),re++}function ve(Se,Fe,Qe){const Le=J[Se];return delete J[Se],J[Fe]=Le,te[Le].geometry[0].pop(),te[Le].geometry[0]=te[Le].geometry[0].concat(Qe[0]),Le}function be(Se,Fe,Qe){const Le=X[Fe];return delete X[Fe],X[Se]=Le,te[Le].geometry[0].shift(),te[Le].geometry[0]=Qe[0].concat(te[Le].geometry[0]),Le}function Pe(Se,Fe,Qe){const Le=Qe?Fe[0][Fe[0].length-1]:Fe[0][0];return`${Se}:${Le.x}:${Le.y}`}for(let Se=0;Se<Z.length;Se++){const Fe=Z[Se],Qe=Fe.geometry,Le=Fe.text?Fe.text.toString():null;if(!Le){pe(Se);continue}const He=Pe(Le,Qe),De=Pe(Le,Qe,!0);if(He in J&&De in X&&J[He]!==X[De]){const ut=be(He,De,Qe),yt=ve(He,De,te[ut].geometry);delete X[He],delete J[De],J[Pe(Le,te[yt].geometry,!0)]=yt,te[ut].geometry=null}else He in J?ve(He,De,Qe):De in X?be(He,De,Qe):(pe(Se),X[He]=re-1,J[De]=re-1)}return te.filter(Se=>Se.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,X)=>Z.sortKey-X.sortKey)}update(n,o,l,h,f){const m=Object.keys(n).length!==0;if(m&&!this.stateDependentLayers.length)return;const _=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(n,o,_,l,h,f),this.icon.programConfigurations.updatePaintArrays(n,o,_,l,h,f)}updateZOffset(){const n=(f,m,_)=>{l+=m,l>f.length&&f.resize(l);for(let x=-m;x<0;x++)f.emplace(x+l,_)},o=(f,m,_)=>{h+=m,h>f.length&&f.resize(h);for(let x=-m;x<0;x++)f.emplace(x+h,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,h=0;for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:x,numIconVertices:w}=m,E=m.zOffset,I=w>0;if((_>0||x>0)&&(n(this.text.zOffsetVertexArray,_,E),n(this.text.zOffsetVertexArray,x,E)),I){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:C}=m;k>=0&&o(this.icon.zOffsetVertexArray,w,E),C>=0&&o(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,E)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ER(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){const l=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:h,y:f}of o)this.lineVertexArray.emplaceBack(h,f);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(n,o,l,h,f,m,_,x,w,E,I,k,C,R,L,N){const j=n.indexArray,Z=n.layoutVertexArray,X=n.globeExtVertexArray,J=n.segments.prepareSegment(4*o.length,Z,j,this.canOverlap?m.sortKey:void 0),te=this.glyphOffsetArray.length,re=J.vertexLength,pe=this.allowVerticalPlacement&&_===ls.vertical?Math.PI/2:0,ve=m.text&&m.text.sections;for(let Pe=0;Pe<o.length;Pe++){const{tl:Se,tr:Fe,bl:Qe,br:Le,texPrimary:He,texSecondary:De,pixelOffsetTL:ut,pixelOffsetBR:yt,minFontScaleX:Ke,minFontScaleY:Vt,glyphOffset:wt,isSDF:ct,sectionIndex:Ut}=o[Pe],Rt=J.vertexLength,Nt=wt[1];if(cv(Z,w.x,w.y,Se.x,Nt+Se.y,He.x,He.y,l,ct,ut.x,ut.y,Ke,Vt),cv(Z,w.x,w.y,Fe.x,Nt+Fe.y,He.x+He.w,He.y,l,ct,yt.x,ut.y,Ke,Vt),cv(Z,w.x,w.y,Qe.x,Nt+Qe.y,He.x,He.y+He.h,l,ct,ut.x,yt.y,Ke,Vt),cv(Z,w.x,w.y,Le.x,Nt+Le.y,He.x+He.w,He.y+He.h,l,ct,yt.x,yt.y,Ke,Vt),x){const{x:it,y:Xt,z:gn}=x.anchor,[en,un,In]=x.up;hv(X,it,Xt,gn,en,un,In),hv(X,it,Xt,gn,en,un,In),hv(X,it,Xt,gn,en,un,In),hv(X,it,Xt,gn,en,un,In),dv(n.dynamicLayoutVertexArray,it,Xt,gn,pe)}else dv(n.dynamicLayoutVertexArray,w.x,w.y,w.z,pe);if(N){const it=De||He;uv(n.iconTransitioningVertexArray,it.x,it.y),uv(n.iconTransitioningVertexArray,it.x+it.w,it.y),uv(n.iconTransitioningVertexArray,it.x,it.y+it.h),uv(n.iconTransitioningVertexArray,it.x+it.w,it.y+it.h)}j.emplaceBack(Rt,Rt+1,Rt+2),j.emplaceBack(Rt+1,Rt+2,Rt+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(wt[0]),Pe!==o.length-1&&Ut===o[Pe+1].sectionIndex||n.programConfigurations.populatePaintArrays(Z.length,m,m.index,{},C,R,L,ve&&ve[Ut])}const be=x?x.anchor:w;n.placedSymbolArray.emplaceBack(be.x,be.y,be.z,w.x,w.y,te,this.glyphOffsetArray.length-te,re,E,I,w.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],_,0,!1,0,k,0)}_commitLayoutVertex(n,o,l,h,f,m,_){n.emplaceBack(o,l,h,f,m,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(n,o,l,h,f,m,_){const x=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),w=x.vertexLength,E=_.tileAnchorX,I=_.tileAnchorY;for(let C=0;C<4;C++)l.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,o,n.padding,_.zOffset),this._commitLayoutVertex(l.layoutVertexArray,h,f,m,E,I,new Oe(n.x1,n.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,f,m,E,I,new Oe(n.x2,n.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,f,m,E,I,new Oe(n.x2,n.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,f,m,E,I,new Oe(n.x1,n.y2)),x.vertexLength+=4;const k=l.indexArray;k.emplaceBack(w,w+1),k.emplaceBack(w+1,w+2),k.emplaceBack(w+2,w+3),k.emplaceBack(w+3,w),x.primitiveLength+=4}_addTextDebugCollisionBoxes(n,o,l,h,f,m){for(let _=h;_<f;_++){const x=l.get(_),w=this.getSymbolInstanceTextSize(n,m,o,_);this._addCollisionDebugVertices(x,w,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(n,o,l,h,f,m){for(let _=h;_<f;_++){const x=l.get(_),w=this.getSymbolInstanceIconSize(n,o,m.placedIconSymbolIndex);this._addCollisionDebugVertices(x,w,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}generateCollisionDebugBuffers(n,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new W2(Lo,XM.members,ji),this.iconCollisionBox=new W2(Lo,XM.members,ji);const l=ef(this.iconSizeData,n),h=ef(this.textSizeData,n);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(h,n,o,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(h,n,o,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(l,n,o,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(l,n,o,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(n,o,l,h){const f=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:h),m=ev(this.textSizeData,n,f)/Ti;return this.tilePixelRatio*m}getSymbolInstanceIconSize(n,o,l){const h=this.icon.placedSymbolArray.get(l),f=ev(this.iconSizeData,n,h);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(n,o,l,h){n.emplaceBack(o,-l,-l,h),n.emplaceBack(o,l,-l,h),n.emplaceBack(o,l,l,h),n.emplaceBack(o,-l,l,h)}_updateTextDebugCollisionBoxes(n,o,l,h,f,m){for(let _=h;_<f;_++){const x=l.get(_),w=this.getSymbolInstanceTextSize(n,m,o,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,x.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(n,o,l,h,f,m){for(let _=h;_<f;_++){const x=l.get(_),w=this.getSymbolInstanceIconSize(n,o,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,x.padding,m.zOffset)}}updateCollisionDebugBuffers(n,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=ef(this.iconSizeData,n),h=ef(this.textSizeData,n);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(h,n,o,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(h,n,o,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(l,n,o,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(l,n,o,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,o,l,h,f,m,_,x,w){const E={};if(o<l){const{x1:I,y1:k,x2:C,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:J,featureIndex:te}=n.get(o);E.textBox={x1:I,y1:k,x2:C,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:J},E.textFeatureIndex=te}if(h<f){const{x1:I,y1:k,x2:C,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:J,featureIndex:te}=n.get(h);E.verticalTextBox={x1:I,y1:k,x2:C,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:J},E.verticalTextFeatureIndex=te}if(m<_){const{x1:I,y1:k,x2:C,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:J,featureIndex:te}=n.get(m);E.iconBox={x1:I,y1:k,x2:C,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:J},E.iconFeatureIndex=te}if(x<w){const{x1:I,y1:k,x2:C,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:J,featureIndex:te}=n.get(x);E.verticalIconBox={x1:I,y1:k,x2:C,y2:R,padding:L,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:J},E.verticalIconFeatureIndex=te}return E}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const l=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,o){const l=n.placedSymbolArray.get(o),h=l.vertexStartIndex+4*l.numGlyphs;for(let f=l.vertexStartIndex;f<h;f+=4)n.indexArray.emplaceBack(f,f+1,f+2),n.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(n),l=Math.cos(n),h=[],f=[],m=[];for(let _=0;_<this.symbolInstances.length;++_){m.push(_);const x=this.symbolInstances.get(_);h.push(0|Math.round(o*x.tileAnchorX+l*x.tileAnchorY)),f.push(x.featureIndex)}return m.sort((_,x)=>h[_]-h[x]||f[x]-f[_]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,o){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===o?l.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const l=this.symbolInstances.get(o);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:w}=l;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),f>=0&&f!==h&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&m!==f&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}xt(fv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),fv.MAX_GLYPHS=65535,fv.addDynamicAttributes=dv;var tg=fv;const HU=Mt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:ZU}=HU,XU=Mt([{name:"a_packed",components:4,type:"Float32"}]),{members:YU}=XU,KU=Z0.types,JU=Math.cos(Math.PI/180*37.5);class pv{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Do,this.layoutVertexArray2=new Rn,this.indexArray=new Bn,this.programConfigurations=new Tc(n.layers,n.zoom),this.segments=new mr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,l,h){this.hasPattern=P2("line",this.layers,o);const f=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:E,id:I,index:k,sourceLayerIndex:C}of n){const R=this.layers[0]._featureFilter.needGeometry,L=Ac(E,R);if(!this.layers[0]._featureFilter.filter(new de(this.zoom),L,l))continue;const N=f?f.evaluate(L,{},l):void 0,j={id:I,properties:E.properties,type:E.type,sourceLayerIndex:C,index:k,geometry:R?L.geometry:Da(E,l,h),patterns:{},sortKey:N};m.push(j)}f&&m.sort((E,I)=>E.sortKey-I.sortKey);const{lineAtlas:_,featureIndex:x}=o,w=this.addConstantDashes(_);for(const E of m){const{geometry:I,index:k,sourceLayerIndex:C}=E;if(w&&this.addFeatureDashes(E,_),this.hasPattern){const R=k2("line",this.layers,E,this.zoom,o);this.patternFeatures.push(R)}else this.addFeature(E,I,k,l,_.positions,o.availableImages,o.brightness);x.insert(n[k].feature,I,k,C,this.index)}}addConstantDashes(n){let o=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(h.kind!=="constant"||f.kind!=="constant")o=!0;else{const m=f.value,_=h.value;if(!_)continue;n.addDash(_,m)}}return o}addFeatureDashes(n,o){const l=this.zoom;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if(f.kind==="constant"&&m.kind==="constant")continue;let _,x;if(f.kind==="constant"){if(_=f.value,!_)continue}else _=f.evaluate({zoom:l},n);x=m.kind==="constant"?m.value:m.evaluate({zoom:l},n),o.addDash(_,x),n.patterns[h.id]=o.getKey(_,x)}}update(n,o,l,h,f){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,o,m?this.stateDependentLayers:this.layers,l,h,f)}addFeatures(n,o,l,h,f,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,o,l,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,YU)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ZU),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,o,l,h,f,m,_){const x=this.layers[0].layout,w=x.get("line-join").evaluate(n,{}),E=x.get("line-cap").evaluate(n,{}),I=x.get("line-miter-limit"),k=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const C of o)this.addLine(C,n,w,E,I,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,f,m,h,_)}addLine(n,o,l,h,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let j=0;j<n.length-1;j++)this.totalDistance+=n[j].dist(n[j+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=KU[o.type]==="Polygon";let x=n.length;for(;x>=2&&n[x-1].equals(n[x-2]);)x--;let w=0;for(;w<x-1&&n[w].equals(n[w+1]);)w++;if(x<(_?3:2))return;l==="bevel"&&(f=1.05);const E=this.overscaling<=16?15*at/(512*this.overscaling):0,I=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let k,C,R,L,N;this.e1=this.e2=-1,_&&(k=n[x-2],N=n[w].sub(k)._unit()._perp());for(let j=w;j<x;j++){if(R=j===x-1?_?n[w+1]:void 0:n[j+1],R&&n[j].equals(R))continue;N&&(L=N),k&&(C=k),k=n[j],N=R?R.sub(k)._unit()._perp():L,L=L||N;let Z=L.add(N);Z.x===0&&Z.y===0||Z._unit();const X=L.x*N.x+L.y*N.y,J=Z.x*N.x+Z.y*N.y,te=J!==0?1/J:1/0,re=2*Math.sqrt(2-2*J),pe=J<JU&&C&&R,ve=L.x*N.y-L.y*N.x>0;if(pe&&j>w){const Se=k.dist(C);if(Se>2*E){const Fe=k.sub(k.sub(C)._mult(E/Se)._round());this.updateDistance(C,Fe),this.addCurrentVertex(Fe,L,0,0,I),C=Fe}}const be=C&&R;let Pe=be?l:_?"butt":h;if(be&&Pe==="round"&&(te<m?Pe="miter":te<=2&&(Pe="fakeround")),Pe==="miter"&&te>f&&(Pe="bevel"),Pe==="bevel"&&(te>2&&(Pe="flipbevel"),te<f&&(Pe="miter")),C&&this.updateDistance(C,k),Pe==="miter")Z._mult(te),this.addCurrentVertex(k,Z,0,0,I);else if(Pe==="flipbevel"){if(te>100)Z=N.mult(-1);else{const Se=te*L.add(N).mag()/L.sub(N).mag();Z._perp()._mult(Se*(ve?-1:1))}this.addCurrentVertex(k,Z,0,0,I),this.addCurrentVertex(k,Z.mult(-1),0,0,I)}else if(Pe==="bevel"||Pe==="fakeround"){const Se=-Math.sqrt(te*te-1),Fe=ve?Se:0,Qe=ve?0:Se;if(C&&this.addCurrentVertex(k,L,Fe,Qe,I),Pe==="fakeround"){const Le=Math.round(180*re/Math.PI/20);for(let He=1;He<Le;He++){let De=He/Le;if(De!==.5){const yt=De-.5;De+=De*yt*(De-1)*((1.0904+X*(X*(3.55645-1.43519*X)-3.2452))*yt*yt+(.848013+X*(.215638*X-1.06021)))}const ut=N.sub(L)._mult(De)._add(L)._unit()._mult(ve?-1:1);this.addHalfVertex(k,ut.x,ut.y,!1,ve,0,I)}}R&&this.addCurrentVertex(k,N,-Fe,-Qe,I)}else if(Pe==="butt")this.addCurrentVertex(k,Z,0,0,I);else if(Pe==="square"){const Se=C?1:-1;C||this.addCurrentVertex(k,Z,Se,Se,I),this.addCurrentVertex(k,Z,0,0,I),C&&this.addCurrentVertex(k,Z,Se,Se,I)}else Pe==="round"&&(C&&(this.addCurrentVertex(k,L,0,0,I),this.addCurrentVertex(k,L,1,1,I,!0)),R&&(this.addCurrentVertex(k,N,-1,-1,I,!0),this.addCurrentVertex(k,N,0,0,I)));if(pe&&j<x-1){const Se=k.dist(R);if(Se>2*E){const Fe=k.add(R.sub(k)._mult(E/Se)._round());this.updateDistance(k,Fe),this.addCurrentVertex(Fe,N,0,0,I),k=Fe}}}}addCurrentVertex(n,o,l,h,f,m=!1){const _=o.y*h-o.x,x=-o.y-o.x*h;this.addHalfVertex(n,o.x+o.y*l,o.y-o.x*l,m,!1,l,f),this.addHalfVertex(n,_,x,m,!0,-h,f)}addHalfVertex({x:n,y:o},l,h,f,m,_,x){this.layoutVertexArray.emplaceBack((n<<1)+(f?1:0),(o<<1)+(m?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),x.primitiveLength++),m?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,o){this.distance+=n.dist(o),this.updateScaledDistance()}}xt(pv,"LineBucket",{omit:["layers","patternFeatures"]});class Pl{constructor(n,o,l,h){this.context=n,this.format=l,this.texture=n.gl.createTexture(),this.update(o,h)}update(n,o,l){const{width:h,height:f}=n,{context:m}=this,{gl:_}=m;if(_.bindTexture(_.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!o||o.premultiply!==!1)),l||this.size&&this.size[0]===h&&this.size[1]===f){const{x,y:w}=l||{x:0,y:0};if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,x,w,_.RGBA,_.UNSIGNED_BYTE,n);else{let E=this.format,I=_.UNSIGNED_BYTE;this.format===_.R32F&&(E=_.RED,I=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,x,w,h,f,E,I,n.data)}}else if(this.size=[h,f],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap){let x=this.format;this.format===_.R8&&(x=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,x,_.UNSIGNED_BYTE,n)}else{let x=this.format,w=this.format,E=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(x=_.DEPTH_COMPONENT16,E=_.UNSIGNED_SHORT),this.format===_.R8&&(w=_.RED),this.format===_.R32F&&(E=_.FLOAT,w=_.RED),_.texImage2D(_.TEXTURE_2D,0,x,h,f,0,w,E,n.data)}this.useMipmap=!!(o&&o.useMipmap),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(n,o,l=!1){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),n!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!l?n===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(n,o,l,h){const{context:f}=this,{gl:m}=f;m.bindTexture(m.TEXTURE_2D,this.texture),o!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),this.magFilter=o),n!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?n===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),l!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,l),this.wrapS=l),h!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class mv{constructor(n,o){this.context=n,this.texture=o}bind(n,o){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,n),this.minFilter=n),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}}const As=32,La=33,Oc=new Uint16Array(8184);for(let r=0;r<2046;r++){let n=r+2,o=0,l=0,h=0,f=0,m=0,_=0;for(1&n?h=f=m=As:o=l=_=As;(n>>=1)>1;){const w=o+h>>1,E=l+f>>1;1&n?(h=o,f=l,o=m,l=_):(o=h,l=f,h=m,f=_),m=w,_=E}const x=4*r;Oc[x+0]=o,Oc[x+1]=l,Oc[x+2]=h,Oc[x+3]=f}const za=new Uint16Array(2178),Dc=new Uint8Array(1089),gv=new Uint16Array(1089);function IR(r){return r===0?-.03125:r===32?.03125:0}var _v=Mt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const AR={type:2,extent:at,loadGeometry:()=>[[new Oe(0,0),new Oe(at+1,0),new Oe(at+1,at+1),new Oe(0,at+1),new Oe(0,0)]]};class q2{constructor(n,o,l,h,f){this.tileID=n,this.uid=_s(),this.uses=0,this.tileSize=o,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,h&&h.style&&(this._lastUpdatedBrightness=h.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(n){const o=n+this.timeAdded;o<Li.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Mc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,o,l){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(h,f){const m={};if(!f)return m;for(const _ of h){const x=_.layerIds.map(w=>f.getLayer(w)).filter(Boolean);if(x.length!==0){_.layers=x,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(w=>x.filter(E=>E.id===w)[0]));for(const w of x)m[w.fqid]=_}}return m}(n.buckets,o.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const f=this.buckets[h];if(f instanceof tg){if(this.hasSymbolBuckets=!0,!l)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const f=this.buckets[h];if(f instanceof tg&&f.hasRTLText){this.hasRTLText=!0,ge.isLoading()||ge.isLoaded()||ee()!=="deferred"||he();break}}this.queryPadding=0;for(const h in this.buckets){const f=this.buckets[h],m=o.style.getOwnLayer(h);if(!m)continue;const _=m.queryRadius(f);this.queryPadding=Math.max(this.queryPadding,_)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new zw}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const h in this.buckets){const f=this.buckets[h];f.uploadPending()&&f.upload(n)}const o=n.gl,l=this.imageAtlas;if(l&&!l.uploaded){const h=!!Object.keys(l.patternPositions).length;this.imageAtlasTexture=new Pl(n,l.image,o.RGBA,{useMipmap:h}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Pl(n,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Pl(n,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(n,o,l){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,l),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const h=o.style.getBrightness();(this._lastUpdatedBrightness||h)&&(this._lastUpdatedBrightness&&h&&Math.abs(this._lastUpdatedBrightness-h)<.001||(this._lastUpdatedBrightness=h,this.updateBuckets(void 0,o)))}queryRenderedFeatures(n,o,l,h,f,m,_,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:_,transform:m,params:f,tileTransform:this.tileTransform},n,o,l):{}}querySourceFeatures(n,o){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),f=o?o.sourceLayer:"",m=h._geojsonTileLayer||h[f];if(!m)return;const _=Fd(o&&o.filter),{z:x,x:w,y:E}=this.tileID.canonical,I={z:x,x:w,y:E};for(let k=0;k<m.length;k++){const C=m.feature(k);if(_.needGeometry){const N=Ac(C,!0);if(!_.filter(new de(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!_.filter(new de(this.tileID.overscaledZ),C))continue;const R=l.getId(C,f),L=new jM(C,x,w,E,R);L.tile=I,n.push(L)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const n in this.buckets)if(this.buckets[n].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const o=this.expirationTime;if(n.cacheControl){const l=Je(n.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(o)if(this.expirationTime<o)h=!0;else{const f=this.expirationTime-o;f?this.expirationTime=l+Math.max(f,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,o){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&o&&this.updateBuckets(n,o)}updateBuckets(n,o){if(!this.latestFeatureIndex)return;const l=this.latestFeatureIndex.loadVTLayers(),h=o.style.listImages(),f=o.style.getBrightness();for(const m in this.buckets){if(!o.style.hasLayer(m))continue;const _=this.buckets[m],x=_.layers[0].sourceLayer||"_geojsonTileLayer",w=l[x];let E={};if(n&&(E=n[x],!w||!E||Object.keys(E).length===0))continue;if(_.update(E,w,h,this.imageAtlas&&this.imageAtlas.patternPositions||{},f),_ instanceof pv||_ instanceof q0){const k=o.style.getOwnSourceCache(_.layers[0].source);o._terrain&&o._terrain.enabled&&k&&_.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(k.id,this.tileID)}const I=o&&o.style&&o.style.getOwnLayer(m);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Li.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=Li.now()+n}setTexture(n,o){const l=o.context,h=l.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof Pl?this.texture.update(n,{useMipmap:!0}):(this.texture=new Pl(l,n,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(n,o){const l={};for(const h of o)l[h]=!0;this.dependencies[n]=l}hasDependency(n,o){for(const l of n){const h=this.dependencies[l];if(h){for(const f of o)if(h[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const l=Da(AR,this.tileID.canonical,this.tileTransform)[0],h=new Qt,f=new Om;for(let m=0;m<l.length;m++){const{x:_,y:x}=l[m];h.emplaceBack(_,x),f.emplaceBack(m)}f.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(f),this._tileDebugBuffer=n.createVertexBuffer(h,Fm.members),this._tileDebugSegments=mr.simpleSegment(0,0,h.length,f.length)}_makeTileBoundsBuffers(n,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const l=Da(AR,this.tileID.canonical,this.tileTransform)[0];let h,f;if(this.isRaster){const m=function(_,x){const w=Mc(_,x),E=Math.pow(2,_.z);for(let N=0;N<La;N++)for(let j=0;j<La;j++){const Z=zo((_.x+(j+IR(j))/As)/E),X=wi((_.y+(N+IR(N))/As)/E),J=x.project(Z,X),te=N*La+j;za[2*te+0]=Math.round((J.x*w.scale-w.x)*at),za[2*te+1]=Math.round((J.y*w.scale-w.y)*at)}Dc.fill(0),gv.fill(0);for(let N=2045;N>=0;N--){const j=4*N,Z=Oc[j+0],X=Oc[j+1],J=Oc[j+2],te=Oc[j+3],re=Z+J>>1,pe=X+te>>1,ve=re+pe-X,be=pe+Z-re,Pe=X*La+Z,Se=te*La+J,Fe=pe*La+re,Qe=Math.hypot((za[2*Pe+0]+za[2*Se+0])/2-za[2*Fe+0],(za[2*Pe+1]+za[2*Se+1])/2-za[2*Fe+1])>=16;Dc[Fe]=Dc[Fe]||(Qe?1:0),N<1022&&(Dc[Fe]=Dc[Fe]||Dc[(X+be>>1)*La+(Z+ve>>1)]||Dc[(te+be>>1)*La+(J+ve>>1)])}const I=new Nn,k=new Bn;let C=0;function R(N,j){const Z=j*La+N;return gv[Z]===0&&(I.emplaceBack(za[2*Z+0],za[2*Z+1],N*at/As,j*at/As),gv[Z]=++C),gv[Z]-1}function L(N,j,Z,X,J,te){const re=N+Z>>1,pe=j+X>>1;if(Math.abs(N-J)+Math.abs(j-te)>1&&Dc[pe*La+re])L(J,te,N,j,re,pe),L(Z,X,J,te,re,pe);else{const ve=R(N,j),be=R(Z,X),Pe=R(J,te);k.emplaceBack(ve,be,Pe)}}return L(0,0,As,As,As,0),L(As,As,0,0,0,As),{vertices:I,indices:k}}(this.tileID.canonical,o);h=m.vertices,f=m.indices}else{h=new Nn,f=new Bn;for(const{x:_,y:x}of l)h.emplaceBack(_,x,0,0);const m=W0(h.int16,void 0,4);for(let _=0;_<m.length;_+=3)f.emplaceBack(m[_],m[_+1],m[_+2])}this._tileBoundsBuffer=n.createVertexBuffer(h,_v.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(f),this._tileBoundsSegments=mr.simpleSegment(0,0,h.length,f.length)}_makeGlobeTileDebugBuffers(n,o){const l=o.projection;if(!l||l.name!=="globe"||o.freezeTileCoverage)return;const h=this.tileID.canonical,f=Um(eM(h,o)),m=El(o.zoom);let _;m>0&&(_=a.m.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,h,o,f,_,m),this._makeGlobeTileDebugTextBuffer(n,h,o,f,_,m)}_globePoint(n,o,l,h,f,m,_){let x=Vm(n,o,l);if(m){const w=1<<l.z,E=Ra(h.center.lng),I=Oa(h.center.lat),k=(l.x+.5)/w-E;let C=0;k>.5?C=-1:k<-.5&&(C=1);let R=(n/at+l.x)/w+C,L=(o/at+l.y)/w;R=(R-E)*h._pixelsPerMercatorPixel+E,L=(L-I)*h._pixelsPerMercatorPixel+I;const N=[R*h.worldSize,L*h.worldSize,0];a.v.transformMat4(N,N,m),x=Tl(x,N,_)}return a.v.transformMat4(x,x,f)}_makeGlobeTileDebugBorderBuffer(n,o,l,h,f,m){const _=new Qt,x=new Om,w=new Hn,E=(k,C,R,L,N)=>{const j=(R-k)/(N-1),Z=(L-C)/(N-1),X=_.length;for(let J=0;J<N;J++){const te=k+J*j,re=C+J*Z;_.emplaceBack(te,re);const pe=this._globePoint(te,re,o,l,h,f,m);w.emplaceBack(pe[0],pe[1],pe[2]),x.emplaceBack(X+J)}},I=at;E(0,0,I,0,16),E(I,0,I,I,16),E(I,I,0,I,16),E(0,I,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(x),this._tileDebugBuffer=n.createVertexBuffer(_,Fm.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(w,qC.members),this._tileDebugSegments=mr.simpleSegment(0,0,_.length,x.length)}_makeGlobeTileDebugTextBuffer(n,o,l,h,f,m){const _=at/4,x=new Qt,w=new Bn,E=new Hn,I=25;w.reserve(32),x.reserve(I),E.reserve(I);const k=(C,R)=>I*C+R;for(let C=0;C<I;C++){const R=C*_;for(let L=0;L<I;L++){const N=L*_;x.emplaceBack(N,R);const j=this._globePoint(N,R,o,l,h,f,m);E.emplaceBack(j[0],j[1],j[2])}}for(let C=0;C<4;C++)for(let R=0;R<4;R++){const L=k(C,R),N=k(C,R+1),j=k(C+1,R),Z=k(C+1,R+1);w.emplaceBack(L,N,j),w.emplaceBack(j,N,Z)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(w),this._tileDebugTextBuffer=n.createVertexBuffer(x,Fm.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(E,qC.members),this._tileDebugTextSegments=mr.simpleSegment(0,0,I,32)}destroy(n=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof Pl&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class QU{constructor(n,o){this.max=n,this.onRemove=o,this.reset()}reset(){for(const n in this.data)for(const o of this.data[n])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(n,o,l){const h=n.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const f={value:o,timeout:void 0};if(l!==void 0&&(f.timeout=setTimeout(()=>{this.remove(n,f)},l)),this.data[h].push(f),this.order.push(h),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const o=this.data[n].shift();return o.timeout&&clearTimeout(o.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),o.value}getByKey(n){const o=this.data[n];return o?o[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,o){if(!this.has(n))return this;const l=n.wrapped().key,h=o===void 0?0:this.data[l].indexOf(o),f=this.data[l][h];return this.data[l].splice(h,1),f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(f.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(n){const o=[];for(const l in this.data)for(const h of this.data[l])n(h.value)||o.push(h);for(const l of o)this.remove(l.value.tileID,l)}}class hh{constructor(n,o,l,h){this.id=hh.uniqueIdxCounter,hh.uniqueIdxCounter++,this.context=n;const f=n.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||h||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=hh.uniqueIdxCounter,hh.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}hh.uniqueIdxCounter=0;class af{constructor(n,o,l){this.func=n,this.mask=o,this.range=l}}af.ReadOnly=!1,af.ReadWrite=!0,af.disabled=new af(519,af.ReadOnly,[0,1]);const H2=7680;class Z2{constructor(n,o,l,h,f,m){this.test=n,this.ref=o,this.mask=l,this.fail=h,this.depthFail=f,this.pass=m}}Z2.disabled=new Z2({func:519,mask:0},0,0,H2,H2,H2);class Ps{constructor(n,o,l,h){this.blendFunction=n,this.blendColor=o,this.mask=l,this.blendEquation=h}}Ps.Replace=[1,0,1,0],Ps.disabled=new Ps(Ps.Replace,sr.transparent,[!1,!1,!1,!1]),Ps.unblended=new Ps(Ps.Replace,sr.transparent,[!0,!0,!0,!0]),Ps.alphaBlended=new Ps([1,771,1,771],sr.transparent,[!0,!0,!0,!0]),Ps.multiply=new Ps([774,0,774,0],sr.transparent,[!0,!0,!0,!0]);const X2=1029,Y2=2305;class Qs{constructor(n,o,l){this.enable=n,this.mode=o,this.frontFace=l}}Qs.disabled=new Qs(!1,X2,Y2),Qs.backCCW=new Qs(!0,X2,Y2),Qs.backCW=new Qs(!0,X2,2304),Qs.frontCW=new Qs(!0,1028,2304),Qs.frontCCW=new Qs(!0,1028,Y2);class dh extends ys{constructor(n,o,l){super(),this.id=n,this._onlySymbols=l,o.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new QU(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new rU,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const o=this._tiles[n];if(o.state!=="errored"&&(o.state!=="loaded"||!o.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,o){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,o)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const l=this._tiles[o];l.upload(n),l.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Kn(this._tiles).map(n=>n.tileID).sort(PR).map(n=>n.key)}getRenderableIds(n,o){const l=[];for(const h in this._tiles)this._isIdRenderable(+h,n,o)&&l.push(this._tiles[h]);return n?l.sort((h,f)=>{const m=h.tileID,_=f.tileID,x=new Oe(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),w=new Oe(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-_.overscaledZ||w.y-x.y||w.x-x.x}).map(h=>h.tileID.key):l.map(h=>h.tileID).sort(PR).map(h=>h.key)}hasRenderableParent(n){const o=this.findLoadedParent(n,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(n,o,l){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(o||!this._tiles[n].holdingForFade())&&(l||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,o){const l=this._tiles[n];l&&(l.state!=="loading"&&(l.state=o),this._loadTile(l,this._tileLoaded.bind(this,l,n,o)))}_tileLoaded(n,o,l,h){if(h)if(n.state="errored",h.status!==404)this._source.fire(new tl(h,{tile:n}));else{if(!(n.tileID.key in this._loadedParentTiles))return void this._source.fire(new Xo("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=Li.now(),l==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(o,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new Xo("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const o=this.getRenderableIds();for(let h=0;h<o.length;h++){const f=o[h];if(n.neighboringTiles&&n.neighboringTiles[f]){const m=this.getTileByID(f);l(n,m),l(m,n)}}function l(h,f){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let m=f.tileID.canonical.x-h.tileID.canonical.x;const _=f.tileID.canonical.y-h.tileID.canonical.y,x=Math.pow(2,h.tileID.canonical.z),w=f.tileID.key;m===0&&_===0||Math.abs(_)>1||(Math.abs(m)>1&&(Math.abs(m+x)===1?m+=x:Math.abs(m-x)===1&&(m-=x)),f.dem&&h.dem&&(h.dem.backfillBorder(f.dem,m,_),h.neighboringTiles&&h.neighboringTiles[w]&&(h.neighboringTiles[w].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,o,l,h){for(const f in this._tiles){let m=this._tiles[f];if(h[f]||!m.hasData()||m.tileID.overscaledZ<=o||m.tileID.overscaledZ>l)continue;let _=m.tileID;for(;m&&m.tileID.overscaledZ>o+1;){const w=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[w.key],m&&m.hasData()&&(_=w)}let x=_;for(;x.overscaledZ>o;)if(x=x.scaledTo(x.overscaledZ-1),n[x.key]){h[_.key]=_;break}}}findLoadedParent(n,o){if(n.key in this._loadedParentTiles){const l=this._loadedParentTiles[n.key];return l&&l.tileID.overscaledZ>=o?l:null}for(let l=n.overscaledZ-1;l>=o;l--){const h=n.scaledTo(l),f=this._getLoadedTile(h);if(f)return f}}_getLoadedTile(n){const o=this._tiles[n.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,o){o=o||this._source.tileSize;const l=Math.ceil(n.width/o)+1,h=Math.ceil(n.height/o)+1,f=Math.floor(l*h*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(_)}handleWrapJump(n){const o=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,o){const l={};for(const h in this._tiles){const f=this._tiles[h];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+o),l[f.tileID.key]=f}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(n,o,l,h){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let f;if(this.updateCacheSize(n,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new hi(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(f=n.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(x=>this._source.hasTile(x)))):f=[],f.length>0&&this.castsShadows&&h&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!K2(this._source.type)){const x=n.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!l}),w=Math.min(x,this._source.maxzoom),E=n.extendTileCoverForShadows(f,h,w);for(const I of E)this._shadowCasterTiles[I.key]=!0,f.push(I)}const m=this._updateRetainedTiles(f);if(K2(this._source.type)&&f.length!==0){const x={},w={},E=Object.keys(m);for(const k of E){const C=m[k],R=this._tiles[k];if(!R||R.fadeEndTime&&R.fadeEndTime<=Li.now())continue;const L=this.findLoadedParent(C,Math.max(C.overscaledZ-dh.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),x[L.tileID.key]=L.tileID),w[k]=C}const I=f[f.length-1].overscaledZ;for(const k in this._tiles){const C=this._tiles[k];if(m[k]||!C.hasData())continue;let R=C.tileID;for(;R.overscaledZ>I;){R=R.scaledTo(R.overscaledZ-1);const L=this._tiles[R.key];if(L&&L.hasData()&&w[R.key]){m[k]=C.tileID;break}}}for(const k in x)m[k]||(this._coveredTiles[k]=!0,m[k]=x[k])}for(const x in m)this._tiles[x].clearFadeHold();const _=function(x,w){const E=[];for(const I in x)I in w||E.push(I);return E}(this._tiles,m);for(const x of _){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const o={};if(n.length===0)return o;const l={},h=n.reduce((w,E)=>Math.min(w,E.overscaledZ),1/0),f=n[0].overscaledZ,m=Math.max(f-dh.maxOverzooming,this._source.minzoom),_=Math.max(f+dh.maxUnderzooming,this._source.minzoom),x={};for(const w of n){const E=this._addTile(w);o[w.key]=w,E.hasData()||h<this._source.maxzoom&&(x[w.key]=w)}this._retainLoadedChildren(x,h,_,o);for(const w of n){let E=this._tiles[w.key];if(E.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const k=w.children(this._source.maxzoom)[0],C=this.getTile(k);if(C&&C.hasData()){o[k.key]=k;continue}}else{const k=w.children(this._source.maxzoom);if(o[k[0].key]&&o[k[1].key]&&o[k[2].key]&&o[k[3].key])continue}let I=E.wasRequested();for(let k=w.overscaledZ-1;k>=m;--k){const C=w.scaledTo(k);if(l[C.key]||(l[C.key]=!0,E=this.getTile(C),!E&&I&&(E=this._addTile(C)),E&&(o[C.key]=C,I=E.wasRequested(),E.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const o=[];let l,h=this._tiles[n].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}o.push(h.key);const f=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(f),l)break;h=f}for(const f of o)this._loadedParentTiles[f]=l}}_addTile(n){let o=this._tiles[n.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),o;o=this._cache.getAndRemove(n),o&&(this._setTileReloadTimer(n.key,o),o.tileID=n,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,o)));const l=!!o;if(!l){const h=this.map?this.map.painter:null;o=new q2(n,this._source.tileSize*n.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,n.key,o.state))}return o?(o.uses++,this._tiles[n.key]=o,l||this._source.fire(new Xo("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(n,o){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const l=o.getExpiryTimeout();l&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},l))}_removeTile(n){const o=this._tiles[n];o&&(o.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,o,l){const h=[],f=this.transform;if(!f)return h;const m=f.projection.name==="globe",_=Ra(f.center.lng);for(const x in this._tiles){const w=this._tiles[x];if(l&&w.clearQueryDebugViz(),w.holdingForFade())continue;let E;if(m){const I=w.tileID.canonical;if(I.z===0){const k=[Math.abs(Ze(_,...ng(I,-1))-_),Math.abs(Ze(_,...ng(I,1))-_)];E=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(Ze(_,...ng(I,-1))-_),Math.abs(Ze(_,...ng(I,0))-_),Math.abs(Ze(_,...ng(I,1))-_)];E=[k.indexOf(Math.min(...k))-1]}}else E=[0];for(const I of E){const k=n.containsTile(w,f,o,I);k&&h.push(k)}}return h}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,o){const l=this.getRenderableIds(n,o).map(f=>this._tiles[f].tileID),h=this.transform.projection.name==="globe";for(const f of l)f.projMatrix=this.transform.calculateProjMatrix(f.toUnwrapped()),f.expandedProjMatrix=h?this.transform.calculateProjMatrix(f.toUnwrapped(),!1,!0):f.projMatrix;return l}sortCoordinatesByDistance(n){const o=n.slice(),l=this.transform._camera.position,h=this.transform._camera.forward(),f={};for(const m of o){const _=1/(1<<m.canonical.z);f[m.key]=((m.canonical.x+.5)*_+m.wrap-l[0])*h[0]+((m.canonical.y+.5)*_-l[1])*h[1]-l[2]*h[2]}return o.sort((m,_)=>f[m.key]-f[_.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(K2(this._source.type))for(const n in this._tiles){const o=this._tiles[n];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=Li.now())return!0}return!1}setFeatureState(n,o,l){this._state.updateState(n=n||"_geojsonTileLayer",o,l)}removeFeatureState(n,o,l){this._state.removeFeatureState(n=n||"_geojsonTileLayer",o,l)}getFeatureState(n,o){return this._state.getState(n=n||"_geojsonTileLayer",o)}setDependencies(n,o,l){const h=this._tiles[n];h&&h.setDependencies(o,l)}reloadTilesForDependencies(n,o){for(const l in this._tiles)this._tiles[l].hasDependency(n,o)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(n,o))}_preloadTiles(n,o){if(!this._sourceLoaded){const _=()=>{this._sourceLoaded&&(this._source.off("data",_),this._preloadTiles(n,o))};return void this._source.on("data",_)}const l=new Map,h=Array.isArray(n)?n:[n],f=this.map.painter.terrain,m=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const _ of h){const x=_.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of x)l.set(w.key,w);this.usedForTerrain&&_.updateElevation(!1)}vn(Array.from(l.values()),(_,x)=>{const w=new q2(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,E=>{this._source.type==="raster-dem"&&w.dem&&this._backfillDEM(w),x(E,w)})},o)}}function PR(r,n){const o=Math.abs(2*r.wrap)-+(r.wrap<0),l=Math.abs(2*n.wrap)-+(n.wrap<0);return r.overscaledZ-n.overscaledZ||l-o||n.canonical.y-r.canonical.y||n.canonical.x-r.canonical.x}function K2(r){return r==="raster"||r==="image"||r==="video"||r==="custom"}function ng(r,n){const o=1<<r.z;return[r.x/o+n,(r.x+1)/o+n]}dh.maxOverzooming=10,dh.maxUnderzooming=3;const e8=Mt([{name:"a_pos_3f",components:3,type:"Float32"}]),t8=Mt([{name:"a_color_3f",components:3,type:"Float32"}]),n8=Mt([{name:"a_color_4f",components:4,type:"Float32"}]),r8=Mt([{name:"a_uv_2f",components:2,type:"Float32"}]),i8=Mt([{name:"a_normal_3f",components:3,type:"Float32"}]),o8=Mt([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),s8=Mt([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function kR(r,n){const o=yv(r.projection,r.zoom,r.width,r.height),l=function(f,m,_,x,w){const E=new On(_.lng-180*Lc,_.lat),I=new On(_.lng+180*Lc,_.lat),k=f.project(E.lng,E.lat),C=f.project(I.lng,I.lat),R=-Math.atan2(C.y-k.y,C.x-k.x),L=Ai.fromLngLat(_);L.y=Ze(L.y,-1+Lc,1-Lc);const N=L.toLngLat(),j=f.project(N.lng,N.lat),Z=Ai.fromLngLat(N);Z.x+=Lc;const X=Z.toLngLat(),J=f.project(X.lng,X.lat),te=RR(J.x-j.x,J.y-j.y,R),re=Ai.fromLngLat(N);re.y+=Lc;const pe=re.toLngLat(),ve=f.project(pe.lng,pe.lat),be=RR(ve.x-j.x,ve.y-j.y,R),Pe=Math.abs(te.x)/Math.abs(be.y),Se=a.m.identity([]);a.m.rotateZ(Se,Se,-R*(1-(w?0:x)));const Fe=a.m.identity([]);return a.m.scale(Fe,Fe,[1,1-(1-Pe)*x,1]),Fe[4]=-be.x/be.y*x,a.m.rotateZ(Fe,Fe,R),a.m.multiply(Fe,Se,Fe),Fe}(r.projection,0,r.center,o,n),h=CR(r);return a.m.scale(l,l,[h,h,1]),l}function CR(r){const n=r.projection,o=yv(r.projection,r.zoom,r.width,r.height),l=MR(n,r.center),h=MR(n,On.convert(n.center));return Math.pow(2,l*o+(1-o)*h)}function yv(r,n,o,l,h=1/0){const f=r.range;if(!f)return 0;const m=Math.min(h,Math.max(o,l)),_=Math.log(m/1024)/Math.LN2;return St(f[0]+_,f[1]+_,n)}const Lc=1/4e4;function MR(r,n){const o=Ze(n.lat,-Pr,Pr),l=new On(n.lng-180*Lc,o),h=new On(n.lng+180*Lc,o),f=r.project(l.lng,o),m=r.project(h.lng,o),_=Ai.fromLngLat(l),x=Ai.fromLngLat(h),w=m.x-f.x,E=m.y-f.y,I=x.x-_.x,k=x.y-_.y,C=Math.sqrt((I*I+k*k)/(w*w+E*E));return Math.log(C)/Math.LN2}function RR(r,n,o){const l=Math.cos(o),h=Math.sin(o);return{x:r*l-n*h,y:r*h+n*l}}function OR(r,n,o){return n*(at/(r.tileSize*Math.pow(2,o-r.tileID.overscaledZ)))}function DR(r,n,o){a.m.identity(r),a.m.rotateZ(r,r,pt(n[2])),a.m.rotateX(r,r,pt(n[0])),a.m.rotateY(r,r,pt(n[1])),a.m.scale(r,r,o),a.m.multiply(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function vv(r,n,o,l,h,f,m,_){const x=[o[0]-n[0],o[1]-n[1],0],w=[l[0]-n[0],l[1]-n[1],0];if(a.v.length(x)<1e-12||a.v.length(w)<1e-12)return a.q.identity(r);const E=a.v.cross([],x,w);a.v.normalize(E,E),a.v.subtract(w,l,n),x[2]=(f-h)*_,w[2]=(m-h)*_;const I=x;return a.v.cross(I,x,w),a.v.normalize(I,I),a.q.rotationTo(r,E,I)}function LR(r,n,o=!1){const l=El(n.zoom),h=function(f,m,_){const x=m.worldSize,w=[f[12],f[13],f[14]],E=wi(w[1]/x),I=zo(w[0]/x),k=a.m.identity([]),C=to(1,E)*x,R=to(1,0)*x*lh(E,m.zoom),L=1/h2(x);let N=R*L;if(_){const J=yv(m.projection,m.zoom,m.width,m.height,1024);N=L*m.projection.pixelSpaceConversion(m.center.lat,x,J)}const j=ah(E,I);a.v.add(j,j,a.v.scale([],a.v.normalize([],j),C*N*w[2]));const Z=function(J){const te=[J[0],J[1],J[2]];let re=[0,1,0];const pe=a.v.cross([],re,te);return a.v.cross(re,te,pe),a.v.squaredLength(re)===0&&(re=[0,1,0],a.v.cross(pe,te,re)),a.v.normalize(pe,pe),a.v.normalize(re,re),a.v.normalize(te,te),[pe[0],pe[1],pe[2],0,re[0],re[1],re[2],0,te[0],te[1],te[2],0,J[0],J[1],J[2],1]}(j);a.m.scale(k,k,[N,N,N*C]),a.m.translate(k,k,[-w[0],-w[1],-w[2]]);const X=a.m.multiply([],m.globeMatrix,Z);return a.m.multiply(X,X,k),a.m.multiply(X,X,f),X}(r,n,o);if(l>0){const f=function(m,_){const x=_.worldSize,w=to(1,0)*x*lh(_.center.lat,_.zoom)/h2(x),E=to(1,_.center.lat)*x,I=a.m.identity([]);return a.m.rotateY(I,I,pt(_.center.lng)),a.m.rotateX(I,I,pt(_.center.lat)),a.m.translate(I,I,[0,0,ss]),a.m.scale(I,I,[w,w,w*E]),a.m.translate(I,I,[_.point.x-.5*x,_.point.y-.5*x,0]),a.m.multiply(I,I,m),a.m.multiply(I,_.globeMatrix,I)}(r,n);return function(m,_,x){const w=(R,L,N)=>{const j=a.v.length(R),Z=a.v.length(L),X=Tl(R,L,N);return a.v.scale(X,X,1/a.v.length(X)*ln(j,Z,N))},E=w([m[0],m[1],m[2]],[_[0],_[1],_[2]],x),I=w([m[4],m[5],m[6]],[_[4],_[5],_[6]],x),k=w([m[8],m[9],m[10]],[_[8],_[9],_[10]],x),C=Tl([m[12],m[13],m[14]],[_[12],_[13],_[14]],x);return[E[0],E[1],E[2],0,I[0],I[1],I[2],0,k[0],k[1],k[2],0,C[0],C[1],C[2],1]}(h,f,l)}return h}const fh=64,xv={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4};function rg(r,n,o=!1){r.uploaded||(r.gfxTexture=new Pl(n,r.image,o?n.gl.R8:n.gl.RGBA,{useMipmap:r.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function a8(r,n,o){r.indexBuffer=n.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=n.createVertexBuffer(r.vertexArray,e8.members,!1,!0),r.normalArray&&(r.normalBuffer=n.createVertexBuffer(r.normalArray,i8.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=n.createVertexBuffer(r.texcoordArray,r8.members,!1,!0)),r.colorArray&&(r.colorBuffer=n.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?t8:n8).members,!1,!0)),r.featureArray&&(r.pbrBuffer=n.createVertexBuffer(r.featureArray,s8.members,!0)),r.segments=mr.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const l=r.material;l.pbrMetallicRoughness.baseColorTexture&&rg(l.pbrMetallicRoughness.baseColorTexture,n),l.pbrMetallicRoughness.metallicRoughnessTexture&&rg(l.pbrMetallicRoughness.metallicRoughnessTexture,n),l.normalTexture&&rg(l.normalTexture,n),l.occlusionTexture&&rg(l.occlusionTexture,n,o),l.emissionTexture&&rg(l.emissionTexture,n)}function J2(r,n,o){if(r.meshes)for(const l of r.meshes)a8(l,n,o);if(r.children)for(const l of r.children)J2(l,n,o)}function bv(r){if(r.meshes)for(const n of r.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(r.children)for(const n of r.children)bv(n)}function wv(r){if(r.meshes)for(const o of r.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((n=o.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(r.children)for(const o of r.children)wv(o)}class zR{constructor(n,o){this.feature=n,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class NR{constructor(){this.instancedDataArray=new Dw,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class FR{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(n,o,l,h){this.tileToMeter=z0(l);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:_,index:x,sourceLayerIndex:w}of n){const E=Ac(m,f);if(!this.layers[0]._featureFilter.filter(new de(this.zoom),E,l))continue;const I={id:_,sourceLayerIndex:w,index:x,geometry:f?E.geometry:Da(m,l,h),properties:m.properties,type:m.type,patterns:{}},k=this.addFeature(I,I.geometry,E);k&&o.featureIndex.insert(m,I.geometry,x,w,this.index,this.instancesPerModel[k].instancedDataArray.length)}this.lookup=null}update(n,o,l,h){for(const f in this.instancesPerModel){const m=this.instancesPerModel[f];for(const _ in n)m.idToFeaturesIndex.hasOwnProperty(_)&&this.evaluate(m.features[m.idToFeaturesIndex[_]],n[_],m,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const o in this.instancesPerModel){const l=this.instancesPerModel[o];for(const h of l.features){const f=this.layers[0],m=h.feature,_=this.canonical,x=f.paint.get("model-rotation").evaluate(m,{},_),w=f.paint.get("model-scale").evaluate(m,{},_),E=f.paint.get("model-translation").evaluate(m,{},_);a.v.exactEquals(h.rotation,x)&&a.v.exactEquals(h.scale,w)&&a.v.exactEquals(h.translation,E)||(this.evaluate(h,h.featureStates,l,!0),n=!0)}}return n}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const o in this.instancesPerModel){const l=this.instancesPerModel[o];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=n.createVertexBuffer(l.instancedDataArray,o8.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const n in this.instancesPerModel){const o=this.instancesPerModel[n];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}}addFeature(n,o,l){const h=this.layers[0],f=h.layout.get("model-id").evaluate(l,{},this.canonical);if(!f)return pr(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),f;this.instancesPerModel[f]||(this.instancesPerModel[f]=new NR);const m=this.instancesPerModel[f],_=m.instancedDataArray,x=new zR(l,_.length);for(const w of o)for(const E of w){if(E.x<0||E.x>=at||E.y<0||E.y>=at)continue;const I=(this.lookupDim-1)/at,k=this.lookupDim*(E.y*I|0)+E.x*I|0;if(this.lookup){if(this.lookup[k]!==0)continue;this.lookup[k]=1}this.instanceCount++;const C=_.length;_.resize(C+1),m.instancesEvaluatedElevation.push(0),_.float32[16*C]=E.x,_.float32[16*C+1]=E.y}return x.instancedDataCount=m.instancedDataArray.length-x.instancedDataOffset,x.instancedDataCount>0&&(n.id&&(m.idToFeaturesIndex[n.id]=m.features.length),m.features.push(x),this.evaluate(x,{},m,!1)),f}evaluate(n,o,l,h){const f=this.layers[0],m=n.feature,_=this.canonical,x=n.rotation=f.paint.get("model-rotation").evaluate(m,o,_),w=n.scale=f.paint.get("model-scale").evaluate(m,o,_),E=n.translation=f.paint.get("model-translation").evaluate(m,o,_),I=f.paint.get("model-color").evaluate(m,o,_);I.a=f.paint.get("model-color-mix-intensity").evaluate(m,o,_);const k=[];this.maxVerticalOffset<E[2]&&(this.maxVerticalOffset=E[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),DR(k,x,w);const C=Math.round(100*I.a)+I.b/1.05;for(let R=0;R<n.instancedDataCount;++R){const L=n.instancedDataOffset+R,N=16*L,j=l.instancedDataArray.float32;let Z=0;h&&(Z=j[N+6]-l.instancesEvaluatedElevation[L]);const X=0|j[N+1];j[N]=(0|j[N])+I.r/1.05,j[N+1]=X+I.g/1.05,j[N+2]=C,j[N+3]=1/(_.z>10?this.tileToMeter:z0(_,X)),j[N+4]=E[0],j[N+5]=E[1],j[N+6]=E[2]+Z,j[N+7]=k[0],j[N+8]=k[1],j[N+9]=k[2],j[N+10]=k[4],j[N+11]=k[5],j[N+12]=k[6],j[N+13]=k[8],j[N+14]=k[9],j[N+15]=k[10],l.instancesEvaluatedElevation[L]=E[2]}}}xt(FR,"ModelBucket",{omit:["layers"]}),xt(NR,"PerModelAttributes"),xt(zR,"ModelFeature");const l8=new $e({visibility:new ne(Ie.layout_model.visibility),"model-id":new Te(Ie.layout_model["model-id"])});var c8={paint:new $e({"model-opacity":new ne(Ie.paint_model["model-opacity"]),"model-rotation":new Te(Ie.paint_model["model-rotation"]),"model-scale":new Te(Ie.paint_model["model-scale"]),"model-translation":new Te(Ie.paint_model["model-translation"]),"model-color":new Te(Ie.paint_model["model-color"]),"model-color-mix-intensity":new Te(Ie.paint_model["model-color-mix-intensity"]),"model-type":new ne(Ie.paint_model["model-type"]),"model-cast-shadows":new ne(Ie.paint_model["model-cast-shadows"]),"model-receive-shadows":new ne(Ie.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ne(Ie.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Te(Ie.paint_model["model-emissive-strength"]),"model-roughness":new Te(Ie.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Te(Ie.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ne(Ie.paint_model["model-cutoff-fade-range"])}),layout:l8};const Q2=new Float32Array(262144),ph=new Uint8Array(262144);function BR(r){let n=0;if(r.meshes)for(const o of r.meshes)n=Math.max(n,o.aabb.max[2]);if(r.children)for(const o of r.children)n=Math.max(n,BR(o));return n}const jR=["","wall","door","roof","window","lamp","logo"];class VR{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:n.id,geometry:[],properties:{height:BR(n)}}}}class UR{constructor(n,o,l,h){this.nodes=n,this.id=o,this.modelTraits|=xv.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,l&&(this.modelTraits|=xv.HasMapboxMeshFeatures),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const l of o){const h=l.node;this.uploaded?this.updatePbrBuffer(h):J2(h,n,!0)}for(const l of o)bv(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let o=!1;if(!n.meshes)return o;for(const l of n.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),o=!0);return o}needsReEvaluation(n,o,l){const h=n.transform.projectionOptions,f=n.style.getBrightness(),m=this.brightness!==f;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||ig(l.paint.get("model-color").value,m)||ig(l.paint.get("model-color-mix-intensity").value,m)||ig(l.paint.get("model-roughness").value,m)||ig(l.paint.get("model-emissive-strength").value,m)||ig(l.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=h,this.brightness=f,!0)}evaluateScale(n,o){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const l=this.getNodesInfo(),h=this.id.canonical;for(const f of l){const m=f.feature;f.evaluatedScale=o.paint.get("model-scale").evaluate(m,{},h)}}evaluate(n){const o=this.getNodesInfo();for(const l of o){if(!l.node.meshes)continue;const h=l.feature,f=l.node.meshes&&l.node.meshes[0].featureData,m=l.evaluatedColor[2],_=l.evaluatedRMEA[2],x=this.id.canonical;if(l.hasTranslucentParts=!1,f){for(let w=0;w<jR.length;w++){const E=jR[w];E.length&&(h.properties.part=E);const I=n.paint.get("model-color").evaluate(h,{},x),k=n.paint.get("model-color-mix-intensity").evaluate(h,{},x);l.evaluatedColor[w]=[I.r,I.g,I.b,k],l.evaluatedRMEA[w][0]=n.paint.get("model-roughness").evaluate(h,{},x),l.evaluatedRMEA[w][2]=n.paint.get("model-emissive-strength").evaluate(h,{},x),l.evaluatedRMEA[w][3]=I.a,l.emissionHeightBasedParams[w]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},x),!l.hasTranslucentParts&&I.a<1&&(l.hasTranslucentParts=!0)}delete h.properties.part,h8(l,m!==l.evaluatedColor[2]||_!==l.evaluatedRMEA[2])}else l.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(h,{},x);l.evaluatedScale=n.paint.get("model-scale").evaluate(h,{},x),this.updatePbrBuffer(l.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,o,l,h){const f=n.findDEMTileFor(l);if(f&&(f.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const m=Qd.create(n,l,f);if(!m)return;this.modelTraits&xv.HasMapboxMeshFeatures&&this.updateDEM(n,m,l,h);for(const _ of this.getNodesInfo()){const x=_.node;if(!x.footprint||!x.footprint.vertices||!x.footprint.vertices.length)continue;const w=x.footprint.vertices;let E=m.getElevationAt(w[0].x,w[0].y,!0,!0);for(let I=1;I<w.length;I++)E=Math.min(E,m.getElevationAt(w[I].x,w[I].y,!0,!0));x.elevation=E}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=o}}updateDEM(n,o,l,h){let f=o._dem._modifiedForSources[h];if(f===void 0&&(o._dem._modifiedForSources[h]=[],f=o._dem._modifiedForSources[h]),f.includes(l.canonical))return;const m=o._dem.dim;f.push(l.canonical);let _=!1;for(const x of this.getNodesInfo()){const w=x.node;if(!w.footprint||!w.footprint.grid)continue;const E=w.footprint.grid,I=o.tileCoordToPixel(E.min.x,E.min.y),k=o.tileCoordToPixel(E.max.x,E.max.y),C=Math.min(Math.min(m-k.y,I.x),Math.min(I.y,m-k.x));if(C<0)continue;const R=Ze(C,2,5);let L=Math.max(0,I.x-R),N=Math.max(0,I.y-R),j=Math.min(k.x+R,m-1),Z=Math.min(k.y+R,m-1);for(let re=N;re<=Z;++re)for(let pe=L;pe<=j;++pe)ph[re*m+pe]=255;let X=0,J=0;for(let re=0;re<E.cellsY;++re)for(let pe=0;pe<E.cellsX;++pe){if(!E.cells[re*E.cellsX+pe])continue;const ve=o.tileCoordToPixel(E.min.x+pe/E.xScale,E.min.y+re/E.yScale),be=o.tileCoordToPixel(E.min.x+(pe+1)/E.xScale,E.min.y+(re+1)/E.yScale);for(let Pe=ve.y;Pe<=Math.min(be.y+1,m-1);++Pe)for(let Se=ve.x;Se<=Math.min(be.x+1,m-1);++Se)ph[Pe*m+Se]===255&&(ph[Pe*m+Se]=0,X+=o.getElevationAtPixel(Se,Pe),J++)}const te=X/J;L=Math.max(1,I.x-R),N=Math.max(1,I.y-R),j=Math.min(k.x+R,m-2),Z=Math.min(k.y+R,m-2),_=!0;for(let re=N;re<=Z;++re)for(let pe=L;pe<=j;++pe)ph[re*m+pe]===0&&(Q2[re*m+pe]=o._dem.set(pe,re,te));for(let re=1;re<R;++re){L=Math.max(1,I.x-re),N=Math.max(1,I.y-re),j=Math.min(k.x+re,m-2),Z=Math.min(k.y+re,m-2);for(let pe=N;pe<=Z;++pe)for(let ve=L;ve<=j;++ve){const be=pe*m+ve;if(ph[be]===255){let Pe=0,Se=0,Fe=-1,Qe=-1;for(let Le=-1;Le<=1;++Le)for(let He=-1;He<=1;++He){const De=(pe+Le)*m+ve+He;if(ph[De]>=re)continue;const ut=Q2[De],yt=Math.abs(ut);yt>Se&&(Pe=ut,Se=yt,Fe=He,Qe=Le)}if(Se>.1){const Le=1-(re+.5*Math.abs(Fe*Qe))/R;let He=o._dem.get(ve,pe)+Pe*Le;const De=o._dem.get(ve+Fe,pe+Qe),ut=o._dem.get(ve-Fe,pe-Qe,!0);(He-De)*(He-ut)>0&&(He=(De+ut)/2),Q2[be]=o._dem.set(ve,pe,He),ph[be]=re}}}}}_&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=Li.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const n of this.nodes)this.nodesInfo.push(new VR(n));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const n of this.nodes)wv(n);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const n=this.getNodesInfo();for(const o of n)bv(o.node),wv(o.node)}isEmpty(){return!this.nodes.length}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const l=o.getReplacementRegionsForTile(n.toUnwrapped()),h=this.getNodesInfo();for(let f=0;f<this.nodesInfo.length;f++){const m=h[f].node;h[f].hiddenByReplacement=!!m.footprint&&!l.find(_=>_.footprint===m.footprint)}}getHeightAtTileCoord(n,o){const l=this.getNodesInfo(),h=[];for(let f=0;f<this.nodesInfo.length;f++){const m=l[f],_=m.node.meshes[0];if(n<_.aabb.min[0]||o<_.aabb.min[1]||n>_.aabb.max[0]||o>_.aabb.max[1])continue;const x=(n-_.aabb.min[0])/(_.aabb.max[0]-_.aabb.min[0])*fh|0,w=Math.min(63,(o-_.aabb.min[1])/(_.aabb.max[1]-_.aabb.min[1])*fh|0)*fh+Math.min(63,x);if(!(_.heightmap[w]<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:_.heightmap[w],maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new Oe(n,o),new Oe(n,o),h),h.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function ig(r,n){return!r.isLightConstant&&n}function u8(r,n,o,l,h,f,m,_){let x=(61440&n|(61440&n)>>4)>>8,w=(3840&n|(3840&n)>>4)>>4,E=240&n|(240&n)>>4;o[3]>0&&(x=ln(x,255*o[0],o[3]),w=ln(w,255*o[1],o[3]),E=ln(E,255*o[2],o[3]));const I=x<<8|w,k=E<<8|Math.floor(255*l[3]),C=function(re){const pe=Ze(re,0,2);return Math.min(Math.round(.5*pe*255),255)}(l[2])<<8|15*l[0]<<4|15*l[1],R=Ze(h[0],0,1),L=Ze(h[1],0,1),N=Ze(h[2],0,1),j=Ze(h[3],0,1);let Z,X,J,te;if(R!==L&&m!==f&&L!==R){const re=m-f;X=1/(re*(L-R)),J=-(f+re*R)/(re*(L-R));const pe=Ze(h[4],-1,1);te=Math.pow(10,pe),Z=255*N<<8|255*j}else Z=65535,X=0,J=1,te=1;if(r.emplaceBack(I,k,C,Z,X,J,te),_){const re=_.length;_.clear();for(let pe=0;pe<re;pe++)_.emplaceBack(I,k,C,Z,X,J,te)}}function h8(r,n){const o=r.node;let l=0;for(const h of o.meshes){if(o.lights&&o.lightMeshIndex===l||!h.featureData)continue;h.featureArray=new S0,h.featureArray.reserve(h.featureData.length);let f=n;for(const m of h.featureData){let _;const x=65535&m,w=(15&x)<8?15&x:0,E=m>>16&65535,I=r.evaluatedRMEA[w],k=r.evaluatedColor[w],C=r.emissionHeightBasedParams[w];if(f&&w===2&&o.lights&&(_=new S0,_.resize(10*o.lights.length)),u8(h.featureArray,E,k,I,C,h.aabb.min[2],h.aabb.max[2],_),_&&f){f=!1;const R=o.meshes[o.lightMeshIndex];R.featureArray=_,R.featureArray._trim()}}h.featureArray._trim(),l++}}function Tv(r,n){return r.x-n.x||r.y-n.y}function $R(r,n){return Tv(r.min,n.min)===0&&Tv(r.max,n.max)===0}function GR(r,n){return!(r.min.x>n.max.x||r.max.x<n.min.x||r.min.y>n.max.y||r.max.y<n.min.y)}function WR(r,n,o){const l=1/at,h=1/(1<<o.canonical.z),f=(n.x*l+o.canonical.x)*h+o.wrap,m=(n.y*l+o.canonical.y)*h;return{min:new Oe((r.x*l+o.canonical.x)*h+o.wrap,(r.y*l+o.canonical.y)*h),max:new Oe(f,m)}}function d8(r,n,o){const l=1<<o.canonical.z,h=((n.x-o.wrap)*l-o.canonical.x)*at,f=(n.y*l-o.canonical.y)*at;return{min:new Oe(((r.x-o.wrap)*l-o.canonical.x)*at,(r.y*l-o.canonical.y)*at),max:new Oe(h,f)}}function qR(r,n,o,l,h,f,m){const _=r.indices,x=r.vertices,w=[];for(let E=l;E<l+h;E+=3){const I=n[o[E+0]+f],k=n[o[E+1]+f],C=n[o[E+2]+f],R=Math.min(I.x,k.x,C.x),L=Math.max(I.x,k.x,C.x),N=Math.min(I.y,k.y,C.y),j=Math.max(I.y,k.y,C.y);w.length=0,r.grid.query(new Oe(R,N),new Oe(L,j),w);for(let Z=0;Z<w.length;Z++){const X=w[Z];if(b2(x[_[3*X+0]],x[_[3*X+1]],x[_[3*X+2]],I,k,C,m))return!0}}return!1}function HR(r,n,o,l){if(!r||!o)return!1;let h=r.vertices;if(!n.canonical.equals(l.canonical)||n.wrap!==l.wrap){if(o.vertices.length<r.vertices.length)return HR(o,l,r,n);const f=n.canonical,m=l.canonical,_=Math.pow(2,m.z-f.z);h=r.vertices.map(x=>new Oe(x.x*f.x*at*_-m.x*at,x.y*f.y*at*_-m.y*at))}return qR(o,h,r.indices,0,r.indices.length,0,0)}xt(UR,"Tiled3dModelBucket",{omit:["layers"]}),xt(VR,"Tiled3dModelFeature");const f8=Z0.types,p8=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],m8=["fill-extrusion-flood-light-ground-radius"],g8=Math.pow(2,13),_8=Math.pow(2,15)-1,ZR=new Oe(0,1),zc=2147483648;function og(r,n,o,l,h,f,m,_){r.emplaceBack((n<<1)+m,(o<<1)+f,(Math.floor(l*g8)<<1)+h,Math.round(_))}function Ev(r,n,o,l,h,f){r.emplaceBack(n.x,n.y,(o.x<<1)+l,(o.y<<1)+h,f)}function sg(r,n,o){r.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class XR{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class YR{constructor(){this.centroidXY=new Oe(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Oe(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Oe(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Oe(this.max.x-this.min.x,this.max.y-this.min.y)}}class KR{constructor(){this.acc=new Oe(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,o){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=o.x,n.min.y=n.max.y=o.y)}appendEdge(n,o,l){this.accCount++,this.acc._add(o);let h=!!this.borders;o.x<n.min.x?(n.min.x=o.x,h=!0):o.x>n.max.x&&(n.max.x=o.x,h=!0),o.y<n.min.y?(n.min.y=o.y,h=!0):o.y>n.max.y&&(n.max.y=o.y,h=!0),((o.x===0||o.x===at)&&o.x===l.x)!=((o.y===0||o.y===at)&&o.y===l.y)&&this.processBorderOverlap(o,l),h&&this.checkBorderIntersection(o,l)}checkBorderIntersection(n,o){o.x<0!=n.x<0&&this.addBorderIntersection(0,ln(o.y,n.y,(0-o.x)/(n.x-o.x))),o.x>at!=n.x>at&&this.addBorderIntersection(1,ln(o.y,n.y,(at-o.x)/(n.x-o.x))),o.y<0!=n.y<0&&this.addBorderIntersection(2,ln(o.x,n.x,(0-o.y)/(n.y-o.y))),o.y>at!=n.y>at&&this.addBorderIntersection(3,ln(o.x,n.x,(at-o.y)/(n.y-o.y)))}addBorderIntersection(n,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[n];o<l[0]&&(l[0]=o),o>l[1]&&(l[1]=o)}processBorderOverlap(n,o){if(n.x===o.x){if(n.y===o.y)return;const l=n.x===0?0:1;this.addBorderIntersection(l,o.y),this.addBorderIntersection(l,n.y)}else{const l=n.y===0?2:3;this.addBorderIntersection(l,o.x),this.addBorderIntersection(l,n.x)}}centroid(){return this.accCount===0?new Oe(0,0):new Oe(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,o)=>n+ +(o[0]!==Number.MAX_VALUE),0):0}}function JR(r,n){const o=r.add(n)._unit(),l=Ze(r.x*o.x+r.y*o.y,-1,1);var h,f,m;return h=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(h)))/4*_8*((f=r).x*(m=n).y-f.y*m.x<0?-1:1)}const y8=[r=>r.x<0,r=>r.x>at,r=>r.y<0,r=>r.y>at];function v8(r,n,o,l){const h=[4];if(l===0)return h;o._mult(l);const f=r.sub(o),m=n.sub(o),_=[r,n,f,m];for(let x=0;x<4;x++)for(const w of _)if(y8[x](w)){h.push(x);break}return h}class QR{constructor(n){this.vertexArray=new Bi,this.indexArray=new Bn,this.programConfigurations=new Tc(n.layers,n.zoom,o=>m8.includes(o)),this._segments=new mr,this.hiddenByLandmarkVertexArray=new Lw,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new mr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,o,l,h=!1){const f=n.length;if(f>2){let m=Math.max(0,this._segments.get().length-1);const _=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let x;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const w=n[0],E=n[1];x=JR(w.sub(n[f-1])._perp()._unit(),E.sub(w)._perp()._unit())}for(let w=0;w<f;w++){const E=w===f-1?0:w+1,I=n[w],k=n[E],C=n[E===f-1?0:E+1],R=k.sub(I)._perp()._unit(),L=JR(R,C.sub(k)._perp()._unit()),N=x,j=L;if(eT(I,k,o)||h&&nO(I,o)&&nO(k,o)){x=L;continue}const Z=_.vertexLength;Ev(this.vertexArray,I,k,1,1,N),Ev(this.vertexArray,I,k,1,0,N),Ev(this.vertexArray,I,k,0,1,j),Ev(this.vertexArray,I,k,0,0,j),_.vertexLength+=4;const X=v8(I,k,R,l);for(const J of X)this._segmentToGroundQuads[m].push({id:Z,region:J}),this._segmentToRegionTriCounts[m][J]+=2,_.primitiveLength+=2;x=L}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),o=n.length;for(let l=0;l<o;l++)this._segmentToGroundQuads[l].sort((h,f)=>h.region-f.region);for(let l=0;l<o;l++){const h=this._segmentToGroundQuads[l],f=n[l],m=this._segmentToRegionTriCounts[l];m.reduce((x,w)=>x+w,0);let _=0;for(let x=0;x<=4;x++){const w=m[x];if(w!==0){let E=this.regionSegments[x];E||(E=this.regionSegments[x]=new mr);const I={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+_,vertexLength:f.vertexLength,primitiveLength:w};E.get().push(I)}_+=w}for(let x=0;x<h.length;x++){const w=h[x].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,o,l,h,f,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,o,l,h,f,m)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,DV.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,o,l,h,f,m){this.hasData()&&this.programConfigurations.updatePaintArrays(n,o,l,h,f,m)}updateHiddenByLandmark(n){if(!this.hasData())return;const o=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const l=n.flags&zc?1:0;for(let h=n.groundVertexArrayOffset;h<o;++h)this.hiddenByLandmarkVertexArray.emplace(h,l);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,zV.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const o=this.regionSegments[n];o&&o.destroy()}}}}class ag{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Bn,this.footprintVertices=new Qt,this.footprintSegments=[],this.layoutVertexArray=new Nn,this.centroidVertexArray=new Ek,this.indexArray=new Bn,this.programConfigurations=new Tc(n.layers,n.zoom,o=>p8.includes(o)),this.segments=new mr,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new QR(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(n,o,l,h){this.features=[],this.hasPattern=P2("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=z0(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:m,index:_,sourceLayerIndex:x}of n){const w=this.layers[0]._featureFilter.needGeometry,E=Ac(f,w);if(!this.layers[0]._featureFilter.filter(new de(this.zoom),E,l))continue;const I={id:m,sourceLayerIndex:x,index:_,geometry:w?E.geometry:Da(f,l,h),properties:f.properties,type:f.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(k2("fill-extrusion",this.layers,I,this.zoom,o)):this.addFeature(I,I.geometry,_,l,{},o.availableImages,h,o.brightness),o.featureIndex.insert(f,I.geometry,_,x,this.index,k)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,o,l,h,f,m){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,o,l,h,f,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,o,l,h,f){const m=Object.keys(n).length!==0;if(m&&!this.stateDependentLayers.length)return;const _=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(n,o,_,l,h,f),this.groundEffect.update(n,o,_,l,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,FV),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,NV.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,LV.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,l,h,f,m,_,x){const w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,E=[new Oe(0,0),new Oe(at,at)],I=_.projection,k=I.name==="globe",C=f8[n.type]==="Polygon",R=new KR;R.centroidDataIndex=this.centroidData.length;const L=new YR,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},h)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},h);L.height=j,L.vertexArrayOffset=this.layoutVertexArray.length,L.groundVertexArrayOffset=this.groundEffect.vertexArray.length,k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ar);const Z=A2(o,500);for(let ve=Z.length-1;ve>=0;ve--){const be=Z[ve];(be.length===0||(X=be[0]).every(Pe=>Pe.x<=0)||X.every(Pe=>Pe.x>=at)||X.every(Pe=>Pe.y<=0)||X.every(Pe=>Pe.y>=at))&&Z.splice(ve,1)}var X;let J;if(k)J=sO(Z,E,h);else{J=[];for(const ve of Z)J.push({polygon:ve,bounds:E})}const te=C?this.edgeRadius:0,re=te>0&&this.zoom<17,pe=(ve,be)=>{if(ve.length===0)return!1;const Pe=ve[ve.length-1];return be.x===Pe.x&&be.y===Pe.y};for(const{polygon:ve,bounds:be}of J){let Pe=0,Se=0;for(const He of ve)C&&!He[0].equals(He[He.length-1])&&He.push(He[0]),Se+=C?He.length-1:He.length;const Fe=this.segments.prepareSegment((C?5:4)*Se,this.layoutVertexArray,this.indexArray);L.footprintSegIdx<0&&(L.footprintSegIdx=this.footprintSegments.length),L.polygonSegIdx<0&&(L.polygonSegIdx=this.polygonSegments.length);const Qe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Le=new XR;if(Le.vertexOffset=this.footprintVertices.length,Le.indexOffset=3*this.footprintIndices.length,Le.ringIndices=[],C){const He=[],De=[];Pe=Fe.vertexLength;for(let yt=0;yt<ve.length;yt++){const Ke=ve[yt];Ke.length&&yt!==0&&De.push(He.length/2);const Vt=[];let wt,ct;wt=Ke[1].sub(Ke[0])._perp()._unit(),Le.ringIndices.push(Ke.length-1);for(let Ut=1;Ut<Ke.length;Ut++){const Rt=Ke[Ut],Nt=Ke[Ut===Ke.length-1?1:Ut+1],it=Rt.clone();if(te){ct=Nt.sub(Rt)._perp()._unit();const Xt=wt.add(ct)._unit(),gn=te*Math.min(4,1/(wt.x*Xt.x+wt.y*Xt.y));it.x+=gn*Xt.x,it.y+=gn*Xt.y,it.x=Math.round(it.x),it.y=Math.round(it.y),wt=ct}!N||te!==0&&!re||pe(Vt,it)||Vt.push(it),og(this.layoutVertexArray,it.x,it.y,0,0,1,1,0),Fe.vertexLength++,this.footprintVertices.emplaceBack(Rt.x,Rt.y),He.push(Rt.x,Rt.y),k&&sg(this.layoutVertexExtArray,I.projectTilePoint(it.x,it.y,h),I.upVector(h,it.x,it.y))}N&&(te===0||re)&&(Vt.length!==0&&pe(Vt,Vt[0])&&Vt.pop(),this.groundEffect.addData(Vt,be,w))}const ut=W0(He,De);for(let yt=0;yt<ut.length;yt+=3)this.footprintIndices.emplaceBack(Le.vertexOffset+ut[yt+0],Le.vertexOffset+ut[yt+1],Le.vertexOffset+ut[yt+2]),this.indexArray.emplaceBack(Pe+ut[yt],Pe+ut[yt+2],Pe+ut[yt+1]),Fe.primitiveLength++;Le.indexCount+=ut.length,Le.vertexCount+=this.footprintVertices.length-Le.vertexOffset}for(let He=0;He<ve.length;He++){const De=ve[He];R.startRing(L,De[0]);let ut=De.length>4&&rO(De[De.length-2],De[0],De[1]),yt=te?x8(De[De.length-2],De[0],De[1],te):0;const Ke=[];let Vt,wt,ct;wt=De[1].sub(De[0])._perp()._unit();let Ut=!0;for(let Rt=1,Nt=0;Rt<De.length;Rt++){let it=De[Rt-1],Xt=De[Rt];const gn=De[Rt===De.length-1?1:Rt+1];if(R.appendEdge(L,Xt,it),eT(Xt,it,be)){te&&(wt=gn.sub(Xt)._perp()._unit(),Ut=!Ut);continue}const en=Xt.sub(it)._perp(),un=en.x/(Math.abs(en.x)+Math.abs(en.y)),In=en.y>0?1:0,Zn=it.dist(Xt);if(Nt+Zn>32768&&(Nt=0),te){ct=gn.sub(Xt)._perp()._unit();let Dn=tO(it,Xt,gn,eO(wt,ct),te);isNaN(Dn)&&(Dn=0);const Fn=Xt.sub(it)._unit();it=it.add(Fn.mult(yt))._round(),Xt=Xt.add(Fn.mult(-Dn))._round(),yt=Dn,wt=ct,N&&this.zoom>=17&&(pe(Ke,it)||Ke.push(it),pe(Ke,Xt)||Ke.push(Xt))}const on=Fe.vertexLength,cr=De.length>4&&rO(it,Xt,gn);let Xn=iO(Nt,ut,Ut);if(og(this.layoutVertexArray,it.x,it.y,un,In,0,0,Xn),og(this.layoutVertexArray,it.x,it.y,un,In,0,1,Xn),Nt+=Zn,Xn=iO(Nt,cr,!Ut),ut=cr,og(this.layoutVertexArray,Xt.x,Xt.y,un,In,0,0,Xn),og(this.layoutVertexArray,Xt.x,Xt.y,un,In,0,1,Xn),Fe.vertexLength+=4,this.indexArray.emplaceBack(on+0,on+1,on+2),this.indexArray.emplaceBack(on+1,on+3,on+2),Fe.primitiveLength+=2,te){const Dn=Pe+(Rt===1?De.length-2:Rt-2),Fn=Rt===1?Pe:Dn+1;if(this.indexArray.emplaceBack(on+1,Dn,on+3),this.indexArray.emplaceBack(Dn,Fn,on+3),Fe.primitiveLength+=2,Vt===void 0&&(Vt=on),!eT(gn,De[Rt],be)){const An=Rt===De.length-1?Vt:Fe.vertexLength;this.indexArray.emplaceBack(on+2,on+3,An),this.indexArray.emplaceBack(on+3,An+1,An),this.indexArray.emplaceBack(on+3,Fn,An+1),Fe.primitiveLength+=3}Ut=!Ut}if(k){const Dn=this.layoutVertexExtArray,Fn=I.projectTilePoint(it.x,it.y,h),An=I.projectTilePoint(Xt.x,Xt.y,h),Tr=I.upVector(h,it.x,it.y),ur=I.upVector(h,Xt.x,Xt.y);sg(Dn,Fn,Tr),sg(Dn,Fn,Tr),sg(Dn,An,ur),sg(Dn,An,ur)}}C&&(Pe+=De.length-1),N&&te&&this.zoom>=17&&(Ke.length!==0&&pe(Ke,Ke[0])&&Ke.pop(),this.groundEffect.addData(Ke,be,w,te>0))}this.footprintSegments.push(Le),Qe.triangleCount=this.indexArray.length-Qe.triangleArrayOffset,this.polygonSegments.push(Qe),++L.footprintSegLen,++L.polygonSegLen}if(L.vertexCount=this.layoutVertexArray.length-L.vertexArrayOffset,L.groundVertexCount=this.groundEffect.vertexArray.length-L.groundVertexArrayOffset,L.vertexCount!==0){if(L.centroidXY=R.borders?ZR:this.encodeCentroid(R,L),this.centroidData.push(L),R.borders){this.featuresOnBorder.push(R);const ve=this.featuresOnBorder.length-1;for(let be=0;be<R.borders.length;be++)R.borders[be][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[be].push(ve)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,f,m,h,x),this.groundEffect.addPaintPropertiesData(n,l,f,m,h,x),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((o,l)=>this.featuresOnBorder[o].borders[n][0]-this.featuresOnBorder[l].borders[n][0])}splitToSubtiles(){const n=[];for(let _=0;_<this.centroidData.length;_++){const x=this.centroidData[_],w=+(x.min.y+x.max.y>at),E=2*w+(+(x.min.x+x.max.x>at)^w);for(let I=0;I<x.polygonSegLen;I++){const k=x.polygonSegIdx+I;n.push({centroidIdx:_,subtile:E,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const o=new Bn;n.sort((_,x)=>_.triangleSegmentIdx===x.triangleSegmentIdx?_.subtile-x.subtile:_.triangleSegmentIdx-x.triangleSegmentIdx);let l=0,h=0,f=0;for(const _ of n){if(_.triangleSegmentIdx!==l)break;f++}const m=n.length;for(;h!==n.length;){l=n[h].triangleSegmentIdx;let _=0,x=h,w=h;for(let E=x;E<f&&n[E].subtile===_;E++)w++;for(;x!==f;){const E=n[x];_=E.subtile;const I=this.centroidData[E.centroidIdx].min.clone(),k=this.centroidData[E.centroidIdx].max.clone(),C={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=x;R<w;R++){const L=n[R],N=this.polygonSegments[L.polygonSegmentIdx],j=this.centroidData[L.centroidIdx].min,Z=this.centroidData[L.centroidIdx].max,X=this.indexArray.uint16;for(let J=N.triangleArrayOffset;J<N.triangleArrayOffset+N.triangleCount;J++)o.emplaceBack(X[3*J],X[3*J+1],X[3*J+2]);C.primitiveLength+=N.triangleCount,I.x=Math.min(I.x,j.x),I.y=Math.min(I.y,j.y),k.x=Math.max(k.x,Z.x),k.y=Math.max(k.y,Z.y)}C.primitiveLength>0&&this.triangleSubSegments.push({segment:C,min:I,max:k}),x=w;for(let R=x;R<f&&n[R].subtile===n[x].subtile;R++)w++}h=f;for(let E=h;E<m&&n[E].triangleSegmentIdx===n[h].triangleSegmentIdx;E++)f++}o._trim(),this.indexArray=o}getVisibleSegments(n,o,l){let h=0,f=0;const m=1<<n.canonical.z;if(o){const L=o.getMinMaxForTile(n);L&&(h=L.min,f=L.max)}f+=this.maxHeight;const _=n.toUnwrapped();let x;const w=[_.canonical.x/m+_.wrap,_.canonical.y/m],E=[(_.canonical.x+1)/m+_.wrap,(_.canonical.y+1)/m],I=new mr,k=(L,N,j)=>[L[0]*(1-j[0])+N[0]*j[0],L[1]*(1-j[1])+N[1]*j[1]],C=[],R=[];for(const L of this.triangleSubSegments){C[0]=L.min.x/at,C[1]=L.min.y/at,R[0]=L.max.x/at,R[1]=L.max.y/at;const N=k(w,E,C),j=k(w,E,R);if(new Dr([N[0],N[1],h],[j[0],j[1],f]).intersectsPrecise(l)===0){x&&(I.segments.push(x),x=void 0);continue}const Z=L.segment;x&&x.vertexOffset!==Z.vertexOffset&&(I.segments.push(x),x=void 0),x?(x.vertexLength+=Z.vertexLength,x.primitiveLength+=Z.primitiveLength):x={vertexOffset:Z.vertexOffset,primitiveLength:Z.primitiveLength,vertexLength:Z.vertexLength,primitiveOffset:Z.primitiveOffset,sortKey:void 0,vaos:{}}}return x&&I.segments.push(x),I}encodeCentroid(n,o){const l=n.centroid(),h=o.span(),f=Math.min(7,Math.round(h.x*this.tileToMeter/10)),m=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Oe(Ze(l.x,1,at-1)<<3|f,Ze(l.y,1,at-1)<<3|m)}encodeBorderCentroid(n){if(!n.borders)return new Oe(0,0);const o=n.borders,l=Number.MAX_VALUE;if(o[0][0]!==l||o[1][0]!==l){const h=o[0][0]!==l?0:1;return new Oe(6|(o[0][0]!==l?0:65528),((o[h][0]+o[h][1])/2|0)<<3|6)}{const h=o[2][0]!==l?2:3;return new Oe(((o[h][0]+o[h][1])/2|0)<<3|6,6|(o[2][0]!==l?0:65528))}}showCentroid(n){const o=this.centroidData[n.centroidDataIndex];o.flags&=zc,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const o=n.vertexArrayOffset,l=n.vertexCount+n.vertexArrayOffset,h=n.flags&zc?ZR:n.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==h.y||f!==h.x){for(let m=o;m<l;++m)this.centroidVertexArray.emplace(m,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const l=o.getReplacementRegionsForTile(n.toUnwrapped());if(function(f,m){if(f.length!==m.length)return!1;for(let _=0;_<f.length;_++)if(f[_].sourceId!==m[_].sourceId||!$R(f[_],m[_]))return!1;return!0}(this.activeReplacements,l))return;if(this.activeReplacements=l,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const h=[];for(const f of this.activeReplacements){const m=Math.pow(2,f.footprintTileId.canonical.z-n.canonical.z);for(const _ of this.centroidData)if(!(_.flags&zc||f.min.x>_.max.x||_.min.x>f.max.x||f.min.y>_.max.y||_.min.y>f.max.y))for(let x=0;x<_.footprintSegLen;x++){const w=this.footprintSegments[_.footprintSegIdx+x];if(h.length=0,b8(this.footprintVertices,w.vertexOffset,w.vertexCount,f.footprintTileId.canonical,n.canonical,h),qR(f.footprint,h,this.footprintIndices.uint16,w.indexOffset,w.indexCount,-w.vertexOffset,-m)){_.flags|=zc;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,o,l){let h=!1;for(let f=0;f<l.footprintSegLen;f++){const m=this.footprintSegments[l.footprintSegIdx+f];let _=0;for(const x of m.ringIndices){for(let w=_,E=x+_-1;w<x+_;E=w++){const I=this.footprintVertices.int16[2*(w+m.vertexOffset)+0],k=this.footprintVertices.int16[2*(w+m.vertexOffset)+1],C=this.footprintVertices.int16[2*(E+m.vertexOffset)+1];k>o!=C>o&&n<(this.footprintVertices.int16[2*(E+m.vertexOffset)+0]-I)*(o-k)/(C-k)+I&&(h=!h)}_=x}}return h}getHeightAtTileCoord(n,o){let l=Number.NEGATIVE_INFINITY,h=!0;const f=4*(n+at)*at+(o+at);if(this.partLookup.hasOwnProperty(f)){const m=this.partLookup[f];return m?{height:m.height,hidden:!!(m.flags&zc)}:void 0}for(const m of this.centroidData)n>m.max.x||m.min.x>n||o>m.max.y||m.min.y>o||this.footprintContainsPoint(n,o,m)&&m&&m.height>l&&(l=m.height,this.partLookup[f]=m,h=!!(m.flags&zc));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:h};this.partLookup[f]=void 0}}function eO(r,n){const o=r.add(n)._unit();return r.x*o.x+r.y*o.y}function x8(r,n,o,l){const h=n.sub(r)._perp()._unit(),f=o.sub(n)._perp()._unit();return tO(r,n,o,eO(h,f),l)}function tO(r,n,o,l,h){const f=Math.sqrt(1-l*l);return Math.min(r.dist(n)/3,n.dist(o)/3,h*f/l)}function eT(r,n,o){return r.x<o[0].x&&n.x<o[0].x||r.x>o[1].x&&n.x>o[1].x||r.y<o[0].y&&n.y<o[0].y||r.y>o[1].y&&n.y>o[1].y}function nO(r,n){return r.x<n[0].x||r.x>n[1].x||r.y<n[0].y||r.y>n[1].y}function rO(r,n,o){if(r.x<0||r.x>=at||n.x<0||n.x>=at||o.x<0||o.x>=at)return!1;const l=o.sub(n),h=l.perp(),f=r.sub(n);return(l.x*f.x+l.y*f.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(f.x*f.x+f.y*f.y))>-.866&&h.x*f.x+h.y*f.y<0}function iO(r,n,o){const l=n?2|r:-3&r;return o?1|l:-2&l}function oO(){const r=Math.PI/32,n=Math.tan(r),o=$m;return o*Math.sqrt(1+2*n*n)-o}function sO(r,n,o){const l=1<<o.z,h=zo(o.x/l),f=zo((o.x+1)/l),m=wi(o.y/l),_=wi((o.y+1)/l);return function(x,w,E,I,k=0,C){const R=[];if(!x.length||!E||!I)return R;const L=(re,pe)=>{for(const ve of re)R.push({polygon:ve,bounds:pe})},N=Math.ceil(Math.log2(E)),j=Math.ceil(Math.log2(I)),Z=N-j,X=[];for(let re=0;re<Math.abs(Z);re++)X.push(Z>0?0:1);for(let re=0;re<Math.min(N,j);re++)X.push(0),X.push(1);let J=x;if(J=X0(J,w[0].y-k,w[1].y+k,1),J=X0(J,w[0].x-k,w[1].x+k,0),!J.length)return R;const te=[];for(X.length?te.push({polygons:J,bounds:w,depth:0}):L(J,w);te.length;){const re=te.pop(),pe=re.depth,ve=X[pe],be=re.bounds[0],Pe=re.bounds[1],Se=ve===0?be.x:be.y,Fe=ve===0?Pe.x:Pe.y,Qe=C?C(ve,Se,Fe):.5*(Se+Fe),Le=X0(re.polygons,Se-k,Qe+k,ve),He=X0(re.polygons,Qe-k,Fe+k,ve);if(Le.length){const De=[be,new Oe(ve===0?Qe:Pe.x,ve===1?Qe:Pe.y)];X.length>pe+1?te.push({polygons:Le,bounds:De,depth:pe+1}):L(Le,De)}if(He.length){const De=[new Oe(ve===0?Qe:be.x,ve===1?Qe:be.y),Pe];X.length>pe+1?te.push({polygons:He,bounds:De,depth:pe+1}):L(He,De)}}return R}(r,n,Math.ceil((f-h)/11.25),Math.ceil((m-_)/11.25),1,(x,w,E)=>{if(x===0)return .5*(w+E);{const I=wi((o.y+w/at)/l);return(Oa(.5*(wi((o.y+E/at)/l)+I))*l-o.y)*at}})}function b8(r,n,o,l,h,f){const m=Math.pow(2,l.z-h.z);for(let _=0;_<o;_++){let x=r.int16[2*(_+n)+0],w=r.int16[2*(_+n)+1];x=(x+h.x*at)*m-l.x*at,w=(w+h.y*at)*m-l.y*at,f.push(new Oe(x,w))}}xt(ag,"FillExtrusionBucket",{omit:["layers","features"]}),xt(YR,"PartData"),xt(XR,"FootprintSegment"),xt(KR,"BorderCentroidData"),xt(QR,"GroundEffect");const w8=new $e({visibility:new ne(Ie["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ne(Ie["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var T8={paint:new $e({"fill-extrusion-opacity":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Te(Ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Te(Ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Te(Ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Te(Ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Te(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Te(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ne(Ie["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:w8};class lf extends Oe{constructor(n,o,l){super(n,o),this.z=l}}function lg(r,n){return r.x*n.x+r.y*n.y}function aO(r,n){if(r.length===1){let o=0;const l=n[o++];let h;for(;!h||l.equals(h);)if(h=n[o++],!h)return 1/0;for(;o<n.length;o++){const f=n[o],m=r[0],_=h.sub(l),x=f.sub(l),w=m.sub(l),E=lg(_,_),I=lg(_,x),k=lg(x,x),C=lg(w,_),R=lg(w,x),L=E*k-I*I,N=(k*C-I*R)/L,j=(E*R-I*C)/L,Z=l.z*(1-N-j)+h.z*N+f.z*j;if(isFinite(Z))return Z}return 1/0}{let o=1/0;for(const l of n)o=Math.min(o,l.z);return o}}function lO(r,n,o,l,h,f,m,_){const x=m*h.getElevationAt(r,n,!0,!0),w=f[0]!==0,E=w?f[1]===0?m*(f[0]/7-450):m*function(I,k,C){const R=Math.floor(k[0]/8),L=Math.floor(k[1]/8),N=10*(k[0]-8*R),j=10*(k[1]-8*L),Z=I.getElevationAt(R,L,!0,!0),X=I.getMeterToDEM(C),J=Math.floor(.5*(N*X-1)),te=Math.floor(.5*(j*X-1)),re=I.tileCoordToPixel(R,L),pe=2*J+1,ve=2*te+1,be=function(He,De,ut,yt,Ke){return[He.getElevationAtPixel(De,ut,!0),He.getElevationAtPixel(De+Ke,ut,!0),He.getElevationAtPixel(De,ut+Ke,!0),He.getElevationAtPixel(De+yt,ut+Ke,!0)]}(I,re.x-J,re.y-te,pe,ve),Pe=Math.abs(be[0]-be[1]),Se=Math.abs(be[2]-be[3]),Fe=Math.abs(be[0]-be[2])+Math.abs(be[1]-be[3]),Qe=Math.min(.25,.5*X*(Pe+Se)/pe),Le=Math.min(.25,.5*X*Fe/ve);return Z+Math.max(Qe*N,Le*j)}(h,f,_):x;return{base:x+(o===0)?-1:o,top:w?Math.max(E+l,x+o+2):x+l}}const E8=new $e({"line-cap":new Te(Ie.layout_line["line-cap"]),"line-join":new Te(Ie.layout_line["line-join"]),"line-miter-limit":new ne(Ie.layout_line["line-miter-limit"]),"line-round-limit":new ne(Ie.layout_line["line-round-limit"]),"line-sort-key":new Te(Ie.layout_line["line-sort-key"]),visibility:new ne(Ie.layout_line.visibility)});var cO={paint:new $e({"line-opacity":new Te(Ie.paint_line["line-opacity"]),"line-color":new Te(Ie.paint_line["line-color"]),"line-translate":new ne(Ie.paint_line["line-translate"]),"line-translate-anchor":new ne(Ie.paint_line["line-translate-anchor"]),"line-width":new Te(Ie.paint_line["line-width"]),"line-gap-width":new Te(Ie.paint_line["line-gap-width"]),"line-offset":new Te(Ie.paint_line["line-offset"]),"line-blur":new Te(Ie.paint_line["line-blur"]),"line-dasharray":new Te(Ie.paint_line["line-dasharray"]),"line-pattern":new Te(Ie.paint_line["line-pattern"]),"line-gradient":new Xe(Ie.paint_line["line-gradient"]),"line-trim-offset":new ne(Ie.paint_line["line-trim-offset"]),"line-emissive-strength":new ne(Ie.paint_line["line-emissive-strength"]),"line-border-width":new Te(Ie.paint_line["line-border-width"]),"line-border-color":new Te(Ie.paint_line["line-border-color"])}),layout:E8};function uO(r,n){return 1/OR(r,1,n.tileZoom)}function hO(r,n,o,l){return r.translatePosMatrix(l||n.tileID.projMatrix,n,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const dO=r=>{const n=[];fO(r)&&n.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const o=r.paint.get("line-trim-offset");return o[0]===0&&o[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER"),n};function fO(r){const n=r.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const pO=new class extends Te{possiblyEvaluate(r,n){return n=new de(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition}),super.possiblyEvaluate(r,n)}evaluate(r,n,o,l){return n=br({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(r,n,o,l)}}(cO.paint.properties["line-width"].specification);function mO(r,n){return n>0?n+2*r:r}pO.useIntegerZoom=!0;const S8=new $e({visibility:new ne(Ie.layout_background.visibility)});var I8={paint:new $e({"background-color":new ne(Ie.paint_background["background-color"]),"background-pattern":new ne(Ie.paint_background["background-pattern"]),"background-opacity":new ne(Ie.paint_background["background-opacity"]),"background-emissive-strength":new ne(Ie.paint_background["background-emissive-strength"])}),layout:S8};const A8=new $e({visibility:new ne(Ie.layout_raster.visibility)});var P8={paint:new $e({"raster-opacity":new ne(Ie.paint_raster["raster-opacity"]),"raster-color":new Xe(Ie.paint_raster["raster-color"]),"raster-color-mix":new ne(Ie.paint_raster["raster-color-mix"]),"raster-color-range":new ne(Ie.paint_raster["raster-color-range"]),"raster-hue-rotate":new ne(Ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ne(Ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ne(Ie.paint_raster["raster-brightness-max"]),"raster-saturation":new ne(Ie.paint_raster["raster-saturation"]),"raster-contrast":new ne(Ie.paint_raster["raster-contrast"]),"raster-resampling":new ne(Ie.paint_raster["raster-resampling"]),"raster-fade-duration":new ne(Ie.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ne(Ie.paint_raster["raster-emissive-strength"]),"raster-array-band":new ne(Ie.paint_raster["raster-array-band"]),"raster-elevation":new ne(Ie.paint_raster["raster-elevation"])}),layout:A8};function Sv(r,n,o,l,h,f,m,_){const x=[r,n,1,o,l,1,h,f,1],w=[m,_,1],E=a.bx.adjoint([],x),[I,k,C]=a.v.transformMat3(w,w,E);return a.bx.multiply(x,x,[I,0,0,0,k,0,0,0,C])}function gO(r,n,o,l,h,f,m,_){const x=function(w,E,I,k,C,R,L,N){const j=Sv(0,0,1,0,1,1,0,1),Z=Sv(w,E,I,k,C,R,L,N),X=a.bx.adjoint([],j);return a.bx.multiply(Z,Z,X)}(r,n,o,l,h,f,m,_);return[x[2]/x[8]/at,x[5]/x[8]/at]}function Iv(r){return[r[0],Math.min(Math.max(r[1],-Pr),Pr)]}class _O extends ys{constructor(n,o,l,h){super(),this.id=n,this.dispatcher=l,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=o,this._dirty=!1}load(n,o){if(this._loaded=o||!1,this.fire(new Xo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=Ue(this.map._requestManager.transformRequest(this.url,ai.Image),(l,h)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new tl(l)):h&&(this.image=h instanceof HTMLImageElement?Li.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new mv(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Xo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof mv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=n[0][1],l=n[0][1];for(const f of n)f[1]>l&&(l=f[1]),f[1]<o&&(o=f[1]);const h=(l+o)/2;if(h>Pr?this.onNorthPole=!0:h<-Pr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=n.map(Ai.fromLngLat);this.tileID=function(m){let _=1/0,x=1/0,w=-1/0,E=-1/0;for(const L of m)_=Math.min(_,L.x),x=Math.min(x,L.y),w=Math.max(w,L.x),E=Math.max(E,L.y);const I=Math.max(w-_,E-x),k=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),C=Math.pow(2,k);let R=Math.floor((_+w)/2*C);return R>1&&(R-=1),new sh(k,R,Math.floor((x+E)/2*C))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Xo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const N in this.tiles){const j=this.tiles[N];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=Mc(new sh(0,0,0),this.map.transform.projection),l=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){const j=N[1].x-N[0].x,Z=N[1].y-N[0].y,X=N[2].x-N[1].x,J=N[2].y-N[1].y,te=N[3].x-N[2].x,re=N[3].y-N[2].y,pe=N[0].x-N[3].x,ve=N[0].y-N[3].y,be=j*J-X*Z,Pe=X*re-te*J,Se=te*ve-pe*re,Fe=pe*Z-j*ve;return be>0&&Pe>0&&Se>0&&Fe>0||be<0&&Pe<0&&Se<0&&Fe<0}(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Mc(this.tileID,this.map.transform.projection),[f,m,_,x]=this.coordinates.map(N=>{const j=h.projection.project(N[0],N[1]);return vR(h,j)._round()});this.perspectiveTransform=gO(f.x,f.y,m.x,m.y,_.x,_.y,x.x,x.y);const w=this._boundsArray=new Nn;w.emplaceBack(f.x,f.y,0,0),w.emplaceBack(m.x,m.y,at,0),w.emplaceBack(x.x,x.y,0,at),w.emplaceBack(_.x,_.y,at,at),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(w,_v.members),this.boundsSegments=mr.simpleSegment(0,0,4,2);const E=[],I=function(N){return[Iv(N[0]),Iv(N[1]),Iv(N[2]),Iv(N[3])]}(this.coordinates),[k,C,R,L]=function(N){let j=N[0][0],Z=j,X=N[0][1],J=X;for(let te=1;te<N.length;te++)N[te][0]<j?j=N[te][0]:N[te][0]>Z&&(Z=N[te][0]),N[te][1]<X?X=N[te][1]:N[te][1]>J&&(J=N[te][1]);return[j,X,Z-j,J-X]}(I);{const N=new Nn,[j,Z,X,J]=function(De){let ut=De[0].x,yt=ut,Ke=De[0].y,Vt=Ke;for(let wt=1;wt<De.length;wt++)De[wt].x<ut?ut=De[wt].x:De[wt].x>yt&&(yt=De[wt].x),De[wt].y<Ke?Ke=De[wt].y:De[wt].y>Vt&&(Vt=De[wt].y);return[ut,Ke,yt-ut,Vt-Ke]}(l),te=De=>[(De.x-j)/X,(De.y-Z)/J],[re,pe,ve,be]=l.map(te),Pe=function(De,ut,yt,Ke,Vt,wt,ct,Ut){const Rt=Sv(0,0,1,0,1,1,0,1),Nt=Sv(De,ut,yt,Ke,Vt,wt,ct,Ut),it=a.bx.adjoint([],Nt);return a.bx.multiply(Rt,Rt,it)}(re[0],re[1],pe[0],pe[1],ve[0],ve[1],be[0],be[1]);this.elevatedGlobePerspectiveTransform=gO(re[0],re[1],pe[0],pe[1],ve[0],ve[1],be[0],be[1]);const Se=(De,ut)=>{E.push(De.lng);const yt=Math.round((De.lng-k)/R*at),Ke=Math.round((De.lat-C)/L*at),Vt=te(ut),wt=a.v.transformMat3([],[Vt[0],Vt[1],1],Pe),ct=Math.round(wt[0]/wt[2]*at),Ut=Math.round(wt[1]/wt[2]*at);N.emplaceBack(yt,Ke,ct,Ut)},Fe=l[3].x-l[0].x,Qe=l[3].y-l[0].y,Le=l[2].x-l[1].x,He=l[2].y-l[1].y;for(let De=0;De<65;De++){const ut=De/64,yt=[l[0].x+ut*Fe,l[0].y+ut*Qe],Ke=[l[1].x+ut*Le,l[1].y+ut*He],Vt=Ke[0]-yt[0],wt=Ke[1]-yt[1];for(let ct=0;ct<65;ct++){const Ut=ct/64,Rt={x:yt[0]+Vt*Ut,y:yt[1]+wt*Ut,z:0};Se(o.projection.unproject(Rt.x,Rt.y),Rt)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer(N,_v.members)}{this.maxLongitudeTriangleSize=0;let N=[],j=new Bn;const Z=(X,J,te)=>{j.emplaceBack(X,J,te);const re=E[X],pe=E[J],ve=E[te],be=Math.min(Math.min(re,pe),ve),Pe=Math.max(Math.max(re,pe),ve)-be;Pe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Pe),N.push(be+Pe/2)};for(let X=0;X<64;X++)for(let J=0;J<64;J++){const te=65*X+J,re=te+1,pe=te+65,ve=pe+1;Z(te,pe,re),Z(re,pe,ve)}[N,j]=function(X,J){const te=Array.from({length:X.length},(ve,be)=>be);te.sort((ve,be)=>X[ve]-X[be]);const re=[],pe=new Bn;for(let ve=0;ve<te.length;ve++){const be=te[ve];re.push(X[be]);const Pe=3*be,Se=Pe+1;pe.emplaceBack(J.uint16[Pe],J.uint16[Se],J.uint16[Se+1])}return[re,pe]}(N,j),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(j)}this.elevatedGlobeSegments=mr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,R/at,0,L/at,0,0,C,k,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const o=this.map.painter.context,l=o.gl;!this._dirty||this.texture instanceof mv||(this.texture?this.texture.update(this.image):(this.texture=new Pl(o,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(o)}loadTile(n,o){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},o(null)):(n.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let h=((E,I)=>E+360*Math.round((I-E)/360))(n+180,l[0]);const f=new mr,m=(E,I)=>{f.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:o.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},_=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-h)<=_){const E=$t(l,0,l.length,h+_);return E===l.length||m(E,et(l,E+1,l.length,h+360-_)-E),f}h<l[0]&&(h+=360);const x=et(l,0,l.length,h-_);if(x===l.length)return m(0,l.length),f;m(0,x-0);const w=$t(l,x+1,l.length,h+_);return w!==l.length&&m(w,l.length-w),f}}class k8 extends _t{constructor(n,o){super(n,{},o),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}const C8=new $e({visibility:new ne(Ie.layout_sky.visibility)});var M8={paint:new $e({"sky-type":new ne(Ie.paint_sky["sky-type"]),"sky-atmosphere-sun":new ne(Ie.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ne(Ie.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ne(Ie.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ne(Ie.paint_sky["sky-gradient-radius"]),"sky-gradient":new Xe(Ie.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ne(Ie.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ne(Ie.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ne(Ie.paint_sky["sky-opacity"])}),layout:C8};function tT(r,n,o){const l=[0,0,1],h=a.q.identity([]);return a.q.rotateY(h,h,o?-pt(r)+Math.PI:pt(r)),a.q.rotateX(h,h,-pt(n)),a.v.transformQuat(l,l,h),a.v.normalize(l,l)}var R8={paint:new $e({})};const O8={circle:class extends _t{constructor(r,n,o){super(r,uV,n,o)}createBucket(r){return new y2(r)}queryRadius(r){const n=r;return Zd("circle-radius",this,n)+Zd("circle-stroke-width",this,n)+B0(this.paint.get("circle-translate"))}queryIntersectsFeature(r,n,o,l,h,f,m,_){const x=vM(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o);return bM(r,l,f,m,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,n){const o=xM(this);return{config:new rh(this,n),defines:o,overrideFog:!1}}},heatmap:class extends _t{createBucket(r){return new TM(r)}constructor(r,n,o){super(r,gV,n,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=j0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return Zd("heatmap-radius",this,r)}queryIntersectsFeature(r,n,o,l,h,f,m,_){const x=this.paint.get("heatmap-radius").evaluate(n,o);return bM(r,l,f,m,_,!0,!0,new Oe(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,n){return r==="heatmap"?{config:new rh(this,n),overrideFog:!1}:{}}},hillshade:class extends _t{constructor(r,n,o){super(r,yV,n,o)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,n){return{overrideFog:!1}}},fill:class extends _t{constructor(r,n,o){super(r,RV,n,o)}getProgramIds(){const r=this.paint.get("fill-pattern"),n=r&&r.constantOr(1),o=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(r,n){return{config:new rh(this,n),overrideFog:!1}}recalculate(r,n){super.recalculate(r,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new q0(r)}queryRadius(){return B0(this.paint.get("fill-translate"))}queryIntersectsFeature(r,n,o,l,h,f){return!r.queryGeometry.isAboveHorizon&&pM(yM(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends _t{constructor(r,n,o){super(r,T8,n,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new ag(r)}queryRadius(){return B0(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,n,o,l,h,f,m,_,x){const w=vM(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(n,o),I=this.paint.get("fill-extrusion-base").evaluate(n,o),k=[0,0],C=_&&f.elevation,R=f.elevation?f.elevation.exaggeration():1,L=r.tile.getBucket(this);if(C&&L instanceof ag){const J=L.centroidVertexArray,te=x+1;te<J.length&&(k[0]=J.geta_centroid_pos0(te),k[1]=J.geta_centroid_pos1(te))}if(k[0]===0&&k[1]===1)return!1;f.projection.name==="globe"&&(l=sO([l],[new Oe(0,0),new Oe(at,at)],r.tileID.canonical).map(J=>J.polygon).flat());const N=C?_:null,[j,Z]=function(J,te,re,pe,ve,be,Pe,Se,Fe,Qe,Le){return J.projection.name==="globe"?function(He,De,ut,yt,Ke,Vt,wt,ct,Ut,Rt,Nt){const it=[],Xt=[],gn=He.projection.upVectorScale(Nt,He.center.lat,He.worldSize).metersToTile,en=[0,0,0,1],un=[0,0,0,1],In=(on,cr,Xn,Dn)=>{on[0]=cr,on[1]=Xn,on[2]=Dn,on[3]=1},Zn=oO();ut>0&&(ut+=Zn),yt+=Zn;for(const on of De){const cr=[],Xn=[];for(const Dn of on){const Fn=Dn.x+Ke.x,An=Dn.y+Ke.y,Tr=He.projection.projectTilePoint(Fn,An,Nt),ur=He.projection.upVector(Nt,Dn.x,Dn.y);let kr=ut,ri=yt;if(wt){const no=lO(Fn,An,ut,yt,wt,ct,Ut,Rt);kr+=no.base,ri+=no.top}ut!==0?In(en,Tr.x+ur[0]*gn*kr,Tr.y+ur[1]*gn*kr,Tr.z+ur[2]*gn*kr):In(en,Tr.x,Tr.y,Tr.z),In(un,Tr.x+ur[0]*gn*ri,Tr.y+ur[1]*gn*ri,Tr.z+ur[2]*gn*ri),a.v.transformMat4(en,en,Vt),a.v.transformMat4(un,un,Vt),cr.push(new lf(en[0],en[1],en[2])),Xn.push(new lf(un[0],un[1],un[2]))}it.push(cr),Xt.push(Xn)}return[it,Xt]}(J,te,re,pe,ve,be,Pe,Se,Fe,Qe,Le):Pe?function(He,De,ut,yt,Ke,Vt,wt,ct,Ut){const Rt=[],Nt=[],it=[0,0,0,1];for(const Xt of He){const gn=[],en=[];for(const un of Xt){const In=un.x+yt.x,Zn=un.y+yt.y,on=lO(In,Zn,De,ut,Vt,wt,ct,Ut);it[0]=In,it[1]=Zn,it[2]=on.base,it[3]=1,a.e.transformMat4(it,it,Ke),it[3]=Math.max(it[3],1e-5);const cr=new lf(it[0]/it[3],it[1]/it[3],it[2]/it[3]);it[0]=In,it[1]=Zn,it[2]=on.top,it[3]=1,a.e.transformMat4(it,it,Ke),it[3]=Math.max(it[3],1e-5);const Xn=new lf(it[0]/it[3],it[1]/it[3],it[2]/it[3]);gn.push(cr),en.push(Xn)}Rt.push(gn),Nt.push(en)}return[Rt,Nt]}(te,re,pe,ve,be,Pe,Se,Fe,Qe):function(He,De,ut,yt,Ke){const Vt=[],wt=[],ct=Ke[8]*De,Ut=Ke[9]*De,Rt=Ke[10]*De,Nt=Ke[11]*De,it=Ke[8]*ut,Xt=Ke[9]*ut,gn=Ke[10]*ut,en=Ke[11]*ut;for(const un of He){const In=[],Zn=[];for(const on of un){const cr=on.x+yt.x,Xn=on.y+yt.y,Dn=Ke[0]*cr+Ke[4]*Xn+Ke[12],Fn=Ke[1]*cr+Ke[5]*Xn+Ke[13],An=Ke[2]*cr+Ke[6]*Xn+Ke[14],Tr=Ke[3]*cr+Ke[7]*Xn+Ke[15],ur=Dn+ct,kr=Fn+Ut,ri=An+Rt,no=Math.max(Tr+Nt,1e-5),Lr=Dn+it,Ar=Fn+Xt,Vi=An+gn,Ui=Math.max(Tr+en,1e-5);In.push(new lf(ur/no,kr/no,ri/no)),Zn.push(new lf(Lr/Ui,Ar/Ui,Vi/Ui))}Vt.push(In),wt.push(Zn)}return[Vt,wt]}(te,re,pe,ve,be)}(f,l,I,E,w,m,N,k,R,f.center.lat,r.tileID.canonical),X=r.queryGeometry;return function(J,te,re){let pe=1/0;pM(re,te)&&(pe=aO(re,te[0]));for(let ve=0;ve<te.length;ve++){const be=te[ve],Pe=J[ve];for(let Se=0;Se<be.length-1;Se++){const Fe=be[Se],Qe=[Fe,be[Se+1],Pe[Se+1],Pe[Se],Fe];fM(re,Qe)&&(pe=Math.min(pe,aO(re,Qe)))}}return pe!==1/0&&pe}(j,Z,X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends _t{constructor(r,n,o){super(r,cO,n,o),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof lm,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,n){super.recalculate(r,n),this.paint._values["line-floorwidth"]=pO.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new pv(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,n){const o=dO(this);return{config:new rh(this,n),defines:o,overrideFog:!1}}queryRadius(r){const n=r,o=mO(Zd("line-width",this,n),Zd("line-gap-width",this,n)),l=Zd("line-offset",this,n);return o/2+Math.abs(l)+B0(this.paint.get("line-translate"))}queryIntersectsFeature(r,n,o,l,h,f){if(r.queryGeometry.isAboveHorizon)return!1;const m=yM(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),_=r.pixelToTileUnitsFactor/2*mO(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),x=this.paint.get("line-offset").evaluate(n,o);return x&&(l=function(w,E){const I=[],k=new Oe(0,0);for(let C=0;C<w.length;C++){const R=w[C],L=[];for(let N=0;N<R.length;N++){const j=R[N],Z=R[N+1],X=N===0?k:j.sub(R[N-1])._unit()._perp(),J=N===R.length-1?k:Z.sub(j)._unit()._perp(),te=X._add(J)._unit();te._mult(1/(te.x*J.x+te.y*J.y)),L.push(te._mult(E)._add(j))}I.push(L)}return I}(l,x*r.pixelToTileUnitsFactor)),function(w,E,I){for(let k=0;k<E.length;k++){const C=E[k];if(w.length>=3){for(let R=0;R<C.length;R++)if(ch(w,C[R]))return!0}if(sV(w,C,I))return!0}return!1}(m,l,_)}isTileClipped(){return!0}},symbol:lv,background:class extends _t{constructor(r,n,o){super(r,I8,n,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,n){return{overrideFog:!1}}},raster:class extends _t{constructor(r,n,o){super(r,P8,n,o),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(r){return!(r&&r._source instanceof _O)||!r._source.onNorthPole&&!r._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-color"].value.expression,[n,o]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=j0({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:n,end:o}],resolution:256}),this.colorRampTexture=null}},sky:class extends _t{constructor(r,n,o){super(r,M8,n,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=j0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(r,n){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),h=!l,f=r.style.light,m=f.properties.get("position");return h&&f.properties.get("anchor")==="viewport"&&pr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?tT(m.azimuthal,90-m.polar,n):tT(l[0],90-l[1],n)}const o=this.paint.get("sky-gradient-center");return tT(o[0],90-o[1],n)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends _t{constructor(r,n,o){super(r,R8,n)}},model:class extends _t{constructor(r,n,o){super(r,c8,n,o)}createBucket(r){return new FR(r)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(r,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const n=this._transitionablePaint._values[r];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof Yu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};class D8{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class L8{constructor(){this.tasks={},this.taskQueue=[],ac(["process"],this),this.invoker=new D8(this.process),this.nextId=0}add(n,o){const l=this.nextId++,h=function({type:f,isSymbolTile:m,zoom:_}){return _=_||0,f==="message"?0:f!=="maybePrepare"||m?f!=="parseTile"||m?f==="parseTile"&&m?300-_:f==="maybePrepare"&&m?400-_:500:200-_:100-_}(o);if(h===0){we();try{n()}finally{}return null}return this.tasks[l]={fn:n,metadata:o,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){we();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const o=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let n=null,o=1/0;for(let h=0;h<this.taskQueue.length;h++){const f=this.tasks[this.taskQueue[h]];f.priority<o&&(o=f.priority,n=h)}if(n===null)return null;const l=this.taskQueue[n];return this.taskQueue.splice(n,1),l}remove(){this.invoker.remove()}}class yO{constructor(n,o,l){this.target=n,this.parent=o,this.mapId=l,this.callbacks={},this.cancelCallbacks={},ac(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new L8}send(n,o,l,h,f=!1,m){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=m,this.callbacks[_]=l);const x=new Set;return this.target.postMessage({id:_,type:n,hasCallback:!!l,targetMapId:h,mustQueue:f,sourceMapId:this.mapId,data:d(o,x)},x),{cancel:()=>{l&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(n){const o=n.data,l=o.id;if(l&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(o.mustQueue||we()){const h=this.callbacks[l],f=this.scheduler.add(()=>this.processTask(l,o),h&&h.metadata||{type:"message"});f&&(this.cancelCallbacks[l]=f)}else this.processTask(l,o)}processTask(n,o){if(delete this.cancelCallbacks[n],o.type==="<response>"){const l=this.callbacks[n];delete this.callbacks[n],l&&(o.error?l(y(o.error)):l(null,y(o.data)))}else{const l=new Set,h=o.hasCallback?(m,_)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:m?d(m):null,data:d(_,l)},l)}:m=>{},f=y(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,f,h);else if(this.parent.getWorkerSource){const m=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,m[0],f.source,f.scope)[m[1]](f,h)}else h(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class cg{constructor(n,o){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=_s();const l=this.workerPool.acquire(this.id);for(let h=0;h<l.length;h++){const f=new cg.Actor(l[h],o,this.id);f.name=`Worker ${h}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,l){vn(this.actors,(h,f)=>{h.send(n,o,f)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}cg.Actor=yO;class vO{constructor(n,o){this.width=n,this.height=o,this.nextRow=0,this.image=new Sl({width:n,height:o}),this.positions={},this.uploaded=!1}getDash(n,o){const l=this.getKey(n,o);return this.positions[l]}trim(){const n=this.width,o=this.height=Ao(this.nextRow);this.image.resize({width:n,height:o})}getKey(n,o){return n.join(",")+o}getDashRanges(n,o,l){const h=[];let f=n.length%2==1?-n[n.length-1]*l:0,m=n[0]*l,_=!0;h.push({left:f,right:m,isDash:_,zeroLength:n[0]===0});let x=n[0];for(let w=1;w<n.length;w++){_=!_;const E=n[w];f=x*l,x+=E,m=x*l,h.push({left:f,right:m,isDash:_,zeroLength:E===0})}return h}addRoundDash(n,o,l){const h=o/2;for(let f=-l;f<=l;f++){const m=this.width*(this.nextRow+l+f);let _=0,x=n[_];for(let w=0;w<this.width;w++){w/x.right>1&&(x=n[++_]);const E=Math.abs(w-x.left),I=Math.abs(w-x.right),k=Math.min(E,I);let C;const R=f/l*(h+1);if(x.isDash){const L=h-Math.abs(R);C=Math.sqrt(k*k+L*L)}else C=h-Math.sqrt(k*k+R*R);this.image.data[m+w]=Math.max(0,Math.min(255,C+128))}}}addRegularDash(n,o){for(let x=n.length-1;x>=0;--x){const w=n[x],E=n[x+1];w.zeroLength?n.splice(x,1):E&&E.isDash===w.isDash&&(E.left=w.left,n.splice(x,1))}const l=n[0],h=n[n.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const f=this.width*this.nextRow;let m=0,_=n[m];for(let x=0;x<this.width;x++){x/_.right>1&&(_=n[++m]);const w=Math.abs(x-_.left),E=Math.abs(x-_.right),I=Math.min(w,E);this.image.data[f+x]=Math.max(0,Math.min(255,(_.isDash?I:-I)+o+128))}}addDash(n,o){const l=this.getKey(n,o);if(this.positions[l])return this.positions[l];const h=o==="round",f=h?7:0,m=2*f+1;if(this.nextRow+m>this.height)return pr("LineAtlas out of space"),null;n.length===0&&n.push(1);let _=0;for(let E=0;E<n.length;E++)n[E]<0&&(pr("Negative value is found in line dasharray, replacing values with 0"),n[E]=0),_+=n[E];if(_!==0){const E=this.width/_,I=this.getDashRanges(n,this.width,E);h?this.addRoundDash(I,E,f):this.addRegularDash(I,o==="square"?.5*E:0)}const x=this.nextRow+f;this.nextRow+=m;const w={tl:[x,f],br:[_,0]};return this.positions[l]=w,w}}xt(vO,"LineAtlas");const xO=1*Js;class bO{constructor(n){const o={},l=[];for(const _ in n){const x=n[_],w=o[_]={};for(const E in x.glyphs){const I=x.glyphs[+E];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const k=I.metrics.localGlyph?xO:1,C={x:0,y:0,w:I.bitmap.width+2*k,h:I.bitmap.height+2*k};l.push(C),w[E]=C}}const{w:h,h:f}=N2(l),m=new Sl({width:h||1,height:f||1});for(const _ in n){const x=n[_];for(const w in x.glyphs){const E=x.glyphs[+w];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const I=o[_][w],k=E.metrics.localGlyph?xO:1;Sl.copy(E.bitmap,m,{x:0,y:0},{x:I.x+k,y:I.y+k},E.bitmap)}}this.image=m,this.positions=o}}xt(bO,"GlyphAtlas");class z8{constructor(n){this.tileID=new hi(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),this.tileZoom=n.tileZoom,this.uid=n.uid,this.zoom=n.zoom,this.canonical=n.tileID.canonical,this.pixelRatio=n.pixelRatio,this.tileSize=n.tileSize,this.source=n.source,this.scope=n.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=n.showCollisionBoxes,this.collectResourceTiming=!!n.collectResourceTiming,this.promoteId=n.promoteId,this.isSymbolTile=n.isSymbolTile,this.tileTransform=Mc(n.tileID.canonical,n.projection),this.projection=n.projection,this.brightness=n.brightness,this.extraShadowCaster=!!n.extraShadowCaster}parse(n,o,l,h,f){this.status="parsing",this.data=n,this.collisionBoxArray=new zw;const m=new DM(Object.keys(n.layers).sort()),_=new R2(this.tileID,this.promoteId);_.bucketLayerIDs=[];const x={},w=new vO(256,256),E={featureIndex:_,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:l,brightness:this.brightness},I=o.familiesBySource[this.source];for(const Z in I){const X=n.layers[Z];if(!X)continue;let J=!1,te=!1,re=!1;for(const be of I[Z])be[0].type==="symbol"?J=!0:te=!0,be[0].is3D()&&be[0].type!=="model"&&(re=!0);if(this.extraShadowCaster&&!re||this.isSymbolTile===!0&&!J||this.isSymbolTile===!1&&!te)continue;X.version===1&&pr(`Vector tile source "${this.source}" layer "${Z}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const pe=m.encode(Z),ve=[];for(let be=0;be<X.length;be++){const Pe=X.feature(be),Se=_.getId(Pe,Z);ve.push({feature:Pe,id:Se,index:be,sourceLayerIndex:pe})}for(const be of I[Z]){const Pe=be[0];(!this.extraShadowCaster||Pe.is3D()&&Pe.type!=="model")&&(this.isSymbolTile!==void 0&&Pe.type==="symbol"!==this.isSymbolTile||Pe.minzoom&&this.zoom<Math.floor(Pe.minzoom)||Pe.maxzoom&&this.zoom>=Pe.maxzoom||Pe.visibility!=="none"&&(nT(be,this.zoom,E.brightness,l),(x[Pe.id]=Pe.createBucket({index:_.bucketLayerIDs.length,layers:be,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pe,sourceID:this.source,projection:this.projection.spec})).populate(ve,E,this.tileID.canonical,this.tileTransform),_.bucketLayerIDs.push(be.map(Se=>Se.id))))}}let k,C,R,L;w.trim();const N={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},j=()=>{if(k)return this.status="done",f(k);if(this.extraShadowCaster)this.status="done",f(null,{buckets:Kn(x).filter(Z=>!Z.isEmpty()),featureIndex:_,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:E.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(C&&R&&L){const Z=new bO(C),X=new uR(R,L);for(const J in x){const te=x[J];te instanceof tg?(nT(te.layers,this.zoom,E.brightness,l),RU(te,C,Z.positions,R,X.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):te.hasPattern&&(te instanceof pv||te instanceof q0||te instanceof ag)&&(nT(te.layers,this.zoom,E.brightness,l),te.addFeatures(E,this.tileID.canonical,X.patternPositions,l,this.tileTransform,this.brightness))}this.status="done",f(null,{buckets:Kn(x).filter(J=>!J.isEmpty()),featureIndex:_,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Z.image,lineAtlas:w,imageAtlas:X,brightness:E.brightness})}};if(!this.extraShadowCaster){const Z=Cu(E.glyphDependencies,te=>Object.keys(te).map(Number));Object.keys(Z).length?h.send("getGlyphs",{uid:this.uid,stacks:Z,scope:this.scope},(te,re)=>{k||(k=te,C=re,j())},void 0,!1,N):C={};const X=Object.keys(E.iconDependencies);X.length?h.send("getImages",{icons:X,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(te,re)=>{k||(k=te,R=re,j())},void 0,!1,N):R={};const J=Object.keys(E.patternDependencies);J.length?h.send("getImages",{icons:J,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(te,re)=>{k||(k=te,L=re,j())},void 0,!1,N):L={}}j()}}function nT(r,n,o,l){const h=new de(n,{brightness:o});for(const f of r)f.recalculate(h,l)}class wO{constructor(n){this.entries={},this.scheduler=n}request(n,o,l,h){const f=this.entries[n]=this.entries[n]||{callbacks:[]};if(f.result){const[m,_]=f.result;return this.scheduler?this.scheduler.add(()=>{h(m,_)},o):h(m,_),()=>{}}return f.callbacks.push(h),f.cancel||(f.cancel=l((m,_)=>{f.result=[m,_];for(const x of f.callbacks)this.scheduler?this.scheduler.add(()=>{x(m,_)},o):x(m,_);setTimeout(()=>delete this.entries[n],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(m=>m!==h),f.callbacks.length||(f.cancel(),delete this.entries[n]))}}}function TO(r,n,o){const l=JSON.stringify(r.request);return r.data&&(this.deduped.entries[l]={result:[null,r.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},h=>{const f=li(r.request,(m,_,x,w)=>{m?h(m):_&&h(null,{vectorTile:o?void 0:new C2(new J0(_)),rawData:_,cacheControl:x,expires:w})});return()=>{f.cancel(),h()}},n)}var ug={workerUrl:"",workerClass:null,workerParams:void 0};function N8(){return ug.workerClass!=null?new ug.workerClass:new self.Worker(ug.workerUrl,ug.workerParams)}const rT="mapboxgl_preloaded_worker_pool";class hg{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<hg.workerCount;)this.workers.push(new N8);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[rT]}numActive(){return Object.keys(this.active).length}}let dg;function iT(){return dg||(dg=new hg),dg}hg.workerCount=2;let Av,oT,ea,sT=null;function EO(){return we()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:oT||B.DRACO_URL}const aT=5123,lT=5126,cT={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[aT]:Uint16Array,5125:Uint32Array,[lT]:Float32Array},F8={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[aT]:"DT_UINT16",5125:"DT_UINT32",[lT]:"DT_FLOAT32"},uT={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function SO(r,n,o){const l=o.json.bufferViews.length,h=o.buffers.length;n.bufferView=l,o.json.bufferViews[l]={buffer:h,byteLength:r.byteLength},o.buffers[h]=r}const hT="KHR_draco_mesh_compression";function B8(r,n){const o=r.extensions&&r.extensions[hT];if(!o)return;const l=new ea.Decoder,h=kO(n,o.bufferView),f=new ea.Mesh;if(!l.DecodeArrayToMesh(h,h.byteLength,f))throw new Error("Failed to decode Draco mesh");const m=n.json.accessors[r.indices],_=cT[m.componentType],x=m.count*_.BYTES_PER_ELEMENT,w=ea._malloc(x);_===Uint16Array?l.GetTrianglesUInt16Array(f,x,w):l.GetTrianglesUInt32Array(f,x,w),SO(ea.memory.buffer.slice(w,w+x),m,n),ea._free(w);for(const E of Object.keys(o.attributes)){const I=l.GetAttributeByUniqueId(f,o.attributes[E]),k=n.json.accessors[r.attributes[E]],C=F8[k.componentType],R=k.count*uT[k.type]*cT[k.componentType].BYTES_PER_ELEMENT,L=ea._malloc(R);l.GetAttributeDataArrayForAllPoints(f,I,ea[C],R,L),SO(ea.memory.buffer.slice(L,L+R),k,n),ea._free(L)}l.destroy(),f.destroy(),delete r.extensions[hT]}const IO=1179937895,AO=new TextDecoder("utf8");function PO(r,n){return new URL(r,n).href}function j8(r,n,o,l){return fetch(PO(r.uri,l)).then(h=>h.arrayBuffer()).then(h=>{n.buffers[o]=h})}function kO(r,n){const o=r.json.bufferViews[n];return new Uint8Array(r.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function V8(r,n,o,l){if(r.uri){const h=PO(r.uri,l);return fetch(h).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{n.images[o]=f})}if(r.bufferView!==void 0){const h=kO(n,r.bufferView),f=new Blob([h],{type:r.mimeType});return createImageBitmap(f).then(m=>{n.images[o]=m})}}function CO(r,n=0,o){const l={json:null,images:[],buffers:[]};if(new Uint32Array(r,n,1)[0]===IO){const w=new Uint32Array(r,n);let E=2;const I=(w[E++]>>2)-3,k=w[E++]>>2;if(E++,l.json=JSON.parse(AO.decode(w.subarray(E,E+k))),E+=k,E<I){const C=w[E++];E++;const R=n+(E<<2);l.buffers[0]=r.slice(R,R+C)}}else l.json=JSON.parse(AO.decode(new Uint8Array(r,n)));const{buffers:h,images:f,meshes:m,extensionsUsed:_}=l.json;let x=Promise.resolve();if(h){const w=[];for(let E=0;E<h.length;E++){const I=h[E];I.uri?w.push(j8(I,l,E,o)):l.buffers[E]||(l.buffers[E]=null)}x=Promise.all(w)}return x.then(()=>{const w=[],E=_&&_.includes(hT);if(E&&w.push(function(){if(!ea)return Av||(Av=function(I){let k,C=null;function R(){k=new Uint8Array(C.buffer)}function L(){throw new Error("Unexpected Draco error.")}const N={a:{a:L,d:function(j,Z,X){return k.copyWithin(j,Z,Z+X)},c:function(j){const Z=k.length,X=Math.max(j>>>0,Math.ceil(1.2*Z)),J=Math.ceil((X-Z)/65536);try{return C.grow(J),R(),!0}catch{return!1}},b:L}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(I,N):I.then(j=>j.arrayBuffer()).then(j=>WebAssembly.instantiate(j,N))).then(j=>{const{Rb:Z,Qb:X,P:J,T:te,X:re,Ja:pe,La:ve,Qa:be,Va:Pe,Wa:Se,eb:Fe,jb:Qe,f:Le,e:He,yb:De,zb:ut,Ab:yt,Bb:Ke,Db:Vt,Gb:wt}=j.instance.exports;C=He;const ct=(()=>{let Ut=0,Rt=0,Nt=0,it=0;return Xt=>{Nt&&(Z(it),Z(Ut),Rt+=Nt,Nt=Ut=0),Ut||(Rt+=128,Ut=X(Rt));const gn=Xt.length+7&-8;let en=Ut;gn>=Rt&&(Nt=gn,en=it=X(gn));for(let un=0;un<Xt.length;un++)k[en+un]=Xt[un];return en}})();return R(),Le(),{memory:He,_free:Z,_malloc:X,Mesh:class{constructor(){this.ptr=J()}destroy(){te(this.ptr)}},Decoder:class{constructor(){this.ptr=pe()}destroy(){Qe(this.ptr)}DecodeArrayToMesh(Ut,Rt,Nt){const it=ct(Ut),Xt=ve(this.ptr,it,Rt,Nt.ptr);return!!re(Xt)}GetAttributeByUniqueId(Ut,Rt){return{ptr:be(this.ptr,Ut.ptr,Rt)}}GetTrianglesUInt16Array(Ut,Rt,Nt){Pe(this.ptr,Ut.ptr,Rt,Nt)}GetTrianglesUInt32Array(Ut,Rt,Nt){Se(this.ptr,Ut.ptr,Rt,Nt)}GetAttributeDataArrayForAllPoints(Ut,Rt,Nt,it,Xt){Fe(this.ptr,Ut.ptr,Rt.ptr,Nt,it,Xt)}},DT_INT8:De(),DT_UINT8:ut(),DT_INT16:yt(),DT_UINT16:Ke(),DT_UINT32:Vt(),DT_FLOAT32:wt()}})}(fetch(EO())),Av.then(I=>{ea=I,Av=void 0}))}()),f)for(let I=0;I<f.length;I++)w.push(V8(f[I],l,I,o));return(w.length?Promise.all(w):Promise.resolve()).then(()=>{if(E&&m)for(const{primitives:I}of m)for(const k of I)B8(k,l);return l})})}class MO{constructor(n,o,l){if(this.triangleCount=o.length/3,this.min=new Oe(0,0),this.max=new Oe(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0||l===0)return;const h=n.map(E=>E.x),f=n.map(E=>E.y);this.min=new Oe(Math.min(...h),Math.min(...f)),this.max=new Oe(Math.max(...h),Math.max(...f));const m=this.max.sub(this.min);m.x=Math.max(m.x,1),m.y=Math.max(m.y,1);const _=Math.max(m.x,m.y)/l;this.cellsX=Math.max(1,Math.ceil(m.x/_)),this.cellsY=Math.max(1,Math.ceil(m.y/_)),this.xScale=1/_,this.yScale=1/_;const x=[];for(let E=0;E<this.triangleCount;E++){const I=n[o[3*E+0]].sub(this.min),k=n[o[3*E+1]].sub(this.min),C=n[o[3*E+2]].sub(this.min),R=Nc(Math.floor(Math.min(I.x,k.x,C.x)),this.xScale,this.cellsX),L=Nc(Math.floor(Math.max(I.x,k.x,C.x)),this.xScale,this.cellsX),N=Nc(Math.floor(Math.min(I.y,k.y,C.y)),this.yScale,this.cellsY),j=Nc(Math.floor(Math.max(I.y,k.y,C.y)),this.yScale,this.cellsY),Z=new Oe(0,0),X=new Oe(0,0),J=new Oe(0,0),te=new Oe(0,0);for(let re=N;re<=j;++re){Z.y=X.y=re*_,J.y=te.y=(re+1)*_;for(let pe=R;pe<=L;++pe)Z.x=J.x=pe*_,X.x=te.x=(pe+1)*_,(b2(I,k,C,Z,X,te)||b2(I,k,C,Z,te,J))&&x.push({cellIdx:re*this.cellsX+pe,triIdx:E})}}if(x.length===0)return;x.sort((E,I)=>E.cellIdx-I.cellIdx||E.triIdx-I.triIdx);let w=0;for(;w<x.length;){const E=x[w].cellIdx,I={start:this.payload.length,len:0};for(;w<x.length&&x[w].cellIdx===E;)++I.len,this.payload.push(x[w++].triIdx);this.cells[E]=I}}query(n,o,l){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>o.x||n.y>this.max.y||this.min.y>o.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let x=0;x<this.lookup.length;x++)this.lookup[x]=0;const h=Nc(n.x-this.min.x,this.xScale,this.cellsX),f=Nc(o.x-this.min.x,this.xScale,this.cellsX),m=Nc(n.y-this.min.y,this.yScale,this.cellsY),_=Nc(o.y-this.min.y,this.yScale,this.cellsY);for(let x=m;x<=_;x++)for(let w=h;w<=f;w++){const E=this.cells[x*this.cellsX+w];if(E)for(let I=0;I<E.len;I++){const k=this.payload[E.start+I],C=Math.floor(k/8),R=1<<k%8;if(!(this.lookup[C]&R)&&(this.lookup[C]|=R,l.push(k),l.length===this.triangleCount))return}}}}function Nc(r,n,o){return Math.max(0,Math.min(o-1,Math.floor(r*n)))}function mh(r,n){const o=r.json.bufferViews[n.bufferView];return new cT[n.componentType](r.buffers[o.buffer],(n.byteOffset||0)+(o.byteOffset||0),n.count*uT[n.type])}function U8(r,n,o){const l=r.indices,h=r.attributes,f={};f.indexArray=new Bn;const m=n.json.accessors[l],_=m.count/3;f.indexArray.reserve(_);const x=mh(n,m);for(let k=0;k<_;k++)f.indexArray.emplaceBack(x[3*k],x[3*k+1],x[3*k+2]);f.indexArray._trim(),f.vertexArray=new th;const w=n.json.accessors[h.POSITION];f.vertexArray.reserve(w.count);const E=mh(n,w);for(let k=0;k<w.count;k++)f.vertexArray.emplaceBack(E[3*k],E[3*k+1],E[3*k+2]);if(f.vertexArray._trim(),f.aabb=new Dr(w.min,w.max),f.centroid=function(k,C){const R=[0,0,0],L=k.length;if(L>0){for(let N=0;N<L;N++){const j=3*k[N];R[0]+=C[j],R[1]+=C[j+1],R[2]+=C[j+2]}R[0]/=L,R[1]/=L,R[2]/=L}return R}(x,E),h.COLOR_0!==void 0){const k=n.json.accessors[h.COLOR_0],C=uT[k.type];if(k.componentType===lT){f.colorArray=C===3?new th:new Rn,f.colorArray.reserve(k.count);const R=mh(n,k);if(C===3)for(let L=0;L<k.count;L++)f.colorArray.emplaceBack(R[3*L],R[3*L+1],R[3*L+2]);else for(let L=0;L<k.count;L++)f.colorArray.emplaceBack(R[4*L],R[4*L+1],R[4*L+2],R[4*L+3]);f.colorArray._trim()}else if(k.componentType===aT&&C===4){f.colorArray=new Rn,f.colorArray.resize(k.count);const R=mh(n,k),L=1/65535,N=f.colorArray.float32;for(let j=0;j<4*R.length;++j)N[j]=R[j]*L}else pr(`glTF color buffer parsing for accessor ${JSON.stringify(k)} is not supported`)}if(h.NORMAL!==void 0){f.normalArray=new th;const k=n.json.accessors[h.NORMAL];f.normalArray.reserve(k.count);const C=mh(n,k);for(let R=0;R<k.count;R++)f.normalArray.emplaceBack(C[3*R],C[3*R+1],C[3*R+2]);f.normalArray._trim()}if(h.TEXCOORD_0!==void 0&&o.length>0){f.texcoordArray=new Dm;const k=n.json.accessors[h.TEXCOORD_0];f.texcoordArray.reserve(k.count);const C=mh(n,k);for(let R=0;R<k.count;R++)f.texcoordArray.emplaceBack(C[2*R],C[2*R+1]);f.texcoordArray._trim()}const I=r.material;return f.material=function(k,C){const{emissiveFactor:R=[0,0,0],alphaMode:L="OPAQUE",alphaCutoff:N=.5,normalTexture:j,occlusionTexture:Z,emissiveTexture:X,doubleSided:J}=k,{baseColorFactor:te=[1,1,1,1],metallicFactor:re=1,roughnessFactor:pe=1,baseColorTexture:ve,metallicRoughnessTexture:be}=k.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new sr(...te),metallicFactor:re,roughnessFactor:pe,baseColorTexture:ve?C[ve.index]:void 0,metallicRoughnessTexture:be?C[be.index]:void 0},doubleSided:J,emissiveFactor:R,alphaMode:L,alphaCutoff:N,normalTexture:j?C[j.index]:void 0,occlusionTexture:Z?C[Z.index]:void 0,emissionTexture:X?C[X.index]:void 0,defined:k.defined===void 0}}(I!==void 0?n.json.materials[I]:{defined:!1},o),h._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(mh(n,n.json.accessors[h._FEATURE_RGBA4444]).buffer)),f}function RO(r,n,o){const{matrix:l,rotation:h,translation:f,scale:m,mesh:_,extras:x,children:w}=r,E={};if(E.matrix=l||a.m.fromRotationTranslationScale([],h||[0,0,0,1],f||[0,0,0],m||[1,1,1]),_!==void 0){E.meshes=o[_];const I=E.anchor=[0,0];for(const k of E.meshes){const{min:C,max:R}=k.aabb;I[0]+=C[0]+R[0],I[1]+=C[1]+R[1]}I[0]=Math.floor(I[0]/E.meshes.length/2),I[1]=Math.floor(I[1]/E.meshes.length/2)}if(x&&(x.id&&(E.id=x.id),x.lights&&(E.lights=function(I){if(!I.length)return[];const k=function(j){const Z=atob(j),X=new Uint8Array(Z.length);for(let J=0;J<Z.length;J++)X[J]=Z.codePointAt(J);return X}(I),C=[],R=k.length/24,L=new Uint16Array(k.buffer),N=new Float32Array(k.buffer);for(let j=0;j<R;j++){const Z=L[2*j*6]/30,X=L[2*j*6+1]/30,J=L[2*j*6+10]/100,te=N[6*j+1],re=N[6*j+2],pe=N[6*j+3],ve=N[6*j+4],be=pe-te,Pe=ve-re,Se=Math.hypot(be,Pe);C.push({pos:[te+.5*be,re+.5*Pe,X],normal:[Pe/Se,-be/Se,0],width:Se,height:Z,depth:J,points:[te,re,pe,ve]})}return C}(x.lights))),w){const I=[];for(const k of w)I.push(RO(n.json.nodes[k],n,o));E.children=I}return E}function $8(r){if(r.vertices.length===0||r.indices.length===0)return null;const[n,o]=[r.vertices[0].clone(),r.vertices[0].clone()];for(let m=1;m<r.vertices.length;++m){const _=r.vertices[m];n.x=Math.min(n.x,_.x),n.y=Math.min(n.y,_.y),o.x=Math.max(o.x,_.x),o.y=Math.max(o.y,_.y)}const l=Math.ceil(Math.max(o.x-n.x,o.y-n.y)/256),h=Math.max(8,l),f=new MO(r.vertices,r.indices,h);return{vertices:r.vertices,indices:r.indices,grid:f,min:n,max:o}}function G8(r){if(!r.extras||!r.extras.ground)return null;const n=r.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const o=n[0];if(!o||!Array.isArray(o)||o.length===0)return null;const l=[];for(const m of o){if(!Array.isArray(m)||m.length!==2)continue;const _=m[0],x=m[1];typeof _=="number"&&typeof x=="number"&&l.push(new Oe(_,x))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let h=0;for(let m=0;m<l.length;m++){const _=l[m],x=l[(m+1)%l.length],w=l[(m+2)%l.length];h+=(_.x-x.x)*(w.y-x.y)-(w.x-x.x)*(_.y-x.y)}h>0&&l.reverse();const f=W0(l.flatMap(m=>[m.x,m.y]),[]);return f.length===0?null:{vertices:l,indices:f}}function W8(r){const n=[],o=[];let l=0;for(const h of r){l=n.length;const f=h.vertexArray.float32,m=h.indexArray.uint16;for(let _=0;_<h.vertexArray.length;_++)n.push(new Oe(f[3*_+0],f[3*_+1]));for(let _=0;_<3*h.indexArray.length;_++)o.push(m[_]+l)}if(o.length%3!=0)return null;for(let h=0;h<o.length;h+=3){const f=n[o[h+0]],m=n[o[h+1]],_=n[o[h+2]];(f.x-m.x)*(_.y-m.y)-(_.x-m.x)*(f.y-m.y)>0&&([o[h+1],o[h+2]]=[o[h+2],o[h+1]])}return{vertices:n,indices:o}}function OO(r){const n=function(x,w){const E=[],I=WebGL2RenderingContext;if(x.json.textures)for(const k of x.json.textures){const C={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};k.sampler!==void 0&&Object.assign(C,x.json.samplers[k.sampler]),E.push({image:w[k.source],sampler:C,uploaded:!1})}return E}(r,r.images),o=function(x,w){const E=[];for(const I of x.json.meshes){const k=[];for(const C of I.primitives)k.push(U8(C,x,w));E.push(k)}return E}(r,n),{scenes:l,scene:h,nodes:f}=r.json,m=l?l[h||0].nodes:f,_=[];for(const x of m)_.push(RO(f[x],r,o));return function(x,w,E){const I={},k=new Set;for(let C=0;C<x.length;C++){const R=E[w[C]];if(!R.extras)continue;const L=R.extras["mapbox:footprint:version"],N=R.extras["mapbox:footprint:id"];(L||N)&&k.add(C),L==="1.0.0"&&N&&(I[N]=C)}for(let C=0;C<x.length;C++){if(k.has(C))continue;const R=x[C],L=E[w[C]];if(!L.extras)continue;let N=null;R.id in I&&(N=W8(x[I[R.id]].meshes)),N||(N=G8(L)),N&&(R.footprint=$8(N))}if(k.size>0){const C=Array.from(k.values()).sort((R,L)=>R-L);for(let R=C.length-1;R>=0;R--)x.splice(C[R],1)}}(_,m,r.json.nodes),_}function q8(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const n=r.vertexArray.float32,o=r.aabb.min[0]-1,l=r.aabb.min[1]-1,h=fh/(r.aabb.max[0]-o+2),f=fh/(r.aabb.max[1]-l+2);for(let m=0;m<n.length;m+=3){const _=n[m+2],x=(n[m+0]-o)*h|0,w=(n[m+1]-l)*f|0;_>r.heightmap[w*fh+x]&&(r.heightmap[w*fh+x]=_)}}function H8(r,n){const o={};o.indexArray=new Bn,o.indexArray.reserve(4*r.length),o.vertexArray=new th,o.vertexArray.reserve(10*r.length),o.colorArray=new Rn,o.vertexArray.reserve(10*r.length);let l=0;for(const m of r){const _=Math.min(10,Math.max(4,1.3*m.height))*n,x=[-m.normal[1],m.normal[0],0],w=Math.min(.29,.1*m.width/m.depth),E=m.width-2*m.depth*n*(w+.01),I=a.v.scaleAndAdd([],m.pos,x,E/2),k=a.v.scaleAndAdd([],m.pos,x,-E/2),C=[I[0],I[1],I[2]+m.height],R=[k[0],k[1],k[2]+m.height],L=a.v.scaleAndAdd([],m.normal,x,w);a.v.scale(L,L,_);const N=a.v.scaleAndAdd([],m.normal,x,-w);a.v.scale(N,N,_),a.v.add(L,I,L),a.v.add(N,k,N),I[2]+=.1,k[2]+=.1,o.vertexArray.emplaceBack(L[0],L[1],L[2]),o.vertexArray.emplaceBack(N[0],N[1],N[2]),o.vertexArray.emplaceBack(I[0],I[1],I[2]),o.vertexArray.emplaceBack(k[0],k[1],k[2]),o.vertexArray.emplaceBack(C[0],C[1],C[2]),o.vertexArray.emplaceBack(R[0],R[1],R[2]),o.vertexArray.emplaceBack(I[0],I[1],I[2]),o.vertexArray.emplaceBack(k[0],k[1],k[2]),o.vertexArray.emplaceBack(L[0],L[1],L[2]),o.vertexArray.emplaceBack(N[0],N[1],N[2]);const j=E/_/2;o.colorArray.emplaceBack(-j-w,-1,j,.8),o.colorArray.emplaceBack(j+w,-1,j,.8),o.colorArray.emplaceBack(-j,0,j,1.3),o.colorArray.emplaceBack(j,0,j,1.3),o.colorArray.emplaceBack(j+w,-.8,j,.7),o.colorArray.emplaceBack(j+w,-.8,j,.7),o.colorArray.emplaceBack(0,0,j,1.3),o.colorArray.emplaceBack(0,0,j,1.3),o.colorArray.emplaceBack(j+w,-1.2,j,.8),o.colorArray.emplaceBack(j+w,-1.2,j,.8),o.indexArray.emplaceBack(6+l,4+l,8+l),o.indexArray.emplaceBack(7+l,9+l,5+l),o.indexArray.emplaceBack(0+l,1+l,2+l),o.indexArray.emplaceBack(1+l,3+l,2+l),l+=10}const h={defined:!0,emissiveFactor:[0,0,0]},f={};return f.baseColorFactor=sr.white,h.pbrMetallicRoughness=f,o.material=h,o.aabb=new Dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}xt(MO,"TriangleGridIndex");const DO=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class dT{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,l]=new Uint8Array(n,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const f=DO[15&l];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(n,2,1),[_]=new Uint32Array(n,4,1);return new dT(_,m,f,n)}constructor(n,o=64,l=Float64Array,h){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=l,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const f=DO.indexOf(this.ArrayType),m=2*n*this.ArrayType.BYTES_PER_ELEMENT,_=n*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+_+x,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+m+_+x),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+_+x,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=n)}add(n,o){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=n,this.coords[this._pos++]=o,l}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return fT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,o,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:_}=this,x=[0,f.length-1,0],w=[];for(;x.length;){const E=x.pop()||0,I=x.pop()||0,k=x.pop()||0;if(I-k<=_){for(let N=k;N<=I;N++){const j=m[2*N],Z=m[2*N+1];j>=n&&j<=l&&Z>=o&&Z<=h&&w.push(f[N])}continue}const C=k+I>>1,R=m[2*C],L=m[2*C+1];R>=n&&R<=l&&L>=o&&L<=h&&w.push(f[C]),(E===0?n<=R:o<=L)&&(x.push(k),x.push(C-1),x.push(1-E)),(E===0?l>=R:h>=L)&&(x.push(C+1),x.push(I),x.push(1-E))}return w}within(n,o,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:f,nodeSize:m}=this,_=[0,h.length-1,0],x=[],w=l*l;for(;_.length;){const E=_.pop()||0,I=_.pop()||0,k=_.pop()||0;if(I-k<=m){for(let N=k;N<=I;N++)zO(f[2*N],f[2*N+1],n,o)<=w&&x.push(h[N]);continue}const C=k+I>>1,R=f[2*C],L=f[2*C+1];zO(R,L,n,o)<=w&&x.push(h[C]),(E===0?n-l<=R:o-l<=L)&&(_.push(k),_.push(C-1),_.push(1-E)),(E===0?n+l>=R:o+l>=L)&&(_.push(C+1),_.push(I),_.push(1-E))}return x}}function fT(r,n,o,l,h,f){if(h-l<=o)return;const m=l+h>>1;LO(r,n,m,l,h,f),fT(r,n,o,l,m-1,1-f),fT(r,n,o,m+1,h,1-f)}function LO(r,n,o,l,h,f){for(;h>l;){if(h-l>600){const w=h-l+1,E=o-l+1,I=Math.log(w),k=.5*Math.exp(2*I/3),C=.5*Math.sqrt(I*k*(w-k)/w)*(E-w/2<0?-1:1);LO(r,n,o,Math.max(l,Math.floor(o-E*k/w+C)),Math.min(h,Math.floor(o+(w-E)*k/w+C)),f)}const m=n[2*o+f];let _=l,x=h;for(fg(r,n,l,o),n[2*h+f]>m&&fg(r,n,l,h);_<x;){for(fg(r,n,_,x),_++,x--;n[2*_+f]<m;)_++;for(;n[2*x+f]>m;)x--}n[2*l+f]===m?fg(r,n,l,x):(x++,fg(r,n,x,h)),x<=o&&(l=x+1),o<=x&&(h=x-1)}}function fg(r,n,o,l){pT(r,o,l),pT(n,2*o,2*l),pT(n,2*o+1,2*l+1)}function pT(r,n,o){const l=r[n];r[n]=r[o],r[o]=l}function zO(r,n,o,l){const h=r-o,f=n-l;return h*h+f*f}a.$=45,a.A=Pr,a.B=function(r){const n=a.m.identity(new Float64Array(16));a.m.multiply(n,r.pixelMatrix,r.globeMatrix);const o=[0,Ss,0],l=[0,Is,0];return a.v.transformMat4(o,o,n),a.v.transformMat4(l,l,n),[o[0]>0&&o[0]<=r.width&&o[1]>0&&o[1]<=r.height&&!d2(r,new On(r.center.lat,90)),l[0]>0&&l[0]<=r.width&&l[1]>0&&l[1]<=r.height&&!d2(r,new On(r.center.lat,-90))]},a.C=sr,a.D=Ec,a.E=Ra,a.F=o2,a.G=JC,a.H=Oa,a.I=hh,a.J=at,a.K=function(r,n){const{scale:o}=r.tileTransform,l=o*at/(r.tileSize*Math.pow(2,n.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return a.h.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[l,l])},a.L=On,a.M=Ai,a.N=yv,a.O=hi,a.P=Oe,a.Q=kR,a.R=r2,a.S=function(r){const n=kR(r,!0);return a.h.invert([],[n[0],n[1],n[4],n[5]])},a.T=i2,a.U=ZC,a.V=function(r){const{x:n,y:o}=r.point,{lng:l,lat:h}=r._center;return oM(n,o,r.worldSize,l,h)},a.W=ls,a.X=pr,a.Y=kn,a.Z=s2,a._=function(r){const n=Math.round((r+45+360)%360/90)%4;return Er[n]},a.a=Ps,a.a$=P0,a.a0=p2,a.a1=function(r,n){return js(br(r,{type:"json"}),n)},a.a2=ai,a.a3=Ue,a.a4=Li,a.a5=as,a.a6=ys,a.a7=tl,a.a8=Xo,a.a9=Pl,a.aA=ch,a.aB=hM,a.aC=ss,a.aD=wO,a.aE=mt,a.aF=TO,a.aG=function(r){Qr++,Qr>Vn&&(r.getActor().send("enforceCacheSizeLimit",Zt),Qr=0)},a.aH=Sr,a.aI=Dy,a.aJ=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},a.aK=_O,a.aL=function(r,n){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){n(null,o)};for(let l=0;l<r.length;l++){const h=document.createElement("source");Vs(r[l])||(o.crossOrigin="Anonymous"),h.src=r[l],o.appendChild(h)}return{cancel:()=>{}}},a.aM=kt,a.aN=mv,a.aO=function(r){return fetch(r).then(n=>n.arrayBuffer()).then(n=>CO(n,0,r))},a.aP=OO,a.aQ=class{constructor(r,n,o,l){this.id=r,this.position=n!=null?new On(n[0],n[1]):new On(0,0),this.orientation=o??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new Dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,n){if(a.m.multiply(r.matrix,n,r.matrix),r.meshes)for(const o of r.meshes){const l=Dr.applyTransform(o.aabb,r.matrix);this.aabb.encapsulate(l)}if(r.children)for(const o of r.children)this._applyTransformations(o,r.matrix)}computeBoundsAndApplyParent(){const r=a.m.identity([]);for(const n of this.nodes)this._applyTransformations(n,r)}_positionModelOnTerrain(r,n){const o=r.elevation;if(!o)return 0;const l=Dr.projectAabbCorners(this.aabb,this.matrix),h=to(1,this.position.lat)*r.worldSize,f=function(N,j){const Z=[0,0,1],X=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const J of X){const te=N[J.corners[0]],re=N[J.corners[1]],pe=N[J.corners[2]],ve=[re[0]-te[0],re[1]-te[1],j*(re[2]-te[2])],be=a.v.cross(ve,ve,[pe[0]-te[0],pe[1]-te[1],j*(pe[2]-te[2])]);a.v.normalize(be,be),J.dotProductWithUp=a.v.dot(be,Z)}return X.sort((J,te)=>J.dotProductWithUp-te.dotProductWithUp),X[0].corners}(l,h),m=l[f[0]],_=l[f[1]],x=l[f[2]],w=l[f[3]],E=o.getAtPointOrZero(new Ai(m[0]/r.worldSize,m[1]/r.worldSize),0),I=o.getAtPointOrZero(new Ai(_[0]/r.worldSize,_[1]/r.worldSize),0),k=o.getAtPointOrZero(new Ai(x[0]/r.worldSize,x[1]/r.worldSize),0),C=o.getAtPointOrZero(new Ai(w[0]/r.worldSize,w[1]/r.worldSize),0),R=(E+C)/2,L=(I+k)/2;return R>L?I<k?vv(n,_,w,m,I,C,E,h):vv(n,x,m,w,k,E,C,h):E<C?vv(n,m,_,x,E,I,k,h):vv(n,w,x,_,C,k,I,h),Math.max(R,L)}computeModelMatrix(r,n,o,l,h,f,m=!1){const _=r.transform,x=_.zoom,w=_.project(this.position),E=lh(this.position.lat,x),I=1/E;a.m.identity(this.matrix),a.m.translate(this.matrix,this.matrix,[w.x+l[0]*I,w.y+l[1]*I,l[2]]);let k=1,C=1;const R=_.worldSize;if(m){if(_.projection.name==="mercator"){let Z=0;_.elevation&&(Z=_.elevation.getAtPointOrZero(new Ai(w.x/R,w.y/R),0));const X=a.e.transformMat4([],[w.x,w.y,Z,1],_.projMatrix)[3]/_.cameraToCenterDistance;k=X,C=X*lh(_.center.lat,x)}else if(_.projection.name==="globe"){const Z=LR(this.matrix,_),X=a.m.multiply([],_.projMatrix,Z),J=[0,0,0,1];a.e.transformMat4(J,J,X);const te=J[3]/_.cameraToCenterDistance,re=El(x),pe=_.projection.pixelsPerMeter(this.position.lat,R)*lh(this.position.lat,x),ve=_.projection.pixelsPerMeter(_.center.lat,R)*lh(_.center.lat,x);k=te/ln(pe,cM(_.center.lat),re),C=te*E/pe,k*=ve,C*=ve}}else k=I;a.m.scale(this.matrix,this.matrix,[k,k,C]);const L=[...this.matrix],N=this.orientation,j=[];if(DR(j,[N[0]+n[0],N[1]+n[1],N[2]+n[2]],o),a.m.multiply(this.matrix,L,j),h&&_.elevation){let Z=0;const X=[];if(f&&_.elevation){Z=this._positionModelOnTerrain(_,X);const J=a.m.fromQuat([],X),te=a.m.multiply([],J,j);a.m.multiply(this.matrix,L,te)}else Z=_.elevation.getAtPointOrZero(new Ai(w.x/R,w.y/R),0);Z!==0&&(this.matrix[14]+=Z)}}upload(r){if(!this.uploaded){for(const n of this.nodes)J2(n,r);for(const n of this.nodes)bv(n);this.uploaded=!0}}destroy(){for(const r of this.nodes)wv(r)}},a.aR=ac,a.aS=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.aT=cR,a.aU=fM,a.aV=Ti,a.aW=mR,a.aX=V2,a.aY=z2,a.aZ=dT,a.a_=zm,a.aa=N2,a.ab=F2,a.ac=$e,a.ad=ne,a.ae=Ie,a.af=class{constructor(r){this.specification=r}possiblyEvaluate(r,n){return ue(r.expression.evaluate(n))}interpolate(r,n,o){return{x:ln(r.x,n.x,o),y:ln(r.y,n.y,o),z:ln(r.z,n.z,o),azimuthal:ln(r.azimuthal,n.azimuthal,o),polar:ln(r.polar,n.polar,o)}}},a.ag=Ae,a.ah=r=>ts(Pm(r)),a.ai=E0,a.aj=Rm,a.ak=br,a.al=de,a.am=Yu,a.an=St,a.ao=El,a.ap=r=>ts(Mm(r)),a.aq=Ad,a.ar=Ve,a.as=class{constructor(r){this.specification=r}possiblyEvaluate(r,n){return function([o,l]){const h=ue([1,o,l]);return{x:h.x,y:h.y,z:h.z}}(r.expression.evaluate(n))}interpolate(r,n,o){return{x:ln(r.x,n.x,o),y:ln(r.y,n.y,o),z:ln(r.z,n.z,o)}}},a.at=function(r,n,o=0,l=!0){const h=new Oe(o,o),f=r.sub(h),m=n.add(h),_=[f,new Oe(m.x,f.y),m,new Oe(f.x,m.y)];return l&&_.push(f.clone()),_},a.au=function(r,n){const o=[];for(let l=0;l<r.length;l++){const h=Lt(l-1,-1,r.length-1),f=Lt(l+1,-1,r.length-1),m=r[l],_=r[f],x=r[h].sub(m).unit(),w=_.sub(m).unit(),E=w.angleWithSep(x.x,x.y),I=x.add(w).unit().mult(-1*n/Math.sin(E/2));o.push(m.add(I))}return o},a.av=vR,a.aw=_M,a.ax=function(r,n,o=0){return a.v.fromValues(((n.x-o)*r.scale-r.x)*at,(n.y*r.scale-r.y)*at,lM(n.z,n.y))},a.ay=OR,a.az=function(r){let n=1/0,o=1/0,l=-1/0,h=-1/0;for(const f of r)n=Math.min(n,f.x),o=Math.min(o,f.y),l=Math.max(l,f.x),h=Math.max(h,f.y);return{min:new Oe(n,o),max:new Oe(l,h)}},a.b=to,a.b$=0,a.b0=nh,a.b1=Mk,a.b2=eo,a.b3=function(r,n,o){const l=Math.sqrt(r*r+n*n+o*o),h=l>0?Math.acos(o/l)*er:0;let f=r!==0||n!==0?Math.atan2(-n,-r)*er+90:0;return f<0&&(f+=360),[l,f,h]},a.b4=af,a.b5=Qs,a.b6=Z2,a.b7=Bw,a.b8=class extends _l{constructor(r){super(r),this.current=wj}set(r,n,o){if(this.fetchUniformLocation(r,n)){for(let l=0;l<9;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},a.b9=Ck,a.bA=function(r,n){const o=[0,0,0],l=Um(Ma(n.canonical));return a.v.transformMat4(o,o,l),a.v.transformMat4(o,o,r),o},a.bB=r=>({u_camera_to_center_distance:new eo(r),u_extrude_scale:new jw(r),u_device_pixel_ratio:new eo(r),u_matrix:new zm(r),u_inv_rot_matrix:new zm(r),u_merc_center:new nh(r),u_tile_id:new Bw(r),u_zoom_transition:new eo(r),u_up_dir:new Bw(r),u_emissive_strength:new eo(r)}),a.bC=r=>({u_matrix:new zm(r),u_pixels_to_tile_units:new jw(r),u_device_pixel_ratio:new eo(r),u_units_to_pixels:new nh(r),u_dash_image:new P0(r),u_gradient_image:new P0(r),u_image_height:new eo(r),u_texsize:new nh(r),u_tile_units_to_pixels:new eo(r),u_alpha_discard_threshold:new eo(r),u_trim_offset:new nh(r),u_emissive_strength:new eo(r)}),a.bD=r=>({u_matrix:new zm(r),u_texsize:new nh(r),u_pixels_to_tile_units:new jw(r),u_device_pixel_ratio:new eo(r),u_image:new P0(r),u_units_to_pixels:new nh(r),u_tile_units_to_pixels:new eo(r),u_alpha_discard_threshold:new eo(r)}),a.bE=qs,a.bF=mU,a.bG=gU,a.bH=xM,a.bI=(r,n,o,l,h,f)=>{const m=r.transform,_=m.projection.name==="globe";let x;if(f.paint.get("circle-pitch-alignment")==="map")if(_){const E=iM(m.zoom,n.canonical)*m._pixelsPerMercatorPixel;x=Float32Array.from([E,0,0,E])}else x=m.calculatePixelsToTileUnitsMatrix(o);else x=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const w={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(m.projection),u_matrix:r.translatePosMatrix(n.projMatrix,o,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Li.devicePixelRatio,u_extrude_scale:x,u_inv_rot_matrix:hV,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(_){w.u_inv_rot_matrix=l,w.u_merc_center=h,w.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],w.u_zoom_transition=El(m.zoom);const E=h[0]*at,I=h[1]*at;w.u_up_dir=m.projection.upVector(new sh(0,0,0),E,I)}return w},a.bJ=dO,a.bK=(r,n,o,l,h)=>{const f=r.transform;return{u_matrix:hO(r,n,o,l),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:f.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:uO(n,f),u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}},a.bL=(r,n,o,l,h,f,m)=>{const _=r.transform,x=_.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:hO(r,n,o,l),u_pixels_to_tile_units:x,u_device_pixel_ratio:f,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:fO(o)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:uO(n,r.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_emissive_strength:o.paint.get("line-emissive-strength")}},a.bM=Ao,a.bN=j0,a.bO=oO,a.bP=Xj,a.bQ=ag,a.bR=zc,a.bS=450,a.bT=7,a.bU=eM,a.bV=u2,a.bW=Mt,a.bX=th,a.bY=eh,a.bZ=1,a.b_=771,a.ba=si,a.bb=function(r,n,o){const l=El(o.zoom),h=r.style.map._antialias,f=n.options.extStandardDerivativesForceOff||r.terrain&&r.terrain.exaggeration()>0;return l===0&&!h&&!f},a.bc=function(r){const n=r.pixelsPerMeter,o=n/to(1,r.center.lat),l=a.m.identity(new Float64Array(16));return a.m.translate(l,l,[r.point.x,r.point.y,0]),a.m.scale(l,l,[o,o,n]),Float32Array.from(l)},a.bd=Yo,a.be=D0,a.bf=function(r){const n=Pr-5;r=Ze(r,-n,n)/n*90;const o=Math.pow(Math.abs(Math.sin(pt(r))),3);return Math.round(o*(a2.length-1))},a.bg=function(r,n,o,l){const h=n.getNorth(),f=n.getSouth(),m=n.getWest(),_=n.getEast(),x=1<<r.z,w=_-m,E=h-f,I=w/Wd,k=-E/a2[o],C=[0,I,0,k,0,0,h,m,0];if(r.z>0){const R=180/l;a.bx.multiply(C,C,[R/w+1,0,0,0,R/E+1,0,-.5*R/I,.5*R/k,1])}return C[2]=x,C[5]=r.x,C[8]=r.y,C},a.bh=Um,a.bi=Ma,a.bj=function(r,n,o){const l=a.m.identity(new Float64Array(16)),h=(n/(1<<r)-.5)*Math.PI*2;return a.m.rotateY(l,o.globeMatrix,h),Float32Array.from(l)},a.bk=class{isDataAvailableAtPoint(r){const n=this._source();if(this.isUsingMockSource()||!n||r.y<0||r.y>1)return!1;const o=n.getSource().maxzoom,l=1<<o,h=Math.floor(r.x),f=Math.floor((r.x-h)*l),m=Math.floor(r.y*l),_=this.findDEMTileFor(new hi(o,h,o,f,m));return!(!_||!_.dem)}getAtPointOrZero(r,n=0){return this.getAtPoint(r,n)||0}getAtPoint(r,n,o=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const l=this._source();if(!l||r.y<0||r.y>1)return n;const h=l.getSource().maxzoom,f=1<<h,m=Math.floor(r.x),_=r.x-m,x=new hi(h,m,h,Math.floor(_*f),Math.floor(r.y*f)),w=this.findDEMTileFor(x);if(!w||!w.dem)return n;const E=w.dem,I=1<<w.tileID.canonical.z,k=(_*I-w.tileID.canonical.x)*E.dim,C=(r.y*I-w.tileID.canonical.y)*E.dim,R=Math.floor(k),L=Math.floor(C);return(o?this.exaggeration():1)*ln(ln(E.get(R,L),E.get(R,L+1),C-L),ln(E.get(R+1,L),E.get(R+1,L+1),C-L),k-R)}getAtTileOffset(r,n,o){const l=1<<r.canonical.z;return this.getAtPointOrZero(new Ai(r.wrap+(r.canonical.x+n/at)/l,(r.canonical.y+o/at)/l))}getAtTileOffsetFunc(r,n,o,l){return h=>{const f=this.getAtTileOffset(r,h.x,h.y),m=l.upVector(r.canonical,h.x,h.y),_=l.upVectorScale(r.canonical,n,o).metersToTile;return a.v.scale(m,m,f*_),m}}getForTilePoints(r,n,o,l){if(this.isUsingMockSource())return!1;const h=Qd.create(this,r,l);return!!h&&(n.forEach(f=>{f[2]=this.exaggeration()*h.getElevationAt(f[0],f[1],o)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(r);if(!n||!n.dem)return null;const o=n.dem.tree,l=n.tileID,h=1<<r.canonical.z-l.canonical.z;let f=r.canonical.x/h-l.canonical.x,m=r.canonical.y/h-l.canonical.y,_=0;for(let x=0;x<r.canonical.z-l.canonical.z&&!o.leaves[_];x++){f*=2,m*=2;const w=2*Math.floor(m)+Math.floor(f);_=o.childOffsets[_]+w,f%=1,m%=1}return{min:this.exaggeration()*o.minimums[_],max:this.exaggeration()*o.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,n,o){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let n=!1,o=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const h of r){const f=this.getMinMaxForTile(h.tileID);f&&(o=Math.min(o,f.min),l=Math.max(l,f.max),n=!0)}return n?{min:o,max:l}:null}},a.bl=Fm,a.bm=mr,a.bn=O0,a.bo=Qt,a.bp=Bn,a.bq=dh,a.br=cg,a.bs=iT,a.bt=q2,a.bu=IM,a.bv=function(r,n){return[Math.pow(r[0],2.2)*n,Math.pow(r[1],2.2)*n,Math.pow(r[2],2.2)*n]},a.bw=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},a.by=iM,a.bz=256,a.c=Ze,a.c$=A,a.c0=Rw,a.c1=function(r,n,o,l,h){return Ze((r-n)/(o-n)*(h-l)+l,l,h)},a.c2=Gu,a.c3=Dr,a.c4=lh,a.c5=LR,a.c6=[1,1,1],a.c7=Qd,a.c8=xv,a.c9=ji,a.cA=id,a.cB=r=>ts(Cm(r)),a.cC=K,a.cD=js,a.cE=xr,a.cF=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.cG=rr,a.cH=uM,a.cI=ah,a.cJ=function([r,n,o]){const l=Math.hypot(r,n,o),h=Math.atan2(r,o),f=.5*Math.PI-Math.acos(-n/l);return new On(kn(h),kn(f))},a.cK=zo,a.cL=$m,a.cM=B,a.cN=d2,a.cO=sM,a.cP=function(r){const n=[0,0,0],o=a.m.identity(new Float64Array(16));return a.m.multiply(o,r.pixelMatrix,r.globeMatrix),a.v.transformMat4(n,n,o),new Oe(n[0],n[1])},a.cQ=function(r){const n=r.navigator?r.navigator.userAgent:null;return!!function(o){if(Ye==null){const l=o.navigator?o.navigator.userAgent:null;Ye=!!o.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Ye}(r)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.cR=_s,a.cS=class{constructor(r,n,o){this._transformRequestFn=r,this._customAccessToken=n,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const r=function(){let n="";for(let o=0;o<10;o++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",le,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,n){return this._transformRequestFn&&this._transformRequestFn(r,n)||{url:r}}normalizeStyleURL(r,n){if(!rt(r))return r;const o=ot(r);return o.params.push(`sdk=js-${A}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeGlyphsURL(r,n){if(!rt(r))return r;const o=ot(r);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeModelURL(r,n){if(!rt(r))return r;const o=ot(r);return o.path=`/models/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeSourceURL(r,n,o,l){if(!rt(r))return r;const h=ot(r);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),o&&h.params.push(`language=${o}`),l&&h.params.push(`worldview=${l}`),this._makeAPIURL(h,this._customAccessToken||n)}normalizeSpriteURL(r,n,o,l){const h=ot(r);return rt(r)?(h.path=`/styles/v1${h.path}/sprite${n}${o}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${n}${o}`,tn(h))}normalizeTileURL(r,n,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!rt(r))return r;const l=ot(r);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||o&&l.authority!=="raster"&&o===512?"@2x":""}${$.supported?".webp":"$1"}`),l.authority==="raster"?l.path=`/${B.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${B.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(f){for(const m of f){const _=m.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(l.params)||B.ACCESS_TOKEN;return B.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(r,n){const o=ot(r);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return r;let l="mapbox://";o.path.match(/^\/raster\/v1\//)?l+=`raster/${o.path.replace(`/${B.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${o.path.replace(`/${B.TILE_URL_VERSION}/`,"")}`;let h=o.params;return n&&(h=h.filter(f=>!f.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(r,n){const o=!!n&&rt(n),l=[];for(const h of r.tiles||[])st(h)?l.push(this.canonicalizeTileURL(h,o)):l.push(h);return l}_makeAPIURL(r,n){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=ot(B.API_URL);if(r.protocol=l.protocol,r.authority=l.authority,r.protocol==="http"){const h=r.params.indexOf("secure");h>=0&&r.params.splice(h,1)}if(l.path!=="/"&&(r.path=`${l.path}${r.path}`),!B.REQUIRE_ACCESS_TOKEN)return tn(r);if(n=n||B.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return r.params=r.params.filter(h=>h.indexOf("access_token")===-1),r.params.push(`access_token=${n||""}`),tn(r)}},a.cT=function(r,n){n?Ki.add(r):Ki.delete(r)},a.cU=$,a.cV=ko,a.cW=vi,a.cX=tt,a.cY=yi,a.cZ=function(r){Ki.delete(r)},a.c_=vn,a.ca=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r){const n=WR(new Oe(0,0),new Oe(at,at),r),o=[];for(const l of this._activeRegions){if(l.hiddenByOverlap||!GR(n,l))continue;const h=d8(l.min,l.max,r);o.push({min:h.min,max:h.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId})}return o}setSources(r){this._setSources(r.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const o=[];for(const l of n.cache.getVisibleCoordinates()){const h=n.cache.getTile(l).buckets[n.layer];if(h)for(const f of h.getNodesInfo()){const m=f.node;m.footprint&&o.push({footprint:m.footprint,id:l.toUnwrapped()})}}return o}})))}_addSource(r){const n=r.getFootprints();if(n.length!==0){for(const o of n){if(!o.footprint)continue;const l=WR(o.footprint.min,o.footprint.max,o.id);this._activeRegions.push({min:l.min,max:l.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:o.id,footprint:o.footprint})}this._sourceIds.push(r.getSourceId())}}_computeReplacement(){this._activeRegions.sort((n,o)=>n.priority-o.priority||Tv(n.min,o.min)||Tv(n.max,o.max));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let n=0,o=0;for(;!r&&n!==this._activeRegions.length;){const l=this._activeRegions[n],h=this._prevRegions[o];r=l.priority!==h.priority||!$R(l,h),++n,++o}}if(r){++this._updateTime;const n=o=>{const l=this._activeRegions;if(o>=l.length)return o;const h=l[o].priority;for(;o<l.length&&l[o].priority===h;)++o;return o};if(this._sourceIds.length>1){let o=0,l=n(o);for(;o!==l;){let h=o;const f=o;for(;h!==l;){const m=this._activeRegions[h];m.hiddenByOverlap=!1;for(let _=0;_<f;_++){const x=this._activeRegions[_];if(!x.hiddenByOverlap&&GR(m,x)&&(m.hiddenByOverlap=HR(m.footprint,m.tileId,x.footprint,x.tileId),m.hiddenByOverlap))break}++h}o=l,l=n(o)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=r.length-1;n>=0;n--)this._addSource(r[n]);this._computeReplacement()}},a.cb=Nn,a.cc=_v,a.cd=Om,a.ce=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,n){const o=new Qt,l=new Bn,h=[],f=r+1+2,m=n[0]+1,_=n[0]+1+(1+n.length),x=(w,E,I)=>{let k=w===f-1?w-2:w===0?w:w-1;return k+=I?24575:0,[k,E]};for(let w=0;w<f;++w)o.emplaceBack(...x(w,0,!0));for(let w=0;w<m;++w)for(let E=0;E<f;++E)o.emplaceBack(...x(E,w,(E===0||E===f-1)&&!0));for(let w=0;w<n.length;++w){const E=n[w];for(let I=0;I<f;++I)o.emplaceBack(...x(I,E,!0))}for(let w=0;w<n.length;++w){const E=l.length,I=n[w]+1+2,k=new Bn;for(let L=0;L<I-1;L++){const N=L===I-2,j=N?f*(_-n.length+w-L):f;for(let Z=0;Z<f-1;Z++){const X=L*f+Z;L===0||N||Z===0||Z===f-2?(k.emplaceBack(X+1,X,X+j),k.emplaceBack(X+j,X+j+1,X+1)):(l.emplaceBack(X+1,X,X+j),l.emplaceBack(X+j,X+j+1,X+1))}}const C=mr.simpleSegment(0,E,o.length,l.length-E);for(let L=0;L<k.uint16.length;L+=3)l.emplaceBack(k.uint16[L],k.uint16[L+1],k.uint16[L+2]);const R=mr.simpleSegment(0,E,o.length,l.length-E);h.push({withoutSkirts:C,withSkirts:R})}return{vertices:o,indices:l,segments:h}}_createGrid(r){const n=this._fillGridMeshWithLods(Wd,a2);this._gridSegments=n.segments,this._gridBuffer=r.createVertexBuffer(n.vertices,Fm.members),this._gridIndexBuffer=r.createIndexBuffer(n.indices,!0)}_createPoles(r){const n=new Bn;for(let m=0;m<=Wd;m++)n.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=r.createIndexBuffer(n,!0);const o=new eh,l=new eh,h=new eh,f=new eh;this._poleSegments=[];for(let m=0,_=0;m<s2;m++){const x=360/(1<<m);o.emplaceBack(0,-ss,0,.5,0),l.emplaceBack(0,-ss,0,.5,1),h.emplaceBack(0,-ss,0,.5,.5),f.emplaceBack(0,-ss,0,.5,.5);for(let w=0;w<=Wd;w++){let E=w/Wd,I=0;const k=ln(0,x,E),[C,R,L]=qd(Qj,eV,k,ss);o.emplaceBack(C,R,L,E,I),l.emplaceBack(C,R,L,E,1-I);const N=pt(k);E=.5+.5*Math.sin(N),I=.5+.5*Math.cos(N),h.emplaceBack(C,R,L,E,I),f.emplaceBack(C,R,L,E,1-I)}this._poleSegments.push(mr.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(o,R0,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(l,R0,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(h,R0,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(f,R0,!1)}getGridBuffers(r,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},a.cf=function(r){return Ki.has(r)},a.cg=z0,a.ch=ue,a.ci=function(r){return r({pluginStatus:G,pluginURL:Q}),K.on("pluginStateChange",r),r},a.cj=nf,a.ck=B2,a.cl=Di,a.cm=oe,a.cn=rt,a.co=Zo,a.cp=function(r,n,o){return r.type==="custom"?new k8(r,n):new O8[r.type](r,n,o)},a.cq=function(r){const n=r.indexOf(bt);return n>=0?r.slice(0,n):r},a.cr=r=>ts(w0(r)),a.cs=r=>ts(x0(r)),a.ct=r=>ts(km(r)),a.cu=function(r){return r.indexOf(bt)>=0},a.cv=function(r){const n=r.indexOf(bt);return n>=0?r.slice(n+1):""},a.cw=Zu,a.cx=function(r){const n=[],o=r.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),r.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},a.cy=r=>ts(v0(r)),a.cz=r=>ts(Am(r)),a.d=pt,a.d0=function(r,n){Zt=r,Vn=n},a.d1=function(r,n,o=!1){if(G===U||G===W||G===H)throw new Error("setRTLTextPlugin cannot be called multiple times.");Q=Li.resolveURL(r),G=U,q=n,ce(),o||he()},a.d2=ee,a.d3=function(){iT().acquire(rT)},a.d4=function(){const r=dg;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(rT),dg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.d5=hg,a.d6=function(r){const n=tr();if(!n)return;const o=n.delete(Wt);r&&o.catch(r).then(()=>r())},a.d7=ug,a.d8=EO,a.d9=function(r){oT=Li.resolveURL(r),sT||(sT=new cg(iT(),new ys)),sT.broadcast("setDracoUrl",oT)},a.da=Kn,a.db=Q0,a.dc=fe,a.dd=Z0,a.de=H0,a.df=It,a.dg=LM,a.dh=class extends ys{constructor(r,n,o,l,h,f){super(),this.actor=r,this.layerIndex=n,this.availableImages=o,this.loadVectorData=h||TO,this.loading={},this.loaded={},this.deduped=new wO(r.scheduler),this.isSpriteLoaded=l,this.scheduler=r.scheduler,this.brightness=f}loadTile(r,n){const o=r.uid,l=r&&r.request,h=l&&l.collectResourceTiming,f=this.loading[o]=new z8(r);f.abort=this.loadVectorData(r,(m,_)=>{const x=!this.loading[o];if(delete this.loading[o],x||m||!_)return f.status="done",x||(this.loaded[o]=f),n(m);const w=_.rawData,E={};_.expires&&(E.expires=_.expires),_.cacheControl&&(E.cacheControl=_.cacheControl),f.vectorTile=_.vectorTile||new C2(new J0(w));const I=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,C)=>{if(k||!C)return n(k);const R={};if(h){const L=Lp(l);L.length>0&&(R.resourceTiming=JSON.parse(JSON.stringify(L)))}n(null,br({rawTileData:w.slice(0)},C,E,R))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[o]=f})}reloadTile(r,n){const o=this.loaded,l=r.uid,h=this;if(o&&o[l]){const f=o[l];f.showCollisionBoxes=r.showCollisionBoxes,f.projection=r.projection,f.brightness=r.brightness,f.tileTransform=Mc(r.tileID.canonical,r.projection),f.extraShadowCaster=r.extraShadowCaster;const m=(_,x)=>{const w=f.reloadCallback;w&&(delete f.reloadCallback,f.parse(f.vectorTile,h.layerIndex,this.availableImages,h.actor,w)),n(_,x)};f.status==="parsing"?f.reloadCallback=m:f.status==="done"&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}else n(null,void 0)}abortTile(r,n){const o=r.uid,l=this.loading[o];l&&(l.abort&&l.abort(),delete this.loading[o]),n()}removeTile(r,n){const o=this.loaded,l=r.uid;o&&o[l]&&delete o[l],n()}},a.di=Lp,a.dj=li,a.dk=R2,a.dl=function(r){let n=0;if(new Uint32Array(r,0,1)[0]!==IO){const o=new Uint32Array(r,0,7),[,,l,h,f,m]=o;n=o.byteLength+h+f+m+f,(l!==r.byteLength||n>=r.byteLength)&&pr("Invalid b3dm header information.")}return CO(r,n)},a.dm=function(r,n){const o=OO(r);for(const l of o){for(const h of l.meshes)q8(h);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(H8(l.lights,n)))}return o},a.dn=UR,a.dp=yO,a.dq=ge,a.dr=function(r){or(),ir&&ir.then(n=>{n.keys().then(o=>{for(let l=0;l<o.length-r;l++)n.delete(o[l])})})},a.f=function(r,n){const{x:o,y:l}=r.point,h=oM(o,l,r.worldSize/r._pixelsPerMercatorPixel,0,0);return a.m.multiply(h,h,u2(Ma(n)))},a.g=Ot,a.i=ef,a.j=ev,a.k=dv,a.l=wi,a.n=ln,a.o=ER,a.p=function(r,n){const o={};for(let l=0;l<n.length;l++){const h=n[l];h in r&&(o[h]=r[h])}return o},a.r=CR,a.s=function(r,n,o){r[4*n+0]=o[0],r[4*n+1]=o[1],r[4*n+2]=o[2],r[4*n+3]=o[3]},a.t=sh,a.u=function(r,n,o,l,h){const f=5*n+2;r.float32[f+0]=o,r.float32[f+1]=l,r.float32[f+2]=h},a.w=Lt,a.x=nM,a.y=function(r,n,o,l,h,f,m,_,x){if(x.name==="globe")return nM(r,n,new sh(o,l,h),!1);const w=Mc({z:o,x:l,y:h},x);return new Dr([(f+w.x/w.scale)*n,n*(w.y/w.scale),m],[(f+w.x2/w.scale)*n,n*(w.y2/w.scale),_])},a.z=function(r,n,o){let l=0;for(let h=0;h<2;++h){const f=o?o[h]:0;r[h]>f&&(l+=(r[h]-f)*(r[h]-f)),n[h]<f&&(l+=(f-n[h])*(f-n[h]))}return l}}),p(["./shared"],function(a){function A(nt){if(typeof nt=="number"||typeof nt=="boolean"||typeof nt=="string"||nt==null)return JSON.stringify(nt);if(Array.isArray(nt)){let ue="[";for(const we of nt)ue+=`${A(we)},`;return`${ue}]`}let ie="{";for(const ue of Object.keys(nt).sort())ie+=`${ue}:${A(nt[ue])},`;return`${ie}}`}function O(nt){let ie="";for(const ue of a.aS)ie+=`/${A(nt[ue])}`;return ie}class B{constructor(ie){this.keyCache={},this._layers={},this._layerConfigs={},ie&&this.replace(ie)}replace(ie,ue){this._layerConfigs={},this._layers={},this.update(ie,[],ue)}update(ie,ue,we){this._options=we;for(const Ye of ie)this._layerConfigs[Ye.id]=Ye,(this._layers[Ye.id]=a.cp(Ye,this.scope,this._options)).compileFilter(),this.keyCache[Ye.id]&&delete this.keyCache[Ye.id];for(const Ye of ue)delete this.keyCache[Ye],delete this._layerConfigs[Ye],delete this._layers[Ye];this.familiesBySource={};const Je=function(Ye,Et){const Ot={};for(let $t=0;$t<Ye.length;$t++){const Wt=Et&&Et[Ye[$t].id]||O(Ye[$t]);Et&&(Et[Ye[$t].id]=Wt);let Zt=Ot[Wt];Zt||(Zt=Ot[Wt]=[]),Zt.push(Ye[$t])}const et=[];for(const $t in Ot)et.push(Ot[$t]);return et}(a.da(this._layerConfigs),this.keyCache);for(const Ye of Je){const Et=Ye.map(Vn=>this._layers[Vn.id]),Ot=Et[0];if(Ot.visibility==="none")continue;const et=Ot.source||"";let $t=this.familiesBySource[et];$t||($t=this.familiesBySource[et]={});const Wt=Ot.sourceLayer||"_geojsonTileLayer";let Zt=$t[Wt];Zt||(Zt=$t[Wt]=[]),Zt.push(Et)}}}class ${loadTile(ie,ue){const{uid:we,encoding:Je,rawImageData:Ye,padding:Et}=ie,Ot=ImageBitmap&&Ye instanceof ImageBitmap?this.getImageData(Ye,Et):Ye;ue(null,new a.db(we,Ot,Je,Et<1))}getImageData(ie,ue){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ie.width,ie.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ie.width,this.offscreenCanvas.height=ie.height,this.offscreenCanvasContext.drawImage(ie,0,0,ie.width,ie.height);const we=this.offscreenCanvasContext.getImageData(-ue,-ue,ie.width+2*ue,ie.height+2*ue);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),we}}function Y(nt,ie){if(nt.length!==0){se(nt[0],ie);for(var ue=1;ue<nt.length;ue++)se(nt[ue],!ie)}}function se(nt,ie){for(var ue=0,we=0,Je=0,Ye=nt.length,Et=Ye-1;Je<Ye;Et=Je++){var Ot=(nt[Je][0]-nt[Et][0])*(nt[Et][1]+nt[Je][1]),et=ue+Ot;we+=Math.abs(ue)>=Math.abs(Ot)?ue-et+Ot:Ot-et+ue,ue=et}ue+we>=0!=!!ie&&nt.reverse()}var me=a.dc(function nt(ie,ue){var we,Je=ie&&ie.type;if(Je==="FeatureCollection")for(we=0;we<ie.features.length;we++)nt(ie.features[we],ue);else if(Je==="GeometryCollection")for(we=0;we<ie.geometries.length;we++)nt(ie.geometries[we],ue);else if(Je==="Feature")nt(ie.geometry,ue);else if(Je==="Polygon")Y(ie.coordinates,ue);else if(Je==="MultiPolygon")for(we=0;we<ie.coordinates.length;we++)Y(ie.coordinates[we],ue);return ie});const _e=a.dd.prototype.toGeoJSON;var Ee={exports:{}},ae=a.df,le=a.de.VectorTileFeature,fe=Ce;function Ce(nt,ie){this.options=ie||{},this.features=nt,this.length=nt.length}function Ge(nt,ie){this.id=typeof nt.id=="number"?nt.id:void 0,this.type=nt.type,this.rawGeometry=nt.type===1?[nt.geometry]:nt.geometry,this.properties=nt.tags,this.extent=ie||4096}Ce.prototype.feature=function(nt){return new Ge(this.features[nt],this.options.extent)},Ge.prototype.loadGeometry=function(){var nt=this.rawGeometry;this.geometry=[];for(var ie=0;ie<nt.length;ie++){for(var ue=nt[ie],we=[],Je=0;Je<ue.length;Je++)we.push(new ae(ue[Je][0],ue[Je][1]));this.geometry.push(we)}return this.geometry},Ge.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var nt=this.geometry,ie=1/0,ue=-1/0,we=1/0,Je=-1/0,Ye=0;Ye<nt.length;Ye++)for(var Et=nt[Ye],Ot=0;Ot<Et.length;Ot++){var et=Et[Ot];ie=Math.min(ie,et.x),ue=Math.max(ue,et.x),we=Math.min(we,et.y),Je=Math.max(Je,et.y)}return[ie,we,ue,Je]},Ge.prototype.toGeoJSON=le.prototype.toGeoJSON;var gt=a.dg,It=fe;function Tt(nt){var ie=new gt;return function(ue,we){for(var Je in ue.layers)we.writeMessage(3,Oe,ue.layers[Je])}(nt,ie),ie.finish()}function Oe(nt,ie){var ue;ie.writeVarintField(15,nt.version||1),ie.writeStringField(1,nt.name||""),ie.writeVarintField(5,nt.extent||4096);var we={keys:[],values:[],keycache:{},valuecache:{}};for(ue=0;ue<nt.length;ue++)we.feature=nt.feature(ue),ie.writeMessage(2,Yt,we);var Je=we.keys;for(ue=0;ue<Je.length;ue++)ie.writeStringField(3,Je[ue]);var Ye=we.values;for(ue=0;ue<Ye.length;ue++)ie.writeMessage(4,si,Ye[ue])}function Yt(nt,ie){var ue=nt.feature;ue.id!==void 0&&ie.writeVarintField(1,ue.id),ie.writeMessage(2,er,nt),ie.writeVarintField(3,ue.type),ie.writeMessage(4,Er,ue)}function er(nt,ie){var ue=nt.feature,we=nt.keys,Je=nt.values,Ye=nt.keycache,Et=nt.valuecache;for(var Ot in ue.properties){var et=ue.properties[Ot],$t=Ye[Ot];if(et!==null){$t===void 0&&(we.push(Ot),Ye[Ot]=$t=we.length-1),ie.writeVarint($t);var Wt=typeof et;Wt!=="string"&&Wt!=="boolean"&&Wt!=="number"&&(et=JSON.stringify(et));var Zt=Wt+":"+et,Vn=Et[Zt];Vn===void 0&&(Je.push(et),Et[Zt]=Vn=Je.length-1),ie.writeVarint(Vn)}}}function pt(nt,ie){return(ie<<3)+(7&nt)}function kn(nt){return nt<<1^nt>>31}function Er(nt,ie){for(var ue=nt.loadGeometry(),we=nt.type,Je=0,Ye=0,Et=ue.length,Ot=0;Ot<Et;Ot++){var et=ue[Ot],$t=1;we===1&&($t=et.length),ie.writeVarint(pt(1,$t));for(var Wt=we===3?et.length-1:et.length,Zt=0;Zt<Wt;Zt++){Zt===1&&we!==1&&ie.writeVarint(pt(2,Wt-1));var Vn=et[Zt].x-Je,ir=et[Zt].y-Ye;ie.writeVarint(kn(Vn)),ie.writeVarint(kn(ir)),Je+=Vn,Ye+=ir}we===3&&ie.writeVarint(pt(7,1))}}function si(nt,ie){var ue=typeof nt;ue==="string"?ie.writeStringField(1,nt):ue==="boolean"?ie.writeBooleanField(7,nt):ue==="number"&&(nt%1!=0?ie.writeDoubleField(3,nt):nt<0?ie.writeSVarintField(6,nt):ie.writeVarintField(5,nt))}Ee.exports=Tt,Ee.exports.fromVectorTileJs=Tt,Ee.exports.fromGeojsonVt=function(nt,ie){ie=ie||{};var ue={};for(var we in nt)ue[we]=new It(nt[we].features,ie),ue[we].name=we,ue[we].version=ie.version,ue[we].extent=ie.extent;return Tt({layers:ue})},Ee.exports.GeoJSONWrapper=It;var xr=a.dc(Ee.exports);const rr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:nt=>nt},Ze=Math.fround||(St=new Float32Array(1),nt=>(St[0]=+nt,St[0]));var St;const Lt=3,vn=5,Kn=6;class br{constructor(ie){this.options=Object.assign(Object.create(rr),ie),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ie){const{log:ue,minZoom:we,maxZoom:Je}=this.options;ue&&console.time("total time");const Ye=`prepare ${ie.length} points`;ue&&console.time(Ye),this.points=ie;const Et=[];for(let et=0;et<ie.length;et++){const $t=ie[et];if(!$t.geometry)continue;const[Wt,Zt]=$t.geometry.coordinates,Vn=Ze(Oi(Wt)),ir=Ze(Ao(Zt));Et.push(Vn,ir,1/0,et,-1,1),this.options.reduce&&Et.push(0)}let Ot=this.trees[Je+1]=this._createTree(Et);ue&&console.timeEnd(Ye);for(let et=Je;et>=we;et--){const $t=+Date.now();Ot=this.trees[et]=this._createTree(this._cluster(Ot,et)),ue&&console.log("z%d: %d clusters in %dms",et,Ot.numItems,+Date.now()-$t)}return ue&&console.timeEnd("total time"),this}getClusters(ie,ue){let we=((ie[0]+180)%360+360)%360-180;const Je=Math.max(-90,Math.min(90,ie[1]));let Ye=ie[2]===180?180:((ie[2]+180)%360+360)%360-180;const Et=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)we=-180,Ye=180;else if(we>Ye){const Zt=this.getClusters([we,Je,180,Et],ue),Vn=this.getClusters([-180,Je,Ye,Et],ue);return Zt.concat(Vn)}const Ot=this.trees[this._limitZoom(ue)],et=Ot.range(Oi(we),Ao(Et),Oi(Ye),Ao(Je)),$t=Ot.data,Wt=[];for(const Zt of et){const Vn=this.stride*Zt;Wt.push($t[Vn+vn]>1?Io($t,Vn,this.clusterProps):this.points[$t[Vn+Lt]])}return Wt}getChildren(ie){const ue=this._getOriginId(ie),we=this._getOriginZoom(ie),Je="No cluster with the specified id.",Ye=this.trees[we];if(!Ye)throw new Error(Je);const Et=Ye.data;if(ue*this.stride>=Et.length)throw new Error(Je);const Ot=this.options.radius/(this.options.extent*Math.pow(2,we-1)),et=Ye.within(Et[ue*this.stride],Et[ue*this.stride+1],Ot),$t=[];for(const Wt of et){const Zt=Wt*this.stride;Et[Zt+4]===ie&&$t.push(Et[Zt+vn]>1?Io(Et,Zt,this.clusterProps):this.points[Et[Zt+Lt]])}if($t.length===0)throw new Error(Je);return $t}getLeaves(ie,ue,we){const Je=[];return this._appendLeaves(Je,ie,ue=ue||10,we=we||0,0),Je}getTile(ie,ue,we){const Je=this.trees[this._limitZoom(ie)],Ye=Math.pow(2,ie),{extent:Et,radius:Ot}=this.options,et=Ot/Et,$t=(we-et)/Ye,Wt=(we+1+et)/Ye,Zt={features:[]};return this._addTileFeatures(Je.range((ue-et)/Ye,$t,(ue+1+et)/Ye,Wt),Je.data,ue,we,Ye,Zt),ue===0&&this._addTileFeatures(Je.range(1-et/Ye,$t,1,Wt),Je.data,Ye,we,Ye,Zt),ue===Ye-1&&this._addTileFeatures(Je.range(0,$t,et/Ye,Wt),Je.data,-1,we,Ye,Zt),Zt.features.length?Zt:null}getClusterExpansionZoom(ie){let ue=this._getOriginZoom(ie)-1;for(;ue<=this.options.maxZoom;){const we=this.getChildren(ie);if(ue++,we.length!==1)break;ie=we[0].properties.cluster_id}return ue}_appendLeaves(ie,ue,we,Je,Ye){const Et=this.getChildren(ue);for(const Ot of Et){const et=Ot.properties;if(et&&et.cluster?Ye+et.point_count<=Je?Ye+=et.point_count:Ye=this._appendLeaves(ie,et.cluster_id,we,Je,Ye):Ye<Je?Ye++:ie.push(Ot),ie.length===we)break}return Ye}_createTree(ie){const ue=new a.aZ(ie.length/this.stride|0,this.options.nodeSize,Float32Array);for(let we=0;we<ie.length;we+=this.stride)ue.add(ie[we],ie[we+1]);return ue.finish(),ue.data=ie,ue}_addTileFeatures(ie,ue,we,Je,Ye,Et){for(const Ot of ie){const et=Ot*this.stride,$t=ue[et+vn]>1;let Wt,Zt,Vn;if($t)Wt=_s(ue,et,this.clusterProps),Zt=ue[et],Vn=ue[et+1];else{const tr=this.points[ue[et+Lt]];Wt=tr.properties;const[or,Un]=tr.geometry.coordinates;Zt=Oi(or),Vn=Ao(Un)}const ir={type:1,geometry:[[Math.round(this.options.extent*(Zt*Ye-we)),Math.round(this.options.extent*(Vn*Ye-Je))]],tags:Wt};let Vr;Vr=$t||this.options.generateId?ue[et+Lt]:this.points[ue[et+Lt]].id,Vr!==void 0&&(ir.id=Vr),Et.features.push(ir)}}_limitZoom(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))}_cluster(ie,ue){const{radius:we,extent:Je,reduce:Ye,minPoints:Et}=this.options,Ot=we/(Je*Math.pow(2,ue)),et=ie.data,$t=[],Wt=this.stride;for(let Zt=0;Zt<et.length;Zt+=Wt){if(et[Zt+2]<=ue)continue;et[Zt+2]=ue;const Vn=et[Zt],ir=et[Zt+1],Vr=ie.within(et[Zt],et[Zt+1],Ot),tr=et[Zt+vn];let or=tr;for(const Un of Vr){const Qr=Un*Wt;et[Qr+2]>ue&&(or+=et[Qr+vn])}if(or>tr&&or>=Et){let Un,Qr=Vn*tr,ai=ir*tr,Po=-1;const Di=((Zt/Wt|0)<<5)+(ue+1)+this.points.length;for(const js of Vr){const li=js*Wt;if(et[li+2]<=ue)continue;et[li+2]=ue;const Vs=et[li+vn];Qr+=et[li]*Vs,ai+=et[li+1]*Vs,et[li+4]=Di,Ye&&(Un||(Un=this._map(et,Zt,!0),Po=this.clusterProps.length,this.clusterProps.push(Un)),Ye(Un,this._map(et,li)))}et[Zt+4]=Di,$t.push(Qr/or,ai/or,1/0,Di,-1,or),Ye&&$t.push(Po)}else{for(let Un=0;Un<Wt;Un++)$t.push(et[Zt+Un]);if(or>1)for(const Un of Vr){const Qr=Un*Wt;if(!(et[Qr+2]<=ue)){et[Qr+2]=ue;for(let ai=0;ai<Wt;ai++)$t.push(et[Qr+ai])}}}}return $t}_getOriginId(ie){return ie-this.points.length>>5}_getOriginZoom(ie){return(ie-this.points.length)%32}_map(ie,ue,we){if(ie[ue+vn]>1){const Et=this.clusterProps[ie[ue+Kn]];return we?Object.assign({},Et):Et}const Je=this.points[ie[ue+Lt]].properties,Ye=this.options.map(Je);return we&&Ye===Je?Object.assign({},Ye):Ye}}function Io(nt,ie,ue){return{type:"Feature",id:nt[ie+Lt],properties:_s(nt,ie,ue),geometry:{type:"Point",coordinates:[(we=nt[ie],360*(we-.5)),rd(nt[ie+1])]}};var we}function _s(nt,ie,ue){const we=nt[ie+vn],Je=we>=1e4?`${Math.round(we/1e3)}k`:we>=1e3?Math.round(we/100)/10+"k":we,Ye=nt[ie+Kn],Et=Ye===-1?{}:Object.assign({},ue[Ye]);return Object.assign(Et,{cluster:!0,cluster_id:nt[ie+Lt],point_count:we,point_count_abbreviated:Je})}function Oi(nt){return nt/360+.5}function Ao(nt){const ie=Math.sin(nt*Math.PI/180),ue=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ue<0?0:ue>1?1:ue}function rd(nt){const ie=(180-360*nt)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}var ac={exports:{}};ac.exports=function(){function nt(je,Ue,tt,rt){for(var st,dt=rt,ft=tt-Ue>>1,lt=tt-Ue,At=je[Ue],ot=je[Ue+1],tn=je[tt],Mn=je[tt+1],Ft=Ue+3;Ft<tt;Ft+=3){var zn=ie(je[Ft],je[Ft+1],At,ot,tn,Mn);if(zn>dt)st=Ft,dt=zn;else if(zn===dt){var wr=Math.abs(Ft-ft);wr<lt&&(st=Ft,lt=wr)}}dt>rt&&(st-Ue>3&&nt(je,Ue,st,rt),je[st+2]=dt,tt-st>3&&nt(je,st,tt,rt))}function ie(je,Ue,tt,rt,st,dt){var ft=st-tt,lt=dt-rt;if(ft!==0||lt!==0){var At=((je-tt)*ft+(Ue-rt)*lt)/(ft*ft+lt*lt);At>1?(tt=st,rt=dt):At>0&&(tt+=ft*At,rt+=lt*At)}return(ft=je-tt)*ft+(lt=Ue-rt)*lt}function ue(je,Ue,tt,rt){var st={id:je===void 0?null:je,type:Ue,geometry:tt,tags:rt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(dt){var ft=dt.geometry,lt=dt.type;if(lt==="Point"||lt==="MultiPoint"||lt==="LineString")we(dt,ft);else if(lt==="Polygon"||lt==="MultiLineString")for(var At=0;At<ft.length;At++)we(dt,ft[At]);else if(lt==="MultiPolygon")for(At=0;At<ft.length;At++)for(var ot=0;ot<ft[At].length;ot++)we(dt,ft[At][ot])}(st),st}function we(je,Ue){for(var tt=0;tt<Ue.length;tt+=3)je.minX=Math.min(je.minX,Ue[tt]),je.minY=Math.min(je.minY,Ue[tt+1]),je.maxX=Math.max(je.maxX,Ue[tt]),je.maxY=Math.max(je.maxY,Ue[tt+1])}function Je(je,Ue,tt,rt){if(Ue.geometry){var st=Ue.geometry.coordinates,dt=Ue.geometry.type,ft=Math.pow(tt.tolerance/((1<<tt.maxZoom)*tt.extent),2),lt=[],At=Ue.id;if(tt.promoteId?At=Ue.properties[tt.promoteId]:tt.generateId&&(At=rt||0),dt==="Point")Ye(st,lt);else if(dt==="MultiPoint")for(var ot=0;ot<st.length;ot++)Ye(st[ot],lt);else if(dt==="LineString")Et(st,lt,ft,!1);else if(dt==="MultiLineString"){if(tt.lineMetrics){for(ot=0;ot<st.length;ot++)Et(st[ot],lt=[],ft,!1),je.push(ue(At,"LineString",lt,Ue.properties));return}Ot(st,lt,ft,!1)}else if(dt==="Polygon")Ot(st,lt,ft,!0);else{if(dt!=="MultiPolygon"){if(dt==="GeometryCollection"){for(ot=0;ot<Ue.geometry.geometries.length;ot++)Je(je,{id:At,geometry:Ue.geometry.geometries[ot],properties:Ue.properties},tt,rt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ot=0;ot<st.length;ot++){var tn=[];Ot(st[ot],tn,ft,!0),lt.push(tn)}}je.push(ue(At,dt,lt,Ue.properties))}}function Ye(je,Ue){Ue.push(et(je[0])),Ue.push($t(je[1])),Ue.push(0)}function Et(je,Ue,tt,rt){for(var st,dt,ft=0,lt=0;lt<je.length;lt++){var At=et(je[lt][0]),ot=$t(je[lt][1]);Ue.push(At),Ue.push(ot),Ue.push(0),lt>0&&(ft+=rt?(st*ot-At*dt)/2:Math.sqrt(Math.pow(At-st,2)+Math.pow(ot-dt,2))),st=At,dt=ot}var tn=Ue.length-3;Ue[2]=1,nt(Ue,0,tn,tt),Ue[tn+2]=1,Ue.size=Math.abs(ft),Ue.start=0,Ue.end=Ue.size}function Ot(je,Ue,tt,rt){for(var st=0;st<je.length;st++){var dt=[];Et(je[st],dt,tt,rt),Ue.push(dt)}}function et(je){return je/360+.5}function $t(je){var Ue=Math.sin(je*Math.PI/180),tt=.5-.25*Math.log((1+Ue)/(1-Ue))/Math.PI;return tt<0?0:tt>1?1:tt}function Wt(je,Ue,tt,rt,st,dt,ft,lt){if(rt/=Ue,dt>=(tt/=Ue)&&ft<rt)return je;if(ft<tt||dt>=rt)return null;for(var At=[],ot=0;ot<je.length;ot++){var tn=je[ot],Mn=tn.geometry,Ft=tn.type,zn=st===0?tn.minX:tn.minY,wr=st===0?tn.maxX:tn.maxY;if(zn>=tt&&wr<rt)At.push(tn);else if(!(wr<tt||zn>=rt)){var Sr=[];if(Ft==="Point"||Ft==="MultiPoint")Zt(Mn,Sr,tt,rt,st);else if(Ft==="LineString")Vn(Mn,Sr,tt,rt,st,!1,lt.lineMetrics);else if(Ft==="MultiLineString")Vr(Mn,Sr,tt,rt,st,!1);else if(Ft==="Polygon")Vr(Mn,Sr,tt,rt,st,!0);else if(Ft==="MultiPolygon")for(var Mr=0;Mr<Mn.length;Mr++){var yi=[];Vr(Mn[Mr],yi,tt,rt,st,!0),yi.length&&Sr.push(yi)}if(Sr.length){if(lt.lineMetrics&&Ft==="LineString"){for(Mr=0;Mr<Sr.length;Mr++)At.push(ue(tn.id,Ft,Sr[Mr],tn.tags));continue}Ft!=="LineString"&&Ft!=="MultiLineString"||(Sr.length===1?(Ft="LineString",Sr=Sr[0]):Ft="MultiLineString"),Ft!=="Point"&&Ft!=="MultiPoint"||(Ft=Sr.length===3?"Point":"MultiPoint"),At.push(ue(tn.id,Ft,Sr,tn.tags))}}}return At.length?At:null}function Zt(je,Ue,tt,rt,st){for(var dt=0;dt<je.length;dt+=3){var ft=je[dt+st];ft>=tt&&ft<=rt&&(Ue.push(je[dt]),Ue.push(je[dt+1]),Ue.push(je[dt+2]))}}function Vn(je,Ue,tt,rt,st,dt,ft){for(var lt,At,ot=ir(je),tn=st===0?or:Un,Mn=je.start,Ft=0;Ft<je.length-3;Ft+=3){var zn=je[Ft],wr=je[Ft+1],Sr=je[Ft+2],Mr=je[Ft+3],yi=je[Ft+4],go=st===0?zn:wr,ko=st===0?Mr:yi,_o=!1;ft&&(lt=Math.sqrt(Math.pow(zn-Mr,2)+Math.pow(wr-yi,2))),go<tt?ko>tt&&(At=tn(ot,zn,wr,Mr,yi,tt),ft&&(ot.start=Mn+lt*At)):go>rt?ko<rt&&(At=tn(ot,zn,wr,Mr,yi,rt),ft&&(ot.start=Mn+lt*At)):tr(ot,zn,wr,Sr),ko<tt&&go>=tt&&(At=tn(ot,zn,wr,Mr,yi,tt),_o=!0),ko>rt&&go<=rt&&(At=tn(ot,zn,wr,Mr,yi,rt),_o=!0),!dt&&_o&&(ft&&(ot.end=Mn+lt*At),Ue.push(ot),ot=ir(je)),ft&&(Mn+=lt)}var vi=je.length-3;zn=je[vi],wr=je[vi+1],Sr=je[vi+2],(go=st===0?zn:wr)>=tt&&go<=rt&&tr(ot,zn,wr,Sr),vi=ot.length-3,dt&&vi>=3&&(ot[vi]!==ot[0]||ot[vi+1]!==ot[1])&&tr(ot,ot[0],ot[1],ot[2]),ot.length&&Ue.push(ot)}function ir(je){var Ue=[];return Ue.size=je.size,Ue.start=je.start,Ue.end=je.end,Ue}function Vr(je,Ue,tt,rt,st,dt){for(var ft=0;ft<je.length;ft++)Vn(je[ft],Ue,tt,rt,st,dt,!1)}function tr(je,Ue,tt,rt){je.push(Ue),je.push(tt),je.push(rt)}function or(je,Ue,tt,rt,st,dt){var ft=(dt-Ue)/(rt-Ue);return je.push(dt),je.push(tt+(st-tt)*ft),je.push(1),ft}function Un(je,Ue,tt,rt,st,dt){var ft=(dt-tt)/(st-tt);return je.push(Ue+(rt-Ue)*ft),je.push(dt),je.push(1),ft}function Qr(je,Ue){for(var tt=[],rt=0;rt<je.length;rt++){var st,dt=je[rt],ft=dt.type;if(ft==="Point"||ft==="MultiPoint"||ft==="LineString")st=ai(dt.geometry,Ue);else if(ft==="MultiLineString"||ft==="Polygon"){st=[];for(var lt=0;lt<dt.geometry.length;lt++)st.push(ai(dt.geometry[lt],Ue))}else if(ft==="MultiPolygon")for(st=[],lt=0;lt<dt.geometry.length;lt++){for(var At=[],ot=0;ot<dt.geometry[lt].length;ot++)At.push(ai(dt.geometry[lt][ot],Ue));st.push(At)}tt.push(ue(dt.id,ft,st,dt.tags))}return tt}function ai(je,Ue){var tt=[];tt.size=je.size,je.start!==void 0&&(tt.start=je.start,tt.end=je.end);for(var rt=0;rt<je.length;rt+=3)tt.push(je[rt]+Ue,je[rt+1],je[rt+2]);return tt}function Po(je,Ue){if(je.transformed)return je;var tt,rt,st,dt=1<<je.z,ft=je.x,lt=je.y;for(tt=0;tt<je.features.length;tt++){var At=je.features[tt],ot=At.geometry,tn=At.type;if(At.geometry=[],tn===1)for(rt=0;rt<ot.length;rt+=2)At.geometry.push(Di(ot[rt],ot[rt+1],Ue,dt,ft,lt));else for(rt=0;rt<ot.length;rt++){var Mn=[];for(st=0;st<ot[rt].length;st+=2)Mn.push(Di(ot[rt][st],ot[rt][st+1],Ue,dt,ft,lt));At.geometry.push(Mn)}}return je.transformed=!0,je}function Di(je,Ue,tt,rt,st,dt){return[Math.round(tt*(je*rt-st)),Math.round(tt*(Ue*rt-dt))]}function js(je,Ue,tt,rt,st){for(var dt=Ue===st.maxZoom?0:st.tolerance/((1<<Ue)*st.extent),ft={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:tt,y:rt,z:Ue,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},lt=0;lt<je.length;lt++){ft.numFeatures++,li(ft,je[lt],dt,st);var At=je[lt].minX,ot=je[lt].minY,tn=je[lt].maxX,Mn=je[lt].maxY;At<ft.minX&&(ft.minX=At),ot<ft.minY&&(ft.minY=ot),tn>ft.maxX&&(ft.maxX=tn),Mn>ft.maxY&&(ft.maxY=Mn)}return ft}function li(je,Ue,tt,rt){var st=Ue.geometry,dt=Ue.type,ft=[];if(dt==="Point"||dt==="MultiPoint")for(var lt=0;lt<st.length;lt+=3)ft.push(st[lt]),ft.push(st[lt+1]),je.numPoints++,je.numSimplified++;else if(dt==="LineString")Vs(ft,st,je,tt,!1,!1);else if(dt==="MultiLineString"||dt==="Polygon")for(lt=0;lt<st.length;lt++)Vs(ft,st[lt],je,tt,dt==="Polygon",lt===0);else if(dt==="MultiPolygon")for(var At=0;At<st.length;At++){var ot=st[At];for(lt=0;lt<ot.length;lt++)Vs(ft,ot[lt],je,tt,!0,lt===0)}if(ft.length){var tn=Ue.tags||null;if(dt==="LineString"&&rt.lineMetrics){for(var Mn in tn={},Ue.tags)tn[Mn]=Ue.tags[Mn];tn.mapbox_clip_start=st.start/st.size,tn.mapbox_clip_end=st.end/st.size}var Ft={geometry:ft,type:dt==="Polygon"||dt==="MultiPolygon"?3:dt==="LineString"||dt==="MultiLineString"?2:1,tags:tn};Ue.id!==null&&(Ft.id=Ue.id),je.features.push(Ft)}}function Vs(je,Ue,tt,rt,st,dt){var ft=rt*rt;if(rt>0&&Ue.size<(st?ft:rt))tt.numPoints+=Ue.length/3;else{for(var lt=[],At=0;At<Ue.length;At+=3)(rt===0||Ue[At+2]>ft)&&(tt.numSimplified++,lt.push(Ue[At]),lt.push(Ue[At+1])),tt.numPoints++;st&&function(ot,tn){for(var Mn=0,Ft=0,zn=ot.length,wr=zn-2;Ft<zn;wr=Ft,Ft+=2)Mn+=(ot[Ft]-ot[wr])*(ot[Ft+1]+ot[wr+1]);if(Mn>0===tn)for(Ft=0,zn=ot.length;Ft<zn/2;Ft+=2){var Sr=ot[Ft],Mr=ot[Ft+1];ot[Ft]=ot[zn-2-Ft],ot[Ft+1]=ot[zn-1-Ft],ot[zn-2-Ft]=Sr,ot[zn-1-Ft]=Mr}}(lt,dt),je.push(lt)}}function pa(je,Ue){var tt=(Ue=this.options=function(st,dt){for(var ft in dt)st[ft]=dt[ft];return st}(Object.create(this.options),Ue)).debug;if(tt&&console.time("preprocess data"),Ue.maxZoom<0||Ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ue.promoteId&&Ue.generateId)throw new Error("promoteId and generateId cannot be used together.");var rt=function(st,dt){var ft=[];if(st.type==="FeatureCollection")for(var lt=0;lt<st.features.length;lt++)Je(ft,st.features[lt],dt,lt);else Je(ft,st.type==="Feature"?st:{geometry:st},dt);return ft}(je,Ue);this.tiles={},this.tileCoords=[],tt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ue.indexMaxZoom,Ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(rt=function(st,dt){var ft=dt.buffer/dt.extent,lt=st,At=Wt(st,1,-1-ft,ft,0,-1,2,dt),ot=Wt(st,1,1-ft,2+ft,0,-1,2,dt);return(At||ot)&&(lt=Wt(st,1,-ft,1+ft,0,-1,2,dt)||[],At&&(lt=Qr(At,1).concat(lt)),ot&&(lt=lt.concat(Qr(ot,-1)))),lt}(rt,Ue)).length&&this.splitTile(rt,0,0,0),tt&&(rt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ci(je,Ue,tt){return 32*((1<<je)*tt+Ue)+je}return pa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},pa.prototype.splitTile=function(je,Ue,tt,rt,st,dt,ft){for(var lt=[je,Ue,tt,rt],At=this.options,ot=At.debug;lt.length;){rt=lt.pop(),tt=lt.pop(),Ue=lt.pop(),je=lt.pop();var tn=1<<Ue,Mn=ci(Ue,tt,rt),Ft=this.tiles[Mn];if(!Ft&&(ot>1&&console.time("creation"),Ft=this.tiles[Mn]=js(je,Ue,tt,rt,At),this.tileCoords.push({z:Ue,x:tt,y:rt}),ot)){ot>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ue,tt,rt,Ft.numFeatures,Ft.numPoints,Ft.numSimplified),console.timeEnd("creation"));var zn="z"+Ue;this.stats[zn]=(this.stats[zn]||0)+1,this.total++}if(Ft.source=je,st){if(Ue===At.maxZoom||Ue===st)continue;var wr=1<<st-Ue;if(tt!==Math.floor(dt/wr)||rt!==Math.floor(ft/wr))continue}else if(Ue===At.indexMaxZoom||Ft.numPoints<=At.indexMaxPoints)continue;if(Ft.source=null,je.length!==0){ot>1&&console.time("clipping");var Sr,Mr,yi,go,ko,_o,vi=.5*At.buffer/At.extent,Ki=.5-vi,Us=.5+vi,cc=1+vi;Sr=Mr=yi=go=null,ko=Wt(je,tn,tt-vi,tt+Us,0,Ft.minX,Ft.maxX,At),_o=Wt(je,tn,tt+Ki,tt+cc,0,Ft.minX,Ft.maxX,At),je=null,ko&&(Sr=Wt(ko,tn,rt-vi,rt+Us,1,Ft.minY,Ft.maxY,At),Mr=Wt(ko,tn,rt+Ki,rt+cc,1,Ft.minY,Ft.maxY,At),ko=null),_o&&(yi=Wt(_o,tn,rt-vi,rt+Us,1,Ft.minY,Ft.maxY,At),go=Wt(_o,tn,rt+Ki,rt+cc,1,Ft.minY,Ft.maxY,At),_o=null),ot>1&&console.timeEnd("clipping"),lt.push(Sr||[],Ue+1,2*tt,2*rt),lt.push(Mr||[],Ue+1,2*tt,2*rt+1),lt.push(yi||[],Ue+1,2*tt+1,2*rt),lt.push(go||[],Ue+1,2*tt+1,2*rt+1)}}},pa.prototype.getTile=function(je,Ue,tt){var rt=this.options,st=rt.extent,dt=rt.debug;if(je<0||je>24)return null;var ft=1<<je,lt=ci(je,Ue=(Ue%ft+ft)%ft,tt);if(this.tiles[lt])return Po(this.tiles[lt],st);dt>1&&console.log("drilling down to z%d-%d-%d",je,Ue,tt);for(var At,ot=je,tn=Ue,Mn=tt;!At&&ot>0;)ot--,tn=Math.floor(tn/2),Mn=Math.floor(Mn/2),At=this.tiles[ci(ot,tn,Mn)];return At&&At.source?(dt>1&&console.log("found parent tile z%d-%d-%d",ot,tn,Mn),dt>1&&console.time("drilling down"),this.splitTile(At.source,ot,tn,Mn,je,Ue,tt),dt>1&&console.timeEnd("drilling down"),this.tiles[lt]?Po(this.tiles[lt],st):null):null},function(je,Ue){return new pa(je,Ue)}}();var lc=a.dc(ac.exports);function Cu(nt,ie){const ue=nt.tileID.canonical;if(!this._geoJSONIndex)return ie(null,null);const we=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!we)return ie(null,null);const Je=new class{constructor(Et){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.J,this.length=Et.length,this._features=Et}feature(Et){return new class{constructor(Ot){this._feature=Ot,this.extent=a.J,this.type=Ot.type,this.properties=Ot.tags,"id"in Ot&&!isNaN(Ot.id)&&(this.id=parseInt(Ot.id,10))}loadGeometry(){if(this._feature.type===1){const Ot=[];for(const et of this._feature.geometry)Ot.push([new a.P(et[0],et[1])]);return Ot}{const Ot=[];for(const et of this._feature.geometry){const $t=[];for(const Wt of et)$t.push(new a.P(Wt[0],Wt[1]));Ot.push($t)}return Ot}}toGeoJSON(Ot,et,$t){return _e.call(this,Ot,et,$t)}}(this._features[Et])}}(we.features);let Ye=xr(Je);Ye.byteOffset===0&&Ye.byteLength===Ye.buffer.byteLength||(Ye=new Uint8Array(Ye)),ie(null,{vectorTile:Je,rawData:Ye.buffer})}class id extends a.dh{constructor(ie,ue,we,Je,Ye,Et){super(ie,ue,we,Je,Cu,Et),Ye&&(this.loadGeoJSON=Ye)}loadData(ie,ue){const we=ie&&ie.request,Je=we&&we.collectResourceTiming;this.loadGeoJSON(ie,(Ye,Et)=>{if(Ye||!Et)return ue(Ye);if(typeof Et!="object")return ue(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));{me(Et,!0);try{if(ie.filter){const et=a.cw(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(et.result==="error")throw new Error(et.value.map(Wt=>`${Wt.key}: ${Wt.message}`).join(", "));Et={type:"FeatureCollection",features:Et.features.filter(Wt=>et.value.evaluate({zoom:0},Wt))}}this._geoJSONIndex=ie.cluster?new br(function({superclusterOptions:et,clusterProperties:$t}){if(!$t||!et)return et;const Wt={},Zt={},Vn={accumulated:null,zoom:0},ir={properties:null},Vr=Object.keys($t);for(const tr of Vr){const[or,Un]=$t[tr],Qr=a.cw(Un),ai=a.cw(typeof or=="string"?[or,["accumulated"],["get",tr]]:or);Wt[tr]=Qr.value,Zt[tr]=ai.value}return et.map=tr=>{ir.properties=tr;const or={};for(const Un of Vr)or[Un]=Wt[Un].evaluate(Vn,ir);return or},et.reduce=(tr,or)=>{ir.properties=or;for(const Un of Vr)Vn.accumulated=tr[Un],tr[Un]=Zt[Un].evaluate(Vn,ir)},et}(ie)).load(Et.features):lc(Et,ie.geojsonVtOptions)}catch(et){return ue(et)}this.loaded={};const Ot={};if(Je){const et=a.di(we);et&&(Ot.resourceTiming={},Ot.resourceTiming[ie.source]=JSON.parse(JSON.stringify(et)))}ue(null,Ot)}})}reloadTile(ie,ue){const we=this.loaded;return we&&we[ie.uid]?super.reloadTile(ie,ue):this.loadTile(ie,ue)}loadGeoJSON(ie,ue){if(ie.request)a.a1(ie.request,ue);else{if(typeof ie.data!="string")return ue(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`));try{return ue(null,JSON.parse(ie.data))}catch{return ue(new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ie,ue){try{ue(null,this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId))}catch(we){ue(we)}}getClusterChildren(ie,ue){try{ue(null,this._geoJSONIndex.getChildren(ie.clusterId))}catch(we){ue(we)}}getClusterLeaves(ie,ue){try{ue(null,this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset))}catch(we){ue(we)}}}class Zo{constructor(ie,ue){this.tileID=new a.O(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.tileZoom=ie.tileZoom,this.uid=ie.uid,this.zoom=ie.zoom,this.canonical=ie.tileID.canonical,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ie.projection,this.brightness=ue}parse(ie,ue,we,Je){this.status="parsing";const Ye=new a.O(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),Et={},Ot=ue.familiesBySource[we.source],et=new a.dk(Ye,we.promoteId);return et.bucketLayerIDs=[],a.dl(ie).then($t=>{if(!$t)return Je(new Error("Could not parse tile"));const Wt=a.dm($t,1/a.cg(we.tileID.canonical)),Zt=$t.json.extensionsUsed&&$t.json.extensionsUsed.includes("MAPBOX_mesh_features"),Vn=new a.al(this.zoom,{brightness:this.brightness});for(const ir in Ot)for(const Vr of Ot[ir]){const tr=Vr[0],or=$t.json.extensionsUsed;tr.recalculate(Vn,[]);const Un=new a.dn(Wt,Ye,or&&or.includes("MAPBOX_mesh_features"),this.brightness);Zt||(Un.needsUpload=!0),Et[tr.fqid]=Un,Un.evaluate(tr)}this.status="done",Je(null,{buckets:Et,featureIndex:et})}).catch($t=>Je(new Error($t.message)))}}class od{constructor(ie,ue,we,Je,Ye,Et){this.actor=ie,this.layerIndex=ue,this.brightness=Et,this.loading={},this.loaded={}}loadTile(ie,ue){const we=ie.uid,Je=this.loading[we]=new Zo(ie,this.brightness);a.dj(ie.request,(Ye,Et)=>{const Ot=!this.loading[we];return delete this.loading[we],Ot||Ye?(Je.status="done",Ot||(this.loaded[we]=Je),ue(Ye)):Et&&Et.byteLength!==0?void Je.parse(Et,this.layerIndex,ie,(et,$t)=>{Je.status="done",this.loaded=this.loaded||{},this.loaded[we]=Je,et||!$t?ue(et):ue(null,$t)}):(Je.status="done",this.loaded[we]=Je,ue())})}reloadTile(ie,ue){const we=this.loaded,Je=ie.uid;if(we&&we[Je]){const Ye=we[Je];Ye.projection=ie.projection,Ye.brightness=ie.brightness;const Et=(Ot,et)=>{Ye.reloadCallback&&(delete Ye.reloadCallback,this.loadTile(ie,ue)),ue(Ot,et)};Ye.status==="parsing"?Ye.reloadCallback=Et:Ye.status==="done"&&this.loadTile(ie,ue)}}abortTile(ie,ue){const we=ie.uid;this.loading[we]&&delete this.loading[we],ue()}removeTile(ie,ue){const we=this.loaded,Je=ie.uid;we&&we[Je]&&delete we[Je],ue()}}class pr{constructor(ie){this.self=ie,this.actor=new a.dp(ie,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.o({name:"mercator"}),this.workerSourceTypes={vector:a.dh,geojson:id,"batched-model":od},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ue,we)=>{if(this.workerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.workerSourceTypes[ue]=we},this.self.registerRTLTextPlugin=ue=>{if(a.dq.isParsed())throw new Error("RTL text plugin already registered.");a.dq.applyArabicShaping=ue.applyArabicShaping,a.dq.processBidirectionalText=ue.processBidirectionalText,a.dq.processStyledBidirectionalText=ue.processStyledBidirectionalText}}clearCaches(ie,ue,we){delete this.layerIndexes[ie],delete this.availableImages[ie],delete this.workerSources[ie],delete this.demWorkerSources[ie],we()}checkIfReady(ie,ue,we){we()}setReferrer(ie,ue){this.referrer=ue}spriteLoaded(ie,{scope:ue,isLoaded:we}){if(this.isSpriteLoaded[ie]||(this.isSpriteLoaded[ie]={}),this.isSpriteLoaded[ie][ue]=we,this.workerSources[ie]&&this.workerSources[ie][ue])for(const Je in this.workerSources[ie][ue]){const Ye=this.workerSources[ie][ue][Je];for(const Et in Ye)Ye[Et]instanceof a.dh&&(Ye[Et].isSpriteLoaded=we,Ye[Et].fire(new a.a8("isSpriteLoaded")))}}setImages(ie,{scope:ue,images:we},Je){if(this.availableImages[ie]||(this.availableImages[ie]={}),this.availableImages[ie][ue]=we,this.workerSources[ie]&&this.workerSources[ie][ue]){for(const Ye in this.workerSources[ie][ue]){const Et=this.workerSources[ie][ue][Ye];for(const Ot in Et)Et[Ot].availableImages=we}Je()}else Je()}setProjection(ie,ue){this.projections[ie]=a.o(ue)}setBrightness(ie,ue,we){this.brightness=ue,we()}setLayers(ie,ue,we){this.getLayerIndex(ie,ue.scope).replace(ue.layers,ue.options),we()}updateLayers(ie,ue,we){this.getLayerIndex(ie,ue.scope).update(ue.layers,ue.removedIds,ue.options),we()}loadTile(ie,ue,we){ue.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,ue.type,ue.source,ue.scope).loadTile(ue,we)}loadDEMTile(ie,ue,we){this.getDEMWorkerSource(ie,ue.source,ue.scope).loadTile(ue,we)}reloadTile(ie,ue,we){ue.projection=this.projections[ie]||this.defaultProjection,this.getWorkerSource(ie,ue.type,ue.source,ue.scope).reloadTile(ue,we)}abortTile(ie,ue,we){this.getWorkerSource(ie,ue.type,ue.source,ue.scope).abortTile(ue,we)}removeTile(ie,ue,we){this.getWorkerSource(ie,ue.type,ue.source,ue.scope).removeTile(ue,we)}removeSource(ie,ue,we){if(!(this.workerSources[ie]&&this.workerSources[ie][ue.scope]&&this.workerSources[ie][ue.scope][ue.type]&&this.workerSources[ie][ue.scope][ue.type][ue.source]))return;const Je=this.workerSources[ie][ue.scope][ue.type][ue.source];delete this.workerSources[ie][ue.scope][ue.type][ue.source],Je.removeSource!==void 0?Je.removeSource(ue,we):we()}loadWorkerSource(ie,ue,we){try{this.self.importScripts(ue.url),we()}catch(Je){we(Je.toString())}}syncRTLPluginState(ie,ue,we){try{a.dq.setState(ue);const Je=a.dq.getPluginURL();if(a.dq.isLoaded()&&!a.dq.isParsed()&&Je!=null){this.self.importScripts(Je);const Ye=a.dq.isParsed();we(Ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Je}`),Ye)}}catch(Je){we(Je.toString())}}setDracoUrl(ie,ue){this.dracoUrl=ue}getAvailableImages(ie,ue){this.availableImages[ie]||(this.availableImages[ie]={});let we=this.availableImages[ie][ue];return we||(we=[]),we}getLayerIndex(ie,ue){this.layerIndexes[ie]||(this.layerIndexes[ie]={});let we=this.layerIndexes[ie][ue];return we||(we=this.layerIndexes[ie][ue]=new B,we.scope=ue),we}getWorkerSource(ie,ue,we,Je){if(this.workerSources[ie]||(this.workerSources[ie]={}),this.workerSources[ie][Je]||(this.workerSources[ie][Je]={}),this.workerSources[ie][Je][ue]||(this.workerSources[ie][Je][ue]={}),this.isSpriteLoaded[ie]||(this.isSpriteLoaded[ie]={}),!this.workerSources[ie][Je][ue][we]){const Ye={send:(Et,Ot,et,$t,Wt,Zt)=>{this.actor.send(Et,Ot,et,ie,Wt,Zt)},scheduler:this.actor.scheduler};this.workerSources[ie][Je][ue][we]=new this.workerSourceTypes[ue](Ye,this.getLayerIndex(ie,Je),this.getAvailableImages(ie,Je),this.isSpriteLoaded[ie][Je],void 0,this.brightness)}return this.workerSources[ie][Je][ue][we]}getDEMWorkerSource(ie,ue,we){return this.demWorkerSources[ie]||(this.demWorkerSources[ie]={}),this.demWorkerSources[ie][we]||(this.demWorkerSources[ie][we]={}),this.demWorkerSources[ie][we][ue]||(this.demWorkerSources[ie][we][ue]=new $),this.demWorkerSources[ie][we][ue]}enforceCacheSizeLimit(ie,ue){a.dr(ue)}getWorkerPerformanceMetrics(ie,ue,we){we(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new pr(self)),pr}),p(["./shared"],function(a){function A(g,c){if(Array.isArray(g)){if(!Array.isArray(c)||g.length!==c.length)return!1;for(let d=0;d<g.length;d++)if(!A(g[d],c[d]))return!1;return!0}if(typeof g=="object"&&g!==null&&c!==null){if(typeof c!="object"||Object.keys(g).length!==Object.keys(c).length)return!1;for(const d in g)if(!A(g[d],c[d]))return!1;return!0}return g===c}var O=B;function B(g){return!function(c){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,T=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(T);try{b=new Worker(S),y=!0}catch{y=!1}return b&&b.terminate(),URL.revokeObjectURL(S),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var T=b.getImageData(0,0,1,1);return T&&T.width===y.width}()?($[d=c&&c.failIfMajorPerformanceCaveat]===void 0&&($[d]=function(y){var b,T=function(S){var P=document.createElement("canvas"),M=Object.create(B.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=S,P.getContext("webgl2",M)}(y);if(!T)return!1;try{b=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!b||T.isContextLost())&&(T.shaderSource(b,"void main() {}"),T.compileShader(b),T.getShaderParameter(b,T.COMPILE_STATUS)===!0)}(d)),$[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var d}(g)}var $={};function Y(g,c,d){const y=document.createElement(g);return c!=null&&(y.className=c),d&&d.appendChild(y),y}function se(g,c,d){const y=document.createElementNS("http://www.w3.org/2000/svg",g);for(const b of Object.keys(c))y.setAttributeNS(null,b,String(c[b]));return d&&d.appendChild(y),y}B.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const me=typeof document<"u"?document.documentElement&&document.documentElement.style:null,_e=me&&me.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ee;function ae(){me&&_e&&(Ee=me[_e],me[_e]="none")}function le(){me&&_e&&(me[_e]=Ee)}function fe(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",fe,!0)}function Ce(){window.addEventListener("click",fe,!0),window.setTimeout(()=>{window.removeEventListener("click",fe,!0)},0)}function Ge(g,c){const d=g.getBoundingClientRect();return Tt(g,d,c)}function gt(g,c){const d=g.getBoundingClientRect(),y=[];for(let b=0;b<c.length;b++)y.push(Tt(g,d,c[b]));return y}function It(g){return window.InstallTrigger!==void 0&&g.button===2&&g.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function Tt(g,c,d){const y=g.offsetWidth===c.width?1:g.offsetWidth/c.width;return new a.P((d.clientX-c.left)*y,(d.clientY-c.top)*y)}class Oe{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(c,d){this._updatedSourceCaches[c]=d,this.setDirty()}discardSourceCacheUpdate(c){delete this._updatedSourceCaches[c]}updateLayer(c){const d=c.scope;this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._updatedLayers[d].add(c.id),this.setDirty()}removeLayer(c){const d=c.scope;this._removedLayers[d]=this._removedLayers[d]||{},this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._removedLayers[d][c.id]=c,this._updatedLayers[d].delete(c.id),this._updatedPaintProps.delete(c.fqid),this.setDirty()}getRemovedLayer(c){return this._removedLayers[c.scope]?this._removedLayers[c.scope][c.id]:null}discardLayerRemoval(c){this._removedLayers[c.scope]&&delete this._removedLayers[c.scope][c.id]}getLayerUpdatesByScope(){const c={};for(const d in this._updatedLayers)c[d]=c[d]||{},c[d].updatedIds=Array.from(this._updatedLayers[d].values());for(const d in this._removedLayers)c[d]=c[d]||{},c[d].removedIds=Object.keys(this._removedLayers[d]);return c}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(c){this._updatedPaintProps.add(c.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(c){this._updatedImages.add(c),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const Yt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class er{constructor(c,d,y,b,T,S){this.length=d.length,this.attributes=y,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.instanceCount=S,this.context=c;const P=c.gl;this.buffer=P.createBuffer(),c.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||T||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,d){for(let y=0;y<this.attributes.length;y++){const b=d.attributes[this.attributes[y].name];b!==void 0&&c.enableVertexAttribArray(b)}}setVertexAttribPointers(c,d,y){for(let b=0;b<this.attributes.length;b++){const T=this.attributes[b],S=d.attributes[T.name];S!==void 0&&c.vertexAttribPointer(S,T.components,c[Yt[T.type]],!1,this.itemSize,T.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(c,d,y){for(let b=0;b<this.attributes.length;b++){const T=d.attributes[this.attributes[b].name];T!==void 0&&this.instanceCount&&this.instanceCount>0&&c.vertexAttribDivisor(T,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class pt{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class kn extends pt{getDefault(){return a.C.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Er extends pt{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class si extends pt{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class xr extends pt{getDefault(){return[!0,!0,!0,!0]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class rr extends pt{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Ze extends pt{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class St extends pt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Lt extends pt{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class vn extends pt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}}class Kn extends pt{getDefault(){return[0,1]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class br extends pt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}}class Io extends pt{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class _s extends pt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}}class Oi extends pt{getDefault(){const c=this.gl;return[c.ONE,c.ZERO,c.ONE,c.ZERO]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.blendFuncSeparate(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Ao extends pt{getDefault(){return a.C.transparent}set(c){const d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class rd extends pt{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(c,c),this.current=c,this.dirty=!1)}}class ac extends pt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}}class lc extends pt{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class Cu extends pt{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let id=class extends pt{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class Zo extends pt{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class od extends pt{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class pr extends pt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class nt extends pt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class ie extends pt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class ue extends pt{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class we extends pt{getDefault(){return null}set(c){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Je extends pt{getDefault(){return null}set(c){this.gl&&(c!==this.current||this.dirty)&&(this.gl.bindVertexArray(c),this.current=c,this.dirty=!1)}}class Ye extends pt{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Et extends pt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class Ot extends pt{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class et extends pt{constructor(c,d){super(c),this.context=c,this.parent=d}getDefault(){return null}}class $t extends et{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Wt extends et{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Zt extends et{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachment(),d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Vn extends Wt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ir{constructor(c,d,y,b,T){this.context=c,this.width=d,this.height=y;const S=this.framebuffer=c.gl.createFramebuffer();b&&(this.colorAttachment=new $t(c,S)),T&&(this.depthAttachmentType=T,this.depthAttachment=T==="renderbuffer"?new Wt(c,S):new Zt(c,S))}destroy(){const c=this.context.gl;if(this.colorAttachment){const d=this.colorAttachment.get();d&&c.deleteTexture(d)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const d=this.depthAttachment.get();d&&c.deleteRenderbuffer(d)}else{const d=this.depthAttachment.get();d&&c.deleteTexture(d)}c.deleteFramebuffer(this.framebuffer)}}class Vr{constructor(c,d){this.gl=c,this.clearColor=new kn(this),this.clearDepth=new Er(this),this.clearStencil=new si(this),this.colorMask=new xr(this),this.depthMask=new rr(this),this.stencilMask=new Ze(this),this.stencilFunc=new St(this),this.stencilOp=new Lt(this),this.stencilTest=new vn(this),this.depthRange=new Kn(this),this.depthTest=new br(this),this.depthFunc=new Io(this),this.blend=new _s(this),this.blendFunc=new Oi(this),this.blendColor=new Ao(this),this.blendEquation=new rd(this),this.cullFace=new ac(this),this.cullFaceSide=new lc(this),this.frontFace=new Cu(this),this.program=new id(this),this.activeTexture=new Zo(this),this.viewport=new od(this),this.bindFramebuffer=new pr(this),this.bindRenderbuffer=new nt(this),this.bindTexture=new ie(this),this.bindVertexBuffer=new ue(this),this.bindElementBuffer=new we(this),this.bindVertexArrayOES=new Je(this),this.pixelStoreUnpack=new Ye(this),this.pixelStoreUnpackPremultiplyAlpha=new Et(this),this.pixelStoreUnpackFlipY=new Ot(this),this.options=d?{...d}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=c.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,d,y){return new a.I(this,c,d,y)}createVertexBuffer(c,d,y,b,T){return new er(this,c,d,y,b,T)}createRenderbuffer(c,d,y){const b=this.gl,T=b.createRenderbuffer();return this.bindRenderbuffer.set(T),b.renderbufferStorage(b.RENDERBUFFER,c,d,y),this.bindRenderbuffer.set(null),T}createFramebuffer(c,d,y,b){return new ir(this,c,d,y,b)}clear({color:c,depth:d,stencil:y,colorMask:b}){const T=this.gl;let S=0;c&&(S|=T.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set(b||[!0,!0,!0,!0])),d!==void 0&&(S|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),y!==void 0&&(S|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),T.clear(S)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){A(c.blendFunction,a.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor),c.blendEquation?this.blendEquation.set(c.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(c.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class tr{constructor(c=0,d=0,y=0,b=0){if(isNaN(c)||c<0||isNaN(d)||d<0||isNaN(y)||y<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=d,this.left=y,this.right=b}interpolate(c,d,y){return d.top!=null&&c.top!=null&&(this.top=a.n(c.top,d.top,y)),d.bottom!=null&&c.bottom!=null&&(this.bottom=a.n(c.bottom,d.bottom,y)),d.left!=null&&c.left!=null&&(this.left=a.n(c.left,d.left,y)),d.right!=null&&c.right!=null&&(this.right=a.n(c.right,d.right,y)),this}getCenter(c,d){const y=a.c((this.left+c-this.right)/2,0,c),b=a.c((this.top+d-this.bottom)/2,0,d);return new a.P(y,b)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new tr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function or(g,c){const d=a.g(g,3);a.m.fromQuat(g,c),a.s(g,3,d)}function Un(g,c){const d=a.q.identity([]);return a.q.rotateZ(d,d,-c),a.q.rotateX(d,d,-g),d}function Qr(g,c){const d=[g[0],g[1],0],y=[c[0],c[1],0];if(a.v.length(d)>=1e-15){const S=a.v.normalize([],d);a.v.scale(y,S,a.v.dot(y,S)),c[0]=y[0],c[1]=y[1]}const b=a.v.cross([],c,g);if(a.v.len(b)<1e-15)return null;const T=Math.atan2(-b[1],b[0]);return Un(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),T)}class ai{constructor(c,d){this.position=c,this.orientation=d}get position(){return this._position}set position(c){if(c){const d=c instanceof a.M?c:new a.M(c[0],c[1],c[2]);this._renderWorldCopies&&(d.x=a.w(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(c,d){if(this.orientation=null,!this.position)return;const y=this.position,b=this._elevation?this._elevation.getAtPointOrZero(a.M.fromLngLat(c)):0,T=a.M.fromLngLat(c,b),S=[T.x-y.x,T.y-y.y,T.z-y.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Qr(S,d)}setPitchBearing(c,d){this.orientation=Un(a.d(c),a.d(-d))}}class Po{constructor(c,d){this._transform=a.m.identity([]),this.orientation=d,this.position=c}get mercatorPosition(){const c=this.position;return new a.M(c[0],c[1],c[2])}get position(){const c=a.g(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var d;c&&a.s(this._transform,3,[(d=c)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||a.q.identity([]),c&&or(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,d){this._orientation=Un(c,d),or(this._transform,this._orientation)}forward(){const c=a.g(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=a.g(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=a.g(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,d){const y=new Float64Array(16);return a.m.invert(y,this.getWorldToCamera(c,d)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(c,d,y){const b=this.position;a.v.scale(b,b,-c);const T=new Float64Array(16);return a.m.fromScaling(T,[y,y,y]),a.m.translate(T,T,b),T[10]*=d,T}getWorldToCamera(c,d){const y=new Float64Array(16),b=new Float64Array(4),T=this.position;return a.q.conjugate(b,this._orientation),a.v.scale(T,T,-c),a.m.fromQuat(y,b),a.m.translate(y,y,T),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=d,y[9]*=d,y[10]*=d,y[11]*=d,y}getCameraToClipPerspective(c,d,y,b){const T=new Float64Array(16);return a.m.perspective(T,c,d,y,b),T}getCameraToClipOrthographic(c,d,y,b,T,S){const P=new Float64Array(16);return a.m.ortho(P,c,d,y,b,T,S),P}getDistanceToElevation(c,d=!1){const y=c===0?0:a.b(c,d?a.l(this.position[1]):this.position[1]),b=this.forward();return(y-this.position[2])/b[2]}clone(){return new Po([...this.position],[...this.orientation])}}const Di={unknown:0,flipRequired:1,flipNotRequired:2},js=Math.tan(85*Math.PI/180);function li(g,c,d,y,b,T,S){const P=a.m.create();if(d)if(T.name==="globe"){const M=a.f(b,c);a.m.multiply(P,P,M)}else{const M=a.h.invert([],S);P[0]=M[0],P[1]=M[1],P[4]=M[2],P[5]=M[3],y||a.m.rotateZ(P,P,b.angle)}else a.m.multiply(P,b.labelPlaneMatrix,g);return P}function Vs(g,c,d,y,b,T,S){const P=li(g,c,d,y,b,T,S);return T.name==="globe"&&d||(P[2]=P[6]=P[10]=P[14]=0),P}function pa(g,c,d,y,b,T,S){if(d){if(T.name==="globe"){const P=li(g,c,d,y,b,T,S);return a.m.invert(P,P),a.m.multiply(P,g,P),P}{const P=a.m.clone(g),M=a.m.identity([]);return M[0]=S[0],M[1]=S[1],M[4]=S[2],M[5]=S[3],a.m.multiply(P,P,M),y||a.m.rotateZ(P,P,-b.angle),P}}return b.glCoordMatrix}function ci(g,c,d,y){const b=[g,c,d,1];d?a.e.transformMat4(b,b,y):tn(b,b,y);const T=b[3];return b[0]/=T,b[1]/=T,b[2]/=T,b}function je(g,c){return Math.min(.5+g/c*.5,1.5)}function Ue(g,c){const d=g[0]/g[3],y=g[1]/g[3];return d>=-c[0]&&d<=c[0]&&y>=-c[1]&&y<=c[1]}function tt(g,c,d,y,b,T,S,P,M,D){const z=d.transform,F=y?g.textSizeData:g.iconSizeData,V=a.i(F,d.transform.zoom),U=z.projection.name==="globe",W=[256/d.width*2+1,256/d.height*2+1],H=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;H.clear();let q=null;U&&(q=y?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const G=g.lineVertexArray,Q=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,oe=d.transform.width/d.transform.height;let ce,K=!1;for(let ee=0;ee<Q.length;ee++){const he=Q.get(ee),{numGlyphs:ge,writingMode:de}=he;if(de!==a.W.vertical||K||ce===a.W.horizontal||(K=!0),ce=de,(he.hidden||de===a.W.vertical)&&!K){ot(ge,H);continue}K=!1;const ye=new a.P(he.tileAnchorX,he.tileAnchorY);let{x:Ne,y:Ae,z:Me}=z.projection.projectTilePoint(ye.x,ye.y,D.canonical);if(M){const[mt,Dt,_t]=M(ye);Ne+=mt,Ae+=Dt,Me+=_t}const xe=[Ne,Ae,Me,1];if(a.e.transformMat4(xe,xe,c),!Ue(xe,W)){ot(ge,H);continue}const ze=xe[3],ke=je(d.transform.getCameraToCenterDistance(z.projection),ze),Ve=a.j(F,V,he),ne=S?Ve/ke:Ve*ke,Te=ci(Ne,Ae,Me,b);if(Te[3]<=0){ot(ge,H);continue}let Xe={};const $e=S?null:M,bt=dt(he,ne,!1,P,c,b,T,g.glyphOffsetArray,G,H,q,Te,ye,Xe,oe,$e,z.projection,D,S);K=bt.useVertical,$e&&bt.needsFlipping&&(Xe={}),(bt.notEnoughRoom||K||bt.needsFlipping&&dt(he,ne,!0,P,c,b,T,g.glyphOffsetArray,G,H,q,Te,ye,Xe,oe,$e,z.projection,D,S).notEnoughRoom)&&ot(ge,H)}y?(g.text.dynamicLayoutVertexBuffer.updateData(H),q&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(q)):(g.icon.dynamicLayoutVertexBuffer.updateData(H),q&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(q))}function rt(g,c,d,y,b,T,S,P,M,D,z,F,V,U,W,H){const{lineStartIndex:q,glyphStartIndex:G,segment:Q}=P,oe=G+P.numGlyphs,ce=q+P.lineLength,K=c.getoffsetX(G),ee=c.getoffsetX(oe-1),he=At(g*K,d,y,b,T,S,Q,q,ce,M,D,z,F,V,!0,U,W,H);if(!he)return null;const ge=At(g*ee,d,y,b,T,S,Q,q,ce,M,D,z,F,V,!0,U,W,H);return ge?{first:he,last:ge}:null}function st(g,c,d,y){return g===a.W.horizontal&&Math.abs(y)>Math.abs(d)?{useVertical:!0}:g===a.W.vertical?y>0?{needsFlipping:!0}:null:c!==Di.unknown&&function(b,T){return b===0||Math.abs(T/b)>js}(d,y)?c===Di.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function dt(g,c,d,y,b,T,S,P,M,D,z,F,V,U,W,H,q,G,Q){const oe=c/24,ce=g.lineOffsetX*oe,K=g.lineOffsetY*oe,{lineStartIndex:ee,glyphStartIndex:he,numGlyphs:ge,segment:de,writingMode:ye,flipState:Ne}=g,Ae=ee+g.lineLength,Me=xe=>{if(z){const[ne,Te,Xe]=xe.up,$e=D.length;a.u(z,$e+0,ne,Te,Xe),a.u(z,$e+1,ne,Te,Xe),a.u(z,$e+2,ne,Te,Xe),a.u(z,$e+3,ne,Te,Xe)}const[ze,ke,Ve]=xe.point;a.k(D,ze,ke,Ve,xe.angle)};if(ge>1){const xe=rt(oe,P,ce,K,d,F,V,g,M,T,U,H,!1,q,G,Q);if(!xe)return{notEnoughRoom:!0};if(y&&!d){let[ze,ke,Ve]=xe.first.point,[ne,Te,Xe]=xe.last.point;[ze,ke]=ci(ze,ke,Ve,S),[ne,Te]=ci(ne,Te,Xe,S);const $e=st(ye,Ne,(ne-ze)*W,Te-ke);if(g.flipState=$e&&$e.needsFlipping?Di.flipRequired:Di.flipNotRequired,$e)return $e}Me(xe.first);for(let ze=he+1;ze<he+ge-1;ze++){const ke=At(oe*P.getoffsetX(ze),ce,K,d,F,V,de,ee,Ae,M,T,U,H,!1,!1,q,G,Q);if(!ke)return D.length-=4*(ze-he),{notEnoughRoom:!0};Me(ke)}Me(xe.last)}else{if(y&&!d){const ze=ci(V.x,V.y,0,b),ke=ee+de+1,Ve=new a.P(M.getx(ke),M.gety(ke)),ne=ci(Ve.x,Ve.y,0,b),Te=ne[3]>0?ne:lt(V,Ve,ze,1,b,void 0,q,G.canonical),Xe=st(ye,Ne,(Te[0]-ze[0])*W,Te[1]-ze[1]);if(g.flipState=Xe&&Xe.needsFlipping?Di.flipRequired:Di.flipNotRequired,Xe)return Xe}const xe=At(oe*P.getoffsetX(he),ce,K,d,F,V,de,ee,Ae,M,T,U,H,!1,!1,q,G,Q);if(!xe)return{notEnoughRoom:!0};Me(xe)}return{}}function ft(g,c,d,y,b){const{x:T,y:S,z:P}=y.projectTilePoint(g.x,g.y,c);if(!b)return ci(T,S,P,d);const[M,D,z]=b(g);return ci(T+M,S+D,P+z,d)}function lt(g,c,d,y,b,T,S,P){const M=ft(g.sub(c)._unit()._add(g),P,b,S,T);return a.v.sub(M,d,M),a.v.normalize(M,M),a.v.scaleAndAdd(M,d,M,y)}function At(g,c,d,y,b,T,S,P,M,D,z,F,V,U,W,H,q,G){const Q=y?g-c:g+c;let oe=Q>0?1:-1,ce=0;y&&(oe*=-1,ce=Math.PI),oe<0&&(ce+=Math.PI);let K=P+S+(oe>0?0:1)|0,ee=b,he=b,ge=0,de=0;const ye=Math.abs(Q),Ne=[],Ae=[];let Me=T,xe=Me;const ze=()=>lt(xe,Me,he,ye-ge+1,z,V,H,q.canonical);for(;ge+de<=ye;){if(K+=oe,K<P||K>=M)return null;if(he=ee,xe=Me,Ne.push(he),U&&Ae.push(xe),Me=new a.P(D.getx(K),D.gety(K)),ee=F[K],!ee){const Dt=ft(Me,q.canonical,z,H,V);ee=Dt[3]>0?F[K]=Dt:ze()}ge+=de,de=a.v.distance(he,ee)}W&&V&&(F[K]&&(ee=ze(),de=a.v.distance(he,ee)),F[K]=ee);const ke=(ye-ge)/de,Ve=Me.sub(xe)._mult(ke)._add(xe),ne=a.v.sub([],ee,he),Te=a.v.scaleAndAdd([],he,ne,ke);let Xe=[0,0,1],$e=ne[0],bt=ne[1];if(G&&(Xe=H.upVector(q.canonical,Ve.x,Ve.y),Xe[0]!==0||Xe[1]!==0||Xe[2]!==1)){const Dt=[Xe[2],0,-Xe[0]],_t=a.v.cross([],Xe,Dt);a.v.normalize(Dt,Dt),a.v.normalize(_t,_t),$e=a.v.dot(ne,Dt),bt=a.v.dot(ne,_t)}if(d){const Dt=a.v.cross([],Xe,ne);a.v.normalize(Dt,Dt),a.v.scaleAndAdd(Te,Te,Dt,d*oe)}const mt=ce+Math.atan2(bt,$e);return Ne.push(Te),U&&Ae.push(Ve),{point:Te,angle:mt,path:Ne,tilePath:Ae,up:Xe}}function ot(g,c){const d=c.length,y=d+4*g;c.resize(y),c.float32.fill(-1/0,4*d,4*y)}function tn(g,c,d){const y=c[0],b=c[1];return g[0]=d[0]*y+d[4]*b+d[12],g[1]=d[1]*y+d[5]*b+d[13],g[3]=d[3]*y+d[7]*b+d[15],g}const Mn=(g,c,d)=>(1-d)*g+d*c,Ft=g=>g*g*g*g*g;class zn{constructor(c,d,y,b,T,S,P){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=c||0,this._maxZoom=d||22,this._minPitch=y??0,this._maxPitch=b??60,this.setProjection(S),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new a.L(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new tr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Po,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const c=new zn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(c,d=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(c||y)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return a.p(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=a.o(this.projectionOptions);const y=!A(d,this.getProjection());return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(c){return this._orthographicProjectionAtLowPitch!==c&&(this._orthographicProjectionAtLowPitch=c,this._calcMatrices(),!0)}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.o({name:"mercator"});const d=c!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.b(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.w(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const d=-c*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=a.h.create(),a.h.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const d=a.c(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=a.d(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const d=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){const c=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,d=this.elevation&&c===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||c===Number.NEGATIVE_INFINITY&&(!d||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;d||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=c||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let b=0,T=0;for(let S=0;S<d.length;S++){const P=new a.P(d[S][0]*this.width,y+d[S][1]*(this.height-y)),M=c.pointCoordinate(P);if(!M)continue;const D=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);b+=M[3]*D,T+=D}return T===0?NaN:b/T}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const c=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(c),T=this._mercatorZfromZoom(this._maxZoom),S=Math.max(b-y,T);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let y;y=c.z<this._camera.position[2]?[d.x,d.y,d.z]:[c.x,c.y,c.z];const b=a.v.length(a.v.sub([],this._camera.position,y));return a.c(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let d=!1;if(c.orientation&&!a.q.exactEquals(c.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(c.orientation)),c.position){const y=[c.position.x,c.position.y,c.position.z];a.v.exactEquals(y,this._camera.position)||(this._setCameraPosition(y),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,d=new ai;return d.position=new a.M(c[0],c[1],c[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(c){if(!a.q.length(c))return!1;a.q.normalize(c,c);const d=a.v.transformQuat([],[0,0,-1],c),y=a.v.transformQuat([],[0,-1,0],c);if(y[2]<0)return!1;const b=Qr(d,y);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(c){const d=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;c[2]=a.c(c[2],b/y,b/d),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,d,y){this._unmodified=!1,this._edgeInsets.interpolate(c,d,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const d=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(c){const d=[new a.U(0,c)];if(this.renderWorldCopies){const y=this.pointCoordinate(new a.P(0,0)),b=this.pointCoordinate(new a.P(this.width,0)),T=this.pointCoordinate(new a.P(this.width,this.height)),S=this.pointCoordinate(new a.P(0,this.height)),P=Math.floor(Math.min(y.x,b.x,T.x,S.x)),M=Math.floor(Math.max(y.x,b.x,T.x,S.x)),D=1;for(let z=P-D;z<=M+D;z++)z!==0&&d.push(new a.U(z,c))}return d}isLODDisabled(c){return(!c||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(c,d,y){let b=[];if(d[0]===0&&d[1]===0)return b;for(const S of c){const P=S.canonical,M=S.overscaledZ,D=S.wrap,z=1<<P.z,F=P.x+1<z,V=P.x>0,U=P.y+1<z,W=P.y>0,H=S.wrap-(V?0:1),q=S.wrap+(F?0:1),G=V?P.x-1:z-1,Q=F?P.x+1:0;d[0]<0?(b.push(new a.O(M,q,P.z,Q,P.y)),d[1]<0&&U&&(b.push(new a.O(M,D,P.z,P.x,P.y+1)),b.push(new a.O(M,q,P.z,Q,P.y+1))),d[1]>0&&W&&(b.push(new a.O(M,D,P.z,P.x,P.y-1)),b.push(new a.O(M,q,P.z,Q,P.y-1)))):d[0]>0?(b.push(new a.O(M,H,P.z,G,P.y)),d[1]<0&&U&&(b.push(new a.O(M,D,P.z,P.x,P.y+1)),b.push(new a.O(M,H,P.z,G,P.y+1))),d[1]>0&&W&&(b.push(new a.O(M,D,P.z,P.x,P.y-1)),b.push(new a.O(M,H,P.z,G,P.y-1)))):d[1]<0&&U?b.push(new a.O(M,D,P.z,P.x,P.y+1)):W&&b.push(new a.O(M,D,P.z,P.x,P.y-1))}if(b.length>1){b.sort((M,D)=>M.overscaledZ-D.overscaledZ||M.wrap-D.wrap||M.canonical.z-D.canonical.z||M.canonical.x-D.canonical.x||M.canonical.y-D.canonical.y);let S=0,P=0;for(;P<b.length;)b[P].equals(b[S])?++P:b[++S]=b[P++];b.length=S+1}const T=[];for(const S of b)b.some(P=>S.isChildOf(P))||T.push(S);return b=T.filter(S=>!c.some(P=>!!(S.overscaledZ<y&&P.isChildOf(S))||S.equals(P)||S.isChildOf(P))),b}coveringTiles(c){let d=this.coveringZoomLevel(c);const y=d,b=this.elevation&&this.elevation.exaggeration(),T=b&&!c.isTerrainDEM,S=this.projection.name==="mercator";if(c.minzoom!==void 0&&d<c.minzoom)return[];c.maxzoom!==void 0&&d>c.maxzoom&&(d=c.maxzoom);const P=this.locationCoordinate(this.center),M=this.center.lat,D=1<<d,z=[D*P.x,D*P.y,0],F=this.projection.name==="globe",V=!F,U=a.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,V),W=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),H=D*a.b(1,this.center.lat),q=this._camera.position[2]/a.b(1,this.center.lat),G=[D*W.x,D*W.y,q*(V?1:H)],Q=F||b,oe=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),ce=this.isLODDisabled(!0)?d:0;let K;if(this._elevation&&c.isTerrainDEM)K=1e4*this._elevation.exaggeration();else if(this._elevation){const ne=this._elevation.getMinMaxForVisibleTiles();K=ne?ne.max:this._centerAltitude}else K=this._centerAltitude;const ee=c.isTerrainDEM?-K:this._elevation?this._elevation.getMinElevationBelowMSL():0,he=this.projection.isReprojectedInTileSpace?a.r(this):1,ge=ne=>{const Xe=new a.M(ne.x+25e-6,ne.y,ne.z),$e=new a.M(ne.x,ne.y+25e-6,ne.z),bt=ne.toLngLat(),mt=Xe.toLngLat(),Dt=$e.toLngLat(),_t=this.locationCoordinate(bt),Bt=this.locationCoordinate(mt),jt=this.locationCoordinate(Dt),Ct=Math.hypot(Bt.x-_t.x,Bt.y-_t.y),Mt=Math.hypot(jt.x-_t.x,jt.y-_t.y);return Math.sqrt(Ct*Mt)*he/25e-6},de=ne=>{const Te=K,Xe=ee;return{aabb:a.y(this,D,0,0,0,ne,Xe,Te,this.projection),zoom:0,x:0,y:0,minZ:Xe,maxZ:Te,wrap:ne,fullyVisible:!1}},ye=[];let Ne=[];const Ae=d,Me=c.reparseOverscaled?y:d,xe=ne=>ne*ne,ze=xe((q-this._centerAltitude)*H),ke=ne=>{if(!this._elevation||!ne.tileID||!S)return;const Te=this._elevation.getMinMaxForTile(ne.tileID),Xe=ne.aabb;Te?(Xe.min[2]=Te.min,Xe.max[2]=Te.max,Xe.center[2]=(Xe.min[2]+Xe.max[2])/2):(ne.shouldSplit=Ve(ne),ne.shouldSplit||(Xe.min[2]=Xe.max[2]=Xe.center[2]=this._centerAltitude))},Ve=ne=>{if(ne.zoom<ce)return!0;if(ne.zoom===Ae)return!1;if(ne.shouldSplit!=null)return ne.shouldSplit;const Te=ne.aabb.distanceX(G),Xe=ne.aabb.distanceY(G);let $e=ze,bt=1;if(F){$e=xe(ne.aabb.distanceZ(G));const _t=Math.pow(2,ne.zoom),Bt=a.l((ne.y+1)/_t),jt=a.l(ne.y/_t),Ct=Math.min(Math.max(M,Bt),jt),Mt=a.a0(Ct)/a.a0(M);if(bt=Ct===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Mt/this._mercatorScaleRatio),this.zoom<=a.Z&&ne.zoom===Ae-1&&Mt>=.9)return!0}else if(T&&($e=xe(ne.aabb.distanceZ(G)*H)),this.projection.isReprojectedInTileSpace&&y<=5){const _t=Math.pow(2,ne.zoom),Bt=ge(new a.M((ne.x+.5)/_t,(ne.y+.5)/_t));bt=Bt>.85?1:Bt}const mt=Te*Te+Xe*Xe+$e,Dt=xe((1<<Ae-ne.zoom)*oe*bt*((_t,Bt)=>{if(Bt*xe(.707)<_t)return 1;const jt=Math.sqrt(Bt/_t);return jt/(1.4144271570014144+(Math.pow(1.1,jt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max($e,ze),mt));return mt<Dt};if(this.renderWorldCopies)for(let ne=1;ne<=3;ne++)ye.push(de(-ne)),ye.push(de(ne));for(ye.push(de(0));ye.length>0;){const ne=ye.pop(),Te=ne.x,Xe=ne.y;let $e=ne.fullyVisible;const bt=()=>this.projection.name==="globe"&&(ne.y===0||ne.y===(1<<ne.zoom)-1);if(!$e){let mt=Q?ne.aabb.intersects(U):ne.aabb.intersectsFlat(U);if(mt===0&&bt()){const Dt=new a.t(ne.zoom,Te,Xe);mt=a.x(this,D,Dt,!0).intersects(U)}if(mt===0)continue;$e=mt===2}if(ne.zoom!==Ae&&Ve(ne))for(let mt=0;mt<4;mt++){const Dt=(Te<<1)+mt%2,_t=(Xe<<1)+(mt>>1),Bt={aabb:S?ne.aabb.quadrant(mt):a.y(this,D,ne.zoom+1,Dt,_t,ne.wrap,ne.minZ,ne.maxZ,this.projection),zoom:ne.zoom+1,x:Dt,y:_t,wrap:ne.wrap,fullyVisible:$e,tileID:void 0,shouldSplit:void 0,minZ:ne.minZ,maxZ:ne.maxZ};T&&!F&&(Bt.tileID=new a.O(ne.zoom+1===Ae?Me:ne.zoom+1,ne.wrap,ne.zoom+1,Dt,_t),ke(Bt)),ye.push(Bt)}else{const mt=ne.zoom===Ae?Me:ne.zoom;if(c.minzoom&&c.minzoom>mt)continue;if(!$e){let jt=Q?ne.aabb.intersectsPrecise(U):ne.aabb.intersectsPreciseFlat(U);if(jt===0&&bt()){const Ct=new a.t(ne.zoom,Te,Xe);jt=a.x(this,D,Ct,!0).intersectsPrecise(U)}if(jt===0)continue}const Dt=z[0]-(.5+Te+(ne.wrap<<ne.zoom))*(1<<d-ne.zoom),_t=z[1]-.5-Xe,Bt=ne.tileID?ne.tileID:new a.O(mt,ne.wrap,ne.zoom,Te,Xe);Ne.push({tileID:Bt,distanceSq:Dt*Dt+_t*_t})}}if(this.fogCullDistSq){const ne=this.fogCullDistSq,Te=this.horizonLineFromTop();Ne=Ne.filter(Xe=>{const $e=[0,0,0,1],bt=[a.J,a.J,0,1],mt=this.calculateFogTileMatrix(Xe.tileID.toUnwrapped());a.e.transformMat4($e,$e,mt),a.e.transformMat4(bt,bt,mt);const Dt=a.e.min([],$e,bt),_t=a.e.max([],$e,bt),Bt=a.z(Dt,_t);if(Bt===0)return!0;let jt=!1;const Ct=this._elevation;if(Ct&&Bt>ne&&Te!==0){const Mt=this.calculateProjMatrix(Xe.tileID.toUnwrapped());let yn;c.isTerrainDEM||(yn=Ct.getMinMaxForTile(Xe.tileID)),yn||(yn={min:ee,max:K});const Qt=a._(this.rotation),Hn=[Qt[0]*a.J,Qt[1]*a.J,yn.max];a.v.transformMat4(Hn,Hn,Mt),jt=(1-Hn[1])*this.height*.5<Te}return Bt<ne||jt})}return Ne.sort((ne,Te)=>ne.distanceSq-Te.distanceSq).map(ne=>ne.tileID)}resize(c,d){this.width=c,this.height=d,this.pixelsToGLUnits=[2/c,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const d=a.c(c.lat,-a.A,a.A),y=this.projection.project(c.lng,d);return new a.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.b(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,d){let y,b;const T=this.centerPoint;if(this.projection.name==="globe"){const P=this.worldSize;y=(d.x-T.x)/P,b=(d.y-T.y)/P}else{const P=this.pointCoordinate(d),M=this.pointCoordinate(T);y=P.x-M.x,b=P.y-M.y}const S=this.locationCoordinate(c);this.setLocation(new a.M(S.x-y,S.y-b))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,d){const y=d?a.b(d,c.lat):void 0,b=this.projection.project(c.lng,c.lat);return new a.M(b.x,b.y,y)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,d){const y=d??this._centerAltitude,b=[c.x,c.y,0,1],T=[c.x,c.y,1,1];a.e.transformMat4(b,b,this.pixelMatrixInverse),a.e.transformMat4(T,T,this.pixelMatrixInverse);const S=T[3];a.e.scale(b,b,1/b[3]),a.e.scale(T,T,1/S);const P=b[2],M=T[2];return{p0:b,p1:T,t:P===M?0:(y-P)/(M-P)}}screenPointToMercatorRay(c){const d=[c.x,c.y,0,1],y=[c.x,c.y,1,1];return a.e.transformMat4(d,d,this.pixelMatrixInverse),a.e.transformMat4(y,y,this.pixelMatrixInverse),a.e.scale(d,d,1/d[3]),a.e.scale(y,y,1/y[3]),d[2]=a.b(d[2],this._center.lat)*this.worldSize,y[2]=a.b(y[2],this._center.lat)*this.worldSize,a.e.scale(d,d,1/this.worldSize),a.e.scale(y,y,1/this.worldSize),new a.R([d[0],d[1],d[2]],a.v.normalize([],a.v.sub([],y,d)))}rayIntersectionCoordinate(c){const{p0:d,p1:y,t:b}=c,T=a.b(d[2],this._center.lat),S=a.b(y[2],this._center.lat);return new a.M(a.n(d[0],y[0],b)/this.worldSize,a.n(d[1],y[1],b)/this.worldSize,a.n(T,S,b))}pointCoordinate(c,d=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,d)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let d=this.projection.pointCoordinate3D(this,c.x,c.y);if(d)return new a.M(d[0],d[1],d[2]);let y=0,b=this.horizonLineFromTop();if(c.y>b)return this.pointCoordinate(c);const T=.02*b,S=c.clone();for(let P=0;P<10&&b-y>T;P++){S.y=a.n(y,b,.66);const M=this.projection.pointCoordinate3D(this,S.x,S.y);M?(b=S.y,d=M):y=S.y}return d?new a.M(d[0],d[1],d[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=a.G)return!this.isPointAboveHorizon(c);const d=this.pointCoordinate(c);return d.y>=0&&d.y<=1}_coordinatePoint(c,d){const y=d&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,b=[c.x*this.worldSize,c.y*this.worldSize,y+c.toAltitude(),1];return a.e.transformMat4(b,b,this.pixelMatrix),b[3]>0?new a.P(b[0]/b[3],b[1]/b[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:d}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,T=this.pointLocation3D(new a.P(d,c)),S=this.pointLocation3D(new a.P(b,c)),P=this.pointLocation3D(new a.P(b,y)),M=this.pointLocation3D(new a.P(d,y));let D=Math.min(T.lng,S.lng,P.lng,M.lng),z=Math.max(T.lng,S.lng,P.lng,M.lng),F=Math.min(T.lat,S.lat,P.lat,M.lat),V=Math.max(T.lat,S.lat,P.lat,M.lat);const U=Math.pow(2,-this.zoom)/16*270,W=this.projection.name==="globe"?1:4,H=(q,G,Q,oe,ce)=>{const K=(q+Q)/2,ee=(G+oe)/2,he=new a.P(K,ee),{lng:ge,lat:de}=this.pointLocation3D(he),ye=Math.max(0,D-ge,F-de,ge-z,de-V);D=Math.min(D,ge),z=Math.max(z,ge),F=Math.min(F,de),V=Math.max(V,de),(ce<W||ye>U)&&(H(q,G,K,ee,ce+1),H(K,ee,Q,oe,ce+1))};if(H(d,c,b,c,1),H(b,c,b,y,1),H(b,y,d,y,1),H(d,y,d,c,1),this.projection.name==="globe"){const[q,G]=a.B(this);q?(V=90,z=180,D=-180):G&&(F=-90,z=180,D=-180)}return new a.D(new a.L(D,F),new a.L(z,V))}_getBoundsRectangular(c,d){const{top:y,left:b}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,P=new a.P(b,y),M=new a.P(S,y),D=new a.P(S,T),z=new a.P(b,T);let F=this.pointCoordinate(P,c),V=this.pointCoordinate(M,c);const U=this.pointCoordinate(D,d),W=this.pointCoordinate(z,d),H=(q,G)=>(G.y-q.y)/(G.x-q.x);return F.y>1&&V.y>=0?F=new a.M((1-W.y)/H(W,F)+W.x,1):F.y<0&&V.y<=1&&(F=new a.M(-W.y/H(W,F)+W.x,0)),V.y>1&&F.y>=0?V=new a.M((1-U.y)/H(U,V)+U.x,1):V.y<0&&F.y<=1&&(V=new a.M(-U.y/H(U,V)+U.x,0)),new a.D().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(U))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=c.visibleDemTiles.reduce((y,b)=>{if(b.dem){const T=b.dem.tree;y.min=Math.min(y.min,T.minimums[0]),y.max=Math.max(y.max,T.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*c.exaggeration(),d.max*c.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-d*(1-this._horizonShift);return c?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-a.A,this.maxLat=a.A,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.E(this.minLng)*this.tileSize,this.worldMaxX=a.E(this.maxLng)*this.tileSize,this.worldMinY=a.H(this.maxLat)*this.tileSize,this.worldMaxY=a.H(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,d){return this.projection.createTileMatrix(this,d,c)}calculateDistanceTileData(c){const d=c.key,y=this._distanceTileDataCache;if(y[d])return y[d];const b=c.canonical,T=1/this.height,S=this.cameraWorldSize,P=S/this.zoomScale(b.z),M=(b.x+Math.pow(2,b.z)*c.wrap)*P,D=b.y*P,z=this.point;z.x*=S/this.worldSize,z.y*=S/this.worldSize;const F=this.angle,V=Math.sin(-F),U=-Math.cos(-F);return y[d]={bearing:[V,U],center:[(z.x-M)*T,(z.y-D)*T],scale:P/a.J*T},y[d]}calculateFogTileMatrix(c){const d=c.key,y=this._fogTileMatrixCache;if(y[d])return y[d];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return a.m.multiply(b,this.worldToFogMatrix,b),y[d]=new Float32Array(b),y[d]}calculateProjMatrix(c,d=!1,y=!1){const b=c.key;let T;if(T=y?this._expandedProjMatrixCache:d?this._alignedProjMatrixCache:this._projMatrixCache,T[b])return T[b];const S=this.calculatePosMatrix(c,this.worldSize);let P;return P=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:d?this.alignedProjMatrix:this.projMatrix,a.m.multiply(S,P,S),T[b]=new Float32Array(S),T[b]}calculatePixelsToTileUnitsMatrix(c){const d=c.tileID.key,y=this._pixelsToTileUnitsCache;if(y[d])return y[d];const b=a.K(c,this);return y[d]=b,y[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const c=1/this.worldSize,d=a.m.fromScaling([],[c,c,c]);return a.m.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const c=this._elevation;this._updateCameraState();const d=a.b(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),b=this._camera.forward(),T=a.b(1,this._center.lat);y[2]/=T,b[2]/=T,a.v.normalize(b,b);const S=c.raycast(y,b,c.exaggeration());if(S){const P=a.v.scaleAndAdd([],y,b,S),M=new a.M(P[0],P[1],a.b(P[2],a.l(P[1]))),D=(M.z+a.v.length([M.x-y[0],M.y-y[1],M.z-y[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const d=this._elevation,y=a.b(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(y),T=d.getAtPointOrZero(new a.M(...b)),S=this.pixelsPerMeter/this.worldSize*T,P=this._minimumHeightOverTerrain(),M=b[2]-S;if(M<=P)if(M<0||c){const D=this.locationCoordinate(this._center,this._centerAltitude),z=[b[0],b[1],D.z-b[2]],F=a.v.length(z);z[2]-=(P-M)/this._pixelsPerMercatorPixel;const V=a.v.length(z);if(V===0)return;a.v.scale(z,z,F/V*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],D.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const V=this.center;return V.lat=a.c(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(V.lng=a.c(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const d=this._unmodified,{x:y,y:b}=this.point;let T=0,S=y,P=b;const M=this.width/2,D=this.height/2,z=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(b-D<z&&(P=z+D),b+D>F&&(P=F-D),F-z<this.height&&(T=Math.max(T,this.height/(F-z)),P=(F+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,W=this.worldSize/2-(V+U)/2;S=(y+W+this.worldSize)%this.worldSize-W,S-M<V&&(S=V+M),S+M>U&&(S=U-M),U-V<this.width&&(T=Math.max(T,this.width/(U-V)),S=(U+V)/2)}S===y&&P===b||(this.center=this.unproject(new a.P(S,P))),T&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,d=this.projection.name==="globe",y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.b(1,this.center.lat)/a.b(1,a.$));const b=a.N(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T=this.projection.zAxisUnit==="meters"?y:1,S=this._camera.getWorldToCamera(this.worldSize,T);let P;const M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(M[8]=2*-c.x/this.width,M[9]=2*c.y/this.height,this.isOrthographic){let de=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ye=de*this.aspect,Ne=-ye,Ae=-de;ye-=c.x,Ne-=c.x,de+=c.y,Ae+=c.y,P=this._camera.getCameraToClipOrthographic(Ne,ye,Ae,de,this._nearZ,this._farZ),((Me,xe,ze,ke)=>{for(let Ve=0;Ve<16;Ve++)Me[Ve]=Mn(xe[Ve],ze[Ve],ke)})(P,P,M,Ft(this.pitch>=15?1:this.pitch/15))}else P=M;const D=a.m.mul([],M,S);let z=a.m.mul([],P,S);if(this.projection.isReprojectedInTileSpace){const de=this.locationCoordinate(this.center),ye=a.m.identity([]);a.m.translate(ye,ye,[de.x*this.worldSize,de.y*this.worldSize,0]),a.m.multiply(ye,ye,a.Q(this)),a.m.translate(ye,ye,[-de.x*this.worldSize,-de.y*this.worldSize,0]),a.m.multiply(z,z,ye),a.m.multiply(D,D,ye),this.inverseAdjustmentMatrix=a.S(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.m.scale([],z,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=z,this.invProjMatrix=a.m.invert(new Float64Array(16),this.projMatrix),d){const de=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);de[8]=2*-c.x/this.width,de[9]=2*c.y/this.height,this.expandedFarZProjMatrix=a.m.mul([],de,S)}else this.expandedFarZProjMatrix=this.projMatrix;const F=a.m.invert([],P);this.frustumCorners=a.T.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!d);const V=new Float32Array(16);a.m.identity(V),a.m.scale(V,V,[1,-1,1]),a.m.rotateX(V,V,this._pitch),a.m.rotateZ(V,V,this.angle);const U=a.m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.m.clone(U);const W=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-c.x/this.width,U[9]=2*(c.y+W)/this.height,this.skyboxMatrix=a.m.multiply(V,U,V);const H=this.point,q=H.x,G=H.y,Q=this.width%2/2,oe=this.height%2/2,ce=Math.cos(this.angle),K=Math.sin(this.angle),ee=q-Math.round(q)+ce*Q+K*oe,he=G-Math.round(G)+ce*oe+K*Q,ge=new Float64Array(z);if(a.m.translate(ge,ge,[ee>.5?ee-1:ee,he>.5?he-1:he,0]),this.alignedProjMatrix=ge,z=a.m.create(),a.m.scale(z,z,[this.width/2,-this.height/2,1]),a.m.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=a.m.create(),a.m.scale(z,z,[1,-1,1]),a.m.translate(z,z,[-1,-1,0]),a.m.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=a.m.multiply(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},z=a.m.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.V(this);const de=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.v.transformMat4(de,de,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,y=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,T=[c,c,d];a.v.scale(T,T,b),a.v.scale(y,y,-1),a.v.multiply(y,y,T);const S=a.m.create();a.m.translate(S,S,y),a.m.scale(S,S,T),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,d,b)}_computeCameraPosition(c){const d=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),b=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-c/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-y[0]*T,b.y/this.worldSize-y[1]*T,c/this.worldSize*this._centerAltitude-y[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],b=c[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(T=Math.min((d-y)/b,1)),this._camera.position=a.v.scaleAndAdd([],this._camera.position,c,T),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,d=this._camera.forward(),{pitch:y,bearing:b}=this._camera.getPitchBearing(),T=a.b(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.d(this._maxPitch)),P=Math.max((c[2]-T)/Math.cos(y),S),M=this._zoomFromMercatorZ(P);a.v.scaleAndAdd(c,c,d,P),this._pitch=a.c(y,a.d(this.minPitch),a.d(this.maxPitch)),this.angle=a.w(b,-Math.PI,Math.PI),this._setZoom(a.c(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.M(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let d=0,y=a.G,b=0,T=1/0;for(;y-d>1e-6&&y>d;){const S=d+.5*(y-d),P=this.tileSize*Math.pow(2,S),M=this.getCameraToCenterDistance(this.projection,S,P),D=this.scaleZoom(M/(c*this.tileSize)),z=Math.abs(S-D);z<T&&(T=z,b=S),S<D?d=S:y=S}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.X("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,d){const y=Math.min(c.x,d.x),b=Math.max(c.x,d.x),T=Math.min(c.y,d.y),S=Math.max(c.y,d.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const P=[new a.P(y,T),new a.P(b,S),new a.P(y,S),new a.P(b,T)],M=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const z of P){const F=this.pointRayIntersection(z);if(F.t<0)return!0;const V=this.rayIntersectionCoordinate(F);if(V.x<M||V.y<0||V.x>D||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.Y(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(c,d){const y=a.v.length(a.v.sub([],this._camera.position,c)),b=this._zoomFromMercatorZ(y)+d;return y-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const c=function([d,y,b],T){const S=[d,y,b,1];a.e.transformMat4(S,S,T);const P=S[3]=Math.max(S[3],1e-6);return S[0]/=P,S[1]/=P,S[2]/=P,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,c))}}getCameraToCenterDistance(c,d=this.zoom,y=this.worldSize){const b=a.N(c,d,this.width,this.height,1024),T=c.pixelSpaceConversion(this.center.lat,y,b);let S=.5/Math.tan(.5*this._fov)*this.height*T;return this.isOrthographic&&(S=Mn(1,S,Ft(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.m.multiply(c,c,this.globeMatrix),c}getFrustum(c){return a.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,this.projection.zAxisUnit==="meters")}}function wr(g){const{userImage:c}=g;return!!(c&&c.render&&c.render())&&(g.data.replace(new Uint8Array(c.data.buffer)),!0)}class Sr extends a.a6{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(c){this.images[c]={},this.loaded[c]=!1,this.updatedImages[c]={},this.patterns[c]={},this.callbackDispatchedThisFrame[c]={},this.atlasImage[c]=new a.a5({width:1,height:1})}isLoaded(){for(const c in this.loaded)if(!this.loaded[c])return!1;return!0}setLoaded(c,d){if(this.loaded[d]!==c&&(this.loaded[d]=c,c)){for(const{ids:y,callback:b}of this.requestors)this._notify(y,d,b);this.requestors=[]}}hasImage(c,d){return!!this.getImage(c,d)}getImage(c,d){return this.images[d][c]}addImage(c,d,y){this._validate(c,y)&&(this.images[d][c]=y)}_validate(c,d){let y=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new a.a7(new Error(`Image "${c}" has invalid "stretchX" value`))),y=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new a.a7(new Error(`Image "${c}" has invalid "stretchY" value`))),y=!1),this._validateContent(d.content,d)||(this.fire(new a.a7(new Error(`Image "${c}" has invalid "content" value`))),y=!1),y}_validateStretch(c,d){if(!c)return!0;let y=0;for(const b of c){if(b[0]<y||b[1]<b[0]||d<b[1])return!1;y=b[1]}return!0}_validateContent(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,d,y){y.version=this.images[d][c].version+1,this.images[d][c]=y,this.updatedImages[d][c]=!0}removeImage(c,d){const y=this.images[d][c];delete this.images[d][c],delete this.patterns[d][c],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(c){return Object.keys(this.images[c])}getImages(c,d,y){let b=!0;const T=!!this.loaded[d];if(!T)for(const S of c)this.images[d][S]||(b=!1);T||b?this._notify(c,d,y):this.requestors.push({ids:c,scope:d,callback:y})}getUpdatedImages(c){return this.updatedImages[c]}_notify(c,d,y){const b={};for(const T of c){this.images[d][T]||this.fire(new a.a8("styleimagemissing",{id:T}));const S=this.images[d][T];S?b[T]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:a.X(`Image "${T}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}y(null,b)}getPixelSize(c){const{width:d,height:y}=this.atlasImage[c];return{width:d,height:y}}getPattern(c,d){const y=this.patterns[d][c],b=this.getImage(c,d);if(!b)return null;if(y&&y.position.version===b.version)return y.position;if(y)y.position.version=b.version;else{const T={w:b.data.width+2,h:b.data.height+2,x:0,y:0},S=new a.ab(T,b);this.patterns[d][c]={bin:T,position:S}}return this._updatePatternAtlas(d),this.patterns[d][c].position}bind(c,d){const y=c.gl;let b=this.atlasTexture[d];b?this.dirty&&(b.update(this.atlasImage[d]),this.dirty=!1):(b=new a.a9(c,this.atlasImage[d],y.RGBA),this.atlasTexture[d]=b),b.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(c){const d=[];for(const S in this.patterns[c])d.push(this.patterns[c][S].bin);const{w:y,h:b}=a.aa(d),T=this.atlasImage[c];T.resize({width:y||1,height:b||1});for(const S in this.patterns[c]){const{bin:P}=this.patterns[c][S],M=P.x+1,D=P.y+1,z=this.images[c][S].data,F=z.width,V=z.height;a.a5.copy(z,T,{x:0,y:0},{x:M,y:D},{width:F,height:V}),a.a5.copy(z,T,{x:0,y:V-1},{x:M,y:D-1},{width:F,height:1}),a.a5.copy(z,T,{x:0,y:0},{x:M,y:D+V},{width:F,height:1}),a.a5.copy(z,T,{x:F-1,y:0},{x:M-1,y:D},{width:1,height:V}),a.a5.copy(z,T,{x:0,y:0},{x:M+F,y:D},{width:1,height:V})}this.dirty=!0}beginFrame(){for(const c in this.images)this.callbackDispatchedThisFrame[c]={}}dispatchRenderCallbacks(c,d){for(const y of c){if(this.callbackDispatchedThisFrame[d][y])continue;this.callbackDispatchedThisFrame[d][y]=!0;const b=this.images[d][y];wr(b)&&this.updateImage(y,d,b)}}}const Mr=new a.ac({anchor:new a.ad(a.ae.light.anchor),position:new a.af(a.ae.light.position),color:new a.ad(a.ae.light.color),intensity:new a.ad(a.ae.light.intensity)});class yi extends a.a6{constructor(c,d="flat"){super(),this._transitionable=new a.ag(Mr),this.setLight(c,d),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,d,y={}){this._validate(a.ah,c,y)||(this._transitionable.setTransitionOrValue(c),this.id=d)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,d,y){return(!y||y.validate!==!1)&&a.ai(this,c.call(a.aj,a.ak({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.ae})))}}const go=new a.ac({source:new a.ad(a.ae.terrain.source),exaggeration:new a.ad(a.ae.terrain.exaggeration)});let ko=class extends a.a6{constructor(g,c,d,y){super(),this.scope=d,this._transitionable=new a.ag(go,d,y),this._transitionable.setTransitionOrValue(g,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(g,c){this._transitionable.setTransitionOrValue(g,c)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new a.al(g)).get("exaggeration")}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof a.am}};const _o=45,vi=65,Ki=.05;function Us(g,c,d,y){const b=a.an(_o,vi,d),[T,S]=cc(g,y);let P=1-Math.min(1,Math.exp((c-T)/(S-T)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*b*g.alpha}function cc(g,c){const d=.5/Math.tan(.5*c);return[g.range[0]+d,g.range[1]+d]}function Lp(g,c,d,y,b){const T=a.v.transformMat4([],[c,d,y],b.mercatorFogMatrix);return Us(g,a.v.length(T),b.pitch,b._fov)}function sd(g,c,d,y,b,T,S){const P=[[d,y,0],[b,y,0],[b,T,0],[d,T,0]];let M=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const z of P){const F=a.v.transformMat4([],z,c),V=a.v.length(F);M=Math.min(M,V),D=Math.max(D,V)}return[Us(g,M,S.pitch,S._fov),Us(g,D,S.pitch,S._fov)]}const ad=new a.ac({range:new a.ad(a.ae.fog.range),color:new a.ad(a.ae.fog.color),"high-color":new a.ad(a.ae.fog["high-color"]),"space-color":new a.ad(a.ae.fog["space-color"]),"horizon-blend":new a.ad(a.ae.fog["horizon-blend"]),"star-intensity":new a.ad(a.ae.fog["star-intensity"]),"vertical-range":new a.ad(a.ae.fog["vertical-range"])});class zp extends a.a6{constructor(c,d){super(),this._transitionable=new a.ag(ad),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){const c=this._transform,d=c.projection.name==="globe",y=a.ao(c.zoom),b=this.properties.get("range"),T=[.5,3];return{range:d?[a.n(T[0],b[0],y),a.n(T[1],b[1],y)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,d={}){if(this._validate(a.ap,c,d))return;const y=a.ak({},c);for(const b of Object.keys(a.ae.fog))y[b]===void 0&&(y[b]=a.ae.fog[b].default);this._transitionable.setTransitionOrValue(y)}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.an(_o,vi,c))*d.a}getOpacityAtLatLng(c,d){return this._transform.projection.supportsFog?function(y,b,T){const S=a.M.fromLngLat(b),P=T.elevation?T.elevation.getAtPointOrZero(S):0;return Lp(y,S.x,S.y,P,T)}(this.state,c,d):0}getOpacityForTile(c){if(!this._transform.projection.supportsFog)return[1,1];const d=this._transform.calculateFogTileMatrix(c.toUnwrapped());return sd(this.state,d,0,0,a.J,a.J,this._transform)}getOpacityForBounds(c,d,y,b,T){return this._transform.projection.supportsFog?sd(this.state,c,d,y,b,T,this._transform):[1,1]}getFovAdjustedRange(c){return this._transform.projection.supportsFog?cc(this.state,c):[0,1]}isVisibleOnFrustum(c){if(!this._transform.projection.supportsFog)return!1;const d=[4,5,6,7];for(const y of d){const b=c.points[y];let T;if(b[2]>=0)T=b;else{const S=c.points[y-4];T=a.aq(S,b,S[2]/(S[2]-b[2]))}if(Lp(this.state,T[0],T[1],0,this._transform)>=Ki)return!0}return!1}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,d,y){return(!y||y.validate!==!1)&&a.ai(this,c.call(a.aj,a.ak({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.ae})))}}class Mu extends a.a6{constructor(c,d,y,b){super(),this.scope=y,this._options=c,this.properties=new a.ar(d),this._transitionable=new a.ag(d,y,new Map(b)),this._transitionable.setTransitionOrValue(c.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(c){this._transitionable.setTransitionOrValue(this._options.properties,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(c,d){this._options=c,this._transitionable.setTransitionOrValue(c.properties,d)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const Qa=new a.ac({color:new a.ad(a.ae.properties_light_ambient.color),intensity:new a.ad(a.ae.properties_light_ambient.intensity)}),Dy=new a.ac({direction:new a.as(a.ae.properties_light_directional.direction),color:new a.ad(a.ae.properties_light_directional.color),intensity:new a.ad(a.ae.properties_light_directional.intensity),"cast-shadows":new a.ad(a.ae.properties_light_directional["cast-shadows"]),"shadow-intensity":new a.ad(a.ae.properties_light_directional["shadow-intensity"])});class Li{constructor(c,d,y,b){this.screenBounds=c,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(c,d){let y,b;if(c instanceof a.P||typeof c[0]=="number"){const T=a.P.convert(c);y=[T],b=d.isPointAboveHorizon(T)}else{const T=a.P.convert(c[0]),S=a.P.convert(c[1]);y=[T,S],b=a.at(T,S).every(P=>d.isPointAboveHorizon(P))}return new Li(y,d.getCameraPoint(),b,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(c){return a.at(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],b=a.at(d,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<y.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),a.au(b,c)}bufferedCameraGeometryGlobe(c){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],b=a.at(d,y,c),T=this.cameraPoint.clone();switch(3*((T.y>d.y)+(T.y>y.y))+((T.x>d.x)+(T.x>y.x))){case 0:b[0]=T,b[4]=T.clone();break;case 1:b.splice(1,0,T);break;case 2:b[1]=T;break;case 3:b.splice(4,0,T);break;case 5:b.splice(2,0,T);break;case 6:b[3]=T;break;case 7:b.splice(3,0,T);break;case 8:b[2]=T}return b}containsTile(c,d,y,b=0){const T=c.queryPadding/d._pixelsPerMercatorPixel+1,S=y?this._bufferedCameraMercator(T,d):this._bufferedScreenMercator(T,d);let P=c.tileID.wrap+(S.unwrapped?b:0);const M=S.polygon.map(q=>a.av(c.tileTransform,q,P));if(!a.aw(M,0,0,a.J,a.J))return;P=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const D=this.screenGeometryMercator.polygon.map(q=>a.ax(c.tileTransform,q,P)),z=D.map(q=>new a.P(q[0],q[1])),F=d.getFreeCameraOptions().position||new a.M(0,0,0),V=a.ax(c.tileTransform,F,P),U=D.map(q=>{const G=a.v.sub(q,q,V);return a.v.normalize(G,G),new a.R(V,G)}),W=a.ay(c,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:U,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(H=a.az(M),H.min.x=a.c(H.min.x,0,a.J),H.min.y=a.c(H.min.y,0,a.J),H.max.x=a.c(H.max.x,0,a.J),H.max.y=a.c(H.max.y,0,a.J),H),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:W};var H}_bufferedScreenMercator(c,d){const y=Xo(c);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(c),d):{polygon:this.bufferedScreenGeometry(c).map(T=>d.pointCoordinate3D(T)),unwrapped:!0},this._screenRaycastCache[y]=b,b}}_bufferedCameraMercator(c,d){const y=Xo(c);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),d):{polygon:this.bufferedCameraGeometry(c).map(T=>d.pointCoordinate3D(T)),unwrapped:!0},this._cameraRaycastCache[y]=b,b}}_projectAndResample(c,d){const y=function(T,S){const P=a.m.multiply([],S.pixelMatrix,S.globeMatrix),M=[0,-a.aC,0,1],D=[0,a.aC,0,1],z=[0,0,0,1];a.e.transformMat4(M,M,P),a.e.transformMat4(D,D,P),a.e.transformMat4(z,z,P);const F=new a.P(M[0]/M[3],M[1]/M[3]),V=new a.P(D[0]/D[3],D[1]/D[3]),U=a.aA(T,F)&&M[3]<z[3],W=a.aA(T,V)&&D[3]<z[3];if(!U&&!W)return null;const H=function(he,ge,de){for(let ye=1;ye<he.length;ye++){const Ne=el(ge.pointCoordinate3D(he[ye-1]).x),Ae=el(ge.pointCoordinate3D(he[ye]).x);if(de<0){if(Ne<Ae)return{idx:ye,t:-Ne/(Ae-1-Ne)}}else if(Ae<Ne)return{idx:ye,t:(1-Ne)/(Ae+1-Ne)}}return null}(T,S,U?-1:1);if(!H)return null;const{idx:q,t:G}=H;let Q=q>1?ld(T.slice(0,q),S):[],oe=q<T.length?ld(T.slice(q),S):[];Q=Q.map(he=>new a.P(el(he.x),he.y)),oe=oe.map(he=>new a.P(el(he.x),he.y));const ce=[...Q];ce.length===0&&ce.push(oe[oe.length-1]);const K=a.n(ce[ce.length-1].y,(oe.length===0?Q[0]:oe[0]).y,G);let ee;return ee=U?[new a.P(0,K),new a.P(0,0),new a.P(1,0),new a.P(1,K)]:[new a.P(1,K),new a.P(1,1),new a.P(0,1),new a.P(0,K)],ce.push(...ee),oe.length===0?ce.push(Q[0]):ce.push(...oe),{polygon:ce.map(he=>new a.M(he.x,he.y)),unwrapped:!1}}(c,d);if(y)return y;const b=function(T,S){let P=!1,M=-1/0,D=0;for(let F=0;F<T.length-1;F++)T[F].x>M&&(M=T[F].x,D=F);for(let F=0;F<T.length-1;F++){const V=(D+F)%(T.length-1),U=T[V],W=T[V+1];Math.abs(U.x-W.x)>.5&&(U.x<W.x?(U.x+=1,V===0&&(T[T.length-1].x+=1)):(W.x+=1,V+1===T.length-1&&(T[0].x+=1)),P=!0)}const z=a.E(S.center.lng);return P&&z<Math.abs(z-1)&&T.forEach(F=>{F.x-=1}),{polygon:T,unwrapped:P}}(ld(c,d).map(T=>new a.P(el(T.x),T.y)),d);return{polygon:b.polygon.map(T=>new a.M(T.x,T.y)),unwrapped:b.unwrapped}}}function ld(g,c){return a.aB(g,d=>{const y=c.pointCoordinate3D(d);d.x=y.x,d.y=y.y},1/256)}function el(g){return g<0?1+g%1:g%1}function Xo(g){return 100*g|0}function tl(g,c,d,y,b){const T=function(S,P){if(S)return b(S);if(P){g.url&&P.tiles&&g.tiles&&delete g.tiles;const M=a.p(a.ak(P,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(M.vectorLayers=P.vector_layers,M.vectorLayerIds=M.vectorLayers.map(D=>D.id)),M.tiles=c.canonicalizeTileset(M,g.url),b(null,M)}};return g.url?a.a1(c.transformRequest(c.normalizeSourceURL(g.url,null,d,y),a.a2.Source),T):a.a4.frame(()=>T(null,g))}class ys{constructor(c,d,y){this.bounds=a.D.convert(this.validateBounds(c)),this.minzoom=d||0,this.maxzoom=y||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const d=Math.pow(2,c.z),y=Math.floor(a.E(this.bounds.getWest())*d),b=Math.floor(a.H(this.bounds.getNorth())*d),T=Math.ceil(a.E(this.bounds.getEast())*d),S=Math.ceil(a.H(this.bounds.getSouth())*d);return c.x>=y&&c.x<T&&c.y>=b&&c.y<S}}class Ie extends a.a6{constructor(c,d,y,b){if(super(),this.id=c,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.ak(this,a.p(d,["url","scheme","tileSize","promoteId"])),this._options=a.ak({type:"vector"},d),this._collectResourceTiming=!!d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new a.aD}load(c){this._loaded=!1,this.fire(new a.a8("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=tl(this._options,this.map._requestManager,d,y,(b,T)=>{this._tileJSONRequest=null,this._loaded=!0,b?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),y&&y.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new a.a7(b))):T&&(a.ak(this,T),T.bounds&&(this.tileBounds=new ys(T.bounds,this.minzoom,this.maxzoom)),a.aH(T.tiles,this.map._requestManager._customAccessToken),this.fire(new a.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.a8("data",{dataType:"source",sourceDataType:"content"}))),c&&c(b)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=a.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.ak({},this._options)}loadTile(c,d){const y=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(y,a.a2.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:c.isExtraShadowCaster};if(b.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",b,T.bind(this));else if(c.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",b,T.bind(this),void 0,!0);else{const S=a.aF.call({deduped:this._deduped},b,(P,M)=>{P||!M?T.call(this,P):(b.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},c.actor&&c.actor.send("loadTile",b,T.bind(this),void 0,!0))},!0);c.request={cancel:S}}function T(S,P){return delete c.request,c.aborted?d(null):S&&S.status!==404?d(S):(P&&P.resourceTiming&&(c.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&c.setExpiryData(P),c.loadVectorData(P,this.map.painter),a.aG(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(c){c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class kt extends a.a6{constructor(c,d,y,b){super(),this.id=c,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.ak({type:"raster"},d),a.ak(this,a.p(d,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new a.a8("dataloading",{dataType:"source"})),this._tileJSONRequest=tl(this._options,this.map._requestManager,null,null,(d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new a.a7(d)):y&&(a.ak(this,y),y.bounds&&(this.tileBounds=new ys(y.bounds,this.minzoom,this.maxzoom)),a.aH(y.tiles),this.fire(new a.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.a8("data",{dataType:"source",sourceDataType:"content"}))),c&&c(d)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=a.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.ak({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,d){const y=a.a4.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);c.request=a.a3(this.map._requestManager.transformRequest(b,a.a2.Tile),(T,S,P,M)=>(delete c.request,c.aborted?(c.state="unloaded",d(null)):T?(c.state="errored",d(T)):S?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:P,expires:M}),c.setTexture(S,this.map.painter),c.state="loaded",a.aG(this.dispatcher),void d(null)):d(null)))}abortTile(c,d){c.request&&(c.request.cancel(),delete c.request),d()}unloadTile(c,d){c.texture&&c.texture instanceof a.a9?(c.destroy(!0),c.texture&&c.texture instanceof a.a9&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const vs={vector:Ie,raster:kt,"raster-dem":class extends kt{constructor(g,c,d,y){super(g,c,d,y),this.type="raster-dem",this.maxzoom=22,this._options=a.ak({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(g,c){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(b,T){b&&(g.state="errored",c(b)),T&&(g.dem=T,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",c(null))}g.request=a.a3(this.map._requestManager.transformRequest(d,a.a2.Tile),(function(b,T,S,P){if(delete g.request,g.aborted)g.state="unloaded",c(null);else if(b)g.state="errored",c(b);else if(T){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:S,expires:P});const M=ImageBitmap&&T instanceof ImageBitmap&&a.aI(),D=1-(T.width-a.aJ(T.width))/2;D<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const z=M?T:a.a4.getImageData(T,D),F={uid:g.uid,coord:g.tileID,source:this.id,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:D};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",F,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const c=g.canonical,d=Math.pow(2,c.z),y=(c.x-1+d)%d,b=c.x===0?g.wrap-1:g.wrap,T=(c.x+1+d)%d,S=c.x+1===d?g.wrap+1:g.wrap,P={};return P[new a.O(g.overscaledZ,b,c.z,y,c.y).key]={backfilled:!1},P[new a.O(g.overscaledZ,S,c.z,T,c.y).key]={backfilled:!1},c.y>0&&(P[new a.O(g.overscaledZ,b,c.z,y,c.y-1).key]={backfilled:!1},P[new a.O(g.overscaledZ,g.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},P[new a.O(g.overscaledZ,S,c.z,T,c.y-1).key]={backfilled:!1}),c.y+1<d&&(P[new a.O(g.overscaledZ,b,c.z,y,c.y+1).key]={backfilled:!1},P[new a.O(g.overscaledZ,g.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},P[new a.O(g.overscaledZ,S,c.z,T,c.y+1).key]={backfilled:!1}),P}},geojson:class extends a.a6{constructor(g,c,d,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(y),this._data=c.data,this._options=a.ak({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const b=a.J/this.tileSize;this.workerOptions=a.ak({source:this.id,scope:this.scope,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(c.buffer!==void 0?c.buffer:128)*b,tolerance:(c.tolerance!==void 0?c.tolerance:.375)*b,extent:a.J,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:a.J,radius:(c.clusterRadius!==void 0?c.clusterRadius:50)*b,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},c),this}getClusterChildren(g,c){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},c),this}getClusterLeaves(g,c,d,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:c,offset:d},y),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.a8("dataloading",{dataType:"source"})),this._loaded=!1;const g=a.ak({},this.workerOptions);g.scope=this.scope;const c=this._data;typeof c=="string"?(g.request=this.map._requestManager.transformRequest(a.a4.resolveURL(c),a.a2.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(d,y)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new a.a7(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),this.fire(new a.a8("data",b)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,c){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const y={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:a.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};g.request=this.actor.send(d,y,(b,T)=>(delete g.request,g.destroy(),g.aborted?c(null):b?c(b):(g.loadVectorData(T,this.map.painter,d==="reloadTile"),c(null))),void 0,d==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.ak({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.aK{constructor(g,c,d,y){super(g,c,d,y),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const c of g.urls)this.urls.push(this.map._requestManager.transformRequest(c,a.a2.Source).url);a.aL(this.urls,(c,d)=>{this._loaded=!0,c?this.fire(new a.a7(c)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const c=this.video.seekable;g<c.start(0)||g>c.end(0)?this.fire(new a.a7(new a.aM(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,c=g.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new a.a9(g,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.aK,model:class extends a.a6{constructor(g,c,d,y){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=c}load(){const g=[];for(const c in this._options.models){const d=this._options.models[c],y=a.aO(this.map._requestManager.transformRequest(d.uri,a.a2.Model).url).then(b=>{if(!b)return;const T=a.aP(b),S=new a.aQ(c,d.position,d.orientation,T);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(b=>{this.fire(new a.a7(new Error(`Could not load model ${c} from ${d.uri}: ${b.message}`)))});g.push(y)}return Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new a.a8("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(c=>{this.fire(new a.a7(new Error(`Could not load models: ${c.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,c){}serialize(){return{type:"model"}}},"batched-model":class extends a.a6{constructor(g,c,d,y){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=c,this.tiles=this._options.tiles,this.maxzoom=c.maxzoom||19,this.minzoom=c.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=d,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(g){this.map=g,this.load()}load(g){this._loaded=!1,this.fire(new a.a8("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map._worldview;this._tileJSONRequest=tl(this._options,this.map._requestManager,c,d,(y,b)=>{this._tileJSONRequest=null,this._loaded=!0,y?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new a.a7(y))):b&&(a.ak(this,b),b.bounds&&(this.tileBounds=new ys(b.bounds,this.minzoom,this.maxzoom)),a.aH(b.tiles,this.map._requestManager._customAccessToken),this.fire(new a.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.a8("data",{dataType:"source",sourceDataType:"content"}))),g&&g(y)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,c){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(d,a.a2.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=c;else{if(g.buckets){const T=Object.values(g.buckets);for(const S of T)S.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",y,b.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",y,b.bind(this),void 0,!0);function b(T,S){return g.aborted?c(null):T&&T.status!==404?c(T):(S&&(S.resourceTiming&&(g.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&g.setExpiryData(S),g.buckets={...g.buckets,...S.buckets}),g.state="loaded",void c(null))}}serialize(){return a.ak({},this._options)}},canvas:class extends a.aK{constructor(g,c,d,y){super(g,c,d,y),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(T=>typeof T!="number"))||this.fire(new a.a7(new a.aM(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.a7(new a.aM(`sources.${g}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new a.a7(new a.aM(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof HTMLCanvasElement||this.fire(new a.a7(new a.aM(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.a7(new a.aM(`sources.${g}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.a7(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof a.aN||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.a9(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends a.a6{constructor(g,c,d,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=c,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.a7(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.a7(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ys(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),a.ak(this,a.p(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.p(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.a8("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new a.a8("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:c,y:d,z:y}=g.canonical;return this._implementation.hasTile({x:c,y:d,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,c){const{x:d,y,z:b}=g.tileID.canonical,T=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:d,y,z:b},{signal:T.signal})).then((function(S){return delete g.request,g.aborted?(g.state="unloaded",c(null)):S===void 0?(g.state="errored",c(null)):S===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",c(null)):function(P){return P instanceof ImageData||P instanceof HTMLCanvasElement||P instanceof ImageBitmap||P instanceof HTMLImageElement}(S)?(this.loadTileData(g,S),g.state="loaded",void c(null)):(g.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(g.state="errored",c(S))}),g.request.cancel=()=>T.abort()}loadTileData(g,c){g.setTexture(c,this._map.painter)}unloadTile(g,c){if(g.texture&&g.texture instanceof a.a9?(g.destroy(!0),g.texture&&g.texture instanceof a.a9&&this._map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:d,y,z:b}=g.tileID.canonical;this._implementation.unloadTile({x:d,y,z:b})}c()}abortTile(g,c){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=a.aE(this.id,this.scope);this._map.style.clearSource(g)}_update(){this.fire(new a.a8("data",{dataType:"source",sourceDataType:"content"}))}}},Yo=function(g,c,d,y){const b=new vs[c.type](g,c,d,y);if(b.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${b.id}`);return a.aR(["load","abort","unload","serialize","prepare"],b),b};function Rr(g,c){const d=a.m.identity([]);return a.m.scale(d,d,[.5*g.width,.5*-g.height,1]),a.m.translate(d,d,[1,-1,0]),a.m.multiply(d,d,g.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(d)}function $s(g,c,d,y,b,T,S,P=!1){const M=g.tilesIn(y,S,P);M.sort(Ko);const D=[];for(const F of M)D.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(c,d,g._state,F,b,T,Rr(g.transform,F.tile.tileID),P)});const z=function(F){const V={},U={};for(const W of F){const H=W.queryResults,q=W.wrappedTileID,G=U[q]=U[q]||{};for(const Q in H){const oe=H[Q],ce=G[Q]=G[Q]||{},K=V[Q]=V[Q]||[];for(const ee of oe)ce[ee.featureIndex]||(ce[ee.featureIndex]=!0,K.push(ee))}}return V}(D);for(const F in z)z[F].forEach(V=>{const U=V.feature,W=U.layer;W&&W.type!=="background"&&W.type!=="sky"&&W.type!=="slot"&&(U.source=W.source,W["source-layer"]&&(U.sourceLayer=W["source-layer"]),U.state=U.id!==void 0?g.getFeatureState(W["source-layer"],U.id):{})});return z}function nw(g,c){const d=g.getRenderableIds().map(T=>g.getTileByID(T)),y=[],b={};for(let T=0;T<d.length;T++){const S=d[T],P=S.tileID.canonical.key;b[P]||(b[P]=!0,S.querySourceFeatures(y,c))}return y}function Ko(g,c){const d=g.tileID,y=c.tileID;return d.overscaledZ-y.overscaledZ||d.canonical.y-y.canonical.y||d.wrap-y.wrap||d.canonical.x-y.canonical.x}class Np{constructor(c){this.style=c}processLayersChanged(){this.layers=[];for(const c in this.style._mergedLayers){const d=this.style._mergedLayers[c];if(d.type==="fill-extrusion")this.layers.push(d);else if(d.type==="model"){const y=this.style.getLayerSource(d);y&&y.type==="batched-model"&&this.layers.push(d)}}}updateZOffset(c,d){this.currentBuildingBuckets=[];for(let b=0;b<this.layers.length;++b){const T=this.layers[b],S=this.style.getLayerSourceCache(T);let P=1;T.type==="fill-extrusion"&&(P=T.paint.get("fill-extrusion-opacity")>0?T.paint.get("fill-extrusion-vertical-scale"):0);let M=S?S.getTile(d):null;if(!M&&S&&d.canonical.z>S.getSource().minzoom){let D=d.scaledTo(Math.min(S.getSource().maxzoom,d.overscaledZ-1));for(;D.overscaledZ>=S.getSource().minzoom&&(M=S.getTile(D),!M&&D.overscaledZ!==0);)D=D.scaledTo(D.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:M?M.getBucket(T):null,tileID:M?M.tileID:d,verticalScale:P})}c.hasAnyZOffset=!1;let y=!1;for(let b=0;b<c.symbolInstances.length;b++){const T=c.symbolInstances.get(b),S=T.zOffset,P=this._getHeightAtTileOffset(d,T.tileAnchorX,T.tileAnchorY);T.zOffset=P!==-1?P:S,y||S===T.zOffset||(y=!0),c.hasAnyZOffset||T.zOffset===0||(c.hasAnyZOffset=!0)}y&&(c.zOffsetBuffersNeedUpload=!0,c.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(c,d,y,b){let T=d,S=y;if(c.canonical.z!==b.canonical.z){const P=b.canonical,M=1/(1<<c.canonical.z-P.z);T=(d+c.canonical.x*a.J)*M-P.x*a.J|0,S=(y+c.canonical.y*a.J)*M-P.y*a.J|0}return{tileX:T,tileY:S}}_getHeightAtTileOffset(c,d,y){let b,T;for(let S=0;S<this.layers.length;++S){if(this.layers[S].type!=="fill-extrusion")continue;const{bucket:P,tileID:M,verticalScale:D}=this.currentBuildingBuckets[S];if(!P)continue;const{tileX:z,tileY:F}=this._mapCoordToOverlappingTile(c,d,y,M),V=P.getHeightAtTileCoord(z,F);V&&V.height!==void 0&&(V.hidden?b=V.height:T=Math.max(V.height*D,T||0))}if(T!==void 0)return T;for(let S=0;S<this.layers.length;++S){if(this.layers[S].type!=="model")continue;const{bucket:P,tileID:M}=this.currentBuildingBuckets[S];if(!P)continue;const{tileX:D,tileY:z}=this._mapCoordToOverlappingTile(c,d,y,M),F=P.getHeightAtTileCoord(D,z);if(F&&!F.hidden)return F.height===void 0&&b!==void 0?Math.min(F.maxHeight,b)*F.verticalScale:(F.height||0)*F.verticalScale}return-1}}function rw(g,c){const d={};for(const y in g)y!=="ref"&&(d[y]=g[y]);return a.aS.forEach(y=>{y in c&&(d[y]=c[y])}),d}function nl(g){g=g.slice();const c=Object.create(null);for(let d=0;d<g.length;d++)c[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=rw(g[d],c[g[d].ref]));return g}const qe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function _n(g,c,d){d.push({command:qe.addSource,args:[g,c[g]]})}function bn(g,c,d){c.push({command:qe.removeSource,args:[g]}),d[g]=!0}function Co(g,c,d,y){bn(g,d,y),_n(g,c,d)}function uc(g,c,d){let y;for(y in g[d])if(g[d].hasOwnProperty(y)&&y!=="data"&&!A(g[d][y],c[d][y]))return!1;for(y in c[d])if(c[d].hasOwnProperty(y)&&y!=="data"&&!A(g[d][y],c[d][y]))return!1;return!0}function pn(g,c,d,y,b,T){let S;for(S in c=c||{},g=g||{})g.hasOwnProperty(S)&&(A(g[S],c[S])||d.push({command:T,args:[y,S,c[S],b]}));for(S in c)c.hasOwnProperty(S)&&!g.hasOwnProperty(S)&&(A(g[S],c[S])||d.push({command:T,args:[y,S,c[S],b]}))}function rl(g){return g.id}function ma(g,c){return g[c.id]=c,g}class Ru{constructor(c,d){this.reset(c,d)}reset(c,d){this.points=c||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=a.c(c,0,1);let d=1,y=this._distances[d];const b=c*this.paddedLength+this.padding;for(;y<b&&d<this._distances.length;)y=this._distances[++d];const T=d-1,S=this._distances[T],P=y-S,M=P>0?(b-S)/P:0;return this.points[T].mult(1-M).add(this.points[d].mult(M))}}class zi{constructor(c,d,y){const b=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(c/y),this.yCellCount=Math.ceil(d/y);for(let S=0;S<this.xCellCount*this.yCellCount;S++)b.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=d,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,d,y,b,T){this._forEachCell(d,y,b,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(b),this.bboxes.push(T)}insertCircle(c,d,y,b){this._forEachCell(d-b,y-b,d+b,y+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(d),this.circles.push(y),this.circles.push(b)}_insertBoxCell(c,d,y,b,T,S){this.boxCells[T].push(S)}_insertCircleCell(c,d,y,b,T,S){this.circleCells[T].push(S)}_query(c,d,y,b,T,S){if(y<0||c>this.width||b<0||d>this.height)return!T&&[];const P=[];if(c<=0&&d<=0&&this.width<=y&&this.height<=b){if(T)return!0;for(let M=0;M<this.boxKeys.length;M++)P.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const D=this.circles[3*M],z=this.circles[3*M+1],F=this.circles[3*M+2];P.push({key:this.circleKeys[M],x1:D-F,y1:z-F,x2:D+F,y2:z+F})}return S?P.filter(S):P}return this._forEachCell(c,d,y,b,this._queryCell,P,{hitTest:T,seenUids:{box:{},circle:{}}},S),T?P.length>0:P}_queryCircle(c,d,y,b,T){const S=c-y,P=c+y,M=d-y,D=d+y;if(P<0||S>this.width||D<0||M>this.height)return!b&&[];const z=[];return this._forEachCell(S,M,P,D,this._queryCellCircle,z,{hitTest:b,circle:{x:c,y:d,radius:y},seenUids:{box:{},circle:{}}},T),b?z.length>0:z}query(c,d,y,b,T){return this._query(c,d,y,b,!1,T)}hitTest(c,d,y,b,T){return this._query(c,d,y,b,!0,T)}hitTestCircle(c,d,y,b){return this._queryCircle(c,d,y,!0,b)}_queryCell(c,d,y,b,T,S,P,M){const D=P.seenUids,z=this.boxCells[T];if(z!==null){const V=this.bboxes;for(const U of z)if(!D.box[U]){D.box[U]=!0;const W=4*U;if(c<=V[W+2]&&d<=V[W+3]&&y>=V[W+0]&&b>=V[W+1]&&(!M||M(this.boxKeys[U]))){if(P.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[U],x1:V[W],y1:V[W+1],x2:V[W+2],y2:V[W+3]})}}}const F=this.circleCells[T];if(F!==null){const V=this.circles;for(const U of F)if(!D.circle[U]){D.circle[U]=!0;const W=3*U;if(this._circleAndRectCollide(V[W],V[W+1],V[W+2],c,d,y,b)&&(!M||M(this.circleKeys[U]))){if(P.hitTest)return S.push(!0),!0;{const H=V[W],q=V[W+1],G=V[W+2];S.push({key:this.circleKeys[U],x1:H-G,y1:q-G,x2:H+G,y2:q+G})}}}}}_queryCellCircle(c,d,y,b,T,S,P,M){const D=P.circle,z=P.seenUids,F=this.boxCells[T];if(F!==null){const U=this.bboxes;for(const W of F)if(!z.box[W]){z.box[W]=!0;const H=4*W;if(this._circleAndRectCollide(D.x,D.y,D.radius,U[H+0],U[H+1],U[H+2],U[H+3])&&(!M||M(this.boxKeys[W])))return S.push(!0),!0}}const V=this.circleCells[T];if(V!==null){const U=this.circles;for(const W of V)if(!z.circle[W]){z.circle[W]=!0;const H=3*W;if(this._circlesCollide(U[H],U[H+1],U[H+2],D.x,D.y,D.radius)&&(!M||M(this.circleKeys[W])))return S.push(!0),!0}}}_forEachCell(c,d,y,b,T,S,P,M){const D=this._convertToXCellCoord(c),z=this._convertToYCellCoord(d),F=this._convertToXCellCoord(y),V=this._convertToYCellCoord(b);for(let U=D;U<=F;U++)for(let W=z;W<=V;W++)if(T.call(this,c,d,y,b,this.xCellCount*W+U,S,P,M))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,d,y,b,T,S){const P=b-c,M=T-d,D=y+S;return D*D>P*P+M*M}_circleAndRectCollide(c,d,y,b,T,S,P){const M=(S-b)/2,D=Math.abs(c-(b+M));if(D>M+y)return!1;const z=(P-T)/2,F=Math.abs(d-(T+z));if(F>z+y)return!1;if(D<=M||F<=z)return!0;const V=D-M,U=F-z;return V*V+U*U<=y*y}}const Wn=100;class iw{constructor(c,d,y=new zi(c.width+200,c.height+200,25),b=new zi(c.width+200,c.height+200,25)){this.transform=c,this.grid=y,this.ignoredGrid=b,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+Wn,this.screenBottomBoundary=c.height+Wn,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=d}placeCollisionBox(c,d,y,b,T,S,P,M){let D=y.projectedAnchorX,z=y.projectedAnchorY,F=y.projectedAnchorZ;const V=y.elevation,U=y.tileID,W=c.getProjection();if(V&&U){const[ee,he,ge]=W.upVector(U.canonical,y.tileAnchorX,y.tileAnchorY),de=W.upVectorScale(U.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=ee*V*de,z+=he*V*de,F+=ge*V*de}const H=this.projectAndGetPerspectiveRatio(P,D,z,F,y.tileID,W.name==="globe"||!!V||this.transform.pitch>0,W),q=S*H.perspectiveRatio,G=(y.x1*d+b.x-y.padding)*q+H.point.x,Q=(y.y1*d+b.y-y.padding)*q+H.point.y,oe=(y.x2*d+b.x+y.padding)*q+H.point.x,ce=(y.y2*d+b.y+y.padding)*q+H.point.y,K=H.perspectiveRatio<=.55||H.occluded;return!this.isInsideGrid(G,Q,oe,ce)||!T&&this.grid.hitTest(G,Q,oe,ce,M)||K?{box:[],offscreen:!1,occluded:H.occluded}:{box:[G,Q,oe,ce],offscreen:this.isOffscreen(G,Q,oe,ce),occluded:!1}}placeCollisionCircles(c,d,y,b,T,S,P,M,D,z,F,V,U,W,H){const q=[],G=this.transform.elevation,Q=c.getProjection(),oe=G?G.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,Q):null,ce=new a.P(y.tileAnchorX,y.tileAnchorY);let{x:K,y:ee,z:he}=Q.projectTilePoint(ce.x,ce.y,H.canonical);if(oe){const[Ve,ne,Te]=oe(ce);K+=Ve,ee+=ne,he+=Te}const ge=Q.name==="globe",de=this.projectAndGetPerspectiveRatio(P,K,ee,he,H,ge||!!G||this.transform.pitch>0,Q),{perspectiveRatio:ye}=de,Ne=(F?S/ye:S*ye)/a.aV,Ae=ci(K,ee,he,M),Me=de.signedDistanceFromCamera>0?rt(Ne,T,y.lineOffsetX*Ne,y.lineOffsetY*Ne,!1,Ae,ce,y,b,M,{},G&&!F?oe:null,F&&!!G,Q,H,F):null;let xe=!1,ze=!1,ke=!0;if(Me&&!de.occluded){const Ve=.5*U*ye+W,ne=new a.P(-100,-100),Te=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Xe=new Ru,{first:$e,last:bt}=Me,mt=$e.path.length;let Dt=[];for(let jt=mt-1;jt>=1;jt--)Dt.push($e.path[jt]);for(let jt=1;jt<bt.path.length;jt++)Dt.push(bt.path[jt]);const _t=2.5*Ve;D&&(Dt=Dt.map(([jt,Ct,Mt],yn)=>(oe&&!ge&&(Mt=oe(yn<mt-1?$e.tilePath[mt-1-yn]:bt.tilePath[yn-mt+2])[2]),ci(jt,Ct,Mt,D))),Dt.some(jt=>jt[3]<=0)&&(Dt=[]));let Bt=[];if(Dt.length>0){let jt=1/0,Ct=-1/0,Mt=1/0,yn=-1/0;for(const Qt of Dt)jt=Math.min(jt,Qt[0]),Mt=Math.min(Mt,Qt[1]),Ct=Math.max(Ct,Qt[0]),yn=Math.max(yn,Qt[1]);Ct>=ne.x&&jt<=Te.x&&yn>=ne.y&&Mt<=Te.y&&(Bt=[Dt.map(Qt=>new a.P(Qt[0],Qt[1]))],(jt<ne.x||Ct>Te.x||Mt<ne.y||yn>Te.y)&&(Bt=a.aT(Bt,ne.x,ne.y,Te.x,Te.y)))}for(const jt of Bt){Xe.reset(jt,.25*Ve);let Ct=0;Ct=Xe.length<=.5*Ve?1:Math.ceil(Xe.paddedLength/_t)+1;for(let Mt=0;Mt<Ct;Mt++){const yn=Mt/Math.max(Ct-1,1),Qt=Xe.lerp(yn),Hn=Qt.x+Wn,Nn=Qt.y+Wn;q.push(Hn,Nn,Ve,0);const Bi=Hn-Ve,Do=Nn-Ve,Rn=Hn+Ve,wn=Nn+Ve;if(ke=ke&&this.isOffscreen(Bi,Do,Rn,wn),ze=ze||this.isInsideGrid(Bi,Do,Rn,wn),!d&&this.grid.hitTestCircle(Hn,Nn,Ve,V)&&(xe=!0,!z))return{circles:[],offscreen:!1,collisionDetected:xe,occluded:!1}}}}return{circles:!z&&xe||!ze?[]:q,offscreen:ke,collisionDetected:xe,occluded:de.occluded}}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let y=1/0,b=1/0,T=-1/0,S=-1/0;for(const z of c){const F=new a.P(z.x+Wn,z.y+Wn);y=Math.min(y,F.x),b=Math.min(b,F.y),T=Math.max(T,F.x),S=Math.max(S,F.y),d.push(F)}const P=this.grid.query(y,b,T,S).concat(this.ignoredGrid.query(y,b,T,S)),M={},D={};for(const z of P){const F=z.key;if(M[F.bucketInstanceId]===void 0&&(M[F.bucketInstanceId]={}),M[F.bucketInstanceId][F.featureIndex])continue;const V=[new a.P(z.x1,z.y1),new a.P(z.x2,z.y1),new a.P(z.x2,z.y2),new a.P(z.x1,z.y2)];a.aU(d,V)&&(M[F.bucketInstanceId][F.featureIndex]=!0,D[F.bucketInstanceId]===void 0&&(D[F.bucketInstanceId]=[]),D[F.bucketInstanceId].push(F.featureIndex))}return D}insertCollisionBox(c,d,y,b,T){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:b,collisionGroupID:T},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,d,y,b,T){const S=d?this.ignoredGrid:this.grid,P={bucketInstanceId:y,featureIndex:b,collisionGroupID:T};for(let M=0;M<c.length;M+=4)S.insertCircle(P,c[M],c[M+1],c[M+2])}projectAndGetPerspectiveRatio(c,d,y,b,T,S,P){const M=[d,y,b,1];let D=!1;b||this.transform.pitch>0?(a.e.transformMat4(M,M,c),this.fogState&&T&&P.name!=="globe"&&(D=function(V,U,W,H,q,G){const Q=G.calculateFogTileMatrix(q),oe=[U,W,H];return a.v.transformMat4(oe,oe,Q),Us(V,a.v.length(oe),G.pitch,G._fov)}(this.fogState,d,y,b,T.toUnwrapped(),this.transform)>.9)):tn(M,M,c);const z=M[3];return{point:new a.P((M[0]/z+1)/2*this.transform.width+Wn,(-M[1]/z+1)/2*this.transform.height+Wn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/z*.5,1.5),signedDistanceFromCamera:z,occluded:S&&M[2]>z||D}}isOffscreen(c,d,y,b){return y<Wn||c>=this.screenRightBoundary||b<Wn||d>this.screenBottomBoundary}isInsideGrid(c,d,y,b){return y>=0&&c<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const c=a.m.identity([]);return a.m.translate(c,c,[-100,-100,0]),c}}function il(g,c,d){const y=c.createTileMatrix(g,g.worldSize,d.toUnwrapped());return a.m.multiply(new Float32Array(16),g.projMatrix,y)}function Fp(g,c,d){if(c.projection.name===d.projection.name)return g.projMatrix;const y=d.clone();return y.setProjection(c.projection),il(y,c.getProjection(),g)}function ol(g,c,d){return c.name===d.projection.name?g.projMatrix:il(d,c,g)}class cd{constructor(c,d,y,b){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?d:-d))):b&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class hc{constructor(c,d,y,b,T,S=!1){this.text=new cd(c?c.text:null,d,y,T),this.icon=new cd(c?c.icon:null,d,b,T),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class dc{constructor(c,d,y,b=!1){this.text=c,this.icon=d,this.skipFade=y,this.clipped=b}}class Bp{constructor(){this.invProjMatrix=a.m.create(),this.viewportMatrix=a.m.create(),this.circles=[]}}class ud{constructor(c,d,y,b,T){this.bucketInstanceId=c,this.featureIndex=d,this.sourceLayerIndex=y,this.bucketIndex=b,this.tileID=T}}class jp{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const d=++this.maxGroupID;this.collisionGroups[c]={ID:d,predicate:y=>y.collisionGroupID===d}}return this.collisionGroups[c]}}function Ni(g,c,d,y,b){const{horizontalAlign:T,verticalAlign:S}=a.aY(g),P=-(T-.5)*c,M=-(S-.5)*d,D=a.aW(g,y);return new a.P(P+D[0]*b,M+D[1]*b)}function sr(g,c,d,y,b){const T=new a.P(g,c);return d&&T._rotate(y?b:-b),T}class Vp{constructor(c,d,y,b,T,S){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new iw(this.transform,T),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new jp(y),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,d,y,b){const T=y.getBucket(d),S=y.latestFeatureIndex;if(!T||!S||d.fqid!==T.layerIds[0])return;const P=T.layers[0].layout,M=y.collisionBoxArray,D=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),z=y.tileSize/a.J,F=y.tileID.toUnwrapped();this.transform.setProjection(T.projection);const V=(U=y.tileID,W=T.getProjection(),H=this.transform,W.name===this.projection?H.calculateProjMatrix(U.toUnwrapped()):il(H,W,U));var U,W,H;const q=P.get("text-pitch-alignment")==="map",G=P.get("text-rotation-alignment")==="map";d.compileFilter();const Q=d.dynamicFilter(),oe=d.dynamicFilterNeedsFeature(),ce=this.transform.calculatePixelsToTileUnitsMatrix(y),K=Vs(V,y.tileID.canonical,q,G,this.transform,T.getProjection(),ce);let ee=null;if(q){const de=pa(V,y.tileID.canonical,q,G,this.transform,T.getProjection(),ce);ee=a.m.multiply([],this.transform.labelPlaneMatrix,de)}let he=null;Q&&y.latestFeatureIndex&&(he={unwrappedTileID:F,dynamicFilter:Q,dynamicFilterNeedsFeature:oe,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new ud(T.bucketInstanceId,S,T.sourceLayerIndex,T.index,y.tileID);const ge={bucket:T,layout:P,posMatrix:V,textLabelPlaneMatrix:K,labelToScreenMatrix:ee,clippingData:he,scale:D,textPixelRatio:z,holdingForFade:y.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:a.i(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.i(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(b)for(const de of T.sortKeyRanges){const{sortKey:ye,symbolInstanceStart:Ne,symbolInstanceEnd:Ae}=de;c.push({sortKey:ye,symbolInstanceStart:Ne,symbolInstanceEnd:Ae,parameters:ge})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(c,d,y,b,T,S,P,M,D,z,F,V,U,W,H,q,G,Q){const{textOffset0:oe,textOffset1:ce,crossTileID:K}=V,ee=[oe,ce],he=Ni(c,y,b,ee,T),ge=this.collisionIndex.placeCollisionBox(W,T,d,sr(he.x,he.y,S,P,this.transform.angle),F,M,D,z.predicate);if(q){const de=W.getSymbolInstanceIconSize(Q,this.transform.zoom,V.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(W,de,q,sr(he.x,he.y,S,P,this.transform.angle),F,M,D,z.predicate).box.length===0)return}if(ge.box.length>0){let de;return this.prevPlacement&&this.prevPlacement.variableOffsets[K]&&this.prevPlacement.placements[K]&&this.prevPlacement.placements[K].text&&(de=this.prevPlacement.variableOffsets[K].anchor),this.variableOffsets[K]={textOffset:ee,width:y,height:b,anchor:c,textScale:T,prevAnchor:de},this.markUsedJustification(W,c,V,H),W.allowVerticalPlacement&&(this.markUsedOrientation(W,H,V),this.placedOrientations[K]=H),{shift:he,placedGlyphBoxes:ge}}}placeLayerBucketPart(c,d,y,b){const{bucket:T,layout:S,posMatrix:P,textLabelPlaneMatrix:M,labelToScreenMatrix:D,clippingData:z,textPixelRatio:F,holdingForFade:V,collisionBoxArray:U,partiallyEvaluatedTextSize:W,partiallyEvaluatedIconSize:H,collisionGroup:q}=c.parameters,G=S.get("text-optional"),Q=S.get("icon-optional"),oe=S.get("text-allow-overlap"),ce=S.get("icon-allow-overlap"),K=S.get("text-rotation-alignment")==="map",ee=S.get("text-pitch-alignment")==="map",he=S.get("symbol-z-order")==="viewport-y",ge=S.get("symbol-z-elevate");this.transform.setProjection(T.projection);let de=oe&&(ce||!T.hasIconData()||Q),ye=ce&&(oe||!T.hasTextData()||G);!T.collisionArrays&&U&&T.deserializeCollisionBoxes(U),y&&b&&T.updateCollisionDebugBuffers(this.transform.zoom,U);const Ne=(Ae,Me,xe)=>{const{crossTileID:ze,numVerticalGlyphVertices:ke}=Ae;if(z){const Rn={zoom:this.transform.zoom,pitch:this.transform.pitch};let wn=null;if(z.dynamicFilterNeedsFeature){const Sn=this.retainedQueryData[T.bucketInstanceId];wn=z.featureIndex.loadFeature({featureIndex:Ae.featureIndex,bucketIndex:Sn.bucketIndex,sourceLayerIndex:Sn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(Rn,wn,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new a.P(Ae.tileAnchorX,Ae.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[ze]=new dc(!1,!1,!1,!0),void d.add(ze)}if(d.has(ze))return;if(V)return void(this.placements[ze]=new dc(!1,!1,!1));let Ve=!1,ne=!1,Te=!0,Xe=!1,$e=!1,bt=null,mt={box:null,offscreen:null,occluded:null},Dt={box:null,offscreen:null,occluded:null},_t=null,Bt=null,jt=null,Ct=0,Mt=0,yn=0;xe.textFeatureIndex?Ct=xe.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(Ct=Ae.featureIndex),xe.verticalTextFeatureIndex&&(Mt=xe.verticalTextFeatureIndex);const Qt=Rn=>{Rn.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const wn=this.transform.elevation;Rn.elevation=Ae.zOffset+(wn?wn.getAtTileOffset(Rn.tileID,Rn.tileAnchorX,Rn.tileAnchorY):0)},Hn=xe.textBox;if(Hn){Qt(Hn);const Rn=Sn=>{let ar=a.W.horizontal;if(T.allowVerticalPlacement&&!Sn&&this.prevPlacement){const ei=this.prevPlacement.placedOrientations[ze];ei&&(this.placedOrientations[ze]=ei,ar=ei,this.markUsedOrientation(T,ar,Ae))}return ar},wn=(Sn,ar)=>{if(T.allowVerticalPlacement&&ke>0&&xe.verticalTextBox){for(const ei of T.writingModes)if(ei===a.W.vertical?(mt=ar(),Dt=mt):mt=Sn(),mt&&mt.box&&mt.box.length)break}else mt=Sn()};if(S.get("text-variable-anchor")){let Sn=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ze]){const Jn=this.prevPlacement.variableOffsets[ze];Sn.indexOf(Jn.anchor)>0&&(Sn=Sn.filter(xi=>xi!==Jn.anchor),Sn.unshift(Jn.anchor))}const ar=(Jn,xi,ji)=>{const bi=T.getSymbolInstanceTextSize(W,Ae,this.transform.zoom,Me),Lo=(Jn.x2-Jn.x1)*bi+2*Jn.padding,qs=(Jn.y2-Jn.y1)*bi+2*Jn.padding,ns=Ae.hasIconTextFit&&!ce?xi:null;ns&&Qt(ns);let Bn={box:[],offscreen:!1,occluded:!1};const rs=oe?2*Sn.length:Sn.length;for(let Ts=0;Ts<rs;++Ts){const Hs=this.attemptAnchorPlacement(Sn[Ts%Sn.length],Jn,Lo,qs,bi,K,ee,F,P,q,Ts>=Sn.length,Ae,Me,T,ji,ns,W,H);if(Hs&&(Bn=Hs.placedGlyphBoxes,Bn&&Bn.box&&Bn.box.length)){Ve=!0,bt=Hs.shift;break}}return Bn};wn(()=>ar(Hn,xe.iconBox,a.W.horizontal),()=>{const Jn=xe.verticalTextBox;return Jn&&Qt(Jn),T.allowVerticalPlacement&&!(mt&&mt.box&&mt.box.length)&&ke>0&&Jn?ar(Jn,xe.verticalIconBox,a.W.vertical):{box:null,offscreen:null,occluded:null}}),mt&&(Ve=mt.box,Te=mt.offscreen,Xe=mt.occluded);const ei=Rn(!(!mt||!mt.box));if(!Ve&&this.prevPlacement){const Jn=this.prevPlacement.variableOffsets[ze];Jn&&(this.variableOffsets[ze]=Jn,this.markUsedJustification(T,Jn.anchor,Ae,ei))}}else{const Sn=(ar,ei)=>{const Jn=T.getSymbolInstanceTextSize(W,Ae,this.transform.zoom,Me),xi=this.collisionIndex.placeCollisionBox(T,Jn,ar,new a.P(0,0),oe,F,P,q.predicate);return xi&&xi.box&&xi.box.length&&(this.markUsedOrientation(T,ei,Ae),this.placedOrientations[ze]=ei),xi};wn(()=>Sn(Hn,a.W.horizontal),()=>{const ar=xe.verticalTextBox;return T.allowVerticalPlacement&&ke>0&&ar?(Qt(ar),Sn(ar,a.W.vertical)):{box:null,offscreen:null,occluded:null}}),Rn(!!(mt&&mt.box&&mt.box.length))}}if(_t=mt,Ve=_t&&_t.box&&_t.box.length>0,Te=_t&&_t.offscreen,Xe=_t&&_t.occluded,Ae.useRuntimeCollisionCircles){const Rn=T.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex>=0?Ae.centerJustifiedTextSymbolIndex:Ae.verticalPlacedTextSymbolIndex),wn=a.j(T.textSizeData,W,Rn),Sn=S.get("text-padding");Bt=this.collisionIndex.placeCollisionCircles(T,oe,Rn,T.lineVertexArray,T.glyphOffsetArray,wn,P,M,D,y,ee,q.predicate,Ae.collisionCircleDiameter*wn/a.aV,Sn,this.retainedQueryData[T.bucketInstanceId].tileID),Ve=oe||Bt.circles.length>0&&!Bt.collisionDetected,Te=Te&&Bt.offscreen,Xe=Bt.occluded}if(xe.iconFeatureIndex&&(yn=xe.iconFeatureIndex),xe.iconBox){const Rn=wn=>{Qt(wn);const Sn=Ae.hasIconTextFit&&bt?sr(bt.x,bt.y,K,ee,this.transform.angle):new a.P(0,0),ar=T.getSymbolInstanceIconSize(H,this.transform.zoom,Ae.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,ar,wn,Sn,ce,F,P,q.predicate)};Dt&&Dt.box&&Dt.box.length&&xe.verticalIconBox?(jt=Rn(xe.verticalIconBox),ne=jt.box.length>0):(jt=Rn(xe.iconBox),ne=jt.box.length>0),Te=Te&&jt.offscreen,$e=jt.occluded}const Nn=G||Ae.numHorizontalGlyphVertices===0&&ke===0,Bi=Q||Ae.numIconVertices===0;if(Nn||Bi?Bi?Nn||(ne=ne&&Ve):Ve=ne&&Ve:ne=Ve=ne&&Ve,Ve&&_t&&_t.box&&this.collisionIndex.insertCollisionBox(_t.box,S.get("text-ignore-placement"),T.bucketInstanceId,Dt&&Dt.box&&Mt?Mt:Ct,q.ID),ne&&jt&&this.collisionIndex.insertCollisionBox(jt.box,S.get("icon-ignore-placement"),T.bucketInstanceId,yn,q.ID),Bt&&(Ve&&this.collisionIndex.insertCollisionCircles(Bt.circles,S.get("text-ignore-placement"),T.bucketInstanceId,Ct,q.ID),y)){const Rn=T.bucketInstanceId;let wn=this.collisionCircleArrays[Rn];wn===void 0&&(wn=this.collisionCircleArrays[Rn]=new Bp);for(let Sn=0;Sn<Bt.circles.length;Sn+=4)wn.circles.push(Bt.circles[Sn+0]),wn.circles.push(Bt.circles[Sn+1]),wn.circles.push(Bt.circles[Sn+2]),wn.circles.push(Bt.collisionDetected?1:0)}const Do=T.projection.name!=="globe";de=de&&(Do||!Xe),ye=ye&&(Do||!$e),this.placements[ze]=new dc(Ve||de,ne||ye,Te||T.justReloaded),d.add(ze)};if(ge&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.updateZOffset()),he){const Ae=T.getSortedSymbolIndexes(this.transform.angle);for(let Me=Ae.length-1;Me>=0;--Me){const xe=Ae[Me];Ne(T.symbolInstances.get(xe),xe,T.collisionArrays[xe])}T.hasAnyZOffset&&a.X(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Ae=T.getSortedIndexesByZOffset();for(let Me=0;Me<Ae.length;++Me){const xe=Ae[Me];Ne(T.symbolInstances.get(xe),xe,T.collisionArrays[xe])}}else for(let Ae=c.symbolInstanceStart;Ae<c.symbolInstanceEnd;Ae++)Ne(T.symbolInstances.get(Ae),Ae,T.collisionArrays[Ae]);if(y&&T.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[T.bucketInstanceId];a.m.invert(Ae.invProjMatrix,P),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(c,d,y,b){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:M,crossTileID:D}=y,z=a.aX(d),F=b===a.W.vertical?M:z==="left"?T:z==="center"?S:z==="right"?P:-1;T>=0&&(c.text.placedSymbolArray.get(T).crossTileID=F>=0&&T!==F?0:D),S>=0&&(c.text.placedSymbolArray.get(S).crossTileID=F>=0&&S!==F?0:D),P>=0&&(c.text.placedSymbolArray.get(P).crossTileID=F>=0&&P!==F?0:D),M>=0&&(c.text.placedSymbolArray.get(M).crossTileID=F>=0&&M!==F?0:D)}markUsedOrientation(c,d,y){const b=d===a.W.horizontal||d===a.W.horizontalOnly?d:0,T=d===a.W.vertical?d:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:D}=y,z=c.text.placedSymbolArray;S>=0&&(z.get(S).placedOrientation=b),P>=0&&(z.get(P).placedOrientation=b),M>=0&&(z.get(M).placedOrientation=b),D>=0&&(z.get(D).placedOrientation=T)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let y=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(c):1,T=d?d.opacities:{},S=d?d.variableOffsets:{},P=d?d.placedOrientations:{};for(const M in this.placements){const D=this.placements[M],z=T[M];z?(this.opacities[M]=new hc(z,b,D.text,D.icon,null,D.clipped),y=y||D.text!==z.text.placed||D.icon!==z.icon.placed):(this.opacities[M]=new hc(null,b,D.text,D.icon,D.skipFade,D.clipped),y=y||D.text||D.icon)}for(const M in T){const D=T[M];if(!this.opacities[M]){const z=new hc(D,b,!1,!1);z.isHidden()||(this.opacities[M]=z,y=y||D.text.placed||D.icon.placed)}}for(const M in S)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=S[M]);for(const M in P)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=P[M]);y?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:c)}updateLayerOpacities(c,d){const y=new Set;for(const b of d){const T=b.getBucket(c);T&&b.latestFeatureIndex&&c.fqid===T.layerIds[0]&&(this.updateBucketOpacities(T,y,b.collisionBoxArray),T.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,b.tileID),T.updateZOffset()))}}updateBucketOpacities(c,d,y){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const b=c.layers[0].layout,T=!!c.layers[0].dynamicFilter(),S=new hc(null,0,!1,!1,!0),P=b.get("text-allow-overlap"),M=b.get("icon-allow-overlap"),D=b.get("text-variable-anchor"),z=b.get("text-rotation-alignment")==="map",F=b.get("text-pitch-alignment")==="map",V=new hc(null,0,P&&(M||!c.hasIconData()||b.get("icon-optional")),M&&(P||!c.hasTextData()||b.get("text-optional")),!0);!c.collisionArrays&&y&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(y);const U=(H,q,G)=>{for(let Q=0;Q<q/4;Q++)H.opacityVertexArray.emplaceBack(G)};let W=0;for(let H=0;H<c.symbolInstances.length;H++){const q=c.symbolInstances.get(H),{numHorizontalGlyphVertices:G,numVerticalGlyphVertices:Q,crossTileID:oe,numIconVertices:ce}=q,K=d.has(oe);let ee=this.opacities[oe];K?ee=S:ee||(ee=V,this.opacities[oe]=ee),d.add(oe);const he=G>0||Q>0,ge=ce>0,de=this.placedOrientations[oe],ye=de===a.W.vertical,Ne=de===a.W.horizontal||de===a.W.horizontalOnly;if(!he&&!ge||ee.isHidden()||W++,he){const Ae=pc(ee.text);U(c.text,G,ye?Or:Ae),U(c.text,Q,Ne?Or:Ae);const Me=ee.text.isHidden(),{leftJustifiedTextSymbolIndex:xe,centerJustifiedTextSymbolIndex:ze,rightJustifiedTextSymbolIndex:ke,verticalPlacedTextSymbolIndex:Ve}=q,ne=c.text.placedSymbolArray,Te=Me||ye?1:0;xe>=0&&(ne.get(xe).hidden=Te),ze>=0&&(ne.get(ze).hidden=Te),ke>=0&&(ne.get(ke).hidden=Te),Ve>=0&&(ne.get(Ve).hidden=Me||Ne?1:0);const Xe=this.variableOffsets[oe];Xe&&this.markUsedJustification(c,Xe.anchor,q,de);const $e=this.placedOrientations[oe];$e&&(this.markUsedJustification(c,"left",q,$e),this.markUsedOrientation(c,$e,q))}if(ge){const Ae=pc(ee.icon),{placedIconSymbolIndex:Me,verticalPlacedIconSymbolIndex:xe}=q,ze=c.icon.placedSymbolArray,ke=ee.icon.isHidden()?1:0;Me>=0&&(U(c.icon,ce,ye?Or:Ae),ze.get(Me).hidden=ke),xe>=0&&(U(c.icon,q.numVerticalIconVertices,Ne?Or:Ae),ze.get(xe).hidden=ke)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const Ae=c.collisionArrays[H];if(Ae){let Me=new a.P(0,0),xe=!0;if(Ae.textBox||Ae.verticalTextBox){if(D){const ke=this.variableOffsets[oe];ke?(Me=Ni(ke.anchor,ke.width,ke.height,ke.textOffset,ke.textScale),z&&Me._rotate(F?this.transform.angle:-this.transform.angle)):xe=!1}T&&(xe=!ee.clipped),Ae.textBox&&sl(c.textCollisionBox.collisionVertexArray,ee.text.placed,!xe||ye,Me.x,Me.y),Ae.verticalTextBox&&sl(c.textCollisionBox.collisionVertexArray,ee.text.placed,!xe||Ne,Me.x,Me.y)}const ze=xe&&!!(!Ne&&Ae.verticalIconBox);Ae.iconBox&&sl(c.iconCollisionBox.collisionVertexArray,ee.icon.placed,ze,q.hasIconTextFit?Me.x:0,q.hasIconTextFit?Me.y:0),Ae.verticalIconBox&&sl(c.iconCollisionBox.collisionVertexArray,ee.icon.placed,!ze,q.hasIconTextFit?Me.x:0,q.hasIconTextFit?Me.y:0)}}}if(c.fullyClipped=W===0,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const H=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=H.invProjMatrix,c.placementViewportMatrix=H.viewportMatrix,c.collisionCircleArray=H.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,d){const y=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*y>c}setStale(){this.stale=!0}}function sl(g,c,d,y,b){g.emplaceBack(c?1:0,d?1:0,y||0,b||0),g.emplaceBack(c?1:0,d?1:0,y||0,b||0),g.emplaceBack(c?1:0,d?1:0,y||0,b||0),g.emplaceBack(c?1:0,d?1:0,y||0,b||0)}const Fi=Math.pow(2,25),Mo=Math.pow(2,24),Ly=Math.pow(2,17),fc=Math.pow(2,16),$r=Math.pow(2,9),Ou=Math.pow(2,8),Up=Math.pow(2,1);function pc(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const c=g.placed?1:0,d=Math.floor(127*g.opacity);return d*Fi+c*Mo+d*Ly+c*fc+d*$r+c*Ou+d*Up+c}const Or=0;class $p{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,d,y,b,T){const S=this._bucketParts;for(;this._currentTileIndex<c.length;)if(d.getBucketParts(S,b,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((P,M)=>P.sortKey-M.sortKey));this._currentPartIndex<S.length;){const P=S[this._currentPartIndex];if(d.placeLayerBucketPart(P,this._seenCrossTileIDs,y,P.symbolInstanceStart===0),this._currentPartIndex++,T())return!0}return!1}}class Gp{constructor(c,d,y,b,T,S,P,M,D){this.placement=new Vp(c,T,S,P,M,D),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(c,d,y,b){const T=a.a4.now(),S=()=>{const P=a.a4.now()-T;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=d[c[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=M)&&(!P.maxzoom||P.maxzoom>M)){const D=P,z=D.layout.get("symbol-z-elevate"),F=this._inProgressLayer=this._inProgressLayer||new $p(D),V=a.aE(P.source,P.scope);if(F.continuePlacement(z?b[V]:y[V],this.placement,this._showCollisionBoxes,P,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const Jo=512/a.J/2;class Du{constructor(c,d,y){this.tileID=c,this.bucketInstanceId=y,this.index=new a.aZ(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=c.canonical.x*a.J,T=c.canonical.y*a.J;for(let S=0;S<d.length;S++){const{key:P,crossTileID:M,tileAnchorX:D,tileAnchorY:z}=d.get(S),F=Math.floor((b+D)*Jo),V=Math.floor((T+z)*Jo);this.index.add(F,V),this.keys.push(P),this.crossTileIDs.push(M)}this.index.finish()}findMatches(c,d,y){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),T=Jo/Math.pow(2,d.canonical.z-this.tileID.canonical.z),S=d.canonical.x*a.J,P=d.canonical.y*a.J;for(let M=0;M<c.length;M++){const D=c.get(M);if(D.crossTileID)continue;const{key:z,tileAnchorX:F,tileAnchorY:V}=D,U=Math.floor((S+F)*T),W=Math.floor((P+V)*T),H=this.index.range(U-b,W-b,U+b,W+b);for(const q of H){const G=this.crossTileIDs[q];if(this.keys[q]===z&&!y.has(G)){y.add(G),D.crossTileID=G;break}}}}}class Lu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Cn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const d=Math.round((c-this.lng)/360);if(d!==0)for(const y in this.indexes){const b=this.indexes[y],T={};for(const S in b){const P=b[S];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),T[P.tileID.key]=P}this.indexes[y]=T}this.lng=c}addBucket(c,d,y){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let T=0;T<d.symbolInstances.length;T++)d.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const b=this.usedCrossTileIDs[c.overscaledZ];for(const T in this.indexes){const S=this.indexes[T];if(Number(T)>c.overscaledZ)for(const P in S){const M=S[P];M.tileID.isChildOf(c)&&M.findMatches(d.symbolInstances,c,b)}else{const P=S[c.scaledTo(Number(T)).key];P&&P.findMatches(d.symbolInstances,c,b)}}for(let T=0;T<d.symbolInstances.length;T++){const S=d.symbolInstances.get(T);S.crossTileID||(S.crossTileID=y.generate(),b.add(S.crossTileID))}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Du(c,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(c,d){for(const y of d.crossTileIDs)this.usedCrossTileIDs[c].delete(y)}removeStaleBuckets(c){let d=!1;for(const y in this.indexes){const b=this.indexes[y];for(const T in b)c[b[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,b[T]),delete b[T],d=!0)}return d}}class ow{constructor(){this.layerIndexes={},this.crossTileIDs=new Lu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,d,y,b){let T=this.layerIndexes[c.fqid];T===void 0&&(T=this.layerIndexes[c.fqid]=new Cn);let S=!1;const P={};b.name!=="globe"&&T.handleWrapJump(y);for(const M of d){const D=M.getBucket(c);D&&c.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(M.tileID,D,this.crossTileIDs)&&(S=!0),P[D.bucketInstanceId]=!0)}return T.removeStaleBuckets(P)&&(S=!0),S}pruneUnusedLayers(c){const d={};c.forEach(y=>{d[y]=!0});for(const y in this.layerIndexes)d[y]||delete this.layerIndexes[y]}}var hd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,ga=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,zy=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Wp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",_a=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Ny=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Qo=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,zu=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,qp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Fy=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const dd=[];Gs(hd,dd),Gs(zy,dd),Gs(ga,dd);const ya={"_prelude_fog.vertex.glsl":Ny,"_prelude_terrain.vertex.glsl":_a,"_prelude_shadow.vertex.glsl":qp,"_prelude_fog.fragment.glsl":Qo,"_prelude_shadow.fragment.glsl":Fy,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":zu},va={};dn("",_a),dn(Qo,Ny),dn(Fy,qp),dn(zu,"");const By=dn(ga,zy),al=hd;var Hp={background:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:dn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:dn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:dn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:dn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:dn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:dn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:dn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:dn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:dn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:dn(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:dn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:dn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:dn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:dn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Wp),skyboxGradient:dn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Wp),skyboxCapture:dn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:dn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:dn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Gs(g,c){const d=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of d)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=y.split(" ");for(const T of b)c.includes(T)||c.push(T)}}function dn(g,c){const d=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let b=c.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);b&&(b=b.map(D=>{const z=D.split(" ");return z[z.length-1]}),b=[...new Set(b)]);const T={},S=[],P=[];if(g=g.replace(d,(D,z)=>(P.push(z),"")),(c=c.replace(d,(D,z)=>(S.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let M=[...dd];Gs(g,M),Gs(c,M);for(const D of[...S,...P])ya[D]||console.error(`Undefined include: ${D}`),va[D]||(va[D]=[],Gs(ya[D],va[D])),M=[...M,...va[D]];return{fragmentSource:g=g.replace(y,(D,z,F,V,U)=>(T[U]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${U}
in ${F} ${V} ${U};
#else
uniform ${F} ${V} u_${U};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${U}
    ${F} ${V} ${U} = u_${U};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${F} ${V} ${U};
#endif
`:z==="initialize-attribute"?"":void 0)),vertexSource:c=c.replace(y,(D,z,F,V,U)=>{const W=V==="float"?"vec2":V,H=U.match(/color/)?"color":W;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${U}
in ${F} ${V} a_${U};
#endif
`:T[U]?z==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${F} ${W} a_${U};
out ${F} ${V} ${U};
#else
uniform ${F} ${V} u_${U};
#endif
`:z==="initialize"?H==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${F} ${V} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${H}(a_${U}, u_${U}_t);
#else
    ${F} ${V} ${U} = u_${U};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${F} ${V} a_${U};
    out ${F} ${V} ${U};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${U} = a_${U};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
in ${F} ${W} a_${U};
#else
uniform ${F} ${V} u_${U};
#endif
`:z==="define-instanced"?H==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${U}0;
in vec4 a_${U}1;
in vec4 a_${U}2;
in vec4 a_${U}3;
#else
uniform ${F} ${V} u_${U};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${W} a_${U};
#else
uniform ${F} ${V} u_${U};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${F} ${V} ${U} = a_${U};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${F} ${V} ${U} = a_${U};
#else
    ${F} ${V} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${F} ${V} ${U} = unpack_mix_${H}(a_${U}, u_${U}_t);
#else
    ${F} ${V} ${U} = u_${U};
#endif
`}),staticAttributes:b,usedDefines:M,vertexIncludes:S,fragmentIncludes:P}}class sw{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,d,y,b,T,S,P,M){this.context=c;let D=this.boundPaintVertexBuffers.length!==b.length;for(let F=0;!D&&F<b.length;F++)this.boundPaintVertexBuffers[F]!==b[F]&&(D=!0);let z=this.boundDynamicVertexBuffers.length!==P.length;for(let F=0;!z&&F<P.length;F++)this.boundDynamicVertexBuffers[F]!==P[F]&&(z=!0);if(!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==y||D||z||this.boundIndexBuffer!==T||this.boundVertexOffset!==S)this.freshBind(d,y,b,T,S,P,M);else{c.bindVertexArrayOES.set(this.vao);for(const F of P)F&&(F.bind(),M&&F.instanceCount&&F.setVertexAttribDivisor(c.gl,d,M));T&&T.dynamicDraw&&T.bind()}}freshBind(c,d,y,b,T,S,P){const M=c.numAttributes,D=this.context,z=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=c,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=b,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=S,d.enableAttributes(z,c),d.bind(),d.setVertexAttribPointers(z,c,T);for(const F of y)F.enableAttributes(z,c),F.bind(),F.setVertexAttribPointers(z,c,T);for(const F of S)F&&(F.enableAttributes(z,c),F.bind(),F.setVertexAttribPointers(z,c,T),P&&F.instanceCount&&F.setVertexAttribDivisor(z,c,P));b&&b.bind(),D.currentNumAttributes=M}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function aw(g,c){const d=Math.pow(2,c.canonical.z),y=c.canonical.y;return[new a.M(0,y/d).toLngLat().lat,new a.M(0,(y+1)/d).toLngLat().lat]}function lw(g,c,d,y,b,T,S){const P=g.context,M=P.gl,D=d.hillshadeFBO;if(!D)return;g.prepareDrawTile();const z=g.isTileAffectedByFog(c),F=g.getOrCreateProgram("hillshade",{overrideFog:z});P.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,D.colorAttachment.get());const V=((q,G,Q,oe)=>{const ce=Q.paint.get("hillshade-shadow-color"),K=Q.paint.get("hillshade-highlight-color"),ee=Q.paint.get("hillshade-accent-color"),he=Q.paint.get("hillshade-emissive-strength");let ge=a.d(Q.paint.get("hillshade-illumination-direction"));if(Q.paint.get("hillshade-illumination-anchor")==="viewport")ge-=q.transform.angle;else if(q.style&&q.style.enable3dLights()&&q.style.directionalLight){const ye=q.style.directionalLight.properties.get("direction"),Ne=a.b3(ye.x,ye.y,ye.z);ge=a.d(Ne[1])}const de=!q.options.moving;return{u_matrix:oe||q.transform.calculateProjMatrix(G.tileID.toUnwrapped(),de),u_image:0,u_latrange:aw(0,G.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),ge],u_shadow:ce,u_highlight:K,u_emissive_strength:he,u_accent:ee}})(g,d,y,g.terrain?c.projMatrix:null);g.uploadCommonUniforms(P,F,c.toUnwrapped());const{tileBoundsBuffer:U,tileBoundsIndexBuffer:W,tileBoundsSegments:H}=g.getTileBoundsBuffers(d);F.draw(g,M.TRIANGLES,b,T,S,a.b5.disabled,V,y.id,U,W,H)}function Zp(g,c,d){if(!c.needsDEMTextureUpload)return;const y=g.context,b=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||g.getTileTexture(d.stride);const T=d.getPixels();c.demTexture?c.demTexture.update(T,{premultiply:!1}):c.demTexture=new a.a9(y,T,b.R32F,{premultiply:!1}),c.needsDEMTextureUpload=!1}function cw(g,c,d){const y=g.context,b=y.gl;if(!c.dem)return;const T=c.dem;if(y.activeTexture.set(b.TEXTURE1),Zp(g,c,T),!c.demTexture)return;c.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const S=T.dim;y.activeTexture.set(b.TEXTURE0);let P=c.hillshadeFBO;if(!P){const V=new a.a9(y,{width:S,height:S,data:null},b.RGBA);V.bind(b.LINEAR,b.CLAMP_TO_EDGE),P=c.hillshadeFBO=y.createFramebuffer(S,S,!0,"renderbuffer"),P.colorAttachment.set(V.texture)}y.bindFramebuffer.set(P.framebuffer),y.viewport.set([0,0,S,S]);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:D,tileBoundsSegments:z}=g.getMercatorTileBoundsBuffers(),F=[];g.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(g,b.TRIANGLES,a.b4.disabled,a.b6.disabled,a.a.unblended,a.b5.disabled,((V,U)=>{const W=U.stride,H=a.m.create();return a.m.ortho(H,0,a.J,-a.J,0,0,1),a.m.translate(H,H,[0,-a.J,0]),{u_matrix:H,u_image:1,u_dimension:[W,W],u_zoom:V.overscaledZ}})(c.tileID,T),d.id,M,D,z),c.needsHillshadePrepare=!1}const fd=g=>({u_matrix:new a.a_(g),u_image0:new a.a$(g),u_skirt_height:new a.b2(g),u_ground_shadow_factor:new a.b7(g)}),Xp=(g,c,d)=>({u_matrix:g,u_image0:0,u_skirt_height:c,u_ground_shadow_factor:d}),Yp=(g,c,d,y,b,T,S,P,M,D,z,F,V,U,W)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:d,u_zoom_transition:b,u_merc_center:T,u_image0:0,u_frustum_tl:S,u_frustum_tr:P,u_frustum_br:M,u_frustum_bl:D,u_globe_pos:z,u_globe_radius:F,u_viewport:V,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:U}),ll=(g,c)=>{if(c>0&&g.terrain&&a.X("Cutoff is currently disabled on terrain"),c<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const d=g.transform,y=Math.max(Math.abs(d._zoom-(g.minCutoffZoom-1)),1),b=d.isLODDisabled(!1)?a.an(60,45,d.pitch):a.an(30,15,d.pitch),T=d._farZ-d._nearZ,S=c*d.height,P=((1-(M=b))*d.cameraToCenterDistance+M*(d._farZ+S))*y;var M;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[d._nearZ,d._farZ,(P-d._nearZ)/T,(P-S-d._nearZ)/T]}}};function Kp(g,c){return g!=null&&c!=null&&!(!g.hasData()||!c.hasData())&&g.demTexture!=null&&c.demTexture!=null&&g.tileID.key!==c.tileID.key}const xs=new class{constructor(){this.operations={}}newMorphing(g,c,d,y,b){if(g in this.operations){const T=this.operations[g];T.to.tileID.key!==d.tileID.key&&(T.queued=d)}else this.operations[g]={startTime:y,phase:0,duration:b,from:c,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const c=this.operations[g];return{from:c.from,to:c.to,phase:c.phase}}update(g){for(const c in this.operations){const d=this.operations[c];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[c];break}}}_nextOp(g,c){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=c,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},pd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Jp(g,c,d){if(c===0)return 0;const y=c<1&&d===514?.25/c:1;return 6*Math.pow(1.5,22-g)*Math.max(c,1)*y}function Qp(g,c){const d=1<<g.z;return!c&&(g.x===0||g.x===d-1)||g.y===0||g.y===d-1}const md=g=>({u_matrix:g});function gd(g,c,d,y,b){if(b>0){const T=a.a4.now(),S=(T-g.timeAdded)/b,P=c?(T-c.timeAdded)/b:-1,M=d.getSource(),D=y.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),z=!c||Math.abs(c.tileID.overscaledZ-D)>Math.abs(g.tileID.overscaledZ-D),F=z&&g.refreshedUponExpiration?1:a.c(z?S:1-P,0,1);return g.refreshedUponExpiration&&S>=1&&(g.refreshedUponExpiration=!1),c?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class at extends a.bq{constructor(c){const d={type:"raster-dem",maxzoom:c.transform.maxZoom},y=new a.br(a.bs(),null),b=Yo("mock-dem",d,y,c.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,d){c.state="loaded",d(null)}}class jy extends a.bq{constructor(c){const d=Yo("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new a.br(a.bs(),null),c.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,d,y){if(c.freezeTileCoverage)return;this.transform=c;const b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,S)=>{if(T[S.key]="",!this._tiles[S.key]){const P=new a.bt(S,this._source.tileSize*S.overscaleFactor(),c.tileZoom);P.state="loaded",this._tiles[S.key]=P}return T},{});for(const T in this._tiles)T in b||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(c){const d=this.proxyCachedFBO[c];if(d!==void 0){const y=Object.values(d);this.renderCachePool.push(...y),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class _d extends a.O{constructor(c,d,y){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=d,this.projMatrix=y}}class em extends a.bk{constructor(c,d){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},c.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),c.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),c.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,b,T]=function(M){const D=new a.bo,z=new a.bp,F=131;D.reserve(17161),z.reserve(33800);const V=a.J/128,U=a.J+V/2,W=U+V;for(let q=-V;q<W;q+=V)for(let G=-V;G<W;G+=V){const Q=G<0||G>U||q<0||q>U?24575:0,oe=a.c(Math.round(G),0,a.J),ce=a.c(Math.round(q),0,a.J);D.emplaceBack(oe+Q,ce)}const H=(q,G)=>{const Q=G*F+q;z.emplaceBack(Q+1,Q,Q+F),z.emplaceBack(Q+F,Q+F+1,Q+1)};for(let q=1;q<129;q++)for(let G=1;G<129;G++)H(G,q);return[0,129].forEach(q=>{for(let G=0;G<130;G++)H(G,q),H(q,G)}),[D,z,32768]}(),S=c.context;this.gridBuffer=S.createVertexBuffer(y,a.bl.members),this.gridIndexBuffer=S.createIndexBuffer(b),this.gridSegments=a.bm.simpleSegment(0,0,y.length,b.length),this.gridNoSkirtSegments=a.bm.simpleSegment(0,0,y.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new jy(d.map),this.orthoMatrix=a.m.create(),a.m.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.J,0,a.J,0,1);const P=S.gl;this._overlapStencilMode=new a.b6({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new at(d.map),this._pendingGroundEffectLayers=[]}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),this._style=c,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,d,y){if(c&&c.terrain){this._style!==c&&(this.style=c,this._evaluationZoom=void 0);const b=c.terrain.properties,T=c.terrain.drapeRenderMode===0,S=c.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.a4.now();const P=c.terrain&&c.terrain.scope,M=b.get("source"),D=T?this._mockSourceCache:c.getSourceCache(M,P);if(!D)return void a.X(`Couldn't find terrain source "${M}".`);if(this.sourceCache=D,this._exaggeration=S?this.calculateExaggeration(d):b.get("exaggeration"),!d.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&a.X(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(d,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),d.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0,this._previousZoom=d.zoom}else this._disable()}calculateExaggeration(c){const d=this._previousCameraAltitude,y=c.getFreeCameraOptions().position.z/c.pixelsPerMeter*c.worldSize;this._previousCameraAltitude=y;const b=d!=null?y-d:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const T=c.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(T);let P=T-this._previousZoom;const M=this._previousUpdateTimestamp;let D=T;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(T-D)>.5&&(P=.5*(T-D+P)),P*b<0&&(D+=P)),this._evaluationZoom=D;const z=S.getExaggeration(D),F=z===S.getExaggeration(Math.max(0,D-.1));if(F&&Math.abs(z-this._exaggeration)<.01)return z;let V=Math.min(.1,.00375*(this._updateTimestamp-M));return(F||z<.1||Math.abs(P)<1e-4)&&(V=Math.min(.2,4*V)),a.n(this._exaggeration,z,V)}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(c){c.coord&&c.dataType==="source"?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):c.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._mergedSourceCaches)this._style._mergedSourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(a.M.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(M=>{const D=d.getTileByID(M).tileID;return D.projMatrix=y.calculateProjMatrix(D.toUnwrapped()),D});(function(M,D){const z=D.transform.pointCoordinate(D.transform.getCameraPoint()),F=new a.P(z.x,z.y);M.sort((V,U)=>{if(U.overscaledZ-V.overscaledZ)return U.overscaledZ-V.overscaledZ;const W=new a.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),H=new a.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),q=F.mult(1<<V.canonical.z);return q.x-=.5,q.y-=.5,q.distSqr(W)-q.distSqr(H)})})(b,this.painter);const T=this.proxyToSource||{};this.proxyToSource={},b.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const M in S){const D=S[M];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,c[M],T),D.usedForTerrain))continue;const z=c[M];D.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[d.id]=b.map(M=>new _d(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1;const P={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const D=this.terrainTileForTile[M.key];if(!D)continue;const z=D.tileID.key;z in P||(this._visibleDemTiles.push(D),P[z]=z)}}_assignTerrainTiles(c){this._initializing||c.forEach(d=>{if(this.terrainTileForTile[d.key])return;const y=this._findTileCoveringTileID(d,this.sourceCache);y&&(this.terrainTileForTile[d.key]=y)})}_prepareDEMTextures(){const c=this.painter.context,d=c.gl;for(const y in this.terrainTileForTile){const b=this.terrainTileForTile[y],T=b.dem;!T||b.demTexture&&!b.needsDEMTextureUpload||(c.activeTexture.set(d.TEXTURE1),Zp(this.painter,b,T))}}_prepareDemTileUniforms(c,d,y,b){if(!d||d.demTexture==null)return!1;const T=c.tileID.canonical,S=Math.pow(2,d.tileID.canonical.z-T.z),P=b||"";return y[`u_dem_tl${P}`]=[T.x*S%1,T.y*S%1],y[`u_dem_scale${P}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,d=c.gl;if(!this._emptyDepthBufferTexture){const y=new a.a5({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.a9(c,y,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const d=this._visibleDemTiles.reduce((y,b)=>{if(!b.dem)return y;const T=b.dem.tree.minimums[0];return T>0&&c++,y+T},0);return c?d/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,d=c.gl;c.activeTexture.set(d.TEXTURE2);const y=this._getLoadedAreaMinimum(),[b,T]=(()=>{const P=new a.bu({width:1,height:1},new Float32Array([y]));return[d.R32F,P]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(T,{premultiply:!1}):S=this._emptyDEMTexture=new a.a9(c,T,b,{premultiply:!1}),S}setupElevationDraw(c,d,y){const b=this.painter.context,T=b.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};S.u_exaggeration=this.exaggeration();let P=null,M=null,D=1;if(y&&y.morphing&&this._useVertexMorphing){const V=y.morphing.srcDemTile,U=y.morphing.dstDemTile;D=y.morphing.phase,V&&U&&(this._prepareDemTileUniforms(c,V,S,"_prev")&&(M=V),this._prepareDemTileUniforms(c,U,S)&&(P=U))}const z=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?T.LINEAR:T.NEAREST,F=V=>{S.u_dem_size=V.size[0]===1?1:V.size[0]-2};if(M&&P)b.activeTexture.set(T.TEXTURE2),P.demTexture.bind(z(P),T.CLAMP_TO_EDGE),b.activeTexture.set(T.TEXTURE4),M.demTexture.bind(z(M),T.CLAMP_TO_EDGE),P.demTexture&&F(P.demTexture),S.u_dem_lerp=D;else{P=this.terrainTileForTile[c.tileID.key],b.activeTexture.set(T.TEXTURE2);const V=this._prepareDemTileUniforms(c,P,S)?P.demTexture:this.emptyDEMTexture;V.bind(z(P),T.CLAMP_TO_EDGE),F(V)}if(b.activeTexture.set(T.TEXTURE3),y&&y.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),y&&y.useMeterToDem&&P){const V=(1<<P.tileID.canonical.z)*a.b(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=V}if(y&&y.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),d.setTerrainUniformValues(b,S),this.painter.transform.projection.name==="globe"){const V=this.globeUniformValues(this.painter.transform,c.tileID.canonical,y&&y.useDenormalizedUpVectorScale);d.setGlobeUniformValues(b,V)}}globeUniformValues(c,d,y){const b=c.projection;return{u_tile_tl_up:b.upVector(d,0,0),u_tile_tr_up:b.upVector(d,a.J,0),u_tile_br_up:b.upVector(d,a.J,a.J),u_tile_bl_up:b.upVector(d,0,a.J),u_tile_up_scale:y?a.bn(1):b.upVectorScale(d,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const d=this.painter,y=this.painter.context;c.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,T,S,P,M){if(b.transform.projection.name==="globe")(function(D,z,F,V,U){const W=D.context,H=W.gl;let q,G;const Q=D.transform,oe=a.bb(D,W,Q),ce=(Me,xe)=>{if(G===xe)return;const ze=[pd[xe],"PROJECTION_GLOBE_VIEW"];oe&&ze.push("CUSTOM_ANTIALIASING");const ke=D.isTileAffectedByFog(Me);q=D.getOrCreateProgram("globeRaster",{defines:ze,overrideFog:ke}),G=xe},K=D.colorModeForRenderPass(),ee=new a.b4(H.LEQUAL,a.b4.ReadWrite,D.depthRangeFor3D);xs.update(U);const he=a.bc(Q),ge=[a.E(Q.center.lng),a.H(Q.center.lat)],de=D.globeSharedBuffers,ye=[Q.width*a.a4.devicePixelRatio,Q.height*a.a4.devicePixelRatio],Ne=Float32Array.from(Q.globeMatrix),Ae={useDenormalizedUpVectorScale:!0};{const Me=D.transform,xe=Jp(Me.zoom,z.exaggeration(),z.sourceCache._source.tileSize);G=-1;const ze=H.TRIANGLES;for(const ke of V){const Ve=F.getTile(ke),ne=a.b6.disabled,Te=z.prevTerrainTileForTile[ke.key],Xe=z.terrainTileForTile[ke.key];Kp(Te,Xe)&&xs.newMorphing(ke.key,Te,Xe,U,250),W.activeTexture.set(H.TEXTURE0),Ve.texture&&Ve.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const $e=xs.getMorphValuesForProxy(ke.key),bt=$e?1:0;$e&&a.bd(Ae,{morphing:{srcDemTile:$e.from,dstDemTile:$e.to,phase:a.ba($e.phase)}});const mt=a.be(ke.canonical),Dt=a.bf(mt.getCenter().lat),_t=a.bg(ke.canonical,mt,Dt,Me.worldSize/Me._pixelsPerMercatorPixel),Bt=a.bh(a.bi(ke.canonical)),jt=Yp(Me.expandedFarZProjMatrix,Ne,he,Bt,a.ao(Me.zoom),ge,Me.frustumCorners.TL,Me.frustumCorners.TR,Me.frustumCorners.BR,Me.frustumCorners.BL,Me.globeCenterInViewSpace,Me.globeRadius,ye,xe,_t);if(ce(ke,bt),q&&(z.setupElevationDraw(Ve,q,Ae),D.uploadCommonUniforms(W,q,ke.toUnwrapped()),de)){const[Ct,Mt,yn]=de.getGridBuffers(Dt,xe!==0);q.draw(D,ze,ee,ne,K,a.b5.backCCW,jt,"globe_raster",Ct,Mt,yn)}}}if(de&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const Me=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&Me.push("CUSTOM_ANTIALIASING"),q=D.getOrCreateProgram("globeRaster",{defines:Me});for(const xe of V){const{x:ze,y:ke,z:Ve}=xe.canonical,ne=ke===0,Te=ke===(1<<Ve)-1,[Xe,$e,bt,mt]=de.getPoleBuffers(Ve,!1);if(mt&&(ne||Te)){const Dt=F.getTile(xe);W.activeTexture.set(H.TEXTURE0),Dt.texture&&Dt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let _t=a.bj(Ve,ze,Q);const Bt=a.bh(a.bi(xe.canonical)),jt=(Ct,Mt)=>Ct.draw(D,H.TRIANGLES,ee,a.b6.disabled,K,a.b5.disabled,Yp(Q.expandedFarZProjMatrix,_t,_t,Bt,0,ge,Q.frustumCorners.TL,Q.frustumCorners.TR,Q.frustumCorners.BR,Q.frustumCorners.BL,Q.globeCenterInViewSpace,Q.globeRadius,ye,0),"globe_pole_raster",Mt,bt,mt);z.setupElevationDraw(Dt,q,Ae),D.uploadCommonUniforms(W,q,xe.toUnwrapped()),ne&&D.renderDefaultNorthPole&&jt(q,Xe),Te&&D.renderDefaultSouthPole&&(_t=a.m.scale(a.m.create(),_t,[1,-1,1]),jt(q,$e))}}}})(b,T,S,P,M);else{const D=b.context,z=D.gl;let F,V;const U=b.shadowRenderer,W=ll(b,b.longestCutoffRange),H=K=>{if(V===K)return;const ee=[];ee.push(pd[K]),W.shouldRenderCutoff&&ee.push("RENDER_CUTOFF"),F=b.getOrCreateProgram("terrainRaster",{defines:ee}),V=K},q=b.colorModeForRenderPass(),G=new a.b4(z.LEQUAL,a.b4.ReadWrite,b.depthRangeFor3D);xs.update(M);const Q=b.transform,oe=Jp(Q.zoom,T.exaggeration(),T.sourceCache._source.tileSize);let ce=[0,0,0];if(U){const K=b.style.directionalLight,ee=b.style.ambientLight;K&&ee&&(ce=Cd(K,ee))}{V=-1;const K=z.TRIANGLES,[ee,he]=[T.gridIndexBuffer,T.gridSegments];for(const ge of P){const de=S.getTile(ge),ye=a.b6.disabled,Ne=T.prevTerrainTileForTile[ge.key],Ae=T.terrainTileForTile[ge.key];Kp(Ne,Ae)&&xs.newMorphing(ge.key,Ne,Ae,M,250),D.activeTexture.set(z.TEXTURE0),de.texture&&de.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Me=xs.getMorphValuesForProxy(ge.key),xe=Me?1:0;let ze;Me&&(ze={morphing:{srcDemTile:Me.from,dstDemTile:Me.to,phase:a.ba(Me.phase)}});const ke=Xp(ge.projMatrix,Qp(ge.canonical,Q.renderWorldCopies)?oe/10:oe,ce);if(H(xe),!F)continue;T.setupElevationDraw(de,F,ze);const Ve=ge.toUnwrapped();U&&U.setupShadows(Ve,F),b.uploadCommonUniforms(D,F,Ve,null,W),F.draw(b,K,G,ye,q,a.b5.backCCW,ke,"terrain_raster",T.gridBuffer,ee,he)}}}}(d,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(this._drapedRenderBatches.length===0)return c+1;this.renderingToTexture=!0;const d=this.painter,y=this.painter.context,b=this.proxySourceCache,T=this.proxiedCoords[b.id],S=this._drapedRenderBatches.shift(),P=d.style.order,M=[];let D=0;for(const z of T){const F=b.getTileByID(z.proxyTileKey),V=b.proxyCachedFBO[z.key]?b.proxyCachedFBO[z.key][c]:void 0,U=V!==void 0?b.renderCache[V]:this.pool[D++],W=V!==void 0;if(F.texture=U.tex,W&&!U.dirty){M.push(F.tileID);continue}let H;y.bindFramebuffer.set(U.fb.framebuffer),this.renderedToTile=!1,U.dirty&&(y.clear({color:a.C.transparent,stencil:0}),U.dirty=!1);for(let q=S.start;q<=S.end;++q){const G=d.style._mergedLayers[P[q]];if(G.isHidden(d.transform.zoom))continue;const Q=d.style.getLayerSourceCache(G),oe=Q?this.proxyToSource[z.key][Q.id]:[z];if(!oe)continue;const ce=oe;y.viewport.set([0,0,U.fb.width,U.fb.height]),H!==(Q?Q.id:null)&&(this._setupStencil(U,oe,G,Q),H=Q?Q.id:null),d.renderLayer(d,Q,G,ce)}if(this._drapedRenderBatches.length===0)for(const q of this._pendingGroundEffectLayers){const G=d.style._mergedLayers[P[q]];if(G.isHidden(d.transform.zoom))continue;const Q=d.style.getLayerSourceCache(G),oe=Q?this.proxyToSource[z.key][Q.id]:[z];if(!oe)continue;const ce=oe;y.viewport.set([0,0,U.fb.width,U.fb.height]),H!==(Q?Q.id:null)&&(this._setupStencil(U,oe,G,Q),H=Q?Q.id:null),d.renderLayer(d,Q,G,ce)}this.renderedToTile?(U.dirty=!0,M.push(F.tileID)):W||--D,D===5&&(D=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),S.end+1}postRender(){}isLayerOrderingCorrect(c){const d=c.order.length;let y=-1,b=d;for(let T=0;T<d;++T)this._style.isLayerDraped(c._mergedLayers[c.order[T]])?y=Math.max(y,T):b=Math.min(b,T);return b>y}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{c=Math.min(c,d.dem.tree.minimums[0])}),c===0?c:(c-30)*this._exaggeration}raycast(c,d,y){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const S=T.tileID,P=1<<S.overscaledZ,{x:M,y:D}=S.canonical,z=M/P,F=(M+1)/P,V=D/P,U=(D+1)/P;return{minx:z,miny:V,maxx:F,maxy:U,t:T.dem.tree.raycastRoot(z,V,F,U,c,d,y),tile:T}});b.sort((T,S)=>(T.t!==null?T.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const T of b){if(T.t==null)return null;const S=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,c,d,y);if(S!=null)return S}return null}_createFBO(){const c=this.painter.context,d=c.gl,y=this.drapeBufferSize;c.activeTexture.set(d.TEXTURE0);const b=new a.a9(c,{width:y[0],height:y[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const T=c.createFramebuffer(y[0],y[1],!0,null);return T.colorAttachment.set(b.texture),T.depthAttachment=new Vn(c,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:T,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const d=this._style._mergedLayers[c],y=d.isHidden(this.painter.transform.zoom);return d.type==="custom"?!y&&d.shouldRedrape():!y&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const y of this._style.getSources())if(y instanceof Ie){c=!0;break}if(!c)return;const d={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],T=this._style.getLayerSourceCache(b);if(T&&!d[T.id]&&!b.isHidden(this.painter.transform.zoom)&&b.type==="line"&&b.widthExpression()instanceof a.am){d[T.id]=!0;for(const S of this.proxyCoords){const P=this.proxyToSource[S.key][T.id];if(P)for(const M of P)this._clearRenderCacheForTile(T.id,M)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof kt){c=!0;break}if(!c)return;const d={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],T=this._style.getLayerSourceCache(b);if(!T||d[T.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const S=b.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const M=this.proxyToSource[P.key][T.id];if(M)for(const D of M){const z=gd(T.getTile(D),T.findLoadedParent(D,0),T,this.painter.transform,S);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(T.id,D)}}}}_setupDrapedRenderBatches(){const c=this._style.order,d=c.length;if(d===0)return;const y=[];this._pendingGroundEffectLayers=[];let b,T=0,S=this._style._mergedLayers[c[T]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++T<d;)S=this._style._mergedLayers[c[T]];for(;T<d;++T){const P=this._style._mergedLayers[c[T]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?b===void 0&&(b=T):(P.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(T),b!==void 0&&(y.push({start:b,end:T-1}),b=void 0)))}if(b!==void 0&&y.push({start:b,end:T-1}),y.length!==0){const P=y[y.length-1];this._pendingGroundEffectLayers.every(M=>M>P.end)||a.X("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(c){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const S=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let P=0;P<S.length;++P){const M=Object.values(S[P]);d.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,b=this._tilesDirty;for(let S=y.length-1;S>=0;S--){const P=y[S];if(d.getTileByID(P.key),d.proxyCachedFBO[P.key]!==void 0){const M=c[P.key],D=this.proxyToSource[P.key];let z=0;for(const F in D){const V=D[F],U=M[F];if(!U||U.length!==V.length||V.some((W,H)=>W!==U[H]||b[F]&&b[F].hasOwnProperty(W.key))){z=-1;break}++z}for(const F in d.proxyCachedFBO[P.key])d.renderCache[d.proxyCachedFBO[P.key][F]].dirty=z<0||z!==Object.values(M).length}}const T=[...this._drapedRenderBatches];T.sort((S,P)=>P.end-P.start-(S.end-S.start));for(const S of T)for(const P of y){if(d.proxyCachedFBO[P.key])continue;let M=d.renderCachePool.pop();M===void 0&&d.renderCache.length<50&&(M=d.renderCache.length,d.renderCache.push(this._createFBO())),M!==void 0&&(d.proxyCachedFBO[P.key]={},d.proxyCachedFBO[P.key][S.start]=M,d.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(c,d,y,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,S=T.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let P;if(y.isTileClipped())P=d.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):a.b6.disabled}_renderTileClippingMasks(c,d){const y=this.painter,b=this.painter.context,T=b.gl;y._tileClippingMaskIDs={},b.setColorMode(a.a.disabled),b.setDepthMode(a.b4.disabled);const S=y.getOrCreateProgram("clippingMask");for(const P of c){const M=y._tileClippingMaskIDs[P.key]=--d;S.draw(y,T.TRIANGLES,a.b4.disabled,new a.b6({func:T.ALWAYS,mask:0},M,255,T.KEEP,T.KEEP,T.REPLACE),a.a.disabled,a.b5.disabled,md(P.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(c){const d=this.painter.transform;if(c.x<0||c.x>d.width||c.y<0||c.y>d.height)return null;const y=[c.x,c.y,1,1];a.e.transformMat4(y,y,d.pixelMatrixInverse),a.e.scale(y,y,1/y[3]),y[0]/=d.worldSize,y[1]/=d.worldSize;const b=d._camera.position,T=a.b(1,d.center.lat),S=[b[0],b[1],b[2]/T,0],P=a.v.subtract([],y.slice(0,3),S);a.v.normalize(P,P);const M=this.raycast(S,P,this._exaggeration);return M!==null&&M?(a.v.scaleAndAdd(S,S,P,M),S[3]=S[2],S[2]*=T,S):null}drawDepth(){const c=this.painter,d=c.context,y=this.proxySourceCache,b=Math.ceil(c.width),T=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===b&&this._depthFBO.height===T||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const S=d.gl,P=d.createFramebuffer(b,T,!0,"renderbuffer");d.activeTexture.set(S.TEXTURE0);const M=new a.a9(d,{width:b,height:T,data:null},S.RGBA);M.bind(S.NEAREST,S.CLAMP_TO_EDGE),P.colorAttachment.set(M.texture);const D=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,b,T);P.depthAttachment.set(D),this._depthFBO=P,this._depthTexture=M}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,b,T]),function(S,P,M,D){if(S.transform.projection.name==="globe")return;const z=S.context,F=z.gl;z.clear({depth:1});const V=S.getOrCreateProgram("terrainDepth"),U=new a.b4(F.LESS,a.b4.ReadWrite,S.depthRangeFor3D);for(const W of D){const H=M.getTile(W),q=Xp(W.projMatrix,0,[0,0,0]);P.setupElevationDraw(H,V),V.draw(S,F.TRIANGLES,U,a.b6.disabled,a.a.unblended,a.b5.backCCW,q,"terrain_depth",P.gridBuffer,P.gridIndexBuffer,P.gridNoSkirtSegments)}}(c,this,y,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,d,y){if(c.getSource()instanceof a.aK)return this._setupProxiedCoordsForImageSource(c,d,y);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const b=this.proxiedCoords[c.id]=[],T=this.proxyCoords;for(let M=0;M<T.length;M++){const D=T[M],z=this._findTileCoveringTileID(D,c);if(z){const F=this._createProxiedId(D,z,y[D.key]&&y[D.key][c.id]);b.push(F),this.proxyToSource[D.key][c.id]=[F]}}let S=!1;const P=new Set;for(let M=0;M<d.length;M++){const D=c.getTile(d[M]);if(!D||!D.hasData())continue;const z=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==D.tileID.canonical.z){const F=this.proxyToSource[z.tileID.key][c.id],V=this._createProxiedId(z.tileID,D,y[z.tileID.key]&&y[z.tileID.key][c.id]);F?F.splice(F.length-1,0,V):this.proxyToSource[z.tileID.key][c.id]=[V];const U=this.proxyToSource[z.tileID.key][c.id];P.has(U)||P.add(U),b.push(V),S=!0}}if(this._sourceTilesOverlap[c.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const M of P)M.sort((D,z)=>z.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(c,d,y){if(!c.getSource().loaded())return;const b=this.proxiedCoords[c.id]=[],T=this.proxyCoords,S=c.getSource(),P=S.tileID;if(!P)return;const M=new a.P(P.x,P.y)._div(1<<P.z),D=S.coordinates.map(a.M.fromLngLat).reduce((F,V)=>(F.min.x=Math.min(F.min.x,V.x-M.x),F.min.y=Math.min(F.min.y,V.y-M.y),F.max.x=Math.max(F.max.x,V.x-M.x),F.max.y=Math.max(F.max.y,V.y-M.y),F),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(F,V)=>{const U=F.wrap+F.canonical.x/(1<<F.canonical.z),W=F.canonical.y/(1<<F.canonical.z),H=a.J/(1<<F.canonical.z),q=V.wrap+V.canonical.x/(1<<V.canonical.z),G=V.canonical.y/(1<<V.canonical.z);return U+H<q+D.min.x||U>q+D.max.x||W+H<G+D.min.y||W>G+D.max.y};for(let F=0;F<T.length;F++){const V=T[F];for(let U=0;U<d.length;U++){const W=c.getTile(d[U]);if(!W||!W.hasData()||z(V,W.tileID))continue;const H=this._createProxiedId(V,W,y[V.key]&&y[V.key][c.id]),q=this.proxyToSource[V.key][c.id];q?q.push(H):this.proxyToSource[V.key][c.id]=[H],b.push(H)}}}_createProxiedId(c,d,y){let b=this.orthoMatrix;if(y){const T=y.find(S=>S.key===d.tileID.key);if(T)return T}if(d.tileID.key!==c.key){const T=c.canonical.z-d.tileID.canonical.z;let S,P,M;b=a.m.create();const D=d.tileID.wrap-c.wrap<<c.overscaledZ;T>0?(S=a.J>>T,P=S*((d.tileID.canonical.x<<T)-c.canonical.x+D),M=S*((d.tileID.canonical.y<<T)-c.canonical.y)):(S=a.J<<-T,P=a.J*(d.tileID.canonical.x-(c.canonical.x+D<<-T)),M=a.J*(d.tileID.canonical.y-(c.canonical.y<<-T))),a.m.ortho(b,0,S,0,S,0,1),a.m.translate(b,b,[P,M,0])}return new _d(d.tileID,c.key,b)}_findTileCoveringTileID(c,d){let y=d.getTile(c);if(y&&y.hasData())return y;const b=this._findCoveringTileCache[d.id],T=b[c.key];if(y=T?d.getTileByID(T):null,y&&y.hasData()||T===null)return y;let S=y?y.tileID:c,P=S.overscaledZ;const M=d.getSource().minzoom,D=[];if(!T){const F=d.getSource().maxzoom;if(c.canonical.z>=F){const V=c.canonical.z-F;d.getSource().reparseOverscaled?(P=Math.max(c.canonical.z+2,d.transform.tileZoom),S=new a.O(P,c.wrap,F,c.canonical.x>>V,c.canonical.y>>V)):V!==0&&(P=F,S=new a.O(P,c.wrap,F,c.canonical.x>>V,c.canonical.y>>V))}S.key!==c.key&&(D.push(S.key),y=d.getTile(S))}const z=F=>{D.forEach(V=>{b[V]=F}),D.length=0};for(P-=1;P>=M&&(!y||!y.hasData());P--){y&&z(y.tileID.key);const F=S.calculateScaledKey(P);if(y=d.getTileByID(F),y&&y.hasData())break;const V=b[F];if(V===null)break;V===void 0?D.push(F):y=d.getTileByID(V)}return z(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,d){let y=this._tilesDirty[c];y||(y=this._tilesDirty[c]={}),y[d.key]=!0}}function Vy(g,c,d){const y=function(P,M,D){const z=a.v.dot(M,P),F=a.v.dot(D,[.2126,.7152,.0722]),V=(W,H,q)=>(1-q)*W+q*H,U=V(1-.3*Math.min(F,1),1,Math.min(z+1,1));return V(.92,1,Math.asin(a.c(M[2],-1,1))/Math.PI+.5)*U}(g,[0,0,1],c),b=[0,0,0];a.v.scale(b,d.slice(0,3),y);const T=[0,0,0];a.v.scale(T,c.slice(0,3),g[2]);const S=[0,0,0];return a.v.add(S,b,T),a.bw(S)}const yd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ws=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class vd{static cacheKey(c,d,y,b){let T=`${d}${b?b.cacheKey:""}`;for(const S of y)c.usedDefines.includes(S)&&(T+=`/${S}`);return T}constructor(c,d,y,b,T,S){const P=c.gl;this.program=P.createProgram(),this.configuration=b,this.name=d,this.fixedDefines=[...S];const M=b?b.getBinderAttributes():[],D=(y.staticAttributes||[]).concat(M);let z=b?b.defines():[];z=z.concat(S.map(q=>`#define ${q}`));const F=`#version 300 es
`;let V=F+z.concat("precision mediump float;",al,By.fragmentSource).join(`
`);for(const q of y.fragmentIncludes)V+=`
${ya[q]}`;V+=`
${y.fragmentSource}`;let U=F+z.concat("precision highp float;",al,By.vertexSource).join(`
`);for(const q of y.vertexIncludes)U+=`
${ya[q]}`;U+=`
${y.vertexSource}`;const W=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(W,V),P.compileShader(W),P.attachShader(this.program,W);const H=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(H,U),P.compileShader(H),P.attachShader(this.program,H),this.attributes={},this.numAttributes=D.length;for(let q=0;q<this.numAttributes;q++)if(D[q]){const G=D[q].startsWith("a_")?D[q]:`a_${D[q]}`;P.bindAttribLocation(this.program,q,G),this.attributes[G]=q}P.linkProgram(this.program),P.deleteShader(H),P.deleteShader(W),this.fixedUniforms=T(c),this.binderUniforms=b?b.getUniforms(c):[],S.includes("TERRAIN")&&(this.terrainUniforms=(q=>({u_dem:new a.a$(q),u_dem_prev:new a.a$(q),u_dem_tl:new a.b0(q),u_dem_scale:new a.b2(q),u_dem_tl_prev:new a.b0(q),u_dem_scale_prev:new a.b2(q),u_dem_size:new a.b2(q),u_dem_lerp:new a.b2(q),u_exaggeration:new a.b2(q),u_depth:new a.a$(q),u_depth_size_inv:new a.b0(q),u_meter_to_dem:new a.b2(q),u_label_plane_matrix_inv:new a.a_(q)}))(c)),S.includes("GLOBE")&&(this.globeUniforms=(q=>({u_tile_tl_up:new a.b7(q),u_tile_tr_up:new a.b7(q),u_tile_br_up:new a.b7(q),u_tile_bl_up:new a.b7(q),u_tile_up_scale:new a.b2(q)}))(c)),S.includes("FOG")&&(this.fogUniforms=(q=>({u_fog_matrix:new a.a_(q),u_fog_range:new a.b0(q),u_fog_color:new a.b9(q),u_fog_horizon_blend:new a.b2(q),u_fog_vertical_limit:new a.b0(q),u_fog_temporal_offset:new a.b2(q),u_frustum_tl:new a.b7(q),u_frustum_tr:new a.b7(q),u_frustum_br:new a.b7(q),u_frustum_bl:new a.b7(q),u_globe_pos:new a.b7(q),u_globe_radius:new a.b2(q),u_globe_transition:new a.b2(q),u_is_globe:new a.a$(q),u_viewport:new a.b0(q)}))(c)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(q=>({u_cutoff_params:new a.b9(q)}))(c)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(q=>({u_lighting_ambient_color:new a.b7(q),u_lighting_directional_dir:new a.b7(q),u_lighting_directional_color:new a.b7(q),u_ground_radiance:new a.b7(q)}))(c)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(q=>({u_light_matrix_0:new a.a_(q),u_light_matrix_1:new a.a_(q),u_fade_range:new a.b0(q),u_shadow_normal_offset:new a.b7(q),u_shadow_intensity:new a.b2(q),u_shadow_texel_size:new a.b2(q),u_shadow_map_resolution:new a.b2(q),u_shadow_direction:new a.b7(q),u_shadow_bias:new a.b7(q),u_shadowmap_0:new a.a$(q),u_shadowmap_1:new a.a$(q)}))(c))}}setTerrainUniformValues(c,d){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)y[b]&&y[b].set(this.program,b,d[b])}}setGlobeUniformValues(c,d){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)y[b]&&y[b].set(this.program,b,d[b])}}setFogUniformValues(c,d){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}setCutoffUniformValues(c,d){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}setLightsUniformValues(c,d){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}setShadowUniformValues(c,d){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;c.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}_drawDebugWireframe(c,d,y,b,T,S,P,M,D,z){const F=c.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;const V=c.context;if(!(()=>!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||c._terrain&&c._terrain.renderingToTexture||!yd.includes(this.name))||!(!F.layers3D||!Ws.includes(this.name)))())return;const U=V.gl,W=c.wireframeDebugCache.getLinesFromTrianglesBuffer(c.frameCounter,T,V);if(!W)return;const H=[...this.fixedDefines];H.push("DEBUG_WIREFRAME");const q=c.getOrCreateProgram(this.name,{config:this.configuration,defines:H});V.program.set(q.program);const G=(ce,K,ee)=>{if(K[ce]&&ee[ce])for(const he in K[ce])ee[ce][he]&&ee[ce][he].set(ee.program,he,K[ce][he].current)};D&&D.setUniforms(q.program,V,q.binderUniforms,P,{zoom:M}),G("fixedUniforms",this,q),G("terrainUniforms",this,q),G("globeUniforms",this,q),G("fogUniforms",this,q),G("lightsUniforms",this,q),G("shadowUniforms",this,q),W.bind(),V.setColorMode(new a.a([U.ONE,U.ONE_MINUS_SRC_ALPHA,U.ZERO,U.ONE],a.C.transparent,[!0,!0,!0,!1])),V.setDepthMode(new a.b4(d.func===U.LESS?U.LEQUAL:d.func,a.b4.ReadOnly,d.range)),V.setStencilMode(a.b6.disabled);const Q=3*S.primitiveLength*2,oe=3*S.primitiveOffset*2*2;z&&z>1?U.drawElementsInstanced(U.LINES,Q,U.UNSIGNED_SHORT,oe,z):U.drawElements(U.LINES,Q,U.UNSIGNED_SHORT,oe),T.bind(),V.program.set(this.program),V.setDepthMode(d),V.setStencilMode(y),V.setColorMode(b)}draw(c,d,y,b,T,S,P,M,D,z,F,V,U,W,H,q){const G=c.context,Q=G.gl;if(this.failedToCreate)return;G.program.set(this.program),G.setDepthMode(y),G.setStencilMode(b),G.setColorMode(T),G.setCullFace(S);for(const K of Object.keys(this.fixedUniforms))this.fixedUniforms[K].set(this.program,K,P[K]);W&&W.setUniforms(this.program,G,this.binderUniforms,V,{zoom:U});const oe={[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[d],ce=q&&q>0?1:void 0;for(const K of F.get()){const ee=K.vaos||(K.vaos={});(ee[M]||(ee[M]=new sw)).bind(G,this,D,W?W.getPaintVertexBuffers():[],z,K.vertexOffset,H||[],ce),q&&q>1?Q.drawElementsInstanced(d,K.primitiveLength*oe,Q.UNSIGNED_SHORT,K.primitiveOffset*oe*2,q):Q.drawElements(d,K.primitiveLength*oe,Q.UNSIGNED_SHORT,K.primitiveOffset*oe*2),d===Q.TRIANGLES&&this._drawDebugWireframe(c,y,b,T,z,K,V,U,W,q)}}}function xa(g,c){const d=Math.pow(2,c.tileID.overscaledZ),y=c.tileSize*Math.pow(2,g.transform.tileZoom)/d,b=y*(c.tileID.canonical.x+c.tileID.wrap*d),T=y*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture?c.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.ay(c,1,g.transform.tileZoom),u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T]}}const xd=a.m.create(),cl=(g,c,d,y,b,T,S,P,M,D,z,F,V,U,W,H)=>{const q=c.style.light,G=q.properties.get("position"),Q=[G.x,G.y,G.z],oe=a.bx.create();q.properties.get("anchor")==="viewport"&&(a.bx.fromRotation(oe,-c.transform.angle),a.v.transformMat3(Q,Q,oe));const ce=q.properties.get("color"),K=c.transform,ee={u_matrix:g,u_lightpos:Q,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_vertical_gradient:+d,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:T,u_flood_light_color:F,u_vertical_scale:V,u_flood_light_intensity:U,u_ground_shadow_factor:W,u_emissive_strength:H};return K.projection.name==="globe"&&(ee.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],ee.u_zoom_transition=M,ee.u_inv_rot_matrix=z,ee.u_merc_center=D,ee.u_up_dir=K.projection.upVector(new a.t(0,0,0),D[0]*a.J,D[1]*a.J),ee.u_height_lift=P),ee},tm=(g,c,d)=>({u_matrix:g,u_edge_radius:c,u_vertical_scale:d}),uw=(g,c,d,y,b,T,S,P,M,D,z,F,V,U)=>{const W=cl(g,c,d,y,b,T,S,M,D,z,F,V,U,1,[0,0,0],0),H={u_height_factor:-Math.pow(2,S.overscaledZ)/P.tileSize/8};return a.ak(W,xa(c,P),H)},nm=(g,c)=>({u_matrix:g,u_emissive_strength:c}),rm=(g,c,d,y)=>a.ak(nm(g,c),xa(d,y)),im=(g,c,d)=>({u_matrix:g,u_world:d,u_emissive_strength:c}),hw=(g,c,d,y,b)=>a.ak(rm(g,c,d,y),{u_world:b}),dw=(g,c,d,y)=>{const b=a.J/d.tileSize;return{u_matrix:g,u_camera_to_center_distance:c.getCameraToCenterDistance(y),u_extrude_scale:[c.pixelsToGLUnits[0]/b,c.pixelsToGLUnits[1]/b]}},Uy=(g,c,d=1)=>({u_matrix:g,u_color:c,u_overlay:0,u_overlay_scale:d}),fw=a.m.create(),$y=(g,c,d,y,b,T,S)=>{const P=g.transform,M=P.projection.name==="globe",D=M?a.by(P.zoom,c.canonical)*P._pixelsPerMercatorPixel:a.ay(d,1,T),z={u_matrix:c.projMatrix,u_extrude_scale:D,u_intensity:S,u_inv_rot_matrix:fw,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){z.u_inv_rot_matrix=y,z.u_merc_center=b,z.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],z.u_zoom_transition=a.ao(P.zoom);const F=b[0]*a.J,V=b[1]*a.J;z.u_up_dir=P.projection.upVector(new a.t(0,0,0),F,V)}return z},Gy=(g,c,d,y,b,T,S,P,M,D,z,F,V,U,W,H,q,G,Q,oe,ce)=>{return{u_matrix:g,u_normalize_matrix:c,u_globe_matrix:d,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:D,u_fade_t:z.mix,u_opacity:z.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:(ee=F.paint.get("raster-saturation"),ee>0?1-1/(1.001-ee):-ee),u_contrast_factor:(K=F.paint.get("raster-contrast"),K>0?1/(1-K):1+K),u_spin_weights:bd(F.paint.get("raster-hue-rotate")),u_perspective_transform:V,u_raster_elevation:U,u_zoom_transition:S,u_merc_center:P,u_cutoff_params:M,u_colorization_mix:pw(H,G),u_colorization_offset:Wy(q,G),u_color_ramp:W,u_texture_offset:[oe/(Q+2*oe),Q/(Q+2*oe)],u_texture_res:[Q+2*oe,Q+2*oe],u_emissive_strength:ce};var K,ee};function bd(g){g*=Math.PI/180;const c=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*c-d+1)/3,(Math.sqrt(3)*c-d+1)/3]}function pw([g,c,d,y],[b,T]){if(b===T)return[0,0,0,0];const S=(a.bz+3)/(a.bz+1)/(T-b);return[g*S,c*S,d*S,y*S]}function Wy(g,[c,d]){return c===d?0:((g-c)/(d-c)*(a.bz+3)-1)/(a.bz+1)}const wd=a.m.create(),Nu=(g,c,d,y,b,T,S,P,M,D,z,F,V,U,W,H,q,G)=>{const Q=b.transform,oe={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:Q.getCameraToCenterDistance(H),u_rotate_symbol:+d,u_aspect_ratio:Q.width/Q.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:S,u_coord_matrix:P,u_is_text:+M,u_pitch_with_map:+y,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:wd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:wd,u_up_vector:[0,-1,0],u_icon_transition:G||0,u_icon_saturation:q};return H.name==="globe"&&(oe.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],oe.u_zoom_transition=F,oe.u_inv_rot_matrix=U,oe.u_merc_center=V,oe.u_camera_forward=Q._camera.forward(),oe.u_ecef_origin=a.bA(Q.globeMatrix,z.toUnwrapped()),oe.u_tile_matrix=Float32Array.from(Q.globeMatrix),oe.u_up_vector=W),oe},Td=(g,c,d,y,b,T,S,P,M,D,z,F,V,U,W,H,q)=>a.ak(Nu(g,c,d,y,b,T,S,P,M,D,F,V,U,W,H,q,1),{u_gamma_scale:y?b.transform.getCameraToCenterDistance(q)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:a.a4.devicePixelRatio,u_is_halo:+z,undefined:void 0}),Fu=(g,c,d,y,b,T,S,P,M,D,z,F,V,U,W,H)=>a.ak(Td(g,c,d,y,b,T,S,P,!0,M,!0,z,F,V,U,W,H),{u_texsize_icon:D,u_texture_icon:1}),om=(g,c,d,y)=>({u_matrix:g,u_emissive_strength:c,u_opacity:d,u_color:y}),mc=(g,c,d,y,b,T,S)=>a.ak(function(P,M,D,z){const F=D.imageManager.getPattern(P.toString(),M),{width:V,height:U}=D.imageManager.getPixelSize(M),W=Math.pow(2,z.tileID.overscaledZ),H=z.tileSize*Math.pow(2,D.transform.tileZoom)/W,q=H*(z.tileID.canonical.x+z.tileID.wrap*W),G=H*z.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[V,U],u_pattern_size:F.displaySize,u_tile_units_to_pixels:1/a.ay(z,1,D.transform.tileZoom),u_pixel_coord_upper:[q>>16,G>>16],u_pixel_coord_lower:[65535&q,65535&G]}}(b,T,y,S),{u_matrix:g,u_emissive_strength:c,u_opacity:d}),ui={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Bu=(g,c,d,y,b,T,S,P,M,D,z,F,V=[0,0,0])=>{const U=y.style.light,W=U.properties.get("position"),H=[-W.x,-W.y,W.z],q=a.bx.create();U.properties.get("anchor")==="viewport"&&(a.bx.fromRotation(q,-y.transform.angle),a.v.transformMat3(H,H,q));const G=D.alphaMode==="MASK",Q=U.properties.get("color"),oe=F.paint.get("model-ambient-occlusion-intensity"),ce=F.paint.get("model-color").constantOr(a.C.white),K=F.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:c,u_normal_matrix:d,u_lightpos:H,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_camera_pos:V,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+G,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:[T.r,T.g,T.b,T.a],u_emissiveFactor:[S[0],S[1],S[2],1],u_metallicFactor:P,u_roughnessFactor:M,u_baseColorTexture:ui.BaseColor,u_metallicRoughnessTexture:ui.MetallicRoughness,u_normalTexture:ui.Normal,u_occlusionTexture:ui.Occlusion,u_emissionTexture:ui.Emission,u_color_mix:[ce.r,ce.g,ce.b,K],u_aoIntensity:oe,u_emissive_strength:z}},ul=new Float32Array(16),Ed=(g,c=ul,d=ul)=>({u_matrix:g,u_instance:c,u_node_matrix:d}),qy={fillExtrusion:g=>({u_matrix:new a.a_(g),u_lightpos:new a.b7(g),u_lightintensity:new a.b2(g),u_lightcolor:new a.b7(g),u_vertical_gradient:new a.b2(g),u_opacity:new a.b2(g),u_edge_radius:new a.b2(g),u_ao:new a.b0(g),u_tile_id:new a.b7(g),u_zoom_transition:new a.b2(g),u_inv_rot_matrix:new a.a_(g),u_merc_center:new a.b0(g),u_up_dir:new a.b7(g),u_height_lift:new a.b2(g),u_flood_light_color:new a.b7(g),u_vertical_scale:new a.b2(g),u_flood_light_intensity:new a.b2(g),u_ground_shadow_factor:new a.b7(g),u_emissive_strength:new a.b2(g)}),fillExtrusionDepth:g=>({u_matrix:new a.a_(g),u_edge_radius:new a.b2(g),u_vertical_scale:new a.b2(g)}),fillExtrusionPattern:g=>({u_matrix:new a.a_(g),u_lightpos:new a.b7(g),u_lightintensity:new a.b2(g),u_lightcolor:new a.b7(g),u_vertical_gradient:new a.b2(g),u_height_factor:new a.b2(g),u_edge_radius:new a.b2(g),u_ao:new a.b0(g),u_tile_id:new a.b7(g),u_zoom_transition:new a.b2(g),u_inv_rot_matrix:new a.a_(g),u_merc_center:new a.b0(g),u_up_dir:new a.b7(g),u_height_lift:new a.b2(g),u_image:new a.a$(g),u_texsize:new a.b0(g),u_pixel_coord_upper:new a.b0(g),u_pixel_coord_lower:new a.b0(g),u_tile_units_to_pixels:new a.b2(g),u_opacity:new a.b2(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new a.a_(g),u_opacity:new a.b2(g),u_ao_pass:new a.b2(g),u_meter_to_tile:new a.b2(g),u_ao:new a.b0(g),u_flood_light_intensity:new a.b2(g),u_flood_light_color:new a.b7(g),u_attenuation:new a.b2(g),u_edge_radius:new a.b2(g),u_fb:new a.a$(g),u_fb_size:new a.b2(g)}),fill:g=>({u_matrix:new a.a_(g),u_emissive_strength:new a.b2(g)}),fillPattern:g=>({u_matrix:new a.a_(g),u_emissive_strength:new a.b2(g),u_image:new a.a$(g),u_texsize:new a.b0(g),u_pixel_coord_upper:new a.b0(g),u_pixel_coord_lower:new a.b0(g),u_tile_units_to_pixels:new a.b2(g)}),fillOutline:g=>({u_matrix:new a.a_(g),u_emissive_strength:new a.b2(g),u_world:new a.b0(g)}),fillOutlinePattern:g=>({u_matrix:new a.a_(g),u_emissive_strength:new a.b2(g),u_world:new a.b0(g),u_image:new a.a$(g),u_texsize:new a.b0(g),u_pixel_coord_upper:new a.b0(g),u_pixel_coord_lower:new a.b0(g),u_tile_units_to_pixels:new a.b2(g)}),circle:a.bB,collisionBox:g=>({u_matrix:new a.a_(g),u_camera_to_center_distance:new a.b2(g),u_extrude_scale:new a.b0(g)}),collisionCircle:g=>({u_matrix:new a.a_(g),u_inv_matrix:new a.a_(g),u_camera_to_center_distance:new a.b2(g),u_viewport_size:new a.b0(g)}),debug:g=>({u_color:new a.b1(g),u_matrix:new a.a_(g),u_overlay:new a.a$(g),u_overlay_scale:new a.b2(g)}),clippingMask:g=>({u_matrix:new a.a_(g)}),heatmap:g=>({u_extrude_scale:new a.b2(g),u_intensity:new a.b2(g),u_matrix:new a.a_(g),u_inv_rot_matrix:new a.a_(g),u_merc_center:new a.b0(g),u_tile_id:new a.b7(g),u_zoom_transition:new a.b2(g),u_up_dir:new a.b7(g)}),heatmapTexture:g=>({u_image:new a.a$(g),u_color_ramp:new a.a$(g),u_opacity:new a.b2(g)}),hillshade:g=>({u_matrix:new a.a_(g),u_image:new a.a$(g),u_latrange:new a.b0(g),u_light:new a.b0(g),u_shadow:new a.b1(g),u_highlight:new a.b1(g),u_emissive_strength:new a.b2(g),u_accent:new a.b1(g)}),hillshadePrepare:g=>({u_matrix:new a.a_(g),u_image:new a.a$(g),u_dimension:new a.b0(g),u_zoom:new a.b2(g)}),line:a.bC,linePattern:a.bD,raster:g=>({u_matrix:new a.a_(g),u_normalize_matrix:new a.a_(g),u_globe_matrix:new a.a_(g),u_merc_matrix:new a.a_(g),u_grid_matrix:new a.b8(g),u_tl_parent:new a.b0(g),u_scale_parent:new a.b2(g),u_fade_t:new a.b2(g),u_opacity:new a.b2(g),u_image0:new a.a$(g),u_image1:new a.a$(g),u_brightness_low:new a.b2(g),u_brightness_high:new a.b2(g),u_saturation_factor:new a.b2(g),u_contrast_factor:new a.b2(g),u_spin_weights:new a.b7(g),u_perspective_transform:new a.b0(g),u_raster_elevation:new a.b2(g),u_zoom_transition:new a.b2(g),u_merc_center:new a.b0(g),u_cutoff_params:new a.b9(g),u_colorization_mix:new a.b9(g),u_colorization_offset:new a.b2(g),u_color_ramp:new a.a$(g),u_texture_offset:new a.b0(g),u_texture_res:new a.b0(g),u_emissive_strength:new a.b2(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new a.a$(g),u_is_size_feature_constant:new a.a$(g),u_size_t:new a.b2(g),u_size:new a.b2(g),u_camera_to_center_distance:new a.b2(g),u_rotate_symbol:new a.a$(g),u_aspect_ratio:new a.b2(g),u_fade_change:new a.b2(g),u_matrix:new a.a_(g),u_label_plane_matrix:new a.a_(g),u_coord_matrix:new a.a_(g),u_is_text:new a.a$(g),u_pitch_with_map:new a.a$(g),u_texsize:new a.b0(g),u_tile_id:new a.b7(g),u_zoom_transition:new a.b2(g),u_inv_rot_matrix:new a.a_(g),u_merc_center:new a.b0(g),u_camera_forward:new a.b7(g),u_tile_matrix:new a.a_(g),u_up_vector:new a.b7(g),u_ecef_origin:new a.b7(g),u_texture:new a.a$(g),u_icon_transition:new a.b2(g),u_icon_saturation:new a.b2(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new a.a$(g),u_is_size_feature_constant:new a.a$(g),u_size_t:new a.b2(g),u_size:new a.b2(g),u_camera_to_center_distance:new a.b2(g),u_rotate_symbol:new a.a$(g),u_aspect_ratio:new a.b2(g),u_fade_change:new a.b2(g),u_matrix:new a.a_(g),u_label_plane_matrix:new a.a_(g),u_coord_matrix:new a.a_(g),u_is_text:new a.a$(g),u_pitch_with_map:new a.a$(g),u_texsize:new a.b0(g),u_texture:new a.a$(g),u_gamma_scale:new a.b2(g),u_device_pixel_ratio:new a.b2(g),u_tile_id:new a.b7(g),u_zoom_transition:new a.b2(g),u_inv_rot_matrix:new a.a_(g),u_merc_center:new a.b0(g),u_camera_forward:new a.b7(g),u_tile_matrix:new a.a_(g),u_up_vector:new a.b7(g),u_ecef_origin:new a.b7(g),u_is_halo:new a.a$(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new a.a$(g),u_is_size_feature_constant:new a.a$(g),u_size_t:new a.b2(g),u_size:new a.b2(g),u_camera_to_center_distance:new a.b2(g),u_rotate_symbol:new a.a$(g),u_aspect_ratio:new a.b2(g),u_fade_change:new a.b2(g),u_matrix:new a.a_(g),u_label_plane_matrix:new a.a_(g),u_coord_matrix:new a.a_(g),u_is_text:new a.a$(g),u_pitch_with_map:new a.a$(g),u_texsize:new a.b0(g),u_texsize_icon:new a.b0(g),u_texture:new a.a$(g),u_texture_icon:new a.a$(g),u_gamma_scale:new a.b2(g),u_device_pixel_ratio:new a.b2(g),u_is_halo:new a.a$(g)}),background:g=>({u_matrix:new a.a_(g),u_emissive_strength:new a.b2(g),u_opacity:new a.b2(g),u_color:new a.b1(g)}),backgroundPattern:g=>({u_matrix:new a.a_(g),u_emissive_strength:new a.b2(g),u_opacity:new a.b2(g),u_image:new a.a$(g),u_pattern_tl:new a.b0(g),u_pattern_br:new a.b0(g),u_texsize:new a.b0(g),u_pattern_size:new a.b0(g),u_pixel_coord_upper:new a.b0(g),u_pixel_coord_lower:new a.b0(g),u_tile_units_to_pixels:new a.b2(g)}),terrainRaster:fd,terrainDepth:fd,skybox:g=>({u_matrix:new a.a_(g),u_sun_direction:new a.b7(g),u_cubemap:new a.a$(g),u_opacity:new a.b2(g),u_temporal_offset:new a.b2(g)}),skyboxGradient:g=>({u_matrix:new a.a_(g),u_color_ramp:new a.a$(g),u_center_direction:new a.b7(g),u_radius:new a.b2(g),u_opacity:new a.b2(g),u_temporal_offset:new a.b2(g)}),skyboxCapture:g=>({u_matrix_3f:new a.b8(g),u_sun_direction:new a.b7(g),u_sun_intensity:new a.b2(g),u_color_tint_r:new a.b9(g),u_color_tint_m:new a.b9(g),u_luminance:new a.b2(g)}),globeRaster:g=>({u_proj_matrix:new a.a_(g),u_globe_matrix:new a.a_(g),u_normalize_matrix:new a.a_(g),u_merc_matrix:new a.a_(g),u_zoom_transition:new a.b2(g),u_merc_center:new a.b0(g),u_image0:new a.a$(g),u_grid_matrix:new a.b8(g),u_skirt_height:new a.b2(g),u_frustum_tl:new a.b7(g),u_frustum_tr:new a.b7(g),u_frustum_br:new a.b7(g),u_frustum_bl:new a.b7(g),u_globe_pos:new a.b7(g),u_globe_radius:new a.b2(g),u_viewport:new a.b0(g)}),globeAtmosphere:g=>({u_frustum_tl:new a.b7(g),u_frustum_tr:new a.b7(g),u_frustum_br:new a.b7(g),u_frustum_bl:new a.b7(g),u_horizon:new a.b2(g),u_transition:new a.b2(g),u_fadeout_range:new a.b2(g),u_color:new a.b9(g),u_high_color:new a.b9(g),u_space_color:new a.b9(g),u_temporal_offset:new a.b2(g),u_horizon_angle:new a.b2(g)}),model:g=>({u_matrix:new a.a_(g),u_lighting_matrix:new a.a_(g),u_normal_matrix:new a.a_(g),u_lightpos:new a.b7(g),u_lightintensity:new a.b2(g),u_lightcolor:new a.b7(g),u_camera_pos:new a.b7(g),u_opacity:new a.b2(g),u_baseColorFactor:new a.b9(g),u_emissiveFactor:new a.b9(g),u_metallicFactor:new a.b2(g),u_roughnessFactor:new a.b2(g),u_baseTextureIsAlpha:new a.a$(g),u_alphaMask:new a.a$(g),u_alphaCutoff:new a.b2(g),u_baseColorTexture:new a.a$(g),u_metallicRoughnessTexture:new a.a$(g),u_normalTexture:new a.a$(g),u_occlusionTexture:new a.a$(g),u_emissionTexture:new a.a$(g),u_color_mix:new a.b9(g),u_aoIntensity:new a.b2(g),u_emissive_strength:new a.b2(g)}),modelDepth:g=>({u_matrix:new a.a_(g),u_instance:new a.a_(g),u_node_matrix:new a.a_(g)}),groundShadow:g=>({u_matrix:new a.a_(g),u_ground_shadow_factor:new a.b7(g)}),stars:g=>({u_matrix:new a.a_(g),u_up:new a.b7(g),u_right:new a.b7(g),u_intensity_multiplier:new a.b2(g)})};let gc;function sm(g,c,d,y,b,T,S){const P=g.context,M=P.gl,D=g.transform,z=g.getOrCreateProgram("collisionBox"),F=[];let V=0,U=0;for(let ce=0;ce<y.length;ce++){const K=y[ce],ee=c.getTile(K),he=ee.getBucket(d);if(!he)continue;const ge=Fp(K,he,D);let de=ge;b[0]===0&&b[1]===0||(de=g.translatePosMatrix(ge,ee,b,T));const ye=S?he.textCollisionBox:he.iconCollisionBox,Ne=he.collisionCircleArray;if(Ne.length>0){const Ae=a.m.create(),Me=de;a.m.mul(Ae,he.placementInvProjMatrix,D.glCoordMatrix),a.m.mul(Ae,Ae,he.placementViewportMatrix),F.push({circleArray:Ne,circleOffset:U,transform:Me,invTransform:Ae,projection:he.getProjection()}),V+=Ne.length/4,U=V}ye&&(g.terrain&&g.terrain.setupElevationDraw(ee,z),z.draw(g,M.LINES,a.b4.disabled,a.b6.disabled,g.colorModeForRenderPass(),a.b5.disabled,dw(de,D,ee,he.getProjection()),d.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,null,D.zoom,null,[ye.collisionVertexBuffer,ye.collisionVertexBufferExt]))}if(!S||!F.length)return;const W=g.getOrCreateProgram("collisionCircle"),H=new a.bE;H.resize(4*V),H._trim();let q=0;for(const ce of F)for(let K=0;K<ce.circleArray.length/4;K++){const ee=4*K,he=ce.circleArray[ee+0],ge=ce.circleArray[ee+1],de=ce.circleArray[ee+2],ye=ce.circleArray[ee+3];H.emplace(q++,he,ge,de,ye,0),H.emplace(q++,he,ge,de,ye,1),H.emplace(q++,he,ge,de,ye,2),H.emplace(q++,he,ge,de,ye,3)}(!gc||gc.length<2*V)&&(gc=function(ce){const K=2*ce,ee=new a.bp;ee.resize(K),ee._trim();for(let he=0;he<K;he++){const ge=6*he;ee.uint16[ge+0]=4*he+0,ee.uint16[ge+1]=4*he+1,ee.uint16[ge+2]=4*he+2,ee.uint16[ge+3]=4*he+2,ee.uint16[ge+4]=4*he+3,ee.uint16[ge+5]=4*he+0}return ee}(V));const G=P.createIndexBuffer(gc,!0),Q=P.createVertexBuffer(H,a.bF.members,!0);for(const ce of F){const K={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(oe=D).getCameraToCenterDistance(ce.projection),u_viewport_size:[oe.width,oe.height]};W.draw(g,M.TRIANGLES,a.b4.disabled,a.b6.disabled,g.colorModeForRenderPass(),a.b5.disabled,K,d.id,Q,G,a.bm.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,D.zoom)}var oe;Q.destroy(),G.destroy()}const Sd=a.m.create();function Id({width:g,height:c,anchor:d,textOffset:y,textScale:b},T){const{horizontalAlign:S,verticalAlign:P}=a.aY(d),M=-(S-.5)*g,D=-(P-.5)*c,z=a.aW(d,y);return new a.P((M/b+z[0])*T,(D/b+z[1])*T)}function am(g,c,d,y,b,T,S,P,M,D,z){const F=g.text.placedSymbolArray,V=g.text.dynamicLayoutVertexArray,U=g.icon.dynamicLayoutVertexArray,W={},H=g.getProjection(),q=ol(P,H,T),G=T.elevation,Q=H.upVectorScale(P.canonical,T.center.lat,T.worldSize).metersToTile;V.clear();for(let oe=0;oe<F.length;oe++){const ce=F.get(oe),{tileAnchorX:K,tileAnchorY:ee,numGlyphs:he}=ce,ge=ce.hidden||!ce.crossTileID||g.allowVerticalPlacement&&!ce.placedOrientation?null:y[ce.crossTileID];if(ge){let de=0,ye=0,Ne=0;if(G){const Xe=G?G.getAtTileOffset(P,K,ee):0,[$e,bt,mt]=H.upVector(P.canonical,K,ee);de=Xe*$e*Q,ye=Xe*bt*Q,Ne=Xe*mt*Q}let[Ae,Me,xe,ze]=ci(ce.projectedAnchorX+de,ce.projectedAnchorY+ye,ce.projectedAnchorZ+Ne,d?q:S);const ke=je(T.getCameraToCenterDistance(H),ze);let Ve=b.evaluateSizeForFeature(g.textSizeData,D,ce)*ke/a.aV;d&&(Ve*=g.tilePixelRatio/M);const ne=Id(ge,Ve);d?({x:Ae,y:Me,z:xe}=H.projectTilePoint(K+ne.x,ee+ne.y,P.canonical),[Ae,Me,xe]=ci(Ae+de,Me+ye,xe+Ne,S)):(c&&ne._rotate(-T.angle),Ae+=ne.x,Me+=ne.y,xe=0);const Te=g.allowVerticalPlacement&&ce.placedOrientation===a.W.vertical?Math.PI/2:0;for(let Xe=0;Xe<he;Xe++)a.k(V,Ae,Me,xe,Te);z&&ce.associatedIconIndex>=0&&(W[ce.associatedIconIndex]={x:Ae,y:Me,z:xe,angle:Te})}else ot(he,V)}if(z){U.clear();const oe=g.icon.placedSymbolArray;for(let ce=0;ce<oe.length;ce++){const K=oe.get(ce),{numGlyphs:ee}=K,he=W[ce];if(K.hidden||!he)ot(ee,U);else{const{x:ge,y:de,z:ye,angle:Ne}=he;for(let Ae=0;Ae<ee;Ae++)a.k(U,ge,de,ye,Ne)}}g.icon.dynamicLayoutVertexBuffer.updateData(U)}g.text.dynamicLayoutVertexBuffer.updateData(V)}function lm(g,c,d){return d.iconsInText&&c?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function ln(g,c,d,y,b,T,S,P,M,D,z,F,V){const U=g.context,W=U.gl,H=g.transform,q=P==="map",G=M==="map",Q=q&&d.layout.get("symbol-placement")!=="point",oe=q&&!G&&!Q,ce=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let K=!1;const ee=g.depthModeForSublayer(0,a.b4.ReadOnly),he=[a.E(H.center.lng),a.H(H.center.lat)],ge=d.layout.get("text-variable-anchor"),de=H.projection.name==="globe",ye=[],Ne=[0,-1,0];let Ae=Ne;!de&&!H.mercatorFromTransition||q||(Ae=function(Me){const xe=Me._camera.getWorldToCamera(Me.worldSize,1),ze=a.m.multiply([],xe,Me.globeMatrix);a.m.invert(ze,ze);const ke=[0,0,0],Ve=[0,1,0,0];return a.e.transformMat4(Ve,Ve,ze),ke[0]=Ve[0],ke[1]=Ve[1],ke[2]=Ve[2],a.v.normalize(ke,ke),ke}(H));for(const Me of y){const xe=c.getTile(Me),ze=xe.getBucket(d);if(!ze||ze.projection.name==="mercator"&&de)continue;const ke=b?ze.text:ze.icon;if(!ke||ze.fullyClipped||!ke.segments.get().length)continue;const Ve=ke.programConfigurations.get(d.id),ne=b||ze.sdfIcons,Te=b?ze.textSizeData:ze.iconSizeData,Xe=G||H.pitch!==0,$e=a.i(Te,H.zoom);let bt,mt,Dt,_t,Bt=[0,0],jt=null;if(b)mt=xe.glyphAtlasTexture?xe.glyphAtlasTexture:null,Dt=W.LINEAR,bt=xe.glyphAtlasTexture?xe.glyphAtlasTexture.size:[0,0],ze.iconsInText&&(Bt=xe.imageAtlasTexture?xe.imageAtlasTexture.size:[0,0],jt=xe.imageAtlasTexture?xe.imageAtlasTexture:null,_t=Xe||g.options.rotating||g.options.zooming||Te.kind==="composite"||Te.kind==="camera"?W.LINEAR:W.NEAREST);else{const Bn=d.layout.get("icon-size").constantOr(0)!==1||ze.iconsNeedLinear;mt=xe.imageAtlasTexture?xe.imageAtlasTexture:null,Dt=ne||g.options.rotating||g.options.zooming||Bn||Xe?W.LINEAR:W.NEAREST,bt=xe.imageAtlasTexture?xe.imageAtlasTexture.size:[0,0]}const Ct=ze.projection.name==="globe",Mt=Ct?Ae:Ne,yn=Ct?a.ao(H.zoom):0,Qt=ol(Me,ze.getProjection(),H),Hn=H.calculatePixelsToTileUnitsMatrix(xe),Nn=li(Qt,xe.tileID.canonical,G,q,H,ze.getProjection(),Hn),Bi=g.terrain&&G&&Q?a.m.invert(a.m.create(),Nn):Sd,Do=pa(Qt,xe.tileID.canonical,G,q,H,ze.getProjection(),Hn),Rn=ge&&ze.hasTextData(),wn=ze.hasIconTextFit()&&Rn&&ze.hasIconData();if(Q){const Bn=H.elevation,rs=Bn?Bn.getAtTileOffsetFunc(Me,H.center.lat,H.worldSize,ze.getProjection()):null,Ts=Vs(Qt,xe.tileID.canonical,G,q,H,ze.getProjection(),Hn);tt(ze,Qt,g,b,Ts,Do,G,D,rs,Me)}const Sn=Q||b&&ge||wn,ar=g.translatePosMatrix(Qt,xe,T,S),ei=Sn?Sd:Nn,Jn=g.translatePosMatrix(Do,xe,T,S,!0),xi=ze.getProjection().createInversionMatrix(H,Me.canonical),ji=d.paint.get("icon-image-cross-fade").constantOr(0),bi=[];g.terrainRenderModeElevated()&&G&&bi.push("PITCH_WITH_MAP_TERRAIN"),Ct&&(bi.push("PROJECTION_GLOBE_VIEW"),Sn&&bi.push("PROJECTED_POS_ON_VIEWPORT")),ji>0&&bi.push("ICON_TRANSITION"),ke.zOffsetVertexBuffer&&bi.push("Z_OFFSET");const Lo=ne&&d.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let qs;ne?qs=ze.iconsInText?Fu(Te.kind,$e,oe,G,g,ar,ei,Jn,bt,Bt,Me,yn,he,xi,Mt,ze.getProjection()):Td(Te.kind,$e,oe,G,g,ar,ei,Jn,b,bt,!0,Me,yn,he,xi,Mt,ze.getProjection()):(z<1&&bi.push("SATURATION"),qs=Nu(Te.kind,$e,oe,G,g,ar,ei,Jn,b,bt,Me,yn,he,xi,Mt,ze.getProjection(),z,ji));const ns={program:g.getOrCreateProgram(lm(ne,b,ze),{config:Ve,defines:bi}),buffers:ke,uniformValues:qs,atlasTexture:mt,atlasTextureIcon:jt,atlasInterpolation:Dt,atlasInterpolationIcon:_t,isSDF:ne,hasHalo:Lo,tile:xe,labelPlaneMatrixInv:Bi};if(ce&&ze.canOverlap){K=!0;const Bn=ke.segments.get();for(const rs of Bn)ye.push({segments:new a.bm([rs]),sortKey:rs.sortKey,state:ns})}else ye.push({segments:ke.segments,sortKey:0,state:ns})}K&&ye.sort((Me,xe)=>Me.sortKey-xe.sortKey);for(const Me of ye){const xe=Me.state;if(g.terrain&&g.terrain.setupElevationDraw(xe.tile,xe.program,{useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:xe.labelPlaneMatrixInv}),U.activeTexture.set(W.TEXTURE0),xe.atlasTexture&&xe.atlasTexture.bind(xe.atlasInterpolation,W.CLAMP_TO_EDGE,!0),xe.atlasTextureIcon&&(U.activeTexture.set(W.TEXTURE1),xe.atlasTextureIcon&&xe.atlasTextureIcon.bind(xe.atlasInterpolationIcon,W.CLAMP_TO_EDGE,!0)),g.uploadCommonLightUniforms(g.context,xe.program),xe.hasHalo){const ze=xe.uniformValues;ze.u_is_halo=1,Ad(xe.buffers,Me.segments,d,g,xe.program,ee,F,V,ze,2),ze.u_is_halo=0}else{if(xe.isSDF){const ze=xe.uniformValues;xe.hasHalo&&(ze.u_is_halo=1,Ad(xe.buffers,Me.segments,d,g,xe.program,ee,F,V,ze,1)),ze.u_is_halo=0}Ad(xe.buffers,Me.segments,d,g,xe.program,ee,F,V,xe.uniformValues,1)}}}function Ad(g,c,d,y,b,T,S,P,M,D){const z=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];b.draw(y,y.context.gl.TRIANGLES,T,S,P,a.b5.disabled,M,d.id,g.layoutVertexBuffer,g.indexBuffer,c,d.paint,y.transform.zoom,g.programConfigurations.get(d.id),z,D)}function ju(g,c,d,y,b,T,S){const P=g.context.gl,M=d.paint.get("fill-pattern"),D=M&&M.constantOr(1);let z,F,V,U,W;S?(F=D&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=P.LINES):(F=D?"fillPattern":"fill",z=P.TRIANGLES);for(const H of y){const q=c.getTile(H);if(D&&!q.patternsLoaded())continue;const G=q.getBucket(d);if(!G)continue;g.prepareDrawTile();const Q=G.programConfigurations.get(d.id),oe=g.isTileAffectedByFog(H),ce=g.getOrCreateProgram(F,{config:Q,overrideFog:oe});D&&(g.context.activeTexture.set(P.TEXTURE0),q.imageAtlasTexture&&q.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Q.updatePaintBuffers());const K=M.constantOr(null);if(K&&q.imageAtlas){const ge=q.imageAtlas.patternPositions[K.toString()];ge&&Q.setConstantPatternPositions(ge)}const ee=g.translatePosMatrix(H.projMatrix,q,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor")),he=d.paint.get("fill-emissive-strength");if(S){U=G.indexBuffer2,W=G.segments2;const ge=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[P.drawingBufferWidth,P.drawingBufferHeight];V=F==="fillOutlinePattern"&&D?hw(ee,he,g,q,ge):im(ee,he,ge)}else U=G.indexBuffer,W=G.segments,V=D?rm(ee,he,g,q):nm(ee,he);g.uploadCommonUniforms(g.context,ce,H.toUnwrapped()),ce.draw(g,z,b,g.stencilModeForClipping(H),T,a.b5.disabled,V,d.id,G.layoutVertexBuffer,U,W,d.paint,g.transform.zoom,Q,void 0)}}function Vu(g,c,d,y,b,T,S,P){d.resetLayerRenderingStats();const M=g.context,D=M.gl,z=g.transform,F=d.paint.get("fill-extrusion-pattern"),V=F.constantOr(1),U=d.paint.get("fill-extrusion-opacity"),W=g.style.enable3dLights(),H=d.paint.get(W&&!V?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),q=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),H],G=d.layout.get("fill-extrusion-edge-radius"),Q=G>0&&!d.paint.get("fill-extrusion-rounded-roof"),oe=Q?0:G,ce=z.projection.name==="globe"?a.bO():0,K=z.projection.name==="globe",ee=K?a.ao(z.zoom):0,he=[a.E(z.center.lng),a.H(z.center.lat)],ge=d.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),de=d.paint.get("fill-extrusion-flood-light-intensity"),ye=d.paint.get("fill-extrusion-vertical-scale"),Ne=ll(g,d.paint.get("fill-extrusion-cutoff-fade-range")),Ae=d.paint.get("fill-extrusion-emissive-strength"),Me=[];let xe;K&&Me.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&Me.push("FAUX_AO"),Q&&Me.push("ZERO_ROOF_RADIUS"),P&&Me.push("HAS_CENTROID"),de>0&&Me.push("FLOOD_LIGHT"),Ne.shouldRenderCutoff&&Me.push("RENDER_CUTOFF");const ze=g.renderPass==="shadow",ke=g.shadowRenderer,Ve=ze&&!!ke;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let ne=[0,0,0];if(ke){const $e=g.style.directionalLight,bt=g.style.ambientLight;$e&&bt&&(ne=Cd($e,bt)),xe=Me.concat(["SHADOWS_SINGLE_CASCADE"])}const Te=Ve?"fillExtrusionDepth":V?"fillExtrusionPattern":"fillExtrusion",Xe=d.getLayerRenderingStats();for(const $e of y){const bt=c.getTile($e),mt=bt.getBucket(d);if(!mt||mt.projection.name!==z.projection.name)continue;let Dt=!1;ke&&(Dt=ke.getMaxCascadeForTile($e.toUnwrapped())===0);const _t=g.isTileAffectedByFog($e),Bt=mt.programConfigurations.get(d.id),jt=g.getOrCreateProgram(Te,{config:Bt,defines:Dt?xe:Me,overrideFog:_t});if(g.terrain&&g.terrain.setupElevationDraw(bt,jt,{useMeterToDem:!0}),!mt.centroidVertexBuffer){const Nn=jt.attributes.a_centroid_pos;Nn!==void 0&&D.vertexAttrib2f(Nn,0,0)}!ze&&ke&&ke.setupShadows(bt.tileID.toUnwrapped(),jt,"vector-tile",bt.tileID.overscaledZ),V&&(g.context.activeTexture.set(D.TEXTURE0),bt.imageAtlasTexture&&bt.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Bt.updatePaintBuffers());const Ct=F.constantOr(null);if(Ct&&bt.imageAtlas){const Nn=bt.imageAtlas.patternPositions[Ct.toString()];Nn&&Bt.setConstantPatternPositions(Nn)}const Mt=d.paint.get("fill-extrusion-vertical-gradient");let yn;if(ze&&ke){if(gw(bt.tileID,mt,g))continue;const Nn=ke.calculateShadowPassMatrixFromTile(bt.tileID.toUnwrapped());yn=tm(Nn,oe,ye)}else{const Nn=g.translatePosMatrix($e.expandedProjMatrix,bt,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Bi=z.projection.createInversionMatrix(z,$e.canonical);yn=V?uw(Nn,g,Mt,U,q,oe,$e,bt,ce,ee,he,Bi,ge,ye):cl(Nn,g,Mt,U,q,oe,$e,ce,ee,he,Bi,ge,ye,de,ne,Ae)}g.uploadCommonUniforms(M,jt,$e.toUnwrapped(),null,Ne);let Qt=mt.segments;if(z.projection.name==="mercator"&&!ze&&(Qt=mt.getVisibleSegments(bt.tileID,g.terrain,g.transform.getFrustum(0)),!Qt.get().length))continue;if(Xe)if(ze)for(const Nn of Qt.get())Xe.numRenderedVerticesInShadowPass+=Nn.primitiveLength;else for(const Nn of Qt.get())Xe.numRenderedVerticesInTransparentPass+=Nn.primitiveLength;const Hn=[];(g.terrain||P)&&Hn.push(mt.centroidVertexBuffer),K&&Hn.push(mt.layoutVertexExtBuffer),jt.draw(g,M.gl.TRIANGLES,b,T,S,a.b5.backCCW,yn,d.id,mt.layoutVertexBuffer,mt.indexBuffer,Qt,d.paint,g.transform.zoom,Bt,Hn)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function hl(g,c,d,y,b,T,S,P,M,D,z,F,V,U,W,H,q,G,Q){const oe=g.context,ce=oe.gl,K=g.transform,ee=g.transform.zoom,he=[],ge=ll(g,d.paint.get("fill-extrusion-cutoff-fade-range"));D==="clear"?(he.push("CLEAR_SUBPASS"),Q&&(he.push("CLEAR_FROM_TEXTURE"),oe.activeTexture.set(ce.TEXTURE0),Q.bind(ce.LINEAR,ce.CLAMP_TO_EDGE))):D==="sdf"&&he.push("SDF_SUBPASS"),q&&he.push("HAS_CENTROID"),ge.shouldRenderCutoff&&he.push("RENDER_CUTOFF");const de=d.layout.get("fill-extrusion-edge-radius"),ye=(Ne,Ae,Me,xe,ze)=>{const ke=Ae.programConfigurations.get(d.id),Ve=g.isTileAffectedByFog(Ne),ne=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:ke,defines:he,overrideFog:Ve}),Te=(($e,bt,mt,Dt,_t,Bt,jt,Ct,Mt,yn,Qt)=>({u_matrix:bt,u_opacity:mt,u_ao_pass:Dt?1:0,u_meter_to_tile:_t,u_ao:Bt,u_flood_light_intensity:jt,u_flood_light_color:Ct,u_attenuation:Mt,u_edge_radius:yn,u_fb:0,u_fb_size:Qt}))(0,xe,z,M,ze,[F,V*ze],U,W,H,ee>=17?0:de*ze,Q?Q.size[0]:0),Xe=[];q&&Xe.push(Ae.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(oe,ne,Ne.toUnwrapped(),null,ge),ne.draw(g,oe.gl.TRIANGLES,b,T,S,P,Te,d.id,Ae.vertexBuffer,Ae.indexBuffer,Me,d.paint,ee,ke,Xe)};for(const Ne of y){const Ae=c.getTile(Ne),Me=Ae.getBucket(d);if(!Me||Me.projection.name!==K.projection.name||!Me.groundEffect||Me.groundEffect&&!Me.groundEffect.hasData())continue;const xe=Me.groundEffect,ze=1/Me.tileToMeter;{const ke=g.translatePosMatrix(Ne.projMatrix,Ae,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Ve=xe.getDefaultSegment();ye(Ne,xe,Ve,ke,ze)}if(G)for(let ke=0;ke<4;ke++){const Ve=a.bP[ke](Ne),ne=c.getTile(Ve);if(!ne)continue;const Te=ne.getBucket(d);if(!Te||Te.projection.name!==K.projection.name||!Te.groundEffect||Te.groundEffect&&!Te.groundEffect.hasData())continue;const Xe=Te.groundEffect;let $e,bt;ke===0?($e=[-a.J,0,0],bt=1):ke===1?($e=[a.J,0,0],bt=0):ke===2?($e=[0,-a.J,0],bt=3):($e=[0,a.J,0],bt=2);const mt=Xe.regionSegments[bt];if(!mt)continue;const Dt=new Float32Array(16);a.m.translate(Dt,Ne.projMatrix,$e),ye(Ne,Xe,mt,g.translatePosMatrix(Dt,Ae,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),ze)}}}function Hy(g,c,d,y,b,T,S){y.centroidVertexArray.length===0&&y.createCentroidsBuffer();const P=T?T.findDEMTileFor(d):null;if(!(P&&P.dem||S))return;const M=G=>new a.P(Math.ceil((G+a.bS)*a.bT),0),D=G=>{const Q=c.getSource().minzoom,oe=K=>{const ee=c.getTileByID(K);if(ee&&ee.hasData())return ee.getBucket(b)},ce=[0,-1,1];for(const K of ce){if(G.overscaledZ+K<Q)continue;const ee=oe(G.calculateScaledKey(G.overscaledZ+K));if(ee)return ee}},z=[0,0,0],F=(G,Q)=>(z[0]=Math.min(G.min.y,Q.min.y),z[1]=Math.max(G.max.y,Q.max.y),z[2]=a.J-Q.min.x>G.max.x?Q.min.x-a.J:G.max.x,z),V=(G,Q)=>(z[0]=Math.min(G.min.x,Q.min.x),z[1]=Math.max(G.max.x,Q.max.x),z[2]=a.J-Q.min.y>G.max.y?Q.min.y-a.J:G.max.y,z),U=[(G,Q)=>F(G,Q),(G,Q)=>F(Q,G),(G,Q)=>V(G,Q),(G,Q)=>V(Q,G)],W=(G,Q,oe,ce,K,ee,he)=>{if(!T)return 0;const ge=[[ee?oe:G,ee?G:oe,0],[ee?oe:Q,ee?Q:oe,0]],de=he<0?a.J+he:he,ye=[ee?de:(G+Q)/2,ee?(G+Q)/2:de,0];return oe===0&&he<0||oe!==0&&he>0?T.getForTilePoints(K,[ye],!0,ce):ge.push(ye),T.getForTilePoints(d,ge,!0,P),Math.max(ge[0][2],ge[1][2],ye[2])/T.exaggeration()};for(let G=0;G<4;G++){const Q=y.borderFeatureIndices[G];if(Q.length===0)continue;const oe=a.bP[G](d),ce=D(oe);if(!(ce&&ce instanceof a.bQ)||y.borderDoneWithNeighborZ[G]===ce.canonical.z)continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const K=T?T.findDEMTileFor(oe):null;if(!(K&&K.dem||S))continue;const ee=(G<2?1:5)-G,he=ce.borderDoneWithNeighborZ[ee]!==y.canonical.z,ge=ce.borderFeatureIndices[ee];let de=0;if(y.canonical.z!==ce.canonical.z){for(const ye of Q)y.showCentroid(y.featuresOnBorder[ye]);if(he)for(const ye of ge)ce.showCentroid(ce.featuresOnBorder[ye]);y.borderDoneWithNeighborZ[G]=ce.canonical.z,ce.borderDoneWithNeighborZ[ee]=y.canonical.z}for(const ye of Q){const Ne=y.featuresOnBorder[ye],Ae=y.centroidData[Ne.centroidDataIndex],Me=Ne.borders[G];let xe;for(;de<ge.length;){xe=ce.featuresOnBorder[ge[de]];const ze=xe.borders[ee];if(ze[1]>Me[0]+3||ze[0]>Me[0]-3)break;ce.showCentroid(xe),de++}if(xe&&de<ge.length){const ze=de;let ke=0;for(;!(xe.borders[ee][0]>Me[1]-3)&&(ke++,++de!==ge.length);)xe=ce.featuresOnBorder[ge[de]];if(xe=ce.featuresOnBorder[ge[ze]],ke>1){const Te=xe.borders[ee];Math.abs(Me[0]-Te[0])<3&&Math.abs(Me[1]-Te[1])<3&&(ke=1,de=ze+1)}else if(ke===0){y.showCentroid(Ne);continue}const Ve=ce.centroidData[xe.centroidDataIndex];S&&ke===1&&(((H=Ae).flags|(q=Ve).flags)&a.bR?(H.flags|=a.bR,q.flags|=a.bR):(H.flags&=~a.bR,q.flags&=~a.bR));const ne=Ne.intersectsCount()>1||xe.intersectsCount()>1;if(ke>1)de=ze,Ae.centroidXY=Ve.centroidXY=new a.P(0,0);else if(K&&K.dem&&!ne){const Te=U[G](Ae,Ve),Xe=G%2?a.J-1:0,$e=W(Te[0],Math.min(a.J-1,Te[1]),Xe,K,oe,G<2,Te[2]);Ae.centroidXY=Ve.centroidXY=M($e)}else ne?Ae.centroidXY=Ve.centroidXY=new a.P(0,0):(Ae.centroidXY=y.encodeBorderCentroid(Ne),Ve.centroidXY=ce.encodeBorderCentroid(xe));y.writeCentroidToBuffer(Ae),ce.writeCentroidToBuffer(Ve)}else y.showCentroid(Ne)}y.borderDoneWithNeighborZ[G]=ce.canonical.z,ce.borderDoneWithNeighborZ[ee]=y.canonical.z}var H,q;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(g)}const _c=[1,0,0],Zy=[0,1,0],mw=[0,0,1];function gw(g,c,d){const y=d.transform,b=d.shadowRenderer;if(!b)return!0;const T=g.toUnwrapped(),S=y.tileSize*b._cascades[d.currentShadowCascade].scale;let P=c.maxHeight;if(y.elevation){const H=y.elevation.getMinMaxForTile(g);H&&(P+=H.max)}const M=[...b.shadowDirection];M[2]=-M[2];const D=b.computeSimplifiedTileShadowVolume(T,P,S,M);if(!D)return!1;const z=[_c,Zy,mw,M,[M[0],0,M[2]],[0,M[1],M[2]]],F=y.projection.name==="globe",V=y.scaleZoom(S),U=a.F.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,V,!F),W=b.getCurrentCascadeFrustum();return U.intersectsPrecise(D.vertices,D.planes,z)===0||W.intersectsPrecise(D.vertices,D.planes,z)===0}function _w(g){const c=g._nearZ,d=g.projection.farthestPixelDistance(g),y=d-c,b=.2*g.height,T=c+b;return[c,d,(T-b-c)/y,(T-c)/y]}const cm=new a.C(1,0,0,1),um=new a.C(0,1,0,1),hm=new a.C(0,0,1,1),dm=new a.C(1,0,1,1),Xy=new a.C(0,1,1,1);function dl(g,c,d,y,b,T){const S=g.context,P=g.transform,M=S.gl,D=P.projection.name==="globe",z=D?["PROJECTION_GLOBE_VIEW"]:[];let F=a.m.clone(d.projMatrix);if(D&&a.ao(P.zoom)>0){const xe=a.bU(d.canonical,P),ze=a.bV(xe);F=a.m.multiply(new Float32Array(16),P.globeMatrix,ze),a.m.multiply(F,P.projMatrix,F)}const V=a.m.create();V[12]+=2*b/(a.a4.devicePixelRatio*P.width),V[13]+=2*T/(a.a4.devicePixelRatio*P.height),a.m.multiply(F,V,F);const U=g.getOrCreateProgram("debug",{defines:z}),W=c.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(W,U);const H=a.b4.disabled,q=a.b6.disabled,G=g.colorModeForRenderPass(),Q="$debug";S.activeTexture.set(M.TEXTURE0),g.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),D?W._makeGlobeTileDebugBuffers(g.context,P):W._makeDebugTileBoundsBuffers(g.context,P.projection);const oe=W._tileDebugBuffer||g.debugBuffer,ce=W._tileDebugIndexBuffer||g.debugIndexBuffer,K=W._tileDebugSegments||g.debugSegments;U.draw(g,M.LINE_STRIP,H,q,G,a.b5.disabled,Uy(F,y),Q,oe,ce,K,null,null,null,[W._globeTileDebugBorderBuffer]);const ee=W.latestRawTileData,he=Math.floor((ee&&ee.byteLength||0)/1024),ge=c.getTile(d).tileSize,de=512/Math.min(ge,512)*(d.overscaledZ/P.zoom)*.5;let ye=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ye+=` => ${d.overscaledZ}`),ye+=` ${he}kb`,function(xe,ze){xe.initDebugOverlayCanvas();const ke=xe.debugOverlayCanvas,Ve=xe.context.gl,ne=xe.debugOverlayCanvas.getContext("2d");ne.clearRect(0,0,ke.width,ke.height),ne.shadowColor="white",ne.shadowBlur=2,ne.lineWidth=1.5,ne.strokeStyle="white",ne.textBaseline="top",ne.font="bold 36px Open Sans, sans-serif",ne.fillText(ze,5,5),ne.strokeText(ze,5,5),xe.debugOverlayTexture.update(ke),xe.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(g,ye);const Ne=W._tileDebugTextBuffer||g.debugBuffer,Ae=W._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Me=W._tileDebugTextSegments||g.debugSegments;U.draw(g,M.TRIANGLES,H,q,a.a.alphaBlended,a.b5.disabled,Uy(F,a.C.transparent,de),Q,Ne,Ae,Me,null,null,null,[W._globeTileDebugTextBuffer])}function Yy(g,c,d,y){ba(g,0,c+d/2,g.transform.width,d,y)}function yc(g,c,d,y){ba(g,c-d/2,0,d,g.transform.height,y)}function ba(g,c,d,y,b,T){const S=g.context,P=S.gl;P.enable(P.SCISSOR_TEST),P.scissor(c*a.a4.devicePixelRatio,d*a.a4.devicePixelRatio,y*a.a4.devicePixelRatio,b*a.a4.devicePixelRatio),S.clear({color:T}),P.disable(P.SCISSOR_TEST)}const Ky=a.bW([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Pd}=Ky;function bs(g,c,d,y){g.emplaceBack(c,d,y)}class es{constructor(c){this.vertexArray=new a.bX,this.indices=new a.bp,bs(this.vertexArray,-1,-1,1),bs(this.vertexArray,1,-1,1),bs(this.vertexArray,-1,1,1),bs(this.vertexArray,1,1,1),bs(this.vertexArray,-1,-1,-1),bs(this.vertexArray,1,-1,-1),bs(this.vertexArray,-1,1,-1),bs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Pd),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=a.bm.simpleSegment(0,0,36,12)}}function wa(g,c,d,y,b,T){const S=g.context.gl,P=c.paint.get("sky-atmosphere-color"),M=c.paint.get("sky-atmosphere-halo-color"),D=c.paint.get("sky-atmosphere-sun-intensity"),z=((F,V,U,W,H)=>({u_matrix_3f:F,u_sun_direction:V,u_sun_intensity:U,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(a.bx.fromMat4(a.bx.create(),y),b,D,P,M);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+T,c.skyboxTexture,0),d.draw(g,S.TRIANGLES,a.b4.disabled,a.b6.disabled,a.a.unblended,a.b5.frontCW,z,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Jy=a.bW([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class fm{constructor(c){const d=new a.bY;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const y=new a.bp;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(d,Jy.members),this.indexBuffer=c.createIndexBuffer(y),this.segments=a.bm.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Qy=a.bW([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class pm{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15}}class yw{constructor(c){this.colorModeAlphaBlendedWriteRGB=new a.a([a.bZ,a.b_,a.bZ,a.b_],a.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new a.a([a.bZ,a.b$,a.bZ,a.b$],a.C.transparent,[!1,!1,!1,!0]),this.params=new pm,this.allocatedStarsCount=0,c.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1}),c.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01})}update(c){const d=c.context;if(!this.atmosphereBuffer||this.allocatedStarsCount!==this.params.starsCount){this.atmosphereBuffer=new fm(d),this.allocatedStarsCount=this.params.starsCount;const y=100,b=200,T=function(z){const F=a.c2(30),V=[];for(let U=0;U<z;++U){const W=2*Math.PI*F(),H=Math.acos(1-2*F())-.5*Math.PI;V.push(a.v.fromValues(Math.cos(H)*Math.cos(W),Math.cos(H)*Math.sin(W),Math.sin(H)))}return V}(this.allocatedStarsCount),S=a.c2(300),P=new a.c0,M=new a.bp;let D=0;for(let z=0;z<T.length;++z){const F=a.v.scale([],T[z],200),V=Math.max(0,1+.01*y*(1*S()-.5)),U=Math.max(0,1+.01*b*(1*S()-.5));P.emplaceBack(F[0],F[1],F[2],-1,-1,V,U),P.emplaceBack(F[0],F[1],F[2],1,-1,V,U),P.emplaceBack(F[0],F[1],F[2],1,1,V,U),P.emplaceBack(F[0],F[1],F[2],-1,1,V,U),M.emplaceBack(D+0,D+1,D+2),M.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=d.createVertexBuffer(P,Qy.members),this.starsIdx=d.createIndexBuffer(M),this.starsSegments=a.bm.simpleSegment(0,0,P.length,M.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(c,d){const y=c.context,b=y.gl,T=c.transform,S=new a.b4(b.LEQUAL,a.b4.ReadOnly,[0,1]),P=a.ao(T.zoom),M=d.properties.get("color").toArray01(),D=d.properties.get("high-color").toArray01(),z=d.properties.get("space-color").toArray01PremultipliedAlpha(),F=5e-4,V=a.c1(d.properties.get("horizon-blend"),0,1,F,.25),U=a.bb(c,y,T)&&V===F?T.worldSize/(2*Math.PI*1.025)-1:T.globeRadius,W=c.frameCounter/1e3%1,H=a.v.length(T.globeCenterInViewSpace),q=Math.sqrt(Math.pow(H,2)-Math.pow(U,2)),G=Math.acos(q/H),Q=oe=>{const ce=T.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];oe&&ce.push("ALPHA_PASS");const K=c.getOrCreateProgram("globeAtmosphere",{defines:ce}),ee=((ge,de,ye,Ne,Ae,Me,xe,ze,ke,Ve,ne,Te)=>({u_frustum_tl:ge,u_frustum_tr:de,u_frustum_br:ye,u_frustum_bl:Ne,u_horizon:Ae,u_transition:Me,u_fadeout_range:xe,u_color:ze,u_high_color:ke,u_space_color:Ve,u_temporal_offset:ne,u_horizon_angle:Te}))(T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.frustumCorners.horizon,P,V,M,D,z,W,G);c.uploadCommonUniforms(y,K);const he=this.atmosphereBuffer;he&&K.draw(c,b.TRIANGLES,S,a.b6.disabled,oe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,a.b5.backCW,ee,oe?"atmosphere_glow_alpha":"atmosphere_glow",he.vertexBuffer,he.indexBuffer,he.segments)};Q(!1),Q(!0)}drawStars(c,d){const y=a.c(d.properties.get("star-intensity"),0,1);if(y===0)return;const b=c.context,T=b.gl,S=c.transform,P=c.getOrCreateProgram("stars"),M=a.q.identity([]);a.q.rotateX(M,M,-S._pitch),a.q.rotateZ(M,M,-S.angle),a.q.rotateX(M,M,a.d(S._center.lat)),a.q.rotateY(M,M,-a.d(S._center.lng));const D=a.m.fromQuat(new Float32Array(16),M),z=a.m.multiply([],S.starsProjMatrix,D),F=a.bx.fromMat4([],D),V=a.bx.invert([],F),U=[0,1,0];a.v.transformMat3(U,U,V),a.v.scale(U,U,this.params.sizeMultiplier);const W=[1,0,0];a.v.transformMat3(W,W,V),a.v.scale(W,W,this.params.sizeMultiplier);const H=(q=U,G=W,Q=y,{u_matrix:Float32Array.from(z),u_up:q,u_right:G,u_intensity_multiplier:Q});var q,G,Q;c.uploadCommonUniforms(b,P),this.starsVx&&this.starsIdx&&P.draw(c,T.TRIANGLES,a.b4.disabled,a.b6.disabled,this.colorModeAlphaBlendedWriteRGB,a.b5.disabled,H,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function kd(g,c){const d=[...g],y=c.cameraWorldSizeForFog/c.worldSize,b=a.m.identity([]);return a.m.scale(b,b,[y,y,1]),a.m.multiply(d,b,d),a.m.multiply(d,c.worldToFogMatrix,d),d}function mm(g,c,d,y){const b=d.material,T=y.context,{baseColorTexture:S,metallicRoughnessTexture:P}=b.pbrMetallicRoughness,{normalTexture:M,occlusionTexture:D,emissionTexture:z}=b;function F(V,U,W){if(V&&(g.push(U),T.activeTexture.set(T.gl.TEXTURE0+W),V.gfxTexture)){const{minFilter:H,magFilter:q,wrapS:G,wrapT:Q}=V.sampler;V.gfxTexture.bindExtraParam(H,q,G,Q)}}F(S,"HAS_TEXTURE_u_baseColorTexture",ui.BaseColor),F(P,"HAS_TEXTURE_u_metallicRoughnessTexture",ui.MetallicRoughness),F(M,"HAS_TEXTURE_u_normalTexture",ui.Normal),F(D,"HAS_TEXTURE_u_occlusionTexture",ui.Occlusion),F(z,"HAS_TEXTURE_u_emissionTexture",ui.Emission),d.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),c.push(d.texcoordBuffer)),d.colorBuffer&&(g.push(d.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),c.push(d.colorBuffer)),d.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),c.push(d.normalBuffer)),d.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),c.push(d.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||g.push("DIFFUSE_SHADED"),g.push("USE_STANDARD_DERIVATIVES")}function fl(g,c,d,y,b,T){const S=d.paint.get("model-opacity"),P=c.context,M=new a.b4(c.context.gl.LEQUAL,a.b4.ReadWrite,c.depthRangeFor3D),D=c.transform,z=g.mesh,F=z.material,V=F.pbrMetallicRoughness,U=c.style.fog;let W;W=c.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:a.m.multiply([],y.zScaleMatrix,g.nodeModelMatrix),a.m.multiply(W,y.negCameraPosMatrix,W);const H=a.m.invert([],W);a.m.transpose(H,H);const q=d.paint.get("model-emissive-strength").constantOr(0),G=Bu(new Float32Array(g.worldViewProjection),new Float32Array(W),new Float32Array(H),c,S,V.baseColorFactor,F.emissiveFactor,V.metallicFactor,V.roughnessFactor,F,q,d),Q={defines:[]},oe=[];mm(Q.defines,oe,z,c);const ce=c.shadowRenderer;ce&&(ce.useNormalOffset=!1);let K=null;if(U){const ge=kd(g.nodeModelMatrix,c.transform);if(K=new Float32Array(ge),D.projection.name!=="globe"){const de=z.aabb.min,ye=z.aabb.max,[Ne,Ae]=U.getOpacityForBounds(ge,de[0],de[1],ye[0],ye[1]);Q.overrideFog=Ne>=Ki||Ae>=Ki}}const ee=ll(c,d.paint.get("model-cutoff-fade-range"));ee.shouldRenderCutoff&&Q.defines.push("RENDER_CUTOFF");const he=c.getOrCreateProgram("model",Q);c.uploadCommonUniforms(P,he,null,K,ee),c.renderPass!=="shadow"&&ce&&ce.setupShadowsFromMatrix(g.nodeModelMatrix,he),he.draw(c,P.gl.TRIANGLES,M,b,T,z.material.doubleSided?a.b5.disabled:a.b5.backCCW,G,d.id,z.vertexBuffer,z.indexBuffer,z.segments,d.paint,c.transform.zoom,void 0,oe)}function e0(g,c,d,y,b,T,S){let P;P=g.projection.name==="globe"?a.c5(d,g):[...d],a.m.multiply(P,P,c.matrix);const M=a.m.multiply([],y,P);if(c.meshes)for(const D of c.meshes){if(D.material.alphaMode!=="BLEND"){S.push({mesh:D,depth:0,modelIndex:b,worldViewProjection:M,nodeModelMatrix:P});continue}const z=a.v.transformMat4([],D.centroid,M);z[2]>0&&T.push({mesh:D,depth:z[2],modelIndex:b,worldViewProjection:M,nodeModelMatrix:P})}if(c.children)for(const D of c.children)e0(g,D,d,y,b,T,S)}function Uu(g,c,d,y){const b=d.shadowRenderer;if(!b)return;const T=b.getShadowPassDepthMode(),S=b.getShadowPassColorMode(),P=b.calculateShadowPassMatrixFromMatrix(c),M=Ed(P);d.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(d,d.context.gl.TRIANGLES,T,a.b6.disabled,S,a.b5.backCCW,M,y.id,g.vertexBuffer,g.indexBuffer,g.segments,y.paint,d.transform.zoom,void 0,void 0)}function vw(g,c,d){const y=c.updateZoomBasedPaintProperties(),b=function(T,S,P){let M,D,z,F=T.terrain?T.terrain.exaggeration():0;if(T.terrain&&F>0){const V=T.terrain,U=V.findDEMTileFor(P);U&&U.dem?M=a.c7.create(V,P,U):F=0}if(F===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),F===S.validForExaggeration&&(F===0||M&&M._demTile&&M._demTile.tileID===S.validForDEMTile.id&&M._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const V in S.instancesPerModel){const U=S.instancesPerModel[V];for(let W=0;W<U.instancedDataArray.length;++W){const H=(M?F*M.getElevationAt(0|U.instancedDataArray.float32[16*W],0|U.instancedDataArray.float32[16*W+1],!0,!0):0)+U.instancesEvaluatedElevation[W];U.instancedDataArray.float32[16*W+6]=H,D=D?Math.min(S.terrainElevationMin,H):H,z=z?Math.max(S.terrainElevationMax,H):H}}return S.terrainElevationMin=D||0,S.terrainElevationMax=z||0,S.validForExaggeration=F,S.validForDEMTile=M&&M._demTile?{id:M._demTile.tileID,timestamp:M._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,c,d);(y||b)&&(c.uploaded=!1,c.upload(g.context))}const Ro={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.c3([0,0,0],[a.J,a.J,0])};function xw(g,c){const d=1<<g.canonical.z,y=c.getFreeCameraOptions().position,b=c.elevation,T=g.canonical.x/d,S=(g.canonical.x+1)/d,P=g.canonical.y/d,M=(g.canonical.y+1)/d;let D=c._centerAltitude;if(b){const U=b.getMinMaxForTile(g);U&&U.max>D&&(D=U.max)}const z=a.c(y.x,T,S)-y.x,F=a.c(y.y,P,M)-y.y,V=a.b(D,c.center.lat)-y.z;return c._zoomFromMercatorZ(Math.sqrt(z*z+F*F+V*V))}function $u(g,c,d,y,b,T,S){const P=g.context,M=g.renderPass==="shadow",D=g.shadowRenderer,z=M&&D?D.getShadowPassDepthMode():new a.b4(P.gl.LEQUAL,a.b4.ReadWrite,g.depthRangeFor3D),F=g.isTileAffectedByFog(T);if(d.meshes)for(const V of d.meshes){const U=["MODEL_POSITION_ON_GPU"],W=[];let H,q,G;y.instancedDataArray.length>20&&U.push("INSTANCED_ARRAYS");const Q=ll(g,c.paint.get("model-cutoff-fade-range"));if(Q.shouldRenderCutoff&&U.push("RENDER_CUTOFF"),M&&D)H=g.getOrCreateProgram("modelDepth",{defines:U}),q=Ed(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(d.matrix)),G=D.getShadowPassColorMode();else{mm(U,W,V,g),H=g.getOrCreateProgram("model",{defines:U,overrideFog:F});const ce=V.material,K=ce.pbrMetallicRoughness,ee=c.paint.get("model-opacity"),he=c.paint.get("model-emissive-strength").constantOr(0);q=Bu(T.expandedProjMatrix,Float32Array.from(d.matrix),new Float32Array(16),g,ee,K.baseColorFactor,ce.emissiveFactor,K.metallicFactor,K.roughnessFactor,ce,he,c,b),D&&(S.shadowUniformsInitialized?H.setShadowUniformValues(P,D.getShadowUniformValues()):(D.setupShadows(T.toUnwrapped(),H,"model-tile",T.overscaledZ),S.shadowUniformsInitialized=!0)),G=Q.shouldRenderCutoff||ee<1||ce.alphaMode!=="OPAQUE"?a.a.alphaBlended:a.a.unblended}g.uploadCommonUniforms(P,H,T.toUnwrapped(),null,Q);const oe=V.material.doubleSided?a.b5.disabled:a.b5.backCCW;if(y.instancedDataArray.length>20)W.push(y.instancedDataBuffer),H.draw(g,P.gl.TRIANGLES,z,a.b6.disabled,G,oe,q,c.id,V.vertexBuffer,V.indexBuffer,V.segments,c.paint,g.transform.zoom,void 0,W,y.instancedDataArray.length);else{const ce=M?"u_instance":"u_normal_matrix";for(let K=0;K<y.instancedDataArray.length;++K)q[ce]=new Float32Array(y.instancedDataArray.arrayBuffer,64*K,16),H.draw(g,P.gl.TRIANGLES,z,a.b6.disabled,G,oe,q,c.id,V.vertexBuffer,V.indexBuffer,V.segments,c.paint,g.transform.zoom,void 0,W)}}if(d.children)for(const V of d.children)$u(g,c,V,y,b,T,S)}const bw=[1,-1,1];function t0(g,c,d,y){if(!d.modelManager)return!0;const b=d.modelManager;if(!d.shadowRenderer)return!0;const T=d.shadowRenderer,S=c.aabb;let P=!0,M=g.maxHeight;if(M===0){let z=0;for(const F in g.instancesPerModel){const V=b.getModel(F,y);V?z=Math.max(z,Math.max(Math.max(V.aabb.max[0],V.aabb.max[1]),V.aabb.max[2])):P=!1}M=g.maxScale*z*1.41+g.maxVerticalOffset,P&&(g.maxHeight=M)}S.max[2]=M,S.min[2]+=g.terrainElevationMin,S.max[2]+=g.terrainElevationMax,a.v.transformMat4(S.min,S.min,c.tileMatrix),a.v.transformMat4(S.max,S.max,c.tileMatrix);const D=S.intersects(T.getCurrentCascadeFrustum());return d.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=D===2),D===0}class n0{}class vc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(c,d,y){{const F=this._storage.get(d.id);if(F)return F.lastUsedFrameIdx=c,F.buf}const b=y.gl,T=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),S=new ArrayBuffer(T),P=new Int16Array(S);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const M=new a.c9;for(let F=0;F<T/2;F+=3){const V=P[F],U=P[F+1],W=P[F+2];M.emplaceBack(V,U),M.emplaceBack(U,W),M.emplaceBack(W,V)}const D=y.bindVertexArrayOES.current,z=new n0;return z.buf=new a.I(y,M),z.lastUsedFrameIdx=c,this._storage.set(d.id,z),y.bindVertexArrayOES.set(D),z.buf}update(c){for(const[d,y]of this._storage)c-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(d))}destroy(){for(const[c,d]of this._storage)d.buf.destroy(),this._storage.delete(c)}}class r0{registerParameter(c,d,y,b,T){}registerButton(c,d,y){}}const gm={symbol:function(g,c,d,y,b){if(g.renderPass!=="translucent")return;const T=a.b6.disabled,S=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(P,M,D,z,F,V,U){const W=M.transform,H=F==="map",q=V==="map";for(const G of P){const Q=z.getTile(G),oe=Q.getBucket(D);if(!oe||!oe.text||!oe.text.segments.get().length)continue;const ce=a.i(oe.textSizeData,W.zoom),K=ol(G,oe.getProjection(),W),ee=W.calculatePixelsToTileUnitsMatrix(Q),he=li(K,Q.tileID.canonical,q,H,W,oe.getProjection(),ee),ge=oe.hasIconTextFit()&&oe.hasIconData();if(ce){const de=Math.pow(2,W.zoom-Q.tileID.overscaledZ);am(oe,H,q,U,a.bG,W,he,G,de,ce,ge)}}}(y,g,d,c,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b),d.paint.get("icon-opacity").constantOr(1)!==0&&ln(g,c,d,y,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),d.paint.get("icon-color-saturation"),T,S),d.paint.get("text-opacity").constantOr(1)!==0&&ln(g,c,d,y,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),d.paint.get("icon-color-saturation"),T,S),c.map.showCollisionBoxes&&(sm(g,c,d,y,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),sm(g,c,d,y,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,c,d,y){if(g.renderPass!=="translucent")return;const b=d.paint.get("circle-opacity"),T=d.paint.get("circle-stroke-width"),S=d.paint.get("circle-stroke-opacity"),P=d.layout.get("circle-sort-key").constantOr(1)!==void 0,M=d.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(T.constantOr(1)===0||S.constantOr(1)===0))return;const D=g.context,z=D.gl,F=g.transform,V=g.depthModeForSublayer(0,a.b4.ReadOnly),U=a.b6.disabled,W=g.colorModeForDrapableLayerRenderPass(M),H=F.projection.name==="globe",q=[a.E(F.center.lng),a.H(F.center.lat)],G=[];for(let oe=0;oe<y.length;oe++){const ce=y[oe],K=c.getTile(ce),ee=K.getBucket(d);if(!ee||ee.projection.name!==F.projection.name)continue;const he=ee.programConfigurations.get(d.id),ge=a.bH(d),de=g.isTileAffectedByFog(ce);H&&ge.push("PROJECTION_GLOBE_VIEW");const ye=g.getOrCreateProgram("circle",{config:he,defines:ge,overrideFog:de}),Ne=ee.layoutVertexBuffer,Ae=ee.globeExtVertexBuffer,Me=ee.indexBuffer,xe=F.projection.createInversionMatrix(F,ce.canonical),ze={programConfiguration:he,program:ye,layoutVertexBuffer:Ne,globeExtVertexBuffer:Ae,indexBuffer:Me,uniformValues:a.bI(g,ce,K,xe,q,d),tile:K};if(P){const ke=ee.segments.get();for(const Ve of ke)G.push({segments:new a.bm([Ve]),sortKey:Ve.sortKey,state:ze})}else G.push({segments:ee.segments,sortKey:0,state:ze})}P&&G.sort((oe,ce)=>oe.sortKey-ce.sortKey);const Q={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const oe of G){const{programConfiguration:ce,program:K,layoutVertexBuffer:ee,globeExtVertexBuffer:he,indexBuffer:ge,uniformValues:de,tile:ye}=oe.state,Ne=oe.segments;g.terrain&&g.terrain.setupElevationDraw(ye,K,Q),g.uploadCommonUniforms(D,K,ye.tileID.toUnwrapped()),K.draw(g,z.TRIANGLES,V,U,W,a.b5.disabled,de,d.id,ee,ge,Ne,d.paint,F.zoom,ce,[he])}},heatmap:function(g,c,d,y){if(d.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const b=g.context,T=b.gl,S=a.b6.disabled,P=new a.a([T.ONE,T.ONE,T.ONE,T.ONE],a.C.transparent,[!0,!0,!0,!0]);(function(U,W,H,q){const G=U.gl,Q=W.width*q,oe=W.height*q;U.activeTexture.set(G.TEXTURE1),U.viewport.set([0,0,Q,oe]);let ce=H.heatmapFbo;if(!ce||ce&&(ce.width!==Q||ce.height!==oe)){ce&&ce.destroy();const K=G.createTexture();G.bindTexture(G.TEXTURE_2D,K),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),ce=H.heatmapFbo=U.createFramebuffer(Q,oe,!0,null),function(ee,he,ge,de,ye,Ne){const Ae=ee.gl;Ae.texImage2D(Ae.TEXTURE_2D,0,ee.extRenderToTextureHalfFloat?Ae.RGBA16F:Ae.RGBA,ye,Ne,0,Ae.RGBA,ee.extRenderToTextureHalfFloat?Ae.HALF_FLOAT:Ae.UNSIGNED_BYTE,null),de.colorAttachment.set(ge)}(U,0,K,ce,Q,oe)}else G.bindTexture(G.TEXTURE_2D,ce.colorAttachment.get()),U.bindFramebuffer.set(ce.framebuffer)})(b,g,d,g.transform.projection.name==="globe"?.5:.25),b.clear({color:a.C.transparent});const M=g.transform,D=M.projection.name==="globe",z=D?["PROJECTION_GLOBE_VIEW"]:[],F=D?a.b5.frontCCW:a.b5.disabled,V=[a.E(M.center.lng),a.H(M.center.lat)];for(let U=0;U<y.length;U++){const W=y[U];if(c.hasRenderableParent(W))continue;const H=c.getTile(W),q=H.getBucket(d);if(!q||q.projection.name!==M.projection.name)continue;const G=g.isTileAffectedByFog(W),Q=q.programConfigurations.get(d.id),oe=g.getOrCreateProgram("heatmap",{config:Q,defines:z,overrideFog:G}),{zoom:ce}=g.transform;g.terrain&&g.terrain.setupElevationDraw(H,oe),g.uploadCommonUniforms(b,oe,W.toUnwrapped());const K=M.projection.createInversionMatrix(M,W.canonical);oe.draw(g,T.TRIANGLES,a.b4.disabled,S,P,F,$y(g,W,H,K,V,ce,d.paint.get("heatmap-intensity")),d.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,d.paint,g.transform.zoom,Q,D?[q.globeExtVertexBuffer]:null)}b.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(b,T){const S=b.context,P=S.gl,M=T.heatmapFbo;if(!M)return;S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,M.colorAttachment.get()),S.activeTexture.set(P.TEXTURE1);let D=T.colorRampTexture;D||(D=T.colorRampTexture=new a.a9(S,T.colorRamp,P.RGBA)),D.bind(P.LINEAR,P.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,P.TRIANGLES,a.b4.disabled,a.b6.disabled,b.colorModeForRenderPass(),a.b5.disabled,((z,F,V,U)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,T),T.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,T.paint,b.transform.zoom)}(g,d))},line:function(g,c,d,y){if(g.renderPass!=="translucent")return;const b=d.paint.get("line-opacity"),T=d.paint.get("line-width");if(b.constantOr(1)===0||T.constantOr(1)===0)return;const S=d.paint.get("line-emissive-strength"),P=g.depthModeForSublayer(0,a.b4.ReadOnly),M=g.colorModeForDrapableLayerRenderPass(S),D=g.terrain&&g.terrain.renderingToTexture?1:a.a4.devicePixelRatio,z=d.paint.get("line-dasharray"),F=z.constantOr(1),V=d.layout.get("line-cap"),U=d.paint.get("line-pattern"),W=U.constantOr(1),H=d.paint.get("line-pattern").constantOr(1),q=d.paint.get("line-opacity").constantOr(1)!==1;let G=!H&&q;const Q=d.paint.get("line-gradient"),oe=W?"linePattern":"line",ce=g.context,K=ce.gl,ee=a.bJ(d);g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(G=!1);for(const he of y){const ge=c.getTile(he);if(W&&!ge.patternsLoaded())continue;const de=ge.getBucket(d);if(!de)continue;g.prepareDrawTile();const ye=de.programConfigurations.get(d.id),Ne=g.isTileAffectedByFog(he),Ae=g.getOrCreateProgram(oe,{config:ye,defines:ee,overrideFog:Ne}),Me=U.constantOr(null);if(Me&&ge.imageAtlas){const $e=ge.imageAtlas.patternPositions[Me.toString()];$e&&ye.setConstantPatternPositions($e)}const xe=z.constantOr(null),ze=V.constantOr(null);if(!W&&xe&&ze&&ge.lineAtlas){const $e=ge.lineAtlas.getDash(xe,ze);$e&&ye.setConstantPatternPositions($e)}let[ke,Ve]=d.paint.get("line-trim-offset");(ze==="round"||ze==="square")&&ke!==Ve&&(ke===0&&(ke-=1),Ve===1&&(Ve+=1));const ne=g.terrain?he.projMatrix:null,Te=W?a.bK(g,ge,d,ne,D):a.bL(g,ge,d,ne,de.lineClipsArray.length,D,[ke,Ve]);if(Q){const $e=de.gradients[d.id];let bt=$e.texture;if(d.gradientVersion!==$e.version){let mt=256;if(d.stepInterpolant){const Dt=c.getSource().maxzoom,_t=he.canonical.z===Dt?Math.ceil(1<<g.transform.maxZoom-he.canonical.z):1;mt=a.c(a.bM(de.maxLineLength/a.J*1024*_t),256,ce.maxTextureSize)}$e.gradient=a.bN({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:mt,image:$e.gradient||void 0,clips:de.lineClipsArray}),$e.texture?$e.texture.update($e.gradient):$e.texture=new a.a9(ce,$e.gradient,K.RGBA),$e.version=d.gradientVersion,bt=$e.texture}ce.activeTexture.set(K.TEXTURE1),bt.bind(d.stepInterpolant?K.NEAREST:K.LINEAR,K.CLAMP_TO_EDGE)}F&&(ce.activeTexture.set(K.TEXTURE0),ge.lineAtlasTexture&&ge.lineAtlasTexture.bind(K.LINEAR,K.REPEAT),ye.updatePaintBuffers()),W&&(ce.activeTexture.set(K.TEXTURE0),ge.imageAtlasTexture&&ge.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),ye.updatePaintBuffers()),g.uploadCommonUniforms(ce,Ae,he.toUnwrapped());const Xe=$e=>{Ae.draw(g,K.TRIANGLES,P,$e,M,a.b5.disabled,Te,d.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,d.paint,g.transform.zoom,ye,[de.layoutVertexBuffer2])};if(G){const $e=g.stencilModeForClipping(he).ref;$e===0&&g.terrain&&ce.clear({stencil:0});const bt={func:K.EQUAL,mask:255};Te.u_alpha_discard_threshold=.8,Xe(new a.b6(bt,$e,255,K.KEEP,K.KEEP,K.INVERT)),Te.u_alpha_discard_threshold=0,Xe(new a.b6(bt,$e,255,K.KEEP,K.KEEP,K.KEEP))}else Xe(g.stencilModeForClipping(he))}G&&(g.resetStencilClippingMasks(),g.terrain&&ce.clear({stencil:0}))},fill:function(g,c,d,y){const b=d.paint.get("fill-color"),T=d.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const S=d.paint.get("fill-emissive-strength"),P=g.colorModeForDrapableLayerRenderPass(S),M=d.paint.get("fill-pattern"),D=g.opaquePassEnabledForLayer()&&!M.constantOr(1)&&b.constantOr(a.C.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===D){const z=g.depthModeForSublayer(1,g.renderPass==="opaque"?a.b4.ReadWrite:a.b4.ReadOnly);ju(g,c,d,y,z,P,!1)}if(g.renderPass==="translucent"&&d.paint.get("fill-antialias")){const z=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,a.b4.ReadOnly);ju(g,c,d,y,z,P,!0)}},"fill-extrusion":function(g,c,d,y){const b=d.paint.get("fill-extrusion-opacity"),T=g.context,S=T.gl,P=g.terrain,M=P&&P.renderingToTexture;if(b===0)return;const D=g.conflationActive&&g.layerUsedInConflation(d,c.getSource());if(D&&function(z,F,V,U){for(const W of U){const H=F.getTile(W).getBucket(V);H&&(H.updateReplacement(W,z.replacementSource),H.uploadCentroid(z.context))}}(g,c,d,y),P||D)for(const z of y){const F=c.getTile(z).getBucket(d);F&&Hy(g.context,c,z,F,d,P,D)}if(g.renderPass==="shadow"&&g.shadowRenderer){const z=g.shadowRenderer;if(P&&b<.65&&d._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.am)return;const F=z.getShadowPassDepthMode(),V=z.getShadowPassColorMode();Vu(g,c,d,y,F,a.b6.disabled,V,D)}else if(g.renderPass==="translucent"){const z=!d.paint.get("fill-extrusion-pattern").constantOr(1),F=d.paint.get("fill-extrusion-color").constantOr(a.C.white);if(!M&&F.a!==0){const V=new a.b4(g.context.gl.LEQUAL,a.b4.ReadWrite,g.depthRangeFor3D);b===1&&z?Vu(g,c,d,y,V,a.b6.disabled,a.a.unblended,D):(Vu(g,c,d,y,V,a.b6.disabled,a.a.disabled,D),Vu(g,c,d,y,V,g.stencilModeFor3D(),g.colorModeForRenderPass(),D),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&z&&(!P&&g.transform.projection.name!=="globe"||M)){const V=d.paint.get("fill-extrusion-opacity"),U=d.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=d.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),H=d.paint.get("fill-extrusion-flood-light-intensity"),q=d.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),G=U>0&&W>0,Q=H>0,oe=(K,ee,he)=>(1-he)*K+he*ee,ce=K=>{const ee=g.depthModeForSublayer(1,a.b4.ReadOnly,S.LEQUAL,!0),he=d.paint.get(K?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ge=oe(.1,3,he),de=g._showOverdrawInspector;if(!de){const ye=new a.b6({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Ne=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0],S.MIN);hl(g,c,d,y,ee,ye,Ne,a.b5.disabled,K,"sdf",V,U,W,H,q,ge,D,!1)}{const ye=de?a.b6.disabled:new a.b6({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Ne=de?g.colorModeForRenderPass():new a.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],a.C.transparent,[!0,!0,!0,!0]);hl(g,c,d,y,ee,ye,Ne,a.b5.disabled,K,"color",V,U,W,H,q,ge,D,!1)}};if(M){const K=(ee,he,ge)=>{const de=g.depthModeForSublayer(1,a.b4.ReadOnly,S.LEQUAL,!1),ye=d.paint.get(ee?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=oe(.1,3,ye);{const Ae=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0]);hl(g,c,d,y,de,a.b6.disabled,Ae,a.b5.disabled,ee,"clear",V,U,W,H,q,Ne,D,he)}{const Ae=new a.b6({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Me=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0],S.MIN);hl(g,c,d,y,de,Ae,Me,a.b5.disabled,ee,"sdf",V,U,W,H,q,Ne,D,he)}{const Ae=ee?S.ZERO:S.ONE_MINUS_DST_ALPHA,Me=new a.b6({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),xe=new a.a([Ae,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],a.C.transparent,[!0,!0,!0,!0]);hl(g,c,d,y,de,Me,xe,a.b5.disabled,ee,"color",V,U,W,H,q,Ne,D,he)}{const Ae=new a.a([S.ONE,S.ONE,S.ONE,ee?S.ZERO:S.ONE],a.C.transparent,[!1,!1,!1,!0],ee?S.FUNC_ADD:S.MAX);hl(g,c,d,y,de,a.b6.disabled,Ae,a.b5.disabled,ee,"clear",V,U,W,H,q,Ne,D,he,ge)}};if(G||Q){let ee;if(g.prepareDrawTile(),P){const he=P.drapeBufferSize[0],ge=P.drapeBufferSize[1];ee=P.framebufferCopyTexture,ee&&(!ee||ee.size[0]===he&&ee.size[1]===ge)||(ee&&ee.destroy(),ee=P.framebufferCopyTexture=new a.a9(T,new a.a5({width:he,height:ge}),S.RGBA)),ee.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,he,ge,0)}G&&K(!0,!1,ee),Q&&K(!1,!0,ee)}}else G&&ce(!0),Q&&ce(!1)}}},hillshade:function(g,c,d,y){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const b=g.context,T=g.terrain&&g.terrain.renderingToTexture,[S,P]=g.renderPass!=="translucent"||T?[{},y]:g.stencilConfigForOverlap(y);for(const M of P){const D=c.getTile(M);if(D.needsHillshadePrepare&&g.renderPass==="offscreen")cw(g,D,d);else if(g.renderPass==="translucent"){const z=g.depthModeForSublayer(0,a.b4.ReadOnly),F=d.paint.get("hillshade-emissive-strength"),V=g.colorModeForDrapableLayerRenderPass(F),U=T&&g.terrain?g.terrain.stencilModeForRTTOverlap(M):S[M.overscaledZ];lw(g,M,D,d,z,U,V)}}b.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,c,d,y,b,T){if(g.renderPass!=="translucent"||d.paint.get("raster-opacity")===0)return;const S=g.context,P=S.gl,M=c.getSource(),D=function(he,ge,de){const ye=he.paint.get("raster-color"),Ne=[],Ae=he.paint.get("raster-resampling"),Me=he.paint.get("raster-color-mix"),xe=he.paint.get("raster-color-range"),ze=[Me[0],Me[1],Me[2],0],ke=Me[3],Ve=Ae==="nearest"?de.NEAREST:de.LINEAR;if(ye&&Ne.push("RASTER_COLOR"),ye){ge.activeTexture.set(de.TEXTURE2);let ne=he.colorRampTexture;ne||(ne=he.colorRampTexture=new a.a9(ge,he.colorRamp,de.RGBA)),ne.bind(de.LINEAR,de.CLAMP_TO_EDGE)}return{mix:ze,range:xe,offset:ke,defines:Ne,resampling:Ve}}(d,S,P),z=D.defines,F=g.transform.projection.name==="globe";let V=!1;if(M instanceof a.aK&&!y.length){if(!F)return;if(M.onNorthPole)V=!0,z.push("GLOBE_POLES");else{if(!M.onSouthPole)return;V=!0,z.push("GLOBE_POLES")}}const U=d.paint.get("raster-emissive-strength"),W=g.colorModeForDrapableLayerRenderPass(U),H=g.terrain&&g.terrain.renderingToTexture,q=M instanceof a.aK&&d.paint.get("raster-elevation")!==0,G=!g.options.moving,Q=d.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(V){const he=c.getSource();if(!(he instanceof a.aK))return;const ge=he.texture;if(!ge)return;const de=g.globeSharedBuffers;if(!de)return;const ye=new a.b4(P.LEQUAL,a.b4.ReadWrite,g.depthRangeFor3D),Ne=Float32Array.from(g.transform.expandedFarZProjMatrix);let Ae=a.bj(0,0,g.transform);const Me=Float32Array.from(a.bh(a.bi(new a.t(0,0,0)))),xe={opacity:1,mix:0};g.terrain&&g.terrain.prepareDrawTile(),S.activeTexture.set(P.TEXTURE0),ge.bind(Q,P.CLAMP_TO_EDGE),S.activeTexture.set(P.TEXTURE1),ge.bind(Q,P.CLAMP_TO_EDGE),ge.useMipmap&&S.extTextureFilterAnisotropic&&g.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax);const[ze,ke,Ve,ne]=de.getPoleBuffers(0,!0);let Te;he.onNorthPole?(Te=ze,g.renderDefaultNorthPole=!1):(Ae=a.m.scale(a.m.create(),Ae,[1,-1,1]),Te=ke,g.renderDefaultSouthPole=!1);const Xe=((bt,mt,Dt,_t,Bt,jt,Ct,Mt,yn,Qt,Hn,Nn)=>Gy(bt,mt,Dt,new Float32Array(16),new Float32Array(9),[0,0],0,[0,0],[0,0,0,0],1,_t,Bt,[0,0],Ct,2,yn,Qt,Hn,1,0,Nn))(Ne,Me,Ae,xe,d,0,d.paint.get("raster-elevation"),0,D.mix,D.offset,D.range,U),$e=g.getOrCreateProgram("raster",{defines:D.defines});return g.uploadCommonUniforms(S,$e,null),void $e.draw(g,P.TRIANGLES,ye,a.b6.disabled,W,a.b5.disabled,Xe,d.id,Te,Ve,ne)}if(!y.length)return;const[oe,ce]=M instanceof a.aK||H?[{},y]:g.stencilConfigForOverlap(y),K=ce[ce.length-1].overscaledZ,ee=q&&F;ee&&D.defines.push("PROJECTION_GLOBE_VIEW"),q&&D.defines.push("RENDER_CUTOFF");for(const he of ce){const ge=he.toUnwrapped(),de=c.getTile(he);if(H&&(!de||!de.hasData())||!de.texture)continue;let ye,Ne;H?(ye=a.b4.disabled,Ne=he.projMatrix):q?(ye=new a.b4(P.LEQUAL,a.b4.ReadWrite,g.depthRangeFor3D),Ne=F?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(ge,G)):(ye=g.depthModeForSublayer(he.overscaledZ-K,d.paint.get("raster-opacity")===1?a.b4.ReadWrite:a.b4.ReadOnly,P.LESS),Ne=g.transform.calculateProjMatrix(ge,G));const Ae=g.terrain&&H?g.terrain.stencilModeForRTTOverlap(he):oe[he.overscaledZ],Me=T?0:d.paint.get("raster-fade-duration");de.registerFadeDuration(Me);const xe=c.findLoadedParent(he,0),ze=gd(de,xe,c,g.transform,Me);let ke,Ve;g.terrain&&g.terrain.prepareDrawTile(),S.activeTexture.set(P.TEXTURE0),de.texture&&de.texture.bind(Q,P.CLAMP_TO_EDGE),S.activeTexture.set(P.TEXTURE1),xe?(xe.texture&&xe.texture.bind(Q,P.CLAMP_TO_EDGE),ke=Math.pow(2,xe.tileID.overscaledZ-de.tileID.overscaledZ),Ve=[de.tileID.canonical.x*ke%1,de.tileID.canonical.y*ke%1]):de.texture&&de.texture.bind(Q,P.CLAMP_TO_EDGE),de.texture&&de.texture.useMipmap&&S.extTextureFilterAnisotropic&&g.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax);const ne=g.transform;let Te;const Xe=q?_w(ne):[0,0,0,0];let $e,bt,mt,Dt,_t;ee&&M instanceof a.aK&&M.coordinates.length>3?($e=Float32Array.from(a.bh(a.bi(new a.t(0,0,0)))),bt=Float32Array.from(ne.globeMatrix),mt=Float32Array.from(a.bc(ne)),Dt=[a.E(ne.center.lng),a.H(ne.center.lat)],Te=M.elevatedGlobePerspectiveTransform,_t=M.elevatedGlobeGridMatrix||new Float32Array(9)):(Te=M instanceof a.aK?M.perspectiveTransform:[0,0],$e=new Float32Array(16),bt=new Float32Array(9),mt=new Float32Array(16),Dt=[0,0],_t=new Float32Array(9));const Bt=Gy(Ne,$e,bt,mt,_t,Ve||[0,0],a.ao(g.transform.zoom),Dt,Xe,ke||1,ze,d,Te,q?d.paint.get("raster-elevation"):0,2,D.mix,D.offset,D.range,1,0,U),jt=g.isTileAffectedByFog(he),Ct=g.getOrCreateProgram("raster",{defines:D.defines,overrideFog:jt});if(g.uploadCommonUniforms(S,Ct,ge),M instanceof a.aK){const Mt=M.elevatedGlobeVertexBuffer,yn=M.elevatedGlobeIndexBuffer;if(H||!F)M.boundsBuffer&&M.boundsSegments&&Ct.draw(g,P.TRIANGLES,ye,a.b6.disabled,W,a.b5.disabled,Bt,d.id,M.boundsBuffer,g.quadTriangleIndexBuffer,M.boundsSegments);else if(Mt&&yn){const Qt=ne.zoom<=a.Z?M.elevatedGlobeSegments:M.getSegmentsForLongitude(ne.center.lng);Qt&&(Ct.draw(g,P.TRIANGLES,ye,a.b6.disabled,W,a.b5.backCW,Bt,d.id,Mt,yn,Qt),Ct.draw(g,P.TRIANGLES,ye,a.b6.disabled,W,a.b5.frontCW,Bt,d.id,Mt,yn,Qt))}}else{const{tileBoundsBuffer:Mt,tileBoundsIndexBuffer:yn,tileBoundsSegments:Qt}=g.getTileBoundsBuffers(de);Ct.draw(g,P.TRIANGLES,ye,Ae,W,a.b5.disabled,Bt,d.id,Mt,yn,Qt)}}g.resetStencilClippingMasks()},background:function(g,c,d,y){const b=d.paint.get("background-color"),T=d.paint.get("background-opacity"),S=d.paint.get("background-emissive-strength");if(T===0)return;const P=g.context,M=P.gl,D=g.transform,z=D.tileSize,F=d.paint.get("background-pattern");if(g.isPatternMissing(F,d.scope))return;const V=!F&&b.a===1&&T===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==V)return;const U=a.b6.disabled,W=g.depthModeForSublayer(0,V==="opaque"?a.b4.ReadWrite:a.b4.ReadOnly),H=g.colorModeForDrapableLayerRenderPass(S),q=F?"backgroundPattern":"background";let G,Q=y;Q||(G=g.getBackgroundTiles(),Q=Object.values(G).map(oe=>oe.tileID)),F&&(P.activeTexture.set(M.TEXTURE0),g.imageManager.bind(g.context,d.scope));for(const oe of Q){const ce=g.isTileAffectedByFog(oe),K=g.getOrCreateProgram(q,{overrideFog:ce}),ee=oe.toUnwrapped(),he=y?oe.projMatrix:g.transform.calculateProjMatrix(ee);g.prepareDrawTile();const ge=c?c.getTile(oe):G?G[oe.key]:new a.bt(oe,z,D.zoom,g),de=F?mc(he,S,T,g,F,d.scope,{tileID:oe,tileSize:z}):om(he,S,T,b);g.uploadCommonUniforms(P,K,ee);const{tileBoundsBuffer:ye,tileBoundsIndexBuffer:Ne,tileBoundsSegments:Ae}=g.getTileBoundsBuffers(ge);K.draw(g,M.TRIANGLES,W,U,H,a.b5.disabled,de,d.id,ye,Ne,Ae)}},sky:function(g,c,d){const y=g._atmosphere?a.ao(g.transform.zoom):1,b=d.paint.get("sky-opacity")*y;if(b===0)return;const T=g.context,S=d.paint.get("sky-type"),P=new a.b4(T.gl.LEQUAL,a.b4.ReadOnly,[0,1]),M=g.frameCounter/1e3%1;S==="atmosphere"?g.renderPass==="offscreen"?d.needsSkyboxCapture(g)&&(function(D,z,F,V){const U=D.context,W=U.gl;let H=z.skyboxFbo;if(!H){H=z.skyboxFbo=U.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new es(U),z.skyboxTexture=U.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,z.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let oe=0;oe<6;++oe)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}U.bindFramebuffer.set(H.framebuffer),U.viewport.set([0,0,32,32]);const q=z.getCenter(D,!0),G=D.getOrCreateProgram("skyboxCapture"),Q=new Float64Array(16);a.m.identity(Q),a.m.rotateY(Q,Q,.5*-Math.PI),wa(D,z,G,Q,q,0),a.m.identity(Q),a.m.rotateY(Q,Q,.5*Math.PI),wa(D,z,G,Q,q,1),a.m.identity(Q),a.m.rotateX(Q,Q,.5*-Math.PI),wa(D,z,G,Q,q,2),a.m.identity(Q),a.m.rotateX(Q,Q,.5*Math.PI),wa(D,z,G,Q,q,3),a.m.identity(Q),wa(D,z,G,Q,q,4),a.m.identity(Q),a.m.rotateY(Q,Q,Math.PI),wa(D,z,G,Q,q,5),U.viewport.set([0,0,D.width,D.height])}(g,d),d.markSkyboxValid(g)):g.renderPass==="sky"&&function(D,z,F,V,U){const W=D.context,H=W.gl,q=D.transform,G=D.getOrCreateProgram("skybox");W.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,z.skyboxTexture);const Q=((oe,ce,K,ee,he)=>({u_matrix:oe,u_sun_direction:ce,u_cubemap:0,u_opacity:ee,u_temporal_offset:he}))(q.skyboxMatrix,z.getCenter(D,!1),0,V,U);D.uploadCommonUniforms(W,G),G.draw(D,H.TRIANGLES,F,a.b6.disabled,D.colorModeForRenderPass(),a.b5.backCW,Q,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(g,d,P,b,M):S==="gradient"&&g.renderPass==="sky"&&function(D,z,F,V,U){const W=D.context,H=W.gl,q=D.transform,G=D.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new es(W)),W.activeTexture.set(H.TEXTURE0);let Q=z.colorRampTexture;Q||(Q=z.colorRampTexture=new a.a9(W,z.colorRamp,H.RGBA)),Q.bind(H.LINEAR,H.CLAMP_TO_EDGE);const oe=((ce,K,ee,he,ge)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:K,u_radius:a.d(ee),u_opacity:he,u_temporal_offset:ge}))(q.skyboxMatrix,z.getCenter(D,!1),z.paint.get("sky-gradient-radius"),V,U);D.uploadCommonUniforms(W,G),G.draw(D,H.TRIANGLES,F,a.b6.disabled,D.colorModeForRenderPass(),a.b5.backCW,oe,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(g,d,P,b,M)},debug:function(g,c,d,y,b){for(let T=0;T<d.length;T++)if(b){const M=new a.C(y.r*.8,y.g*.8,y.b*.8,1);dl(g,c,d[T],y,-1,-1),dl(g,c,d[T],y,-1,1),dl(g,c,d[T],y,1,1),dl(g,c,d[T],y,1,-1),dl(g,c,d[T],M,0,0)}else dl(g,c,d[T],y,0,0)},custom:function(g,c,d,y){const b=g.context,T=d.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&d.isLayerDraped(c)){if(g.renderPass==="offscreen"){const S=T.prerender;if(S){if(g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const P=g.transform.pointMerc;S.call(T,b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.ao(g.transform.zoom),[P.x,P.y],g.transform.pixelsPerMeterRatio)}else S.call(T,b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const P=T.renderToTile;if(P){const M=y[0].canonical,D=new a.M(M.x+y[0].wrap*(1<<M.z),M.y,M.z);b.setDepthMode(a.b4.disabled),b.setStencilMode(a.b6.disabled),b.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),P.call(T,b.gl,D),b.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),b.setStencilMode(a.b6.disabled);const S=T.renderingMode==="3d"?new a.b4(g.context.gl.LEQUAL,a.b4.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,a.b4.ReadOnly);if(b.setDepthMode(S),g.transform.projection.name==="globe"){const P=g.transform.pointMerc;T.render(b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.ao(g.transform.zoom),[P.x,P.y],g.transform.pixelsPerMeterRatio)}else T.render(b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState(),b.bindFramebuffer.set(null)}}else a.X("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,c,d,y){if(g.renderPass==="opaque")return;const b=d.paint.get("model-opacity");if(b===0)return;const T=d.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!T||g.terrain&&b<.65&&d._transitionablePaint._values["model-opacity"].value.expression instanceof a.am))return;const S=g.shadowRenderer,P=d.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,P||(S.enabled=!1));const M=()=>{S&&(S.useNormalOffset=!0,P||(S.enabled=!0))},D=c.getSource();if(g.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(G,Q,oe,ce){const K=G.transform;if(K.projection.name!=="mercator")return void a.X(`Drawing 3D models for ${K.projection.name} projection is not yet implemented`);const ee=K.getFreeCameraOptions().position;if(!G.modelManager)return;const he=G.modelManager,ge=G.shadowRenderer;if(!oe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const de=oe._unevaluatedLayout._values["model-id"],ye={...oe.layout.get("model-id").parameters};for(const Ne of ce){const Ae=Q.getTile(Ne).getBucket(oe);if(!Ae||Ae.projection.name!==K.projection.name)continue;const Me=xw(Ne,K);ye.zoom=Me;const xe=de.possiblyEvaluate(ye);if(vw(G,Ae,Ne),Ro.shadowUniformsInitialized=!1,Ro.useSingleShadowCascade=!!ge&&ge.getMaxCascadeForTile(Ne.toUnwrapped())===0,G.renderPass==="shadow"&&ge){if(G.currentShadowCascade===1&&Ae.isInsideFirstShadowMapFrustum)continue;const Ve=K.calculatePosMatrix(Ne.toUnwrapped(),K.worldSize);if(Ro.tileMatrix.set(Ve),Ro.shadowTileMatrix=Float32Array.from(ge.calculateShadowPassMatrixFromMatrix(Ve)),Ro.aabb.min.fill(0),Ro.aabb.max[0]=Ro.aabb.max[1]=a.J,Ro.aabb.max[2]=0,t0(Ae,Ro,G,oe.scope))continue}const ze=1<<Ne.canonical.z,ke=[((ee.x-Ne.wrap)*ze-Ne.canonical.x)*a.J,(ee.y*ze-Ne.canonical.y)*a.J,ee.z*ze*a.J];for(let Ve in Ae.instancesPerModel){const ne=Ae.instancesPerModel[Ve];ne.features.length>0&&(Ve=xe.evaluate(ne.features[0].feature,{}));const Te=he.getModel(Ve,oe.scope);if(Te&&Te.uploaded)for(const Xe of Te.nodes)$u(G,oe,Xe,ne,ke,Ne,Ro)}}}(g,c,d,y),void M();if(!D.loaded())return;if(D.type==="batched-model")return function(G,Q,oe,ce){const K=G.context,ee=G.transform,he=G.style.fog,ge=G.shadowRenderer;if(ee.projection.name!=="mercator")return void a.X(`Drawing 3D landmark models for ${ee.projection.name} projection is not yet implemented`);const de=G.transform.getFreeCameraOptions().position,ye=a.v.scale([],[de.x,de.y,de.z],G.transform.worldSize);a.v.negate(ye,ye);const Ne=a.m.identity([]),Ae=a.c4(ee.center.lat,ee.zoom),Me=a.m.fromScaling([],[1,1,1/Ae]);a.m.translate(Ne,Ne,ye);const xe=oe.paint.get("model-opacity"),ze=new a.b4(K.gl.LEQUAL,a.b4.ReadWrite,G.depthRangeFor3D),ke=new a.b4(K.gl.LEQUAL,a.b4.ReadOnly,G.depthRangeFor3D),Ve=function(ne,Te){for(const Xe of ce){const $e=Q.getTile(Xe).getBucket(oe);if(!$e||!$e.uploaded)continue;let bt=!1;ge&&(bt=ge.getMaxCascadeForTile(Xe.toUnwrapped())===0);const mt=ee.calculatePosMatrix(Xe.toUnwrapped(),ee.worldSize),Dt=$e.modelTraits;for(const _t of $e.getNodesInfo()){if(_t.hiddenByReplacement||!_t.node.meshes)continue;const Bt=_t.node,jt=G.renderPass==="light-beam",Ct=[...mt],Mt=_t.evaluatedScale;let yn=0;G.terrain&&Bt.elevation&&(yn=Bt.elevation*G.terrain.exaggeration()),a.m.translate(Ct,Ct,[(Bt.anchor?Bt.anchor[0]:0)*(Mt[0]-1),(Bt.anchor?Bt.anchor[1]:0)*(Mt[1]-1),yn]),Mt!==a.c6&&a.m.scale(Ct,Ct,Mt),a.m.multiply(Ct,Ct,Bt.matrix);const Qt=a.m.multiply([],Me,Ct);a.m.multiply(Qt,Ne,Qt);const Hn=a.m.invert([],Qt);a.m.transpose(Hn,Hn),a.m.scale(Hn,Hn,bw);const Nn=a.m.multiply([],ee.expandedFarZProjMatrix,Ct),Bi=Dt&a.c8.HasMapboxMeshFeatures,Do=Bi?0:_t.evaluatedRMEA[0][2];for(let Rn=0;Rn<Bt.meshes.length;++Rn){const wn=Bt.meshes[Rn],Sn=Rn===Bt.lightMeshIndex;if(Sn){if(!jt&&!G.terrain&&G.shadowRenderer){G.currentLayer<G.firstLightBeamLayer&&(G.firstLightBeamLayer=G.currentLayer);continue}}else if(jt)continue;const ar={defines:[]},ei=[];mm(ar.defines,ei,wn,G),Bi||ar.defines.push("DIFFUSE_SHADED"),bt&&ar.defines.push("SHADOWS_SINGLE_CASCADE");const Jn=G.renderPass==="shadow";if(Jn){Uu(wn,Ct,G,oe);continue}let xi=null;if(he){const ns=kd(Ct,G.transform);if(xi=new Float32Array(ns),ee.projection.name!=="globe"){const Bn=wn.aabb.min,rs=wn.aabb.max,[Ts,Hs]=he.getOpacityForBounds(ns,Bn[0],Bn[1],rs[0],rs[1]);ar.overrideFog=Ts>=Ki||Hs>=Ki}}const ji=G.getOrCreateProgram("model",ar);!Jn&&ge&&(ge.useNormalOffset=!!wn.normalBuffer,ge.setupShadowsFromMatrix(Ct,ji,ge.useNormalOffset)),G.uploadCommonUniforms(K,ji,Xe.toUnwrapped(),xi);const bi=wn.material,Lo=bi.pbrMetallicRoughness;Lo.metallicFactor=.9,Lo.roughnessFactor=.5;const qs=Bu(new Float32Array(Nn),new Float32Array(Qt),new Float32Array(Hn),G,xe,Lo.baseColorFactor,bi.emissiveFactor,Lo.metallicFactor,Lo.roughnessFactor,bi,Do,oe);ji.draw(G,K.gl.TRIANGLES,Te&&!Sn?ze:ke,a.b6.disabled,ne?Sn||xe<1||_t.hasTranslucentParts?a.a.alphaBlended:a.a.unblended:a.a.disabled,a.b5.backCCW,qs,oe.id,wn.vertexBuffer,wn.indexBuffer,wn.segments,oe.paint,G.transform.zoom,void 0,ei)}}}};(function(ne,Te,Xe,$e){const bt=ne.terrain?ne.terrain.exaggeration():0,mt=ne.transform.zoom;for(const Dt of $e){const _t=Te.getTile(Dt).getBucket(Xe);_t&&(ne.conflationActive&&_t.updateReplacement(Dt,ne.replacementSource),_t.evaluateScale(ne,Xe),ne.terrain&&bt>0&&_t.elevationUpdate(ne.terrain,bt,Dt,Xe.source),_t.needsReEvaluation(ne,mt,Xe)&&_t.evaluate(Xe))}})(G,Q,oe,ce),xe===1?Ve(!0,!0):(Ve(!1,!0),Ve(!0,!1))}(g,c,d,y),void M();const z=D.getModels(),F=[],V=g.transform.getFreeCameraOptions().position,U=a.v.scale([],[V.x,V.y,V.z],g.transform.worldSize);a.v.negate(U,U);const W=[],H=[];let q=0;for(const G of z){const Q=d.paint.get("model-rotation").constantOr(null),oe=d.paint.get("model-scale").constantOr(null),ce=d.paint.get("model-translation").constantOr(null);G.computeModelMatrix(g,Q,oe,ce,!0,!0,!1);const K=a.m.identity([]),ee=a.c4(G.position.lat,g.transform.zoom),he=a.m.fromScaling([],[1,1,1/ee]);a.m.translate(K,K,U),F.push({zScaleMatrix:he,negCameraPosMatrix:K});for(const ge of G.nodes)e0(g.transform,ge,G.matrix,g.transform.expandedFarZProjMatrix,q,W,H);q++}if(W.sort((G,Q)=>Q.depth-G.depth),g.renderPass!=="shadow"){if(b===1)for(const G of H)fl(G,g,d,F[G.modelIndex],a.b6.disabled,g.colorModeForRenderPass());else{for(const G of H)fl(G,g,d,F[G.modelIndex],a.b6.disabled,a.a.disabled);for(const G of H)fl(G,g,d,F[G.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const G of W)fl(G,g,d,F[G.modelIndex],a.b6.disabled,g.colorModeForRenderPass());M()}else{for(const G of H)Uu(G.mesh,G.nodeModelMatrix,g,d);for(const G of W)Uu(G.mesh,G.nodeModelMatrix,g,d);M()}}},i0={modelUpload:function(g,c,d){const y=c.getSource();if(!y.loaded())return;if(y.type==="vector"||y.type==="geojson")return void(g.modelManager&&g.modelManager.upload(g,d));if(y.type==="batched-model")return;const b=y.getModels();for(const T of b)T.upload(g.context)}};class ww{constructor(c,d,y,b){this.context=new Vr(c,d),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._debugParams={showTerrainProxyTiles:!1},b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=a.bq.maxUnderzooming+a.bq.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.ca,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ym(this),this._wireframeDebugCache=new vc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(c,d){const y=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new em(this,c));const b=this._terrain;this.transform.elevation=y?b:null,b.update(c,this.transform,d),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(c){const d=c.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,b]=d.getFovAdjustedRange(this.transform._fov);if(y>b)return void(this.transform.fogCullDistSq=null);const T=y+.78*(b-y);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(c,d){if(this.width=c*a.a4.devicePixelRatio,this.height=d*a.a4.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const c=this.context,d=new a.bo;d.emplaceBack(0,0),d.emplaceBack(a.J,0),d.emplaceBack(0,a.J),d.emplaceBack(a.J,a.J),this.tileExtentBuffer=c.createVertexBuffer(d,a.bl.members),this.tileExtentSegments=a.bm.simpleSegment(0,0,4,2);const y=new a.bo;y.emplaceBack(0,0),y.emplaceBack(a.J,0),y.emplaceBack(0,a.J),y.emplaceBack(a.J,a.J),this.debugBuffer=c.createVertexBuffer(y,a.bl.members),this.debugSegments=a.bm.simpleSegment(0,0,4,5);const b=new a.bo;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(b,a.bl.members),this.viewportSegments=a.bm.simpleSegment(0,0,4,2);const T=new a.cb;T.emplaceBack(0,0,0,0),T.emplaceBack(a.J,0,a.J,0),T.emplaceBack(0,a.J,0,a.J),T.emplaceBack(a.J,a.J,a.J,a.J),this.mercatorBoundsBuffer=c.createVertexBuffer(T,a.cc.members),this.mercatorBoundsSegments=a.bm.simpleSegment(0,0,4,2);const S=new a.bp;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(S);const P=new a.cd;for(const D of[0,1,3,2,0])P.emplaceBack(D);this.debugIndexBuffer=c.createIndexBuffer(P),this.emptyTexture=new a.a9(c,new a.a5({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=a.m.create();const M=this.context.gl;this.stencilClearMode=new a.b6({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,c.TRIANGLES,a.b4.disabled,this.stencilClearMode,a.a.disabled,a.b5.disabled,md(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,d,y){if(!d||this.currentStencilSource===d.id||!c.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const M of y)if(this._tileClippingMaskIDs[M.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=d.id;const b=this.context,T=b.gl;this.nextStencilID+y.length>256&&this.clearStencil(),b.setColorMode(a.a.disabled),b.setDepthMode(a.b4.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of y){const M=d.getTile(P),D=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:F,tileBoundsSegments:V}=this.getTileBoundsBuffers(M);S.draw(this,T.TRIANGLES,a.b4.disabled,new a.b6({func:T.ALWAYS,mask:0},D,255,T.KEEP,T.KEEP,T.REPLACE),a.a.disabled,a.b5.disabled,md(P.projMatrix),"$clipping",z,F,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,d=this.context.gl;return new a.b6({func:d.NOTEQUAL,mask:255},c,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const d=this.context.gl;return new a.b6({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(c){const d=this.context.gl,y=c.sort((S,P)=>P.overscaledZ-S.overscaledZ),b=y[y.length-1].overscaledZ,T=y[0].overscaledZ-b+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const S={};for(let P=0;P<T;P++)S[P+b]=new a.b6({func:d.GEQUAL,mask:255},P+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=T,[S,y]}return[{[b]:a.b6.disabled},y]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new a.a([c.CONSTANT_COLOR,c.ONE,c.CONSTANT_COLOR,c.ONE],new a.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.a.unblended:a.a.alphaBlended}colorModeForDrapableLayerRenderPass(c){const d=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&this.renderPass==="translucent"?new a.a([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.CONSTANT_ALPHA,d.ONE_MINUS_SRC_ALPHA],new a.C(0,0,0,c===void 0?0:c),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(c,d,y,b=!1){if(!this.opaquePassEnabledForLayer()&&!b)return a.b4.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new a.b4(y||this.context.gl.LEQUAL,d,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,d){this._wireframeDebugCache.update(this.frameCounter),this.style=c,this.options=d;const y=this.style._mergedLayers,b=this.style.order,T=b.map(K=>y[K]),S=this.style._mergedSourceCaches;this.imageManager=c.imageManager,this.modelManager=c.modelManager,this.symbolFadeChange=c.placement.symbolFadeChange(a.a4.now()),this.imageManager.beginFrame();let P=0,M=!1;for(const K in S){const ee=S[K];ee.used&&(ee.prepare(this.context),ee.getSource().usedInConflation&&++P)}const D={},z={},F={},V={},U={};for(const K in S){const ee=S[K];D[K]=ee.getVisibleCoordinates(),z[K]=D[K].slice().reverse(),F[K]=ee.getVisibleCoordinates(!0).reverse(),V[K]=ee.getShadowCasterCoordinates(),U[K]=ee.sortCoordinatesByDistance(D[K])}const W=K=>{const ee=this.style.getLayerSourceCache(K);return ee&&ee.used?ee.getSource():null};if(P){const K=[];for(const ee of T)this.layerUsedInConflation(ee,W(ee))&&K.push(ee);if(K&&K.length>1){const ee=[];for(const he of K){const ge=this.style.getLayerSourceCache(he);ge&&ge.used&&ge.getSource().usedInConflation&&ee.push({layer:he.fqid,cache:ge})}this.replacementSource.setSources(ee),M=!0}}M||this.replacementSource.clear(),this.conflationActive=M,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const K of T){const ee=K.cutoffRange();if(this.longestCutoffRange=Math.max(ee,this.longestCutoffRange),ee>0){const he=W(K);he&&(this.minCutoffZoom=Math.max(he.minzoom,this.minCutoffZoom)),K.minzoom&&(this.minCutoffZoom=Math.max(K.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let K=0;K<T.length;K++)if(T[K].is3D()){this.opaquePassCutoff=K;break}const H=this.style&&this.style.fog;H?(this._fogVisible=H.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=H.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(F),this.opaquePassCutoff=0);const q=this._shadowRenderer;if(q){q.updateShadowParameters(this.transform,this.style.directionalLight);for(const K in S)for(const ee of D[K]){let he={min:0,max:0};this.terrain&&(he=this.terrain.getMinMaxForTile(ee)||he),q.addShadowReceiver(ee.toUnwrapped(),he.min,he.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.ce(this.context));for(const K of T){if(K.isHidden(this.transform.zoom))continue;const ee=c.getLayerSourceCache(K);this.uploadLayer(this,K,ee)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new yw(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!a.cf(this.context.gl))return;this.renderPass="offscreen";for(const K of T){const ee=c.getLayerSourceCache(K);if(!K.hasOffscreenPass()||K.isHidden(this.transform.zoom))continue;const he=ee?z[ee.id]:void 0;(K.type==="custom"||K.type==="raster"||K.isSky()||he&&he.length)&&this.renderLayer(this,ee,K,he)}this.depthRangeFor3D=[0,1-(T.length+2)*this.numSublayers*this.depthEpsilon];const G=this.terrain;G&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&G.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,V)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Q=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),oe=(()=>{if(d.showOverdrawInspector)return a.C.black;if(this.style.fog&&this.transform.projection.supportsFog&&!Q){const K=this.style.fog.properties.get("color").toArray01();return new a.C(...K)}if(this.style.fog&&this.transform.projection.supportsFog&&Q){const K=this.style.fog.properties.get("space-color").toArray01();return new a.C(...K)}return a.C.transparent})();if(this.context.clear({color:oe,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Q&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const K=T[this.currentLayer],ee=c.getLayerSourceCache(K);if(K.isSky())continue;const he=ee?(K.is3D()?U:z)[ee.id]:void 0;this._renderTileClippingMasks(K,ee,he),this.renderLayer(this,ee,K,he)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Q&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.ao(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const K=T[this.currentLayer],ee=c.getLayerSourceCache(K);K.isSky()&&this.renderLayer(this,ee,K,ee?z[ee.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ce=0;for(q&&(ce=q.getShadowCastingLayerCount());this.currentLayer<b.length;){const K=T[this.currentLayer],ee=c.getLayerSourceCache(K);if(K.isSky()){++this.currentLayer;continue}if(G&&this.style.isLayerDraped(K)){if(K.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=G.renderBatch(this.currentLayer);continue}let he;if(ee&&(he=(K.type==="symbol"?F:K.is3D()?U:z)[ee.id]),this._renderTileClippingMasks(K,ee,ee?D[ee.id]:void 0),this.renderLayer(this,ee,K,he),!G&&q&&ce>0&&K.hasShadowPass()&&--ce==0&&(q.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ge=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ge;this.currentLayer++){const de=T[this.currentLayer];if(!de.hasLightBeamPass())continue;const ye=c.getLayerSourceCache(de);this.renderLayer(this,ye,de,ye?z[ye.id]:void 0)}this.currentLayer=ge,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let K=null;T.forEach(ee=>{const he=c.getLayerSourceCache(ee);he&&!ee.isHidden(this.transform.zoom)&&he.getVisibleCoordinates().length&&(!K||K.getSource().maxzoom<he.getSource().maxzoom)&&(K=he)}),K&&this.options.showTileBoundaries&&gm.debug(this,K,K.getVisibleCoordinates(),a.C.red,!1)}this.terrain&&this._debugParams.showTerrainProxyTiles&&gm.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.C(1,.8,.1,1),!0),this.options.showPadding&&function(K){const ee=K.transform.padding;Yy(K,K.transform.height-(ee.top||0),3,cm),Yy(K,ee.bottom||0,3,um),yc(K,ee.left||0,3,hm),yc(K,K.transform.width-(ee.right||0),3,dm);const he=K.transform.centerPoint;(function(ge,de,ye,Ne){ba(ge,de-1,ye-10,2,20,Ne),ba(ge,de-10,ye-1,20,2,Ne)})(K,he.x,K.transform.height-he.y,Xy)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),M||(this.conflationActive=!1)}uploadLayer(c,d,y){this.gpuTimingStart(d),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(d.type)||c.terrain&&d.type==="custom")&&i0[`${d.type}Upload`]&&i0[`${d.type}Upload`](c,y,d.scope),this.gpuTimingEnd()}renderLayer(c,d,y,b){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||y.type==="model"||y.type==="raster"||b&&b.length)&&(this.id=y.id,this.gpuTimingStart(y),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(y.type)||c.terrain&&y.type==="custom")&&gm[y.type](c,d,y,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery,y=this.context.gl;let b=this.gpuTimers[c.id];b||(b=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:y.createQuery()}),b.calls++,y.beginQuery(d.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,d=this.context.gl,y=d.createQuery();this.deferredRenderGpuTimeQueries.push(y),d.beginQuery(c.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const d={};for(const y in c){const b=c[y],T=this.context.extTimerQuery,S=T.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;T.deleteQueryEXT(b.query),d[y]=S}return d}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery,y=this.context.gl;let b=0;for(const T of c)b+=d.getQueryParameter(T,y.QUERY_RESULT)/1e6,d.deleteQueryEXT(T);return b}translatePosMatrix(c,d,y,b,T){if(!y[0]&&!y[1])return c;const S=T?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(S){const D=Math.sin(S),z=Math.cos(S);y=[y[0]*z-y[1]*D,y[0]*D+y[1]*z]}const P=[T?y[0]:a.ay(d,y[0],this.transform.zoom),T?y[1]:a.ay(d,y[1],this.transform.zoom),0],M=new Float32Array(16);return a.m.translate(M,c,P),M}saveTileTexture(c){const d=c.size[0],y=this._tileTextures[d];y?y.push(c):this._tileTextures[d]=[c]}getTileTexture(c){const d=this._tileTextures[c];return d&&d.length>0?d.pop():null}isPatternMissing(c,d){return c===null||c!==void 0&&!this.imageManager.getPattern(c.toString(),d)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(c,d,y){const b=y===void 0?this.terrain&&this.terrain.renderingToTexture:y,T=this.terrain&&this.terrain.exaggeration()===0,S=[];return this.style&&this.style.enable3dLights()&&(c==="globeRaster"||c==="terrainRaster"?(S.push("LIGHTING_3D_MODE"),S.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||S.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||S.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?S.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):S.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(S.push("TERRAIN"),this.linearFloatFilteringSupported()&&S.push("TERRAIN_DEM_FLOAT_FORMAT"),T&&S.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&S.push("GLOBE"),!this._fogVisible||b||d!==void 0&&!d||S.push("FOG","FOG_DITHERING"),b&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}getOrCreateProgram(c,d){this.cache=this.cache||{};const y=d&&d.defines||[],b=d&&d.config,T=this.currentGlobalDefines(c,d&&d.overrideFog,d&&d.overrideRtt).concat(y),S=vd.cacheKey(Hp[c],c,T,b);return this.cache[S]||(this.cache[S]=new vd(this.context,c,Hp[c],b,qy[c],T)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.a9(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(c,d){if(this.style.enable3dLights()){const y=this.style.directionalLight,b=this.style.ambientLight;if(y&&b){const T=((S,P)=>{const M=S.properties.get("direction"),D=S.properties.get("color").toArray01(),z=S.properties.get("intensity"),F=P.properties.get("color").toArray01(),V=P.properties.get("intensity"),U=[M.x,M.y,M.z],W=a.bv(F,V),H=a.bv(D,z);return{u_lighting_ambient_color:W,u_lighting_directional_dir:U,u_lighting_directional_color:H,u_ground_radiance:Vy(U,H,W)}})(y,b);d.setLightsUniformValues(c,T)}}}uploadCommonUniforms(c,d,y,b,T){if(this.uploadCommonLightUniforms(c,d),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const P=S.getOpacity(this.transform.pitch),M=((D,z,F,V,U,W,H,q,G,Q,oe,ce)=>{const K=D.transform,ee=z.properties.get("color").toArray01();ee[3]=V;const he=D.frameCounter/1e3%1,[ge,de]=z.properties.get("vertical-range");return{u_fog_matrix:F?K.calculateFogTileMatrix(F):ce||D.identityMat,u_fog_range:z.getFovAdjustedRange(K._fov),u_fog_color:ee,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ge,de),de],u_fog_temporal_offset:he,u_frustum_tl:U,u_frustum_tr:W,u_frustum_br:H,u_frustum_bl:q,u_globe_pos:G,u_globe_radius:Q,u_viewport:oe,u_globe_transition:a.ao(K.zoom),u_is_globe:+(K.projection.name==="globe")}})(this,S,y,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.a4.devicePixelRatio,this.transform.height*a.a4.devicePixelRatio],b);d.setFogUniformValues(c,M)}T&&d.setCutoffUniformValues(c,T.uniformValues)}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,d=c.createTexture();return c.bindTexture(c.TEXTURE_2D,d),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&c.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const c=this._backgroundTiles,d=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const b of y)d[b.key]=c[b.key]||new a.bt(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(c,d){return!(!c.is3D()||c.minzoom&&c.minzoom>this.transform.zoom||c.sourceLayer!=="building"&&(!d||d.type!=="batched-model"))}isTileAffectedByFog(c){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let d=this._cachedTileFogOpacities[c.key];return d||(this._cachedTileFogOpacities[c.key]=d=this.style.fog.getOpacityForTile(c)),d[0]>=Ki||d[1]>=Ki}}const Ji={cascadeCount:2,shadowMapResolution:2048};class Tw{constructor(c,d){this.aabb=c,this.lastCascade=d}}class _m{add(c,d){const y=this.receivers[c.key];y!==void 0?(y.aabb.min[0]=Math.min(y.aabb.min[0],d.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],d.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],d.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],d.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],d.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],d.max[2])):this.receivers[c.key]=new Tw(d,null)}clear(){this.receivers={}}get(c){return this.receivers[c.key]}computeRequiredCascades(c,d,y){const b=a.c3.fromPoints(c.points);let T=0;for(const S in this.receivers){const P=this.receivers[S];if(!P||!b.intersectsAabb(P.aabb))continue;P.aabb.min=b.closestPoint(P.aabb.min),P.aabb.max=b.closestPoint(P.aabb.max);const M=P.aabb.getCorners();for(let D=0;D<y.length;D++){let z=!0;for(const F of M){const V=[F[0]*d,F[1]*d,F[2]];if(a.v.transformMat4(V,V,y[D].matrix),V[0]<-1||V[0]>1||V[1]<-1||V[1]>1){z=!1;break}}if(P.lastCascade=D,T=Math.max(T,D),z)break}}return T+1}}class ym{constructor(c){this.painter=c,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new _m,this._depthMode=new a.b4(c.context.gl.LEQUAL,a.b4.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,c.tp.registerParameter(Ji,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),c.tp.registerParameter(Ji,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const c of this._cascades)c.texture.destroy(),c.framebuffer.destroy();this._cascades=[]}updateShadowParameters(c,d){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!d||!d.properties)return;const b=d.properties.get("shadow-intensity");if(!d.shadowsEnabled()||b<=0||(this._shadowLayerCount=y.style.order.reduce((W,H)=>{const q=y.style._mergedLayers[H];return W+(q.hasShadowPass()&&!q.isHidden(c.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const T=y.context,S=Ji.shadowMapResolution,P=Ji.shadowMapResolution;if(this._cascades.length===0||Ji.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let W=0;W<Ji.cascadeCount;++W){const H=y._shadowMapDebug,q=T.gl,G=T.createFramebuffer(S,P,H,"texture"),Q=new a.a9(T,{width:S,height:P,data:null},q.DEPTH_COMPONENT);if(G.depthAttachment.set(Q.texture),H){const oe=new a.a9(T,{width:S,height:P,data:null},q.RGBA);G.colorAttachment.set(oe.texture)}this._cascades.push({framebuffer:G,texture:Q,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.F,scale:0})}}this.shadowDirection=vm(d);let M=0;if(c.elevation){const W=c.elevation,H=[1e4,-1e4];W.visibleDemTiles.filter(q=>q.dem).forEach(q=>{const G=q.dem.tree;H[0]=Math.min(H[0],G.minimums[0]),H[1]=Math.max(H[1],G.maximums[0])}),H[0]!==1e4&&(M=(H[1]-H[0])*W.exaggeration())}const D=1.5*c.cameraToCenterDistance,z=3*D,F=new Float64Array(16);for(let W=0;W<this._cascades.length;++W){const H=this._cascades[W];let q=c.height/50,G=1;Ji.cascadeCount===1?G=z:W===0?G=D:(q=D,G=z);const[Q,oe]=o0(c,this.shadowDirection,q,G,Ji.shadowMapResolution,M);H.scale=c.scale,H.matrix=Q,H.boundingSphereRadius=oe,a.m.invert(F,H.matrix),H.frustum=a.F.fromInvProjectionMatrix(F,1,0,!0),H.far=G}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ji.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ji.shadowMapResolution,this._uniformValues.u_shadowmap_0=ui.ShadowMap0,this._uniformValues.u_shadowmap_1=ui.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const U=y.transform.elevation;for(const W of this._groundShadowTiles){let H={min:0,max:0};if(U){const q=U.getMinMaxForTile(W);q&&(H=q)}this.addShadowReceiver(W.toUnwrapped(),H.min,H.max)}}get enabled(){return this._enabled}set enabled(c){this._enabled=c}drawShadowPass(c,d){if(!this._enabled)return;const y=this.painter,b=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),b.viewport.set([0,0,Ji.shadowMapResolution,Ji.shadowMapResolution]);for(let T=0;T<this._numCascadesToRender;++T){y.currentShadowCascade=T,b.bindFramebuffer.set(this._cascades[T].framebuffer.framebuffer),b.clear({color:a.C.white,depth:1});for(const S of c.order){const P=c._mergedLayers[S];if(!P.hasShadowPass()||P.isHidden(y.transform.zoom))continue;const M=c.getLayerSourceCache(P),D=M?d[M.id]:void 0;(P.type==="model"||D&&D.length)&&y.renderLayer(y,M,P,D)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const c=this.painter,d=c.style,y=c.context,b=d.directionalLight,T=d.ambientLight;if(!b||!T)return;const S=[],P=ll(c,c.longestCutoffRange);P.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const M=Cd(b,T),D=new a.b4(y.gl.LEQUAL,a.b4.ReadOnly,c.depthRangeFor3D);for(const z of this._groundShadowTiles){const F=z.toUnwrapped(),V=c.isTileAffectedByFog(z),U=c.getOrCreateProgram("groundShadow",{defines:S,overrideFog:V});this.setupShadows(F,U),c.uploadCommonUniforms(y,U,F,null,P);const W={u_matrix:c.transform.calculateProjMatrix(F),u_ground_shadow_factor:M};U.draw(c,y.gl.TRIANGLES,D,a.b6.disabled,a.a.multiply,a.b5.disabled,W,"ground_shadow",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments,{},c.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?a.a.unblended:a.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(c){const d=this.painter.transform,y=d.calculatePosMatrix(c,d.worldSize);return a.m.multiply(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(c){return a.m.multiply(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}setupShadows(c,d,y,b=0){if(!this._enabled)return;const T=this.painter.transform,S=this.painter.context,P=S.gl,M=this._uniformValues,D=new Float64Array(16),z=T.calculatePosMatrix(c,T.worldSize);for(let F=0;F<this._cascades.length;F++)a.m.multiply(D,this._cascades[F].matrix,z),M[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),S.activeTexture.set(P.TEXTURE0+ui.ShadowMap0+F),this._cascades[F].texture.bind(P.NEAREST,P.CLAMP_TO_EDGE);if(this.useNormalOffset=!!y,this.useNormalOffset){const F=a.cg(c.canonical),V=2/T.tileSize*a.J/Ji.shadowMapResolution,U=V*this._cascades[0].boundingSphereRadius,W=V*this._cascades[this._cascades.length-1].boundingSphereRadius,H=(y==="vector-tile"?1:3)/Math.pow(2,b-c.canonical.z-(1-T.zoom+Math.floor(T.zoom)));M.u_shadow_normal_offset=[F,U*H,W*H],M.u_shadow_bias=[6e-5,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(S,M)}setupShadowsFromMatrix(c,d,y=!1){if(!this._enabled)return;const b=this.painter.context,T=b.gl,S=this._uniformValues,P=new Float64Array(16);for(let M=0;M<Ji.cascadeCount;M++)a.m.multiply(P,this._cascades[M].matrix,c),S[M===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),b.activeTexture.set(T.TEXTURE0+ui.ShadowMap0+M),this._cascades[M].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);this.useNormalOffset=y,y?(S.u_shadow_normal_offset=[1,5,5],S.u_shadow_bias=[6e-5,.0012,.012]):S.u_shadow_bias=[36e-5,.0012,.012],d.setShadowUniformValues(b,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(c,d,y,b){if(b[2]>=0)return{};const T=function(M,D,z){const F=z/(1<<M.canonical.z);return new a.c3([M.canonical.x*F+M.wrap*z,M.canonical.y*F+M.wrap*z,0],[(M.canonical.x+1)*F+M.wrap*z,(M.canonical.y+1)*F+M.wrap*z,D])}(c,d,y).getCorners(),S=d/-b[2];b[0]<0?(a.v.add(T[0],T[0],[b[0]*S,0,0]),a.v.add(T[3],T[3],[b[0]*S,0,0])):b[0]>0&&(a.v.add(T[1],T[1],[b[0]*S,0,0]),a.v.add(T[2],T[2],[b[0]*S,0,0])),b[1]<0?(a.v.add(T[0],T[0],[0,b[1]*S,0]),a.v.add(T[1],T[1],[0,b[1]*S,0])):b[1]>0&&(a.v.add(T[2],T[2],[0,b[1]*S,0]),a.v.add(T[3],T[3],[0,b[1]*S,0]));const P={};return P.vertices=T,P.planes=[Gu(T[1],T[0],T[4]),Gu(T[2],T[1],T[5]),Gu(T[3],T[2],T[6]),Gu(T[0],T[3],T[7])],P}addShadowReceiver(c,d,y){this._receivers.add(c,a.c3.fromTileIdAndHeight(c,d,y))}getMaxCascadeForTile(c){const d=this._receivers.get(c);return d&&d.lastCascade?d.lastCascade:0}}function Gu(g,c,d){const y=a.v.sub([],d,c),b=a.v.sub([],g,c),T=a.v.cross([],y,b),S=a.v.length(T);return S===0?[0,0,1,0]:(a.v.scale(T,T,1/S),[T[0],T[1],T[2],-a.v.dot(T,c)])}function vm(g){const c=g.properties.get("direction"),d=a.b3(c.x,c.y,c.z);d[2]=a.c(d[2],0,75);const y=a.ch([d[0],d[1],d[2]]);return a.v.fromValues(y.x,y.y,y.z)}function Cd(g,c){const d=g.properties.get("color"),y=g.properties.get("intensity"),b=g.properties.get("direction"),T=[b.x,b.y,b.z],S=c.properties.get("color"),P=c.properties.get("intensity"),M=Math.max(a.v.dot([0,0,1],T),0),D=[0,0,0];a.v.scale(D,S.toArray01Linear().slice(0,3),P);const z=[0,0,0];return a.v.scale(z,d.toArray01Linear().slice(0,3),M*y),a.bw([D[0]>0?D[0]/(D[0]+z[0]):0,D[1]>0?D[1]/(D[1]+z[1]):0,D[2]>0?D[2]/(D[2]+z[2]):0])}function o0(g,c,d,y,b,T){const S=g.zoom,P=g.scale,M=g.worldSize,D=1/M,z=g.aspect,F=Math.sqrt(1+z*z)*Math.tan(.5*g.fovX),V=F*F,U=y-d,W=y+d;let H,q;V>U/W?(H=y,q=y*F):(H=.5*W*(1+V),q=.5*Math.sqrt(U*U+2*(y*y+d*d)*V+W*W*V*V));const G=g.projection.pixelsPerMeter(g.center.lat,M),Q=g._camera.getCameraToWorldMercator(),oe=[0,0,-H*D];a.v.transformMat4(oe,oe,Q);let ce=q*D;const K=g._edgeInsets;if(!(K.left===0&&K.top===0&&K.right===0&&K.bottom===0||K.left===K.right&&K.top===K.bottom)){const $e=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?G:1),bt=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,d,y);bt[8]=2*-g.centerOffset.x/g.width,bt[9]=2*g.centerOffset.y/g.height;const mt=new Float64Array(16);a.m.mul(mt,bt,$e);const Dt=new Float64Array(16);a.m.invert(Dt,mt);const _t=a.F.fromInvProjectionMatrix(Dt,M,S,!0);for(const Bt of _t.points){const jt=((ee=Bt)[0]/=P,ee[1]/=P,ee[2]=a.b(ee[2],g._center.lat),ee);ce=Math.max(ce,a.v.len(a.v.subtract([],oe,jt)))}}var ee;ce*=b/(b-1);const he=Math.acos(c[2]),ge=Math.atan2(-c[0],-c[1]),de=new Po;de.position=oe,de.setPitchBearing(he,ge);const ye=de.getWorldToCamera(M,G),Ne=ce*M,Ae=Math.min(g._mercatorZfromZoom(17)*M*-2,-2*Ne),Me=de.getCameraToClipOrthographic(-Ne,Ne,-Ne,Ne,Ae,(Ne+T*G)/c[2]),xe=new Float64Array(16);a.m.multiply(xe,Me,ye);const ze=a.v.fromValues(Math.floor(1e6*oe[0])/1e6*M,Math.floor(1e6*oe[1])/1e6*M,0),ke=.5*b,Ve=[0,0,0];a.v.transformMat4(Ve,ze,xe),a.v.scale(Ve,Ve,ke);const ne=[Math.floor(Ve[0]),Math.floor(Ve[1]),Math.floor(Ve[2])],Te=[0,0,0];a.v.sub(Te,Ve,ne),a.v.scale(Te,Te,-1/ke);const Xe=new Float64Array(16);return a.m.identity(Xe),a.m.translate(Xe,Xe,Te),a.m.multiply(xe,Xe,xe),[xe,Ne]}class s0 extends a.a6{constructor(c){super(),this.requestManager=c,this.models={"":{}},this.numModelsLoading={}}loadModel(c,d){return a.aO(this.requestManager.transformRequest(d,a.a2.Model).url).then(y=>{if(!y)return;const b=a.aP(y),T=new a.aQ(c,void 0,void 0,b);return T.computeBoundsAndApplyParent(),T}).catch(y=>{this.fire(new a.a7(new Error(`Could not load model ${c} from ${d}: ${y.message}`)))})}load(c,d){this.models[d]||(this.models[d]={});const y=Object.keys(c);this.numModelsLoading[d]=(this.numModelsLoading[d]||0)+y.length;const b=[];for(const T of y)b.push(this.loadModel(T,c[T]));Promise.allSettled(b).then(T=>{for(let S=0;S<T.length;S++){const{status:P,value:M}=T[S];P==="fulfilled"&&M&&(this.models[d][y[S]]=M)}this.numModelsLoading[d]-=y.length,this.fire(new a.a8("data",{dataType:"style"}))}).catch(T=>{this.fire(new a.a7(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const c in this.numModelsLoading)if(this.numModelsLoading[c]>0)return!1;return!0}hasModel(c,d){return!!this.getModel(c,d)}getModel(c,d){return this.models[d]||(this.models[d]={}),this.models[d][c]}addModel(c,d,y){this.models[y]||(this.models[y]={}),this.hasModel(c,y)&&this.removeModel(c,y),this.load({[c]:this.requestManager.normalizeModelURL(d)},y)}addModels(c,d){const y={};for(const b in c)y[b]=this.requestManager.normalizeModelURL(c[b]);this.load(y,d)}removeModel(c,d){this.models[d]||(this.models[d]={});const y=this.models[d][c];delete this.models[d][c],y.destroy()}listModels(c){return this.models[c]||(this.models[c]={}),Object.keys(this.models[c])}upload(c,d){this.models[d]||(this.models[d]={});for(const y in this.models[d])this.models[d][y].upload(c.context)}}const pl=(g,c)=>a.ai(g,c&&c.filter(d=>d.identifier!=="source.canvas")),a0=a.p(qe,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),l0=a.p(qe,["setCenter","setZoom","setBearing","setPitch"]),xm={version:8,layers:[],sources:{}},Ta={duration:300,delay:0},Wu=new Set(["fill","line","background","hillshade","raster"]);class Oo extends a.a6{constructor(c,d={}){super(),this.map=c,this.scope=d.scope||"",this.fragments=[],this.importDepth=d.importDepth||0,this.importsCache=d.importsCache||new Map,this.resolvedImports=d.resolvedImports||new Set,this.transition=a.ak({},Ta),this._buildingIndex=new Np(this),this.crossTileSymbolIndex=new ow,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=d.styleChanges||new Oe,this.dispatcher=d.dispatcher?d.dispatcher:new a.br(a.bs(),this),d.imageManager?this.imageManager=d.imageManager:(this.imageManager=new Sr,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=d.glyphManager?d.glyphManager:new a.cj(c._requestManager,d.localFontFamily?a.ck.all:d.localIdeographFontFamily?a.ck.ideographs:a.ck.none,d.localFontFamily||d.localIdeographFontFamily),d.modelManager?this.modelManager=d.modelManager:(this.modelManager=new s0(c._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=d.configOptions?d.configOptions:new Map,this._configDependentLayers=d.configDependentLayers?d.configDependentLayers:new Set,this._config=d.config,this.dispatcher.broadcast("setReferrer",a.cl());const y=this;this._rtlTextPluginCallback=Oo.registerForPluginStateChange(b=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(T,S)=>{if(a.cm(T),S&&S.every(P=>P))for(const P in y._sourceCaches){const M=y._sourceCaches[P],D=M.getSource().type;D!=="vector"&&D!=="geojson"||M.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const T=this.getOwnSource(b.sourceId);if(T&&T.vectorLayerIds)for(const S in this._layers){const P=this._layers[S];P.source===T.id&&this._validateLayer(P)}})}loadURL(c,d={}){this.fire(new a.a8("dataloading",{dataType:"style"}));const y=typeof d.validate=="boolean"?d.validate:!a.cn(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken),this.resolvedImports.add(c);const b=this.importsCache.get(c);if(b)return this._load(b,y);const T=this.map._requestManager.transformRequest(c,a.a2.Style);this._request=a.a1(T,(S,P)=>{if(this._request=null,S)this.fire(new a.a7(S));else if(P)return this.importsCache.set(c,P),this._load(P,y)})}loadJSON(c,d={}){this.fire(new a.a8("dataloading",{dataType:"style"})),this._request=a.a4.frame(()=>{this._request=null,this._load(c,d.validate!==!1)})}loadEmpty(){this.fire(new a.a8("dataloading",{dataType:"style"})),this._load(xm,!1)}_loadImports(c,d){if(this.importDepth>=4)return a.X("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const b of c){const T=this._createFragmentStyle(b),S=new Promise(M=>{T.once("style.import.load",M),T.once("error",M)}).then(()=>this.mergeAll());if(y.push(S),this.resolvedImports.has(b.url)){T.loadEmpty();continue}const P=b.data||this.importsCache.get(b.url);P?T.loadJSON(P,{validate:d}):b.url?T.loadURL(b.url,{validate:d}):T.loadEmpty(),this.fragments.push({style:T,id:b.id,config:b.config})}return Promise.allSettled(y)}_createFragmentStyle(c){const d=this.scope?a.aE(c.id,this.scope):c.id,y=new Oo(this.map,{scope:d,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const c=this.isRootStyle();this._shouldPrecompile=c,this.fire(new a.a8(c?"style.load":"style.import.load"))}_load(c,d){const y=c.schema;if(this.isRootStyle()&&(c.fragment||y&&c.fragment!==!1)){const S=a.ak({},xm,{imports:[{id:"basemap",data:c,url:""}]});return void this._load(S,d)}if(this.setConfig(this._config,y),d&&pl(this,a.aj(c)))return;this._loaded=!0,this.stylesheet=a.co(c);for(const S in c.sources)this.addSource(S,c.sources[S],{validate:!1,isInitialLoad:!0});c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(c.glyphs,this.scope);const b=nl(this.stylesheet.layers);if(this._order=b.map(S=>S.id),this.stylesheet.light&&a.X("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const S=this.stylesheet.lights[0];this.light=new yi(S.properties,S.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new yi(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const S of b){const P=a.cp(S,this.scope,this.options);P.isConfigDependent&&this._configDependentLayers.add(P.fqid),P.setEventedParent(this,{layer:{id:P.id}}),this._layers[P.id]=P,this._serializedLayers[P.id]=P.serialize();const M=this.getOwnLayerSourceCache(P),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&P.canCastShadows()&&D&&(M.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const T=this.stylesheet.terrain;T&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.a4.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?a.X("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.a8("data",{dataType:"style"})),c.imports?this._loadImports(c.imports,d).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let c,d,y,b,T,S,P,M;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(D=>{if(D.stylesheet){if(D.light!=null&&(c=D.light),D.stylesheet.lights)for(const z of D.stylesheet.lights)z.type==="ambient"&&D.ambientLight!=null&&(d=D.ambientLight),z.type==="directional"&&D.directionalLight!=null&&(y=D.directionalLight);b=this._prioritizeTerrain(b,D.terrain,D.stylesheet.terrain),D.stylesheet.fog&&D.fog!=null&&(T=D.fog),D.stylesheet.camera!=null&&(M=D.stylesheet.camera),D.stylesheet.projection!=null&&(S=D.stylesheet.projection),D.stylesheet.transition!=null&&(P=D.stylesheet.transition)}}),this.light=c,this.ambientLight=d,this.directionalLight=y,this.fog=T,b===null?delete this.terrain:this.terrain=b,this.camera=M||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=a.ak({},Ta,P),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(c){const d=y=>{for(const b of y.fragments)d(b.style);c(y)};d(this)}_prioritizeTerrain(c,d,y){const b=c&&c.drapeRenderMode===0;return y===null?d&&d.drapeRenderMode===0?d:b?c:null:d!=null&&(!c||b||d&&d.drapeRenderMode===1)?d:c}mergeTerrain(){let c;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(d=>{c=this._prioritizeTerrain(c,d.terrain,d.stylesheet.terrain)}),c===null?delete this.terrain:this.terrain=c}mergeProjection(){let c;this.forEachFragmentStyle(d=>{d.stylesheet.projection!=null&&(c=d.stylesheet.projection)}),this.projection=c||{name:"mercator"}}mergeSources(){const c={},d={},y={};this.forEachFragmentStyle(b=>{for(const T in b._sourceCaches){const S=a.aE(T,b.scope);c[S]=b._sourceCaches[T]}for(const T in b._otherSourceCaches){const S=a.aE(T,b.scope);d[S]=b._otherSourceCaches[T]}for(const T in b._symbolSourceCaches){const S=a.aE(T,b.scope);y[S]=b._symbolSourceCaches[T]}}),this._mergedSourceCaches=c,this._mergedOtherSourceCaches=d,this._mergedSymbolSourceCaches=y}mergeLayers(){const c={},d=[],y={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(T=>{for(const S of T._order){const P=T._layers[S];if(P.type==="slot"){const M=a.cq(S);if(c[M])continue;c[M]=[]}P.slot&&c[P.slot]?c[P.slot].push(P):d.push(P)}}),this._mergedOrder=[];const b=(T=[])=>{for(const S of T)if(S.type==="slot"){const P=a.cq(S.id);c[P]&&b(c[P])}else{const P=a.aE(S.id,S.scope);this._mergedOrder.push(P),y[P]=S,S.is3D()&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0)}};b(d),this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(c){return this.stylesheet.camera=a.ak({},this.stylesheet.camera,c),this.camera=this.stylesheet.camera,this}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(c){this._spriteRequest=function(d,y,b){let T,S,P;const M=a.a4.devicePixelRatio>1?"@2x":"";let D=a.a1(y.transformRequest(y.normalizeSpriteURL(d,M,".json"),a.a2.SpriteJSON),(V,U)=>{D=null,P||(P=V,T=U,F())}),z=a.a3(y.transformRequest(y.normalizeSpriteURL(d,M,".png"),a.a2.SpriteImage),(V,U)=>{z=null,P||(P=V,S=U,F())});function F(){if(P)b(P);else if(T&&S){const V=a.a4.getImageData(S),U={};for(const W in T){const{width:H,height:q,x:G,y:Q,sdf:oe,pixelRatio:ce,stretchX:K,stretchY:ee,content:he}=T[W],ge=new a.a5({width:H,height:q});a.a5.copy(V,ge,{x:G,y:Q},{x:0,y:0},{width:H,height:q}),U[W]={data:ge,pixelRatio:ce,sdf:oe,stretchX:K,stretchY:ee,content:he}}b(null,U)}}return{cancel(){D&&(D.cancel(),D=null),z&&(z.cancel(),z=null)}}}(c,this.map._requestManager,(d,y)=>{if(this._spriteRequest=null,d)this.fire(new a.a7(d));else if(y)for(const b in y)this.imageManager.addImage(b,this.scope,y[b]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.a8("data",{dataType:"style"}))})}_validateLayer(c){const d=this.getOwnSource(c.source);if(!d)return;const y=c.sourceLayer;y&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(y)===-1)&&this.fire(new a.a7(new Error(`Source layer "${y}" does not exist on source "${d.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:c}of this.fragments)if(!c.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((c,d)=>{const y=this.fragments[d];return y&&y.style&&(c.data=y.style.serialize()),c})}_serializeSources(){const c={};for(const d in this._sourceCaches){const y=this._sourceCaches[d].getSource();c[y.id]||(c[y.id]=y.serialize())}return c}_serializeLayers(c){const d=[];for(const y of c){const b=this._layers[y];b&&b.type!=="custom"&&d.push(b.serialize())}return d}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(c){return!!this.terrain&&(typeof c.isLayerDraped=="function"?c.isLayerDraped(this.getLayerSourceCache(c)):Wu.has(c.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(c){const d=this.getOwnLayer(c);if(d)return d;this.fire(new a.a7(new Error(`The layer '${c}' does not exist in the map's style.`)))}_checkSource(c){const d=this.getOwnSource(c);if(d)return d;this.fire(new a.a7(new Error(`The source '${c}' does not exist in the map's style.`)))}update(c){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(c),this.directionalLight&&this.directionalLight.recalculate(c);const d=this.calculateLightsBrightness();c.brightness=d||0,d!==this._brightness&&(this._brightness=d,this.dispatcher.broadcast("setBrightness",d));const y=this._changes.isDirty();if(this._changes.isDirty()){const T=this._changes.getLayerUpdatesByScope();for(const S in T){const{updatedIds:P,removedIds:M}=T[S];(P||M)&&this._updateWorkerLayers(S,P,M)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(c),this.light&&this.light.updateTransitions(c),this.ambientLight&&this.ambientLight.updateTransitions(c),this.directionalLight&&this.directionalLight.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._changes.reset()}const b={};for(const T in this._mergedSourceCaches){const S=this._mergedSourceCaches[T];b[T]=S.used,S.used=!1}for(const T of this._mergedOrder){const S=this._mergedLayers[T];if(S.recalculate(c,this._availableImages),!S.isHidden(c.zoom)){const P=this.getLayerSourceCache(S);P&&(P.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let P=S.minzoom||0;P<(S.maxzoom||25.5);P++){const M=this.map.painter;if(M){const D=S.getProgramIds();if(!D)continue;for(const z of D){const F=S.getDefaultProgramParams(z,c.zoom);F&&(M.style=this,this.fog&&(M._fogVisible=!0,F.overrideFog=!0,M.getOrCreateProgram(z,F)),M._fogVisible=!1,F.overrideFog=!1,M.getOrCreateProgram(z,F),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(F.overrideRtt=!0,M.getOrCreateProgram(z,F)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const T in b){const S=this._mergedSourceCaches[T];b[T]!==S.used&&S.getSource().fire(new a.a8("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light&&this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),y&&this.fire(new a.a8("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=this._changes.getUpdatedImages();if(c.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changes.resetUpdatedImages()}}_updateWorkerLayers(c,d,y){const b=this.getFragmentStyle(c);b&&this.dispatcher.broadcast("updateLayers",{layers:d?b._serializeLayers(d):[],scope:c,removedIds:y||[],options:b.options})}setState(c){if(this._checkLoaded(),pl(this,a.aj(c)))return!1;(c=a.co(c)).layers=nl(c.layers);const d=function(b,T){if(!b)return[{command:qe.setStyle,args:[T]}];let S=[];try{if(!A(b.version,T.version))return[{command:qe.setStyle,args:[T]}];A(b.center,T.center)||S.push({command:qe.setCenter,args:[T.center]}),A(b.zoom,T.zoom)||S.push({command:qe.setZoom,args:[T.zoom]}),A(b.bearing,T.bearing)||S.push({command:qe.setBearing,args:[T.bearing]}),A(b.pitch,T.pitch)||S.push({command:qe.setPitch,args:[T.pitch]}),A(b.sprite,T.sprite)||S.push({command:qe.setSprite,args:[T.sprite]}),A(b.glyphs,T.glyphs)||S.push({command:qe.setGlyphs,args:[T.glyphs]}),A(b.imports,T.imports)||function(F=[],V=[],U){V=V||[];const W=(F=F||[]).map(rl),H=V.map(rl),q=F.reduce(ma,{}),G=V.reduce(ma,{}),Q=W.slice();let oe,ce,K,ee;for(oe=0,ce=0;oe<W.length;oe++)K=W[oe],G.hasOwnProperty(K)?ce++:(U.push({command:qe.removeImport,args:[K]}),Q.splice(Q.indexOf(K,ce),1));for(oe=0,ce=0;oe<H.length;oe++)K=H[H.length-1-oe],Q[Q.length-1-oe]!==K&&(q.hasOwnProperty(K)?(U.push({command:qe.removeImport,args:[K]}),Q.splice(Q.lastIndexOf(K,Q.length-ce),1)):ce++,ee=Q[Q.length-oe],U.push({command:qe.addImport,args:[G[K],ee]}),Q.splice(Q.length-oe,0,K));for(const he of V){const ge=q[he.id];if(!ge||A(ge,he))continue;A(ge.config,he.config)||U.push({command:qe.setImportConfig,args:[he.id,he.config]}),A(ge.url,he.url)||U.push({command:qe.setImportUrl,args:[he.id,he.url]});const de=he.data;A(ge&&ge.data,de)||U.push({command:qe.setImportData,args:[he.id,de]})}}(b.imports,T.imports,S),A(b.transition,T.transition)||S.push({command:qe.setTransition,args:[T.transition]}),A(b.light,T.light)||S.push({command:qe.setLight,args:[T.light]}),A(b.fog,T.fog)||S.push({command:qe.setFog,args:[T.fog]}),A(b.projection,T.projection)||S.push({command:qe.setProjection,args:[T.projection]}),A(b.lights,T.lights)||S.push({command:qe.setLights,args:[T.lights]}),A(b.camera,T.camera)||S.push({command:qe.setCamera,args:[T.camera]});const P={},M=[];(function(F,V,U,W){let H;for(H in V=V||{},F=F||{})F.hasOwnProperty(H)&&(V.hasOwnProperty(H)||bn(H,U,W));for(H in V){if(!V.hasOwnProperty(H))continue;const q=V[H];F.hasOwnProperty(H)?A(F[H],q)||(F[H].type==="geojson"&&q.type==="geojson"&&uc(F,V,H)?U.push({command:qe.setGeoJSONSourceData,args:[H,q.data]}):Co(H,V,U,W)):_n(H,V,U)}})(b.sources,T.sources,M,P);const D=[];b.layers&&b.layers.forEach(F=>{F.source&&P[F.source]?S.push({command:qe.removeLayer,args:[F.id]}):D.push(F)});let z=b.terrain;z&&P[z.source]&&(S.push({command:qe.setTerrain,args:[void 0]}),z=void 0),S=S.concat(M),A(z,T.terrain)||S.push({command:qe.setTerrain,args:[T.terrain]}),function(F,V,U){V=V||[];const W=(F=F||[]).map(rl),H=V.map(rl),q=F.reduce(ma,{}),G=V.reduce(ma,{}),Q=W.slice(),oe=Object.create(null);let ce,K,ee,he,ge,de,ye;for(ce=0,K=0;ce<W.length;ce++)ee=W[ce],G.hasOwnProperty(ee)?K++:(U.push({command:qe.removeLayer,args:[ee]}),Q.splice(Q.indexOf(ee,K),1));for(ce=0,K=0;ce<H.length;ce++)ee=H[H.length-1-ce],Q[Q.length-1-ce]!==ee&&(q.hasOwnProperty(ee)?(U.push({command:qe.removeLayer,args:[ee]}),Q.splice(Q.lastIndexOf(ee,Q.length-K),1)):K++,de=Q[Q.length-ce],U.push({command:qe.addLayer,args:[G[ee],de]}),Q.splice(Q.length-ce,0,ee),oe[ee]=!0);for(ce=0;ce<H.length;ce++)if(ee=H[ce],he=q[ee],ge=G[ee],!oe[ee]&&!A(he,ge))if(A(he.source,ge.source)&&A(he["source-layer"],ge["source-layer"])&&A(he.type,ge.type)){for(ye in pn(he.layout,ge.layout,U,ee,null,qe.setLayoutProperty),pn(he.paint,ge.paint,U,ee,null,qe.setPaintProperty),A(he.slot,ge.slot)||U.push({command:qe.setSlot,args:[ee,ge.slot]}),A(he.filter,ge.filter)||U.push({command:qe.setFilter,args:[ee,ge.filter]}),A(he.minzoom,ge.minzoom)&&A(he.maxzoom,ge.maxzoom)||U.push({command:qe.setLayerZoomRange,args:[ee,ge.minzoom,ge.maxzoom]}),he)he.hasOwnProperty(ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&ye!=="slot"&&(ye.indexOf("paint.")===0?pn(he[ye],ge[ye],U,ee,ye.slice(6),qe.setPaintProperty):A(he[ye],ge[ye])||U.push({command:qe.setLayerProperty,args:[ee,ye,ge[ye]]}));for(ye in ge)ge.hasOwnProperty(ye)&&!he.hasOwnProperty(ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&ye!=="slot"&&(ye.indexOf("paint.")===0?pn(he[ye],ge[ye],U,ee,ye.slice(6),qe.setPaintProperty):A(he[ye],ge[ye])||U.push({command:qe.setLayerProperty,args:[ee,ye,ge[ye]]}))}else U.push({command:qe.removeLayer,args:[ee]}),de=Q[Q.lastIndexOf(ee)+1],U.push({command:qe.addLayer,args:[ge,de]})}(D,T.layers,S)}catch(P){console.warn("Unable to compute style diff:",P),S=[{command:qe.setStyle,args:[T]}]}return S}(this.serialize(),c).filter(b=>!(b.command in l0));if(d.length===0)return!1;const y=d.filter(b=>!(b.command in a0));if(y.length>0)throw new Error(`Unimplemented: ${y.map(b=>b.command).join(", ")}.`);return d.forEach(b=>{this[b.command].apply(this,b.args)}),this.stylesheet=c,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(c,d){return this.getImage(c)?this.fire(new a.a7(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,this.scope,d),this._afterImageUpdated(c),this)}updateImage(c,d){this.imageManager.updateImage(c,this.scope,d)}getImage(c){return this.imageManager.getImage(c,this.scope)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c,this.scope),this._afterImageUpdated(c),this):this.fire(new a.a7(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(c),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new a.a8("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(c,d,y={}){return this._checkLoaded(),this._validate(a.cr,`models.${c}`,d,null,y)||(this.modelManager.addModel(c,d,this.scope),this._changes.setDirty()),this}hasModel(c){return this.modelManager.hasModel(c,this.scope)}removeModel(c){return this.hasModel(c)?(this.modelManager.removeModel(c,this.scope),this):this.fire(new a.a7(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(c,d,y={}){if(this._checkLoaded(),this.getOwnSource(c)!==void 0)throw new Error(`There is already a source with ID "${c}".`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(a.cs,`sources.${c}`,d,null,y))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=Yo(c,d,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const T=S=>{const P=(S?"symbol:":"other:")+b.id,M=a.aE(P,this.scope),D=this._sourceCaches[P]=new a.bq(M,b,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=D,D.onAdd(this.map)};T(!1),d.type!=="vector"&&d.type!=="geojson"||T(!0),b.onAdd&&b.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(c){this._checkLoaded();const d=this.getOwnSource(c);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===c)return this.fire(new a.a7(new Error(`Source "${c}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===c)return this.fire(new a.a7(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const y=this.getOwnSourceCaches(c);for(const b of y){const T=a.cq(b.id);delete this._sourceCaches[T],this._changes.discardSourceCacheUpdate(b.id),b.fire(new a.a8("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],this.mergeSources(),d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(c,d){this._checkLoaded(),this.getOwnSource(c).setData(d),this._changes.setDirty()}getOwnSource(c){const d=this.getOwnSourceCache(c);return d&&d.getSource()}getOwnSources(){const c=[];for(const d in this._otherSourceCaches){const y=this.getOwnSourceCache(d);y&&c.push(y.getSource())}return c}areTilesLoaded(){const c=this._mergedSourceCaches;for(const d in c){const y=c[d]._tiles;for(const b in y){const T=y[b];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}setLights(c){if(this._checkLoaded(),!c)return delete this.ambientLight,void delete this.directionalLight;const d=this._getTransitionParameters();for(const b of c){if(this._validate(a.ct,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(b),T.updateTransitions(d)}else this.ambientLight=new Mu(b,Qa,this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(b),T.updateTransitions(d)}else this.directionalLight=new Mu(b,Dy,this.scope,this.options)}}const y=new a.al(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const c=this.directionalLight,d=this.ambientLight;if(!c||!d)return;const y=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),b=c.properties.get("color").toArray01(),T=c.properties.get("intensity"),S=c.properties.get("direction"),P=1-a.b3(S.x,S.y,S.z)[2]/90,M=y(b)*T*P,D=d.properties.get("color").toArray01(),z=d.properties.get("intensity");return(M+y(D)*z)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const c=[];return this.directionalLight&&c.push(this.directionalLight.get()),this.ambientLight&&c.push(this.ambientLight.get()),c}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(c){if(!c)return this;if(a.cu(c)){const d=a.cv(c),y=this.fragments.find(({id:T})=>T===d);if(!y)throw new Error(`Style import not found: ${c}`);const b=a.cq(c);return y.style.getFragmentStyle(b)}{const d=this.fragments.find(({id:y})=>y===c);if(!d)throw new Error(`Style import not found: ${c}`);return d.style}}getConfigProperty(c,d){const y=this.getFragmentStyle(c);if(!y)return null;const b=a.aE(d,y.scope),T=y.options.get(b),S=T?T.value||T.default:null;return S?S.serialize():null}setConfigProperty(c,d,y){const b=a.cw(y);if(b.result!=="success")return void pl(this,b.value);const T=b.value.expression,S=this.getFragmentStyle(c);if(!S)return;const P=a.aE(d,S.scope),M=S.options.get(P);M&&(this.options.set(P,{...M,value:T}),this.updateConfigDependencies())}setConfig(c,d){if(this._config=c,c||d)if(d)for(const y in d){let b,T;const S=a.cw(d[y].default);if(S.result==="success"&&(b=S.value.expression),c&&c[y]!==void 0){const V=a.cw(c[y]);V.result==="success"&&(T=V.value.expression)}const{minValue:P,maxValue:M,stepValue:D,type:z,values:F}=d[y];if(b){const V=a.aE(y,this.scope);this.options.set(V,{default:b,value:T,minValue:P,maxValue:M,stepValue:D,type:z,values:F})}else this.fire(new a.a7(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new a.a7(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const c of this._configDependentLayers){const d=this.getLayer(c);d&&(d.possiblyEvaluateVisibility(),this._updateLayer(d))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(c,d,y={}){this._checkLoaded();const b=c.id;if(this._layers[b])return void this.fire(new a.a7(new Error(`Layer with id "${b}" already exists on this map`)));let T;if(c.type==="custom"){if(pl(this,a.cx(c)))return;T=a.cp(c,this.scope,this.options)}else{if(typeof c.source=="object"&&(this.addSource(b,c.source),c=a.co(c),c=a.ak(c,{source:b})),this._validate(a.cy,`layers.${b}`,c,{arrayIndex:-1},y))return;T=a.cp(c,this.scope,this.options),this._validateLayer(T),T.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[T.id]=T.serialize()}T.isConfigDependent&&this._configDependentLayers.add(T.fqid);let S=this._order.length;if(d){const z=this._order.indexOf(d);if(z===-1)return void this.fire(new a.a7(new Error(`Layer with id "${d}" does not exist on this map.`)));T.slot===this._layers[d].slot?S=z:a.X(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,b),this._layerOrderChanged=!0,this._layers[b]=T;const P=this.getOwnLayerSourceCache(T),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&T.canCastShadows()&&M&&(P.castsShadows=!0);const D=this._changes.getRemovedLayer(T);if(D&&T.source&&P&&T.type!=="custom"){this._changes.discardLayerRemoval(T);const z=a.aE(T.source,T.scope);D.type!==T.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),P.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),T.scope=this.scope,this.mergeLayers()}moveLayer(c,d){this._checkLoaded();const y=this._checkLayer(c);if(!y||c===d)return;const b=this._order.indexOf(c);this._order.splice(b,1);let T=this._order.length;if(d){const S=this._order.indexOf(d);if(S===-1)return void this.fire(new a.a7(new Error(`Layer with id "${d}" does not exist on this map.`)));y.slot===this._layers[d].slot?T=S:a.X(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,c),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(c){this._checkLoaded();const d=this._checkLayer(c);if(!d)return;d.setEventedParent(null);const y=this._order.indexOf(c);this._order.splice(y,1),delete this._layers[c],delete this._serializedLayers[c],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(d.fqid),this._changes.removeLayer(d);const b=this.getOwnLayerSourceCache(d);if(b&&b.castsShadows){let T=!1;for(const S in this._layers)if(this._layers[S].source===d.source&&this._layers[S].canCastShadows()){T=!0;break}b.castsShadows=T}d.onRemove&&d.onRemove(this.map),this.mergeLayers()}getOwnLayer(c){return this._layers[c]}hasLayer(c){return c in this._mergedLayers}hasLayerType(c){for(const d in this._layers)if(this._layers[d].type===c)return!0;return!1}setLayerZoomRange(c,d,y){this._checkLoaded();const b=this._checkLayer(c);b&&(b.minzoom===d&&b.maxzoom===y||(d!=null&&(b.minzoom=d),y!=null&&(b.maxzoom=y),this._updateLayer(b)))}setSlot(c,d){this._checkLoaded();const y=this._checkLayer(c);y&&y.slot!==d&&(y.slot=d,this._updateLayer(y))}setFilter(c,d,y={}){this._checkLoaded();const b=this._checkLayer(c);if(b&&!A(b.filter,d))return d==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(a.cz,`layers.${b.id}.filter`,d,{layerType:b.type},y)||(b.filter=a.co(d),this._updateLayer(b)))}getFilter(c){const d=this._checkLayer(c);if(d)return a.co(d.filter)}setLayoutProperty(c,d,y,b={}){this._checkLoaded();const T=this._checkLayer(c);T&&(A(T.getLayoutProperty(d),y)||(T.setLayoutProperty(d,y,b),T.isConfigDependent&&this._configDependentLayers.add(T.fqid),this._updateLayer(T)))}getLayoutProperty(c,d){const y=this._checkLayer(c);if(y)return y.getLayoutProperty(d)}setPaintProperty(c,d,y,b={}){this._checkLoaded();const T=this._checkLayer(c);if(!T||A(T.getPaintProperty(d),y))return;const S=T.setPaintProperty(d,y,b);T.isConfigDependent&&this._configDependentLayers.add(T.fqid),S&&this._updateLayer(T),this._changes.updatePaintProperties(T)}getPaintProperty(c,d){const y=this._checkLayer(c);if(y)return y.getPaintProperty(d)}setFeatureState(c,d){this._checkLoaded();const y=c.source,b=c.sourceLayer,T=this._checkSource(y);if(!T)return;const S=T.type;if(S==="geojson"&&b)return void this.fire(new a.a7(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!b)return void this.fire(new a.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));c.id===void 0&&this.fire(new a.a7(new Error("The feature id parameter must be provided.")));const P=this.getOwnSourceCaches(y);for(const M of P)M.setFeatureState(b,c.id,d)}removeFeatureState(c,d){this._checkLoaded();const y=c.source,b=this._checkSource(y);if(!b)return;const T=b.type,S=T==="vector"?c.sourceLayer:void 0;if(T==="vector"&&!S)return void this.fire(new a.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof c.id!="string"&&typeof c.id!="number")return void this.fire(new a.a7(new Error("A feature id is required to remove its specific state property.")));const P=this.getOwnSourceCaches(y);for(const M of P)M.removeFeatureState(S,c.id,d)}getFeatureState(c){this._checkLoaded();const d=c.source,y=c.sourceLayer,b=this._checkSource(d);if(b){if(b.type!=="vector"||y)return c.id===void 0&&this.fire(new a.a7(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(y,c.id);this.fire(new a.a7(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(c){return this.stylesheet.transition=a.ak({},this.stylesheet.transition,c),this.transition=this.stylesheet.transition,this}getTransition(){return a.ak({},this.stylesheet.transition)}serialize(){this._checkLoaded();const c=this.getTerrain(),d=c&&this.terrain&&this.terrain.scope===this.scope?c:this.stylesheet.terrain;return a.cA({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:d,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>y!==void 0)}_updateLayer(c){this._changes.updateLayer(c);const d=this.getLayerSourceCache(c),y=a.aE(c.source,c.scope),b=this._changes.getUpdatedSourceCaches();c.source&&!b[y]&&d&&d.getSource().type!=="raster"&&(this._changes.updateSourceCache(y,"reload"),d.pause()),c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const d=P=>this._mergedLayers[P].type==="fill-extrusion",y=this.order,b={},T=[];for(let P=y.length-1;P>=0;P--){const M=y[P];if(d(M)){b[M]=P;for(const D of c){const z=D[M];if(z)for(const F of z)T.push(F)}}}T.sort((P,M)=>M.intersectionZ-P.intersectionZ);const S=[];for(let P=y.length-1;P>=0;P--){const M=y[P];if(d(M))for(let D=T.length-1;D>=0;D--){const z=T[D].feature;if(b[z.layer.id]<P)break;S.push(z),T.pop()}else for(const D of c){const z=D[M];if(z)for(const F of z)S.push(F.feature)}}return S}queryRenderedFeatures(c,d,y){d&&d.filter&&this._validate(a.cz,"queryRenderedFeatures.filter",d.filter,null,d),d.scope=this.scope,d.availableImages=this._availableImages,d.serializedLayers=this._serializedLayers;const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new a.a7(new Error("parameters.layers must be an Array."))),[];for(const D of d.layers){const z=this._mergedLayers[D];if(!z)return this.fire(new a.a7(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];b[z.source]=!0}}const T=[],S=d.serializedLayers||{},P=d&&d.layers?d.layers.some(D=>{const z=this.getLayer(D);return z&&z.is3D()}):this.has3DLayers(),M=Li.createFromScreenPoints(c,y);for(const D in this._mergedSourceCaches){const z=this._mergedSourceCaches[D].getSource();if(!z||z.scope!==d.scope)continue;const F=this._mergedSourceCaches[D].getSource().id;d.layers&&!b[F]||T.push($s(this._mergedSourceCaches[D],this._mergedLayers,S,M,d,y,P,!!this.map._showQueryGeometry))}return this.placement&&T.push(function(D,z,F,V,U,W,H){const q={},G=W.queryRenderedSymbols(V),Q=[];for(const oe of Object.keys(G).map(Number))Q.push(H[oe]);Q.sort(Ko);for(const oe of Q){const ce=oe.featureIndex.lookupSymbolFeatures(G[oe.bucketInstanceId],z,oe.bucketIndex,oe.sourceLayerIndex,U.filter,U.layers,U.availableImages,D);for(const K in ce){const ee=q[K]=q[K]||[],he=ce[K];he.sort((ge,de)=>{const ye=oe.featureSortOrder;if(ye){const Ne=ye.indexOf(ge.featureIndex);return ye.indexOf(de.featureIndex)-Ne}return de.featureIndex-ge.featureIndex});for(const ge of he)ee.push(ge)}}for(const oe in q)q[oe].forEach(ce=>{const K=ce.feature,ee=F(D[oe]);if(!ee)return;const he=ee.getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=he});return q}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),M.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(c,d){d&&d.filter&&this._validate(a.cz,"querySourceFeatures.filter",d.filter,null,d);const y=this.getOwnSourceCaches(c);let b=[];for(const T of y)b=b.concat(nw(T,d));return b}addSourceType(c,d,y){return Oo.getSourceType(c)?y(new Error(`A source type called "${c}" already exists.`)):(Oo.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(c,d,y={}){this._checkLoaded();const b=this.light.getLight();let T=!1;for(const P in c)if(!A(c[P],b[P])){T=!0;break}if(!T)return;const S=this._getTransitionParameters();this.light.setLight(c,d,y),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,d=1){if(this._checkLoaded(),!c)return delete this.terrain,c===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let y=c;const b=c.source==null;if(d===1){if(typeof y.source=="object"){const P="terrain-dem-src";this.addSource(P,y.source),y=a.co(y),y=a.ak(y,{source:P})}const T=a.ak({},y),S={};if(this.terrain&&b){T.source=this.terrain.get().source;const P=this.terrain?this.getFragmentStyle(this.terrain.scope):null;P&&(S.style=P.serialize())}if(this._validate(a.cB,"terrain",T,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&d!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,d),this.fire(new a.a8("data",{dataType:"style"}))}else{const T=this.terrain,S=T.get();for(const P of Object.keys(a.ae.terrain))!y.hasOwnProperty(P)&&a.ae.terrain[P].default&&(y[P]=a.ae.terrain[P].default);for(const P in c)if(!A(c[P],S[P])){T.set(c,this.options),this.stylesheet.terrain=c;const M=this._getTransitionParameters({duration:0});T.updateTransitions(M),this.fire(new a.a8("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const d=this.fog=new zp(c,this.map.transform);this.stylesheet.fog=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog;if(!A(d.get(),c)){d.set(c),this.stylesheet.fog=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}}else this._createFog(c);this._markersNeedUpdate=!0}_getTransitionParameters(c){return{now:a.a4.now(),transition:a.ak(this.transition,c)}}updateDrapeFirstLayers(){if(!this.terrain)return;const c=[],d=[];for(const y in this._mergedLayers)this.isLayerDraped(this._mergedLayers[y])?c.push(y):d.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...d)}_createTerrain(c,d){const y=this.terrain=new ko(c,d,this.scope,this.options);d===1&&(this.stylesheet.terrain=c),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});y.updateTransitions(b)}_force3DLayerUpdate(){for(const c in this._layers){const d=this._layers[c];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const d=this._layers[c];d.type==="symbol"&&this._updateLayer(d)}}_validate(c,d,y,b,T={}){if(T&&T.validate===!1)return!1;const S=a.ak({},this.serialize());return pl(this,c.call(a.aj,a.ak({key:d,style:S,value:y,styleSpec:a.ae},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.cC.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._mergedLayers)this._mergedLayers[c].setEventedParent(null);for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].clearTiles(),this._mergedSourceCaches[c].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(c){const d=this.getSourceCaches(c);for(const y of d)y.clearTiles()}clearSources(){for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].clearTiles()}reloadSource(c){const d=this.getSourceCaches(c);for(const y of d)y.resume(),y.reload()}reloadSources(){for(const c of this.getSources())c.reload&&c.reload()}updateSources(c){let d;this.directionalLight&&(d=vm(this.directionalLight));for(const y in this._mergedSourceCaches)this._mergedSourceCaches[y].update(c,void 0,void 0,d)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const d=this._sourceCaches[c];d.resume(),d.reload()}}_updatePlacement(c,d,y,b,T=!1){let S=!1,P=!1;const M={},D={};for(const z of this._mergedOrder){const F=this._mergedLayers[z];if(F.type!=="symbol")continue;const V=a.aE(F.source,F.scope);let U=M[V];if(!U){const H=this.getLayerSourceCache(F);if(!H)continue;const q=H.getRenderableIds(!0).map(G=>H.getTileByID(G));D[V]=q.slice(),U=M[V]=q.sort((G,Q)=>Q.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(Q.tileID)?-1:1))}const W=this.crossTileSymbolIndex.addLayer(F,U,c.center.lng,c.projection);S=S||W}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),T=T||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new a.a8("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.a4.now(),c.zoom))&&(this.pauseablePlacement=new Gp(c,this._mergedOrder,T,d,y,b,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,M,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.a4.now()),P=!0),S&&this.pauseablePlacement.placement.setStale()),P||S)for(const z of this._mergedOrder){const F=this._mergedLayers[z];F.type==="symbol"&&this.placement.updateLayerOpacities(F,M[a.aE(F.source,F.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.a4.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}addImport(c){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];return d.findIndex(({id:y})=>y===c.id)!==-1?this.fire(new a.a7(new Error(`Import with id '${c.id}' already exists in the map's style.`))):(d.push(c),this._loadImports([c],!0),this)}setImportUrl(c,d){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(c);if(b===-1)return this;y[b].url=d;const T=this.fragments[b];return T.style=this._createFragmentStyle(y[b]),T.style.on("style.import.load",()=>this.mergeAll()),T.style.loadURL(d),this}setImportData(c,d){this._checkLoaded();const y=this.getImportIndex(c),b=this.stylesheet.imports||[];return y===-1?this:d?(this.fragments[y].style.setState(d),this._reloadImports(),this):(delete b[y].data,this.setImportUrl(c,b[y].url))}setImportConfig(c,d){this._checkLoaded();const y=this.getImportIndex(c),b=this.stylesheet.imports||[];if(y===-1)return this;d?b[y].config=d:delete b[y].config;const T=this.fragments[y],S=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=d,T.style.setConfig(d,S),this.updateConfigDependencies(),this}removeImport(c){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(c);return y===-1||(d.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports()),this}getImportIndex(c){const d=(this.stylesheet.imports||[]).findIndex(y=>y.id===c);return d===-1&&this.fire(new a.a7(new Error(`Import '${c}' does not exist in the map's style and cannot be updated.`))),d}getLayer(c){return this._mergedLayers[c]}getSources(){const c=[];for(const d in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[d];y&&c.push(y.getSource())}return c}getSource(c,d){const y=this.getSourceCache(c,d);return y&&y.getSource()}getLayerSource(c){const d=this.getLayerSourceCache(c);return d&&d.getSource()}getSourceCache(c,d){const y=a.aE(c,d);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(c){const d=a.aE(c.source,c.scope);return c.type==="symbol"?this._mergedSymbolSourceCaches[d]:this._mergedOtherSourceCaches[d]}getSourceCaches(c){const d=[];return this._mergedOtherSourceCaches[c]&&d.push(this._mergedOtherSourceCaches[c]),this._mergedSymbolSourceCaches[c]&&d.push(this._mergedSymbolSourceCaches[c]),d}updateSourceCaches(){const c=this._changes.getUpdatedSourceCaches();for(const d in c){const y=c[d];y==="reload"?this.reloadSource(d):y==="clear"&&this.clearSource(d)}}updateLayers(c){const d=this._changes.getUpdatedPaintProperties();for(const y of d){const b=this.getLayer(y);b&&b.updateTransitions(c)}}getImages(c,d,y){this.imageManager.getImages(d.icons,d.scope,y),this._updateTilesForChangedImages();const b=T=>{T&&T.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(c,d,y){this.glyphManager.getGlyphs(d.stacks,d.scope,y)}getResource(c,d,y){return a.cD(d,y)}getOwnSourceCache(c){return this._otherSourceCaches[c]}getOwnLayerSourceCache(c){return c.type==="symbol"?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}getOwnSourceCaches(c){const d=[];return this._otherSourceCaches[c]&&d.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&d.push(this._symbolSourceCaches[c]),d}_isSourceCacheLoaded(c){const d=this.getOwnSourceCaches(c);return d.length===0?(this.fire(new a.a7(new Error(`There is no source with ID '${c}'`))),!1):d.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Ea(g,c){let d=!1,y=null;const b=()=>{y=null,d&&(g(),y=setTimeout(b,c),d=!1)};return()=>(d=!0,y||b(),y)}Oo.getSourceType=function(g){return vs[g]},Oo.setSourceType=function(g,c){vs[g]=c},Oo.registerForPluginStateChange=a.ci;class c0{constructor(c){this._hashName=c&&encodeURIComponent(c),a.aR(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ea(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const d=Sa(c);if(this._hashName){const y=this._hashName;let b=!1;const T=location.hash.slice(1).split("&").map(S=>{const P=S.split("=")[0];return P===y?(b=!0,`${P}=${d}`):S}).filter(S=>S);return b||T.push(`${y}=${d}`),`#${T.join("&")}`}return`#${d}`}_getCurrentHash(){const c=location.hash.replace("#","");if(this._hashName){let d;return c.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(d=y)}),(d&&d[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(y=>isNaN(y))){const y=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(d[3]||0):c.getBearing();return c.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:y,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Sa(g,c){const d=g.getCenter(),y=Math.round(100*g.getZoom())/100,b=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,b),S=Math.round(d.lng*T)/T,P=Math.round(d.lat*T)/T,M=g.getBearing(),D=g.getPitch();let z=c?`/${S}/${P}/${y}`:`${y}/${P}/${S}`;return(M||D)&&(z+="/"+Math.round(10*M)/10),D&&(z+=`/${Math.round(D)}`),z}const qu={linearity:.3,easing:a.cE(0,0,.3,1)},bm=a.ak({deceleration:2500,maxSpeed:1400},qu),wm=a.ak({deceleration:20,maxSpeed:1400},qu),Md=a.ak({deceleration:1e3,maxSpeed:360},qu),Ew=a.ak({deceleration:1e3,maxSpeed:90},qu);class u0{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.a4.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,d=a.a4.now();for(;c.length>0&&d-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)d.zoom+=T.zoomDelta||0,d.bearing+=T.bearingDelta||0,d.pitch+=T.pitchDelta||0,T.panDelta&&d.pan._add(T.panDelta),T.around&&(d.around=T.around),T.pinchAround&&(d.pinchAround=T.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const T=Rd(d.pan.mag(),y,a.ak({},bm,c||{}));b.offset=d.pan.mult(T.amount/d.pan.mag()),b.center=this._map.transform.center,Ia(b,T)}if(d.zoom){const T=Rd(d.zoom,y,wm);b.zoom=this._map.transform.zoom+T.amount,Ia(b,T)}if(d.bearing){const T=Rd(d.bearing,y,Md);b.bearing=this._map.transform.bearing+a.c(T.amount,-179,179),Ia(b,T)}if(d.pitch){const T=Rd(d.pitch,y,Ew);b.pitch=this._map.transform.pitch+T.amount,Ia(b,T)}if(b.zoom||b.bearing){const T=d.pinchAround===void 0?d.around:d.pinchAround;b.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Ia(g,c){(!g.duration||g.duration<c.duration)&&(g.duration=c.duration,g.easing=c.easing)}function Rd(g,c,d){const{maxSpeed:y,linearity:b,deceleration:T}=d,S=a.c(g*b/(c/1e3),-y,y),P=Math.abs(S)/(T*b);return{easing:d.easing,duration:1e3*P,amount:S*(P/2)}}class yo extends a.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,y,b={}){const T=Ge(d.getCanvasContainer(),y),S=d.unproject(T);super(c,a.ak({point:T,lngLat:S,originalEvent:y},b)),this._defaultPrevented=!1,this.target=d}}class Hu extends a.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,y){const b=c==="touchend"?y.changedTouches:y.touches,T=gt(d.getCanvasContainer(),b),S=T.map(M=>d.unproject(M)),P=T.reduce((M,D,z,F)=>M.add(D.div(F.length)),new a.P(0,0));super(c,{points:T,point:P,lngLats:S,lngLat:d.unproject(P),originalEvent:y}),this._defaultPrevented=!1}}class Sw extends a.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,d,y){super(c,{originalEvent:y}),this._defaultPrevented=!1}}class Tm{constructor(c,d){this._map=c,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new Sw(c.type,this._map,c))}mousedown(c,d){return this._mousedownPos=d,this._firePreventable(new yo(c.type,this._map,c))}mouseup(c){this._map.fire(new yo(c.type,this._map,c))}preclick(c){const d=a.ak({},c);d.type="preclick",this._map.fire(new yo(d.type,this._map,d))}click(c,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(c),this._map.fire(new yo(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new yo(c.type,this._map,c))}mouseover(c){this._map.fire(new yo(c.type,this._map,c))}mouseout(c){this._map.fire(new yo(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Hu(c.type,this._map,c))}touchmove(c){this._map.fire(new Hu(c.type,this._map,c))}touchend(c){this._map.fire(new Hu(c.type,this._map,c))}touchcancel(c){this._map.fire(new Hu(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Od{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new yo(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new yo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new yo(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zu{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,d){this.isEnabled()&&c.shiftKey&&c.button===0&&(ae(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(c,d){if(!this._active)return;const y=d,b=this._startPos,T=this._lastPos;if(!b||!T||T.equals(y)||!this._box&&y.dist(b)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=Y("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const S=Math.min(b.x,y.x),P=Math.max(b.x,y.x),M=Math.min(b.y,y.y),D=Math.max(b.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${M}px)`,this._box.style.width=P-S+"px",this._box.style.height=D-M+"px")})}mouseupWindow(c,d){if(!this._active)return;const y=this._startPos,b=d;if(y&&c.button===0){if(this.reset(),Ce(),y.x!==b.x||y.y!==b.y)return this._map.fire(new a.a8("boxzoomend",{originalEvent:c})),{cameraAnimation:T=>T.fitScreenCoordinates(y,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),le(),delete this._startPos,delete this._lastPos}_fireEvent(c,d){return this._map.fire(new a.a8(c,{originalEvent:d}))}}function Xu(g,c){const d={};for(let y=0;y<g.length;y++)d[g[y].identifier]=c[y];return d}class Yu{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,d,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=c.timeStamp),y.length===this.numTouches&&(this.centroid=function(b){const T=new a.P(0,0);for(const S of b)T._add(S);return T.div(b.length)}(d),this.touches=Xu(y,d)))}touchmove(c,d,y){if(this.aborted||!this.centroid)return;const b=Xu(y,d);for(const T in this.touches){const S=b[T];(!S||S.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(c,d,y){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Ku{constructor(c){this.singleTap=new Yu(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,d,y){this.singleTap.touchstart(c,d,y)}touchmove(c,d,y){this.singleTap.touchmove(c,d,y)}touchend(c,d,y){const b=this.singleTap.touchend(c,d,y);if(b){const T=c.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(b)<30;if(T&&S||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Dd{constructor(){this._zoomIn=new Ku({numTouches:1,numTaps:2}),this._zoomOut=new Ku({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,d,y){this._zoomIn.touchstart(c,d,y),this._zoomOut.touchstart(c,d,y)}touchmove(c,d,y){this._zoomIn.touchmove(c,d,y),this._zoomOut.touchmove(c,d,y)}touchend(c,d,y){const b=this._zoomIn.touchend(c,d,y),T=this._zoomOut.touchend(c,d,y);return b?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(b)},{originalEvent:c})}):T?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(T)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ld={0:1,2:2};class Qi{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,d){return!1}_move(c,d){return{}}mousedown(c,d){if(this._lastPoint)return;const y=It(c);this._correctButton(c,y)&&(this._lastPoint=d,this._eventButton=y)}mousemoveWindow(c,d){const y=this._lastPoint;if(y){if(c.preventDefault(),this._eventButton!=null&&function(b,T){const S=Ld[T];return b.buttons===void 0||(b.buttons&S)!==S}(c,this._eventButton))this.reset();else if(this._moved||!(d.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(y,d)}}mouseupWindow(c){this._lastPoint&&It(c)===this._eventButton&&(this._moved&&Ce(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class h0 extends Qi{mousedown(c,d){super.mousedown(c,d),this._lastPoint&&(this._active=!0)}_correctButton(c,d){return d===0&&!c.ctrlKey}_move(c,d){return{around:d,panDelta:d.sub(c)}}}class Em extends Qi{_correctButton(c,d){return d===0&&c.ctrlKey||d===2}_move(c,d){const y=.8*(d.x-c.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(c){c.preventDefault()}}class Sm extends Qi{_correctButton(c,d){return d===0&&c.ctrlKey||d===2}_move(c,d){const y=-.5*(d.y-c.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(c){c.preventDefault()}}class ml{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),a.aR(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(c,d,y){return this._calculateTransform(c,d,y)}touchmove(c,d,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!a.cF())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,d,y)}}touchend(c,d,y){this._calculateTransform(c,d,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,d,y){y.length>0&&(this._active=!0);const b=Xu(y,d),T=new a.P(0,0),S=new a.P(0,0);let P=0;for(const D in b){const z=b[D],F=this._touches[D];F&&(T._add(z),S._add(z.sub(F)),P++,b[D]=z)}if(this._touches=b,P<this._minTouches||!S.mag())return;const M=S.div(P);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(P),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Y("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class zd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,d,y){return{}}touchstart(c,d,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([d[0],d[1]]))}touchmove(c,d,y){const b=this._firstTwoTouches;if(!b)return;c.preventDefault();const[T,S]=b,P=gl(y,d,T),M=gl(y,d,S);if(!P||!M)return;const D=this._aroundCenter?null:P.add(M).div(2);return this._move([P,M],D,c)}touchend(c,d,y){if(!this._firstTwoTouches)return;const[b,T]=this._firstTwoTouches,S=gl(y,d,b),P=gl(y,d,T);S&&P||(this._active&&Ce(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function gl(g,c,d){for(let y=0;y<g.length;y++)if(g[y].identifier===d)return c[y]}function Nd(g,c){return Math.log(g/c)/Math.LN2}class Fd extends zd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,d){const y=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Nd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nd(this._distance,y),pinchAround:d}}}function Im(g,c){return 180*g.angleWith(c)/Math.PI}class d0 extends zd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,d){const y=this._vector;if(this._vector=c[0].sub(c[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Im(this._vector,y),pinchAround:d}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const d=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const b=Im(c,y);return Math.abs(b)<d}}function Aa(g){return Math.abs(g.y)>Math.abs(g.x)}class Iw extends zd{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,Aa(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,d,y){const b=this._lastPoints;if(!b)return;const T=c[0].sub(b[0]),S=c[1].sub(b[1]);return this._map._cooperativeGestures&&!a.cF()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(T,S,y.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(T.y+S.y)/2*-.5})}gestureBeginsVertically(c,d,y){if(this._valid!==void 0)return this._valid;const b=c.mag()>=2,T=d.mag()>=2;if(!b&&!T)return;if(!b||!T)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const S=c.y>0==d.y>0;return Aa(c)&&Aa(d)&&S}}const Aw={panStep:100,bearingStep:15,pitchStep:10};class f0{constructor(){const c=Aw;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let d=0,y=0,b=0,T=0,S=0;switch(c.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:c.shiftKey?y=-1:(c.preventDefault(),T=-1);break;case 39:c.shiftKey?y=1:(c.preventDefault(),T=1);break;case 38:c.shiftKey?b=1:(c.preventDefault(),S=-1);break;case 40:c.shiftKey?b=-1:(c.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(y=0,b=0),{cameraAnimation:P=>{const M=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Bd,zoom:d?Math.round(M)+d*(c.shiftKey?2:1):M,bearing:P.getBearing()+y*this._bearingStep,pitch:P.getPitch()+b*this._pitchStep,offset:[-T*this._panStep,-S*this._panStep],center:P.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bd(g){return g*(2-g)}const jd=4.000244140625;class p0{constructor(c,d){this._map=c,this._el=c.getCanvasContainer(),this._handler=d,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.aR(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||a.cF()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const y=a.a4.now(),b=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,d!==0&&d%jd==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),c.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=c,this._delta-=d,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=Ge(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;this._type==="wheel"&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>jd?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&z!==0&&(z=1/z);const F=d(),V=Math.pow(2,F),U=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(U*z))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:d(),b=this._startZoom,T=this._easing;let S,P=!1;if(this._type==="wheel"&&b&&T){const D=Math.min((a.a4.now()-this._lastWheelEventTime)/200,1),z=T(D);S=a.n(b,y,z),D<1?this._frameId||(this._frameId=!0):P=!0}else S=y,P=!0;this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let M=S-d();return M*this._lastDelta<0&&(M=0),{noInertia:!0,needsRenderFrame:!P,zoomDelta:M,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let d=a.cG;if(this._prevEase){const y=this._prevEase,b=(a.a4.now()-y.start)/y.duration,T=y.easing(b+.01)-y.easing(b),S=.27/Math.sqrt(T*T+1e-4)*.01,P=Math.sqrt(.0729-S*S);d=a.cE(S,P,.25,1)}return this._prevEase={start:a.a4.now(),duration:c,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Y("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class m0{constructor(c,d){this._clickZoom=c,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,d){return c.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(c.shiftKey?-1:1),around:y.unproject(d)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Am{constructor(){this._tap=new Ku({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,d,y){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=d[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(c,d,y))}touchmove(c,d,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const b=d[0],T=b.y-this._swipePoint.y;return this._swipePoint=b,c.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(c,d,y)}touchend(c,d,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(c,d,y)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class g0{constructor(c,d,y){this._el=c,this._mousePan=d,this._touchPan=y}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _0{constructor(c,d,y){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=d,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class y0{constructor(c,d,y,b){this._el=c,this._touchZoom=d,this._touchRotate=y,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ju=g=>g.zoom||g.drag||g.pitch||g.rotate;class v0 extends a.a8{}class xc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,d){const y=a.v.sub([],d,c);this.radius=a.v.length(y[2]<0?a.v.div([],y,this.constants):[y[0],y[1],0])}projectRay(c){a.v.div(c,c,this.constants),a.v.normalize(c,c),a.v.mul(c,c,this.constants);const d=a.v.scale([],c,this.radius);if(d[2]>0){const y=a.v.scale([],[0,0,1],a.v.dot(d,[0,0,1])),b=a.v.scale([],a.v.normalize([],[d[0],d[1],0]),this.radius),T=a.v.add([],d,a.v.scale([],a.v.sub([],a.v.add([],b,y),d),2));d[0]=T[0],d[1]=T[1]}return d}}function Qu(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class x0{constructor(c,d){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new u0(c),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new xc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),a.aR(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,T,S]of this._listeners){const P=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(T,P,S)}}destroy(){for(const[c,d,y]of this._listeners){const b=c===document?this.handleWindowEvent:this.handleEvent;c.removeEventListener(d,b,y)}}_addDefaultHandlers(c){const d=this._map,y=d.getCanvasContainer();this._add("mapEvent",new Tm(d,c));const b=d.boxZoom=new Zu(d,c);this._add("boxZoom",b);const T=new Dd,S=new Vd;d.doubleClickZoom=new m0(S,T),this._add("tapZoom",T),this._add("clickZoom",S);const P=new Am;this._add("tapDragZoom",P);const M=d.touchPitch=new Iw(d);this._add("touchPitch",M);const D=new Em(c),z=new Sm(c);d.dragRotate=new _0(c,D,z),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const F=new h0(c),V=new ml(d,c);d.dragPan=new g0(y,F,V),this._add("mousePan",F),this._add("touchPan",V,["touchZoom","touchRotate"]);const U=new d0,W=new Fd;d.touchZoomRotate=new y0(y,W,U,P),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Od(d));const H=d.scrollZoom=new p0(d,this);this._add("scrollZoom",H,["mousePan"]);const q=d.keyboard=new f0;this._add("keyboard",q);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[G]&&d[G].enable(c[G])}_add(c,d,y){this._handlers.push({handlerName:c,handler:d,allowed:y}),this._handlersById[c]=d}stop(c){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ju(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,d,y){for(const b in c)if(b!==y&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const d=[];for(const y of c)this._el.contains(y.target)&&d.push(y);return d}handleEvent(c,d){this._updatingCamera=!0;const y=c.type==="renderFrame",b=y?void 0:c,T={needsRenderFrame:!1},S={},P={},M=c.touches?this._getMapTouches(c.touches):void 0,D=M?gt(this._el,M):y?void 0:Ge(this._el,c);for(const{handlerName:V,handler:U,allowed:W}of this._handlers){if(!U.isEnabled())continue;let H;this._blockedByActive(P,W,V)?U.reset():U[d||c.type]&&(H=U[d||c.type](c,D,M),this.mergeHandlerResult(T,S,H,V,b),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||U.isActive())&&(P[V]=U)}const z={};for(const V in this._previousActiveHandlers)P[V]||(z[V]=b);this._previousActiveHandlers=P,(Object.keys(z).length||Qu(T))&&(this._changes.push([T,S,z]),this._triggerRenderFrame()),(Object.keys(P).length||Qu(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=T;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(c,d,y,b,T){if(!y)return;a.ak(c,y);const S={handlerName:b,originalEvent:y.originalEvent||T};y.zoomDelta!==void 0&&(d.zoom=S),y.panDelta!==void 0&&(d.drag=S),y.pitchDelta!==void 0&&(d.pitch=S),y.bearingDelta!==void 0&&(d.rotate=S)}_applyChanges(){const c={},d={},y={};for(const[b,T,S]of this._changes)b.panDelta&&(c.panDelta=(c.panDelta||new a.P(0,0))._add(b.panDelta)),b.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(c.around=b.around),b.aroundCoord!==void 0&&(c.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(c.pinchAround=b.pinchAround),b.noInertia&&(c.noInertia=b.noInertia),a.ak(d,T),a.ak(y,S);this._updateMapTransform(c,d,y),this._changes=[]}_updateMapTransform(c,d,y){const b=this._map,T=b.transform,S=Q=>[Q.x,Q.y,Q.z];if((Q=>{const oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!Qu(c)){const Q=T.zoom;T.cameraElevationReference="sea",this._originalZoom!=null&&T._orthographicProjectionAtLowPitch&&T.projection.name!=="globe"&&T.pitch===0?(T.cameraElevationReference="ground",T.zoom=this._originalZoom):(T.recenterOnTerrain(),T.cameraElevationReference="ground"),Q!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&b._stop(!0),!Qu(c))return void this._fireEvents(d,y,!0);let{panDelta:P,zoomDelta:M,bearingDelta:D,pitchDelta:z,around:F,aroundCoord:V,pinchAround:U}=c;T._isCameraConstrained&&(M>0&&(M=0),T._isCameraConstrained=!1),U!==void 0&&(F=U),(M||(Q=>d[Q]&&!this._eventsInProgress[Q])("drag"))&&F&&(this._dragOrigin=S(T.pointCoordinate3D(F)),this._originalZoom=T.zoom,this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",b._stop(!0),F=F||b.transform.centerPoint,D&&(T.bearing+=D),z&&(T.pitch+=z),T._updateCameraState();const W=[0,0,0];if(P)if(T.projection.name==="mercator"){const Q=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(F).dir),oe=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(F.sub(P)).dir);W[0]=oe[0]-Q[0],W[1]=oe[1]-Q[1]}else{const Q=T.pointCoordinate(F);if(T.projection.name==="globe"){P=P.rotate(-T.angle);const oe=T._pixelsPerMercatorPixel/T.worldSize;W[0]=-P.x*a.cH(a.l(Q.y))*oe,W[1]=-P.y*a.cH(T.center.lat)*oe}else{const oe=T.pointCoordinate(F.sub(P));Q&&oe&&(W[0]=oe.x-Q.x,W[1]=oe.y-Q.y)}}const H=T.zoom,q=[0,0,0];if(M){const Q=S(V||T.pointCoordinate3D(F)),oe={dir:a.v.normalize([],a.v.sub([],Q,T._camera.position))};if(oe.dir[2]<0){const ce=T.zoomDeltaToMovement(Q,M);a.v.scale(q,oe.dir,ce)}}const G=a.v.add(W,W,q);T._translateCameraConstrained(G),M&&Math.abs(T.zoom-H)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(d,y,!0)}_fireEvents(c,d,y){const b=Ju(this._eventsInProgress),T=Ju(c),S={};for(const z in c){const{originalEvent:F}=c[z];this._eventsInProgress[z]||(S[`${z}start`]=F),this._eventsInProgress[z]=c[z]}!b&&T&&this._fireEvent("movestart",T.originalEvent);for(const z in S)this._fireEvent(z,S[z]);T&&this._fireEvent("move",T.originalEvent);for(const z in c){const{originalEvent:F}=c[z];this._fireEvent(z,F)}const P={};let M;for(const z in this._eventsInProgress){const{handlerName:F,originalEvent:V}=this._eventsInProgress[z];this._handlersById[F].isActive()||(delete this._eventsInProgress[z],M=d[F]||V,P[`${z}end`]=M)}for(const z in P)this._fireEvent(z,P[z]);const D=Ju(this._eventsInProgress);if(y&&(b||T)&&!D){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;z?(F(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:M})):(this._map.fire(new a.a8("moveend",{originalEvent:M})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,d){this._map.fire(new a.a8(c,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new v0("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const b0="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class w0 extends a.a6{constructor(c,d){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=d.respectPrefersReducedMotion!==!1,a.aR(["_renderFrameCallback"],this)}getCenter(){return new a.L(this.transform.center.lng,this.transform.center.lat)}setCenter(c,d){return this.jumpTo({center:c},d)}panBy(c,d,y){return c=a.P.convert(c).mult(-1),this.panTo(this.transform.center,a.ak({offset:c},d),y)}panTo(c,d,y){return this.easeTo(a.ak({center:c},d),y)}getZoom(){return this.transform.zoom}setZoom(c,d){return this.jumpTo({zoom:c},d),this}zoomTo(c,d,y){return this.easeTo(a.ak({zoom:c},d),y)}zoomIn(c,d){return this.zoomTo(this.getZoom()+1,c,d),this}zoomOut(c,d){return this.zoomTo(this.getZoom()-1,c,d),this}getBearing(){return this.transform.bearing}setBearing(c,d){return this.jumpTo({bearing:c},d),this}getPadding(){return this.transform.padding}setPadding(c,d){return this.jumpTo({padding:c},d),this}rotateTo(c,d,y){return this.easeTo(a.ak({bearing:c},d),y)}resetNorth(c,d){return this.rotateTo(0,a.ak({duration:1e3},c),d),this}resetNorthPitch(c,d){return this.easeTo(a.ak({bearing:0,pitch:0,duration:1e3},c),d),this}snapToNorth(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this}getPitch(){return this.transform.pitch}setPitch(c,d){return this.jumpTo({pitch:c},d),this}cameraForBounds(c,d){c=a.D.convert(c);const y=d&&d.bearing||0,b=d&&d.pitch||0,T=c.getNorthWest(),S=c.getSouthEast();return this._cameraForBounds(this.transform,T,S,y,b,d)}_extendCameraOptions(c){const d={top:0,bottom:0,right:0,left:0};if(typeof(c=a.ak({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const y=c.padding;c.padding={top:y,bottom:y,right:y,left:y}}return c.padding=a.ak(d,c.padding),c}_minimumAABBFrustumDistance(c,d){const y=d.max[0]-d.min[0],b=d.max[1]-d.min[1];return y/b>c.aspect?y/(2*Math.tan(.5*c.fovX)*c.aspect):b/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,d,y,b,T,S){const P=c.clone(),M=this._extendCameraOptions(S);P.bearing=b,P.pitch=T;const D=a.L.convert(d),z=a.L.convert(y),F=.5*(D.lat+z.lat),V=.5*(D.lng+z.lng),U=a.cI(F,V),W=a.v.normalize([],U),H=a.v.normalize([],a.v.cross([],W,[0,1,0])),q=a.v.cross([],H,W),G=[H[0],H[1],H[2],0,q[0],q[1],q[2],0,W[0],W[1],W[2],0,0,0,0,1],Q=[U,a.cI(D.lat,D.lng),a.cI(z.lat,D.lng),a.cI(z.lat,z.lng),a.cI(D.lat,z.lng),a.cI(F,D.lng),a.cI(F,z.lng),a.cI(D.lat,V),a.cI(z.lat,V)];let oe=a.c3.fromPoints(Q.map(Te=>[a.v.dot(H,Te),a.v.dot(q,Te),a.v.dot(W,Te)]));const ce=a.v.transformMat4([],oe.center,G);a.v.squaredLength(ce)===0&&a.v.set(ce,0,0,1),a.v.normalize(ce,ce),a.v.scale(ce,ce,a.aC),P.center=a.cJ(ce);const K=P.getWorldToCameraMatrix(),ee=a.m.invert(new Float64Array(16),K);oe=a.c3.applyTransform(oe,a.m.multiply([],K,G)),a.v.transformMat4(ce,ce,K);const he=.5*(oe.max[2]-oe.min[2]),ge=this._minimumAABBFrustumDistance(P,oe),de=a.v.scale([],[0,0,1],he),ye=a.v.add(de,ce,de),Ne=ge+(P.pitch===0?0:a.v.distance(ce,ye)),Ae=P.globeCenterInViewSpace,Me=a.v.sub([],ce,[Ae[0],Ae[1],Ae[2]]);a.v.normalize(Me,Me),a.v.scale(Me,Me,Ne);const xe=a.v.add([],ce,Me);a.v.transformMat4(xe,xe,ee);const ze=a.cL/a.aC,ke=a.v.length(xe),Ve=a.b(Math.max(ke*ze-a.cL,Number.EPSILON),0),ne=Math.min(P.zoomFromMercatorZAdjusted(Ve),M.maxZoom);return ne>.5*(a.Z+a.G)?(P.setProjection({name:"mercator"}),P.zoom=ne,this._cameraForBounds(P,d,y,b,T,S)):{center:P.center,zoom:ne,bearing:b,pitch:T}}queryTerrainElevation(c,d){const y=this.transform.elevation;return y?(d=a.ak({},{exaggerated:!0},d),y.getAtPoint(a.M.fromLngLat(c),null,d.exaggerated)):null}_cameraForBounds(c,d,y,b,T,S){if(c.projection.name==="globe")return this._cameraForBoundsOnGlobe(c,d,y,b,T,S);const P=c.clone(),M=this._extendCameraOptions(S),D=P.padding;P.bearing=b,P.pitch=T;const z=a.L.convert(d),F=a.L.convert(y),V=new a.L(z.lng,F.lat),U=new a.L(F.lng,z.lat),W=P.project(z),H=P.project(F),q=this.queryTerrainElevation(z),G=this.queryTerrainElevation(F),Q=this.queryTerrainElevation(V),oe=this.queryTerrainElevation(U),ce=[[W.x,W.y,Math.min(q||0,G||0,Q||0,oe||0)],[H.x,H.y,Math.max(q||0,G||0,Q||0,oe||0)]];let K=a.c3.fromPoints(ce);const ee=P.getWorldToCameraMatrix(),he=a.m.invert(new Float64Array(16),ee);K=a.c3.applyTransform(K,ee);const ge=a.v.sub([],K.max,K.min),de=D.left||0,ye=D.right||0,Ne=D.bottom||0,Ae=D.top||0,{left:Me,right:xe,top:ze,bottom:ke}=M.padding,Ve=.5*(de+ye),ne=.5*(Ae+Ne),Te=Math.min(P.scaleZoom(P.scale*Math.min((P.width-(de+ye+Me+xe))/ge[0],(P.height-(Ne+Ae+ke+ze))/ge[1])),M.maxZoom),Xe=P.scale/P.zoomScale(Te);K=new a.c3([K.min[0]-(Me+Ve)*Xe,K.min[1]-(ke+ne)*Xe,K.min[2]],[K.max[0]+(xe+Ve)*Xe,K.max[1]+(ze+ne)*Xe,K.max[2]]);const $e=.5*ge[2],bt=this._minimumAABBFrustumDistance(P,K),mt=[0,0,1,0];a.e.transformMat4(mt,mt,ee),a.e.normalize(mt,mt);const Dt=a.v.scale([],mt,bt+$e),_t=a.v.add([],K.center,Dt),Bt=(typeof M.offset.x=="number"&&typeof M.offset.y=="number"?new a.P(M.offset.x,M.offset.y):a.P.convert(M.offset)).rotate(-a.d(b));K.center[0]-=Bt.x*Xe,K.center[1]+=Bt.y*Xe,a.v.transformMat4(K.center,K.center,he),a.v.transformMat4(_t,_t,he);const jt=[K.center[0],K.center[1],_t[2]*P.pixelsPerMeter];a.v.scale(jt,jt,1/P.worldSize);const Ct=a.cK(jt[0]),Mt=a.l(jt[1]),yn=Math.min(P._zoomFromMercatorZ(jt[2]),M.maxZoom),Qt=new a.L(Ct,Mt);return P.mercatorFromTransition&&yn<.5*(a.Z+a.G)?(P.setProjection({name:"globe"}),P.zoom=yn,this._cameraForBounds(P,d,y,b,T,S)):{center:Qt,zoom:yn,bearing:b,pitch:T}}fitBounds(c,d,y){const b=this.cameraForBounds(c,d);return this._fitInternal(b,d,y)}fitScreenCoordinates(c,d,y,b,T){const S=a.P.convert(c),P=a.P.convert(d),M=new a.P(Math.min(S.x,P.x),Math.min(S.y,P.y)),D=new a.P(Math.max(S.x,P.x),Math.max(S.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,P))return this;const z=this.transform.pointLocation3D(M),F=this.transform.pointLocation3D(D),V=this.transform.pointLocation3D(new a.P(M.x,D.y)),U=this.transform.pointLocation3D(new a.P(D.x,M.y)),W=[Math.min(z.lng,F.lng,V.lng,U.lng),Math.min(z.lat,F.lat,V.lat,U.lat)],H=[Math.max(z.lng,F.lng,V.lng,U.lng),Math.max(z.lat,F.lat,V.lat,U.lat)],q=b&&b.pitch?b.pitch:this.getPitch(),G=this._cameraForBounds(this.transform,W,H,y,q,b);return this._fitInternal(G,b,T)}_fitInternal(c,d,y){return c?(delete(d=a.ak(c,d)).padding,d.linear?this.easeTo(d,y):this.flyTo(d,y)):this}jumpTo(c,d){this.stop();const y=c.preloadOnly?this.transform.clone():this.transform;let b=!1,T=!1,S=!1;return"zoom"in c&&y.zoom!==+c.zoom&&(b=!0,y.zoom=+c.zoom),c.center!==void 0&&(y.center=a.L.convert(c.center)),"bearing"in c&&y.bearing!==+c.bearing&&(T=!0,y.bearing=+c.bearing),"pitch"in c&&y.pitch!==+c.pitch&&(S=!0,y.pitch=+c.pitch),c.padding==null||y.isPaddingEqual(c.padding)||(y.padding=c.padding),c.preloadOnly?(this._preloadTiles(y),this):(this.fire(new a.a8("movestart",d)).fire(new a.a8("move",d)),b&&this.fire(new a.a8("zoomstart",d)).fire(new a.a8("zoom",d)).fire(new a.a8("zoomend",d)),T&&this.fire(new a.a8("rotatestart",d)).fire(new a.a8("rotate",d)).fire(new a.a8("rotateend",d)),S&&this.fire(new a.a8("pitchstart",d)).fire(new a.a8("pitch",d)).fire(new a.a8("pitchend",d)),this.fire(new a.a8("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.X(b0),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,d){const y=this.transform;if(!y.projection.supportsFreeCamera)return a.X(b0),this;this.stop();const b=y.zoom,T=y.pitch,S=y.bearing;y.setFreeCameraOptions(c);const P=b!==y.zoom,M=T!==y.pitch,D=S!==y.bearing;return this.fire(new a.a8("movestart",d)).fire(new a.a8("move",d)),P&&this.fire(new a.a8("zoomstart",d)).fire(new a.a8("zoom",d)).fire(new a.a8("zoomend",d)),D&&this.fire(new a.a8("rotatestart",d)).fire(new a.a8("rotate",d)).fire(new a.a8("rotateend",d)),M&&this.fire(new a.a8("pitchstart",d)).fire(new a.a8("pitch",d)).fire(new a.a8("pitchend",d)),this.fire(new a.a8("moveend",d)),this}easeTo(c,d){this._stop(!1,c.easeId),((c=a.ak({offset:[0,0],duration:500,easing:a.cG},c)).animate===!1||this._prefersReducedMotion(c))&&(c.duration=0);const y=this.transform,b=this.getZoom(),T=this.getBearing(),S=this.getPitch(),P=this.getPadding(),M="zoom"in c?+c.zoom:b,D="bearing"in c?this._normalizeBearing(c.bearing,T):T,z="pitch"in c?+c.pitch:S,F="padding"in c?c.padding:y.padding,V=a.P.convert(c.offset);let U,W,H;if(y.projection.name==="globe"){const de=a.M.fromLngLat(y.center),ye=V.rotate(-y.angle);de.x+=ye.x/y.worldSize,de.y+=ye.y/y.worldSize;const Ne=de.toLngLat(),Ae=a.L.convert(c.center||Ne);this._normalizeCenter(Ae),U=y.centerPoint.add(ye),W=new a.P(de.x,de.y).mult(y.worldSize),H=new a.P(a.E(Ae.lng),a.H(Ae.lat)).mult(y.worldSize).sub(W)}else{U=y.centerPoint.add(V);const de=y.pointLocation(U),ye=a.L.convert(c.center||de);this._normalizeCenter(ye),W=y.project(de),H=y.project(ye).sub(W)}const q=y.zoomScale(M-b);let G,Q;c.around&&(G=a.L.convert(c.around),Q=y.locationPoint(G));const oe=this._zooming||M!==b,ce=this._rotating||T!==D,K=this._pitching||z!==S,ee=!y.isPaddingEqual(F),he=de=>ye=>{if(oe&&(de.zoom=a.n(b,M,ye)),ce&&(de.bearing=a.n(T,D,ye)),K&&(de.pitch=a.n(S,z,ye)),ee&&(de.interpolatePadding(P,F,ye),U=de.centerPoint.add(V)),G)de.setLocationAtPoint(G,Q);else{const Ne=de.zoomScale(de.zoom-b),Ae=M>b?Math.min(2,q):Math.max(.5,q),Me=Math.pow(Ae,1-ye),xe=de.unproject(W.add(H.mult(ye*Me)).mult(Ne));de.setLocationAtPoint(de.renderWorldCopies?xe.wrap():xe,U)}return c.preloadOnly||this._fireMoveEvents(d),de};if(c.preloadOnly){const de=this._emulate(he,c.duration,y);return this._preloadTiles(de),this}const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=ce,this._pitching=K,this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,ge),this._ease(he(y),de=>{y.cameraElevationReference==="sea"&&y.recenterOnTerrain(),this._afterEase(d,de)},c),this}_prepareEase(c,d,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),d||y.moving||this.fire(new a.a8("movestart",c)),this._zooming&&!y.zooming&&this.fire(new a.a8("zoomstart",c)),this._rotating&&!y.rotating&&this.fire(new a.a8("rotatestart",c)),this._pitching&&!y.pitching&&this.fire(new a.a8("pitchstart",c))}_fireMoveEvents(c){this.fire(new a.a8("move",c)),this._zooming&&this.fire(new a.a8("zoom",c)),this._rotating&&this.fire(new a.a8("rotate",c)),this._pitching&&this.fire(new a.a8("pitch",c))}_afterEase(c,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,b=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,y&&this.fire(new a.a8("zoomend",c)),b&&this.fire(new a.a8("rotateend",c)),T&&this.fire(new a.a8("pitchend",c)),this.fire(new a.a8("moveend",c))}flyTo(c,d){if(this._prefersReducedMotion(c)){const ke=a.p(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ke,d)}this.stop(),c=a.ak({offset:[0,0],speed:1.2,curve:1.42,easing:a.cG},c);const y=this.transform,b=this.getZoom(),T=this.getBearing(),S=this.getPitch(),P="zoom"in c?a.c(+c.zoom,y.minZoom,y.maxZoom):b,M="bearing"in c?this._normalizeBearing(c.bearing,T):T,D="pitch"in c?+c.pitch:S,z=y.zoomScale(P-b),F=a.P.convert(c.offset),V=y.centerPoint.add(F),U=y.pointLocation(V);let W=c.center;if(W&&c.padding){const ke=this._cameraForBounds(this.transform,W,W,M,D,c);ke&&(W=ke.center)}W=a.L.convert(W||U),this._normalizeCenter(W);const H=y.project(U),q=y.project(W).sub(H);let G=c.curve;const Q=Math.max(y.width,y.height),oe=Q/z,ce=q.mag();if("minZoom"in c){const ke=a.c(Math.min(c.minZoom,b,P),y.minZoom,y.maxZoom),Ve=Q/y.zoomScale(ke-b);G=Math.sqrt(Ve/ce*2)}const K=G*G;function ee(ke){const Ve=(oe*oe-Q*Q+(ke?-1:1)*K*K*ce*ce)/(2*(ke?oe:Q)*K*ce);return Math.log(Math.sqrt(Ve*Ve+1)-Ve)}function he(ke){return(Math.exp(ke)-Math.exp(-ke))/2}function ge(ke){return(Math.exp(ke)+Math.exp(-ke))/2}const de=ee(0);let ye=function(ke){return ge(de)/ge(de+G*ke)},Ne=function(ke){return Q*((ge(de)*(he(Ve=de+G*ke)/ge(Ve))-he(de))/K)/ce;var Ve},Ae=(ee(1)-de)/G;if(Math.abs(ce)<1e-6||!isFinite(Ae)){if(Math.abs(Q-oe)<1e-6)return this.easeTo(c,d);const ke=oe<Q?-1:1;Ae=Math.abs(Math.log(oe/Q))/G,Ne=function(){return 0},ye=function(Ve){return Math.exp(ke*G*Ve)}}c.duration="duration"in c?+c.duration:1e3*Ae/("screenSpeed"in c?+c.screenSpeed/G:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const Me=T!==M,xe=D!==S,ze=ke=>Ve=>{const ne=Ve*Ae,Te=1/ye(ne);ke.zoom=Ve===1?P:b+ke.scaleZoom(Te),Me&&(ke.bearing=a.n(T,M,Ve)),xe&&(ke.pitch=a.n(S,D,Ve));const Xe=Ve===1?W:ke.unproject(H.add(q.mult(Ne(ne))).mult(Te));return ke.setLocationAtPoint(ke.renderWorldCopies?Xe.wrap():Xe,V),ke._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(d),ke};if(c.preloadOnly){const ke=this._emulate(ze,c.duration,y);return this._preloadTiles(ke),this}return this._zooming=!0,this._rotating=Me,this._pitching=xe,this._prepareEase(d,!1),this._ease(ze(y),()=>this._afterEase(d),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,d)}if(!c){const y=this.handlers;y&&y.stop(!1)}return this}_ease(c,d,y){y.animate===!1||y.duration===0?(c(1),d()):(this._easeStart=a.a4.now(),this._easeOptions=y,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((a.a4.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,d){c=a.w(c,-180,180);const y=Math.abs(c-d);return Math.abs(c-360-d)<y&&(c-=360),Math.abs(c+360-d)<y&&(c+=360),c}_normalizeCenter(c){const d=this.transform;if(d.maxBounds||d.projection.name!=="globe"&&!d.renderWorldCopies)return;const y=c.lng-d.center.lng;c.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&a.a4.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,d,y){const b=Math.ceil(15*d/1e3),T=[],S=c(y.clone());for(let P=0;P<=b;P++){const M=S(P/b);T.push(M.clone())}return T}}class Pm{constructor(c={}){this.options=c,a.aR(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const d=this.options&&this.options.compact;return this._map=c,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Y("button","mapboxgl-ctrl-attrib-button",this._container),Y("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Y("div","mapboxgl-ctrl-attrib-inner",this._container),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,d){const y=this._map._getUIString(`AttributionControl.${d}`);c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",y)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.cM.ACCESS_TOKEN}];if(c){const y=d.reduce((b,T,S)=>(T.value&&(b+=`${T.key}=${T.value}${S<d.length-1?"&":""}`),b),"?");c.href=`${a.cM.FEEDBACK_URL}/${y}#${Sa(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._mergedSourceCaches;for(const b in d){const T=d[b];if(T.used){const S=T.getSource();S.attribution&&c.indexOf(S.attribution)<0&&c.push(S.attribution)}}c.sort((b,T)=>b.length-T.length),c=c.filter((b,T)=>{for(let S=T+1;S<c.length;S++)if(c[S].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const y=c.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,c.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class km{constructor(){a.aR(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=Y("div","mapboxgl-ctrl");const d=Y("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(Object.entries(c).length===0)return!0;for(const d in c){const y=c[d].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const d=c[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class Cm{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const d=++this._id;return this._queue.push({callback:c,id:d,cancelled:!1}),d}remove(c){const d=this._currentlyRunning,y=d?this._queue.concat(d):this._queue;for(const b of y)if(b.id===c)return void(b.cancelled=!0)}run(c=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const y of d)if(!y.cancelled&&(y.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Mm(g,c,d){if(g=new a.L(g.lng,g.lat),c){const y=new a.L(g.lng-360,g.lat),b=new a.L(g.lng+360,g.lat),T=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),S=d.locationPoint(g).distSqr(c),P=c.x<0||c.y<0||c.x>d.width||c.y>d.height;d.locationPoint(y).distSqr(c)<S&&(P||Math.abs(y.lng-d.center.lng)<T)?g=y:d.locationPoint(b).distSqr(c)<S&&(P||Math.abs(b.lng-d.center.lng)<T)&&(g=b)}for(;Math.abs(g.lng-d.center.lng)>180;){const y=d.locationPoint(g);if(y.x>=0&&y.y>=0&&y.x<=d.width&&y.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const Ud={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Gr extends a.a6{constructor(c,d){if(super(),(c instanceof HTMLElement||d)&&(c=a.ak({element:c},d)),a.aR(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=a.P.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y("div");const T=41,S=27,P=se("svg",{display:"block",height:T*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${T}`},this._element),M=se("radialGradient",{id:"shadowGradient"},se("defs",{},P));se("stop",{offset:"10%","stop-opacity":.4},M),se("stop",{offset:"100%","stop-opacity":.05},M),se("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},P),se("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},P),se("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},P),se("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},P),this._offset=a.P.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",T=>{T.preventDefault()}),this._element.addEventListener("mousedown",T=>{T.preventDefault()});const y=this._element.classList;for(const T in Ud)y.remove(`mapboxgl-marker-anchor-${T}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`);const b=c&&c.className?c.className.trim().split(/\s+/):[];y.add(...b),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=a.L.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const d=c.code,y=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(c){const d=c.originalEvent.target,y=this._element;this._popup&&(d===y||y.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,d=this._pos;if(!c||!d)return!1;const y=c.unproject(d),b=c.getFreeCameraOptions();if(!b.position)return!1;const T=b.position.toLngLat();return T.distanceTo(y)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const d=this._pos;if(!d||d.x<0||d.x>c.transform.width||d.y<0||d.y>c.transform.height)return void this._clearFadeTimer();const y=c.unproject(d);let b;c._showingGlobe()&&a.cN(c.transform,this._lngLat)?b=0:(b=1-c._queryFogOpacity(y),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${c.x}px,${c.y}px)
            ${Ud[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const c=this._pos,d=this._map,y=this.getPitchAlignment();if(!d||!c||y!=="map")return"";if(!d._showingGlobe()){const M=d.getPitch();return M?`rotateX(${M}deg)`:""}const b=a.Y(a.cO(d.transform,this._lngLat)),T=c.sub(a.cP(d.transform)),S=Math.abs(T.x)+Math.abs(T.y);if(S===0)return"";const P=b/S;return`rotateX(${-T.y*P}deg) rotateY(${T.x*P}deg)`}_calculateZTransform(){const c=this._pos,d=this._map;if(!d||!c)return"";let y=0;const b=this.getRotationAlignment();if(b==="map")if(d._showingGlobe()){const T=d.project(new a.L(this._lngLat.lng,this._lngLat.lat+.001)),S=d.project(new a.L(this._lngLat.lng,this._lngLat.lat-.001)).sub(T);y=a.Y(Math.atan2(S.y,S.x))-90}else y=-d.getBearing();else if(b==="horizon"){const T=a.an(4,6,d.getZoom()),S=a.cP(d.transform);S.y+=T*d.transform.height;const P=c.sub(S),M=a.Y(Math.atan2(P.y,P.x));y=(M>90?M-270:M+90)*(1-T)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(c){cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Mm(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),c===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=a.P.convert(c),this._update(),this}addClassName(c){return this._element.classList.add(c),this}removeClassName(c){return this._element.classList.remove(c),this}toggleClassName(c){return this._element.classList.toggle(c)}_onMove(c){const d=this._map;if(!d)return;const y=this._pointerdownPos,b=this._positionDelta;if(y&&b){if(!this._isDragging){const T=this._clickTolerance||d._clickTolerance;if(c.point.dist(y)<T)return;this._isDragging=!0}this._pos=c.point.sub(b),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.a8("dragstart"))),this.fire(new a.a8("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.a8("dragend")),this._state="inactive"}_addDragHandler(c){const d=this._map,y=this._pos;d&&y&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(y),this._pointerdownPos=c.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const d=this._map;return d&&(c?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Pw={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},T0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Rm(g=new a.P(0,0),c="bottom"){if(typeof g=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(c){case"top":return new a.P(0,g);case"top-left":return new a.P(d,d);case"top-right":return new a.P(-d,d);case"bottom":return new a.P(0,-g);case"bottom-left":return new a.P(d,-d);case"bottom-right":return new a.P(-d,-d);case"left":return new a.P(g,0);case"right":return new a.P(-g,0)}return new a.P(0,0)}return g instanceof a.P||Array.isArray(g)?a.P.convert(g):a.P.convert(g[c]||[0,0])}class kw{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const d=a.ba((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,d,y){this._start=this.getValue(d),this._end=c,this._startTime=d,this._endTime=d+y}}const Cw={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ts={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class E0{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.continuousRedraw=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const Mw={showCompass:!0,showZoom:!0,visualizePitch:!1};class Pa{constructor(c,d,y=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Em({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,y&&(this.mousePitch=new Sm({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),a.aR(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(c,d){this.mouseRotate.mousedown(c,d),this.mousePitch&&this.mousePitch.mousedown(c,d),ae()}move(c,d){const y=this.map,b=this.mouseRotate.mousemoveWindow(c,d),T=b&&b.bearingDelta;if(T&&y.setBearing(y.getBearing()+T),this.mousePitch){const S=this.mousePitch.mousemoveWindow(c,d),P=S&&S.pitchDelta;P&&y.setPitch(y.getPitch()+P)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){le(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(a.ak({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),Ge(this.element,c)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,Ge(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=gt(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){c.targetTouches.length!==1?this.reset():(this._lastPos=gt(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ws={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},bc={maxWidth:100,unit:"metric"},$d={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:a.c$,supported:O,setRTLTextPlugin:a.d1,getRTLTextPluginStatus:a.d2,Map:class extends w0{constructor(g){const c=g;if((g=a.ak({},ts,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&a.cQ(window)&&(g.antialias=!1,a.X("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new zn(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._repaint=!1,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Cm,this._domRenderTaskQueue=new Cm,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.cR(),this._locale=a.ak({},Cw,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new kw(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new a.cS(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?{...g.contextCreateOptions}:{},typeof g.container=="string"){const d=document.getElementById(g.container);if(!d)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=d}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&a.X("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),a.aR(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new E0,this._tp=g.devtools?new r0(this):new r0,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,d=>{this.repaint=d}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new x0(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||a.cM.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new c0(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){c.center==null&&c.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const d=g.bounds;d&&(this.resize(),this.fitBounds(d,a.ak({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new Pm({customAttribution:g.customAttribution})),this._logoControl=new km,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new a.a8(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new a.a8(`${d.dataType}dataloading`,d))})}_getMapId(){return this._mapId}addControl(g,c){if(c===void 0&&(c=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new a.a7(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[c];return c.indexOf("bottom")!==-1?y.insertBefore(d,y.firstChild):y.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new a.a7(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(g);return c>-1&&this._controls.splice(c,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new a.a8("movestart",g)).fire(new a.a8("move",g)),this.fire(new a.a8("resize",g)),c&&this.fire(new a.a8("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(a.D.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new a.a8("zoomstart")).fire(new a.a8("zoom")).fire(new a.a8("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new a.a8("zoomstart")).fire(new a.a8("zoom")).fire(new a.a8("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new a.a8("pitchstart")).fire(new a.a8("pitch")).fire(new a.a8("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new a.a8("pitchstart")).fire(new a.a8("pitch")).fire(new a.a8("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(c=>c==="auto"?navigator.language:c):g}setLanguage(g){const c=this._parseLanguage(g);if(!this.style||c===this._language)return this;this._language=c,this.style.reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,c=g.projection.name;let d;c==="globe"&&g.zoom>=a.G?(g.setMercatorFromTransition(),d=!0):c==="mercator"&&g.zoom<a.G&&(g.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,c){return this._updateProjection(g||c||{name:"mercator"})}_updateProjection(g){let c;return c=g.name==="globe"&&this.transform.zoom>=a.G?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),c&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g){return this.transform.locationPoint3D(a.L.convert(g))}unproject(g){return this.transform.pointLocation3D(a.P.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,c,d){if(g==="mouseenter"||g==="mouseover"){let y=!1;const b=S=>{const P=c.filter(D=>this.getLayer(D)),M=P.length?this.queryRenderedFeatures(S.point,{layers:P}):[];M.length?y||(y=!0,d.call(this,new yo(g,this,S.originalEvent,{features:M}))):y=!1},T=()=>{y=!1};return{layers:new Set(c),listener:d,delegates:{mousemove:b,mouseout:T}}}if(g==="mouseleave"||g==="mouseout"){let y=!1;const b=S=>{const P=c.filter(M=>this.getLayer(M));(P.length?this.queryRenderedFeatures(S.point,{layers:P}):[]).length?y=!0:y&&(y=!1,d.call(this,new yo(g,this,S.originalEvent)))},T=S=>{y&&(y=!1,d.call(this,new yo(g,this,S.originalEvent)))};return{layers:new Set(c),listener:d,delegates:{mousemove:b,mouseout:T}}}{const y=b=>{const T=c.filter(P=>this.getLayer(P)),S=T.length?this.queryRenderedFeatures(b.point,{layers:T}):[];S.length&&(b.features=S,d.call(this,b),delete b.features)};return{layers:new Set(c),listener:d,delegates:{[g]:y}}}}on(g,c,d){if(d===void 0)return super.on(g,c);if(Array.isArray(c)||(c=[c]),c){for(const b of c)if(!this._isValidId(b))return this}const y=this._createDelegatedListener(g,c,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const b in y.delegates)this.on(b,y.delegates[b]);return this}once(g,c,d){if(d===void 0)return super.once(g,c);if(Array.isArray(c)||(c=[c]),c){for(const b of c)if(!this._isValidId(b))return this}const y=this._createDelegatedListener(g,c,d);for(const b in y.delegates)this.once(b,y.delegates[b]);return this}off(g,c,d){if(d===void 0)return super.off(g,c);c=new Set(Array.isArray(c)?c:[c]);for(const T of c)if(!this._isValidId(T))return this;const y=(T,S)=>{if(T.size!==S.size)return!1;for(const P of T)if(!S.has(P))return!1;return!0},b=this._delegatedListeners?this._delegatedListeners[g]:void 0;return b&&(T=>{for(let S=0;S<T.length;S++){const P=T[S];if(P.listener===d&&y(P.layers,c)){for(const M in P.delegates)this.off(M,P.delegates[M]);return T.splice(S,1),this}}})(b),this}queryRenderedFeatures(g,c){if(!this.style)return[];if(c!==void 0||g===void 0||g instanceof a.P||Array.isArray(g)||(c=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],(c=c||{}).layers&&Array.isArray(c.layers)){for(const d of c.layers)if(!this._isValidId(d))return[]}return this.style.queryRenderedFeatures(g,c,this.transform)}querySourceFeatures(g,c){return this._isValidId(g)?this.style.querySourceFeatures(g,c):[]}isPointOnSurface(g){const{name:c}=this.transform.projection;return c!=="globe"&&c!=="mercator"&&a.X(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(g))}setStyle(g,c){return(c=a.ak({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(g,c))}_getUIString(g){const c=this._locale[g];if(c==null)throw new Error(`Missing UI string '${g}'`);return c}_updateStyle(g,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new Oo(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Oo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,c){if(typeof g=="string"){const d=this._requestManager.normalizeStyleURL(g),y=this._requestManager.transformRequest(d,a.a2.Style);a.a1(y,(b,T)=>{b?this.fire(new a.a7(b)):T&&this._updateDiff(T,c)})}else typeof g=="object"&&this._updateDiff(g,c)}_updateDiff(g,c){try{this.style.setState(g)&&this._update(!0)}catch(d){a.X(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(g,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.X("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new a.a7(new Error("IDs can't be empty."))),!1):!a.cu(g)||(this.fire(new a.a7(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}addSource(g,c){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,c),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,c,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,c,d)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,c,{pixelRatio:d=1,sdf:y=!1,stretchX:b,stretchY:T,content:S}={}){if(this._lazyInitEmptyStyle(),c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap){const{width:P,height:M,data:D}=a.a4.getImageData(c);this.style.addImage(g,{data:new a.a5({width:P,height:M},D),pixelRatio:d,stretchX:b,stretchY:T,content:S,sdf:y,version:0})}else if(c.width===void 0||c.height===void 0)this.fire(new a.a7(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:P,height:M}=c,D=c;this.style.addImage(g,{data:new a.a5({width:P,height:M},new Uint8Array(D.data)),pixelRatio:d,stretchX:b,stretchY:T,content:S,sdf:y,version:0,userImage:D}),D.onAdd&&D.onAdd(this,g)}}updateImage(g,c){this._lazyInitEmptyStyle();const d=this.style.getImage(g);if(!d)return void this.fire(new a.a7(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap?a.a4.getImageData(c):c,{width:b,height:T}=y,S=y.data;if(b===void 0||T===void 0)return void this.fire(new a.a7(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==d.data.width||T!==d.data.height)return void this.fire(new a.a7(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const P=!(c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap);d.data.replace(S,P),this.style.updateImage(g,d)}hasImage(g){return g?!!this.style&&!!this.style.getImage(g):(this.fire(new a.a7(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,c){a.a3(this._requestManager.transformRequest(g,a.a2.Image),(d,y)=>{c(d,y instanceof HTMLImageElement?a.a4.getImageData(y):y)})}listImages(){return this.style.listImages()}addModel(g,c){this._lazyInitEmptyStyle(),this.style.addModel(g,c)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new a.a7(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,c){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,c),this._update(!0)):this}moveLayer(g,c){return this._isValidId(g)?(this.style.moveLayer(g,c),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){return this._isValidId(g)?this.style.getOwnLayer(g):null}setLayerZoomRange(g,c,d){return this._isValidId(g)?(this.style.setLayerZoomRange(g,c,d),this._update(!0)):this}setFilter(g,c,d={}){return this._isValidId(g)?(this.style.setFilter(g,c,d),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,c,d,y={}){return this._isValidId(g)?(this.style.setPaintProperty(g,c,d,y),this._update(!0)):this}getPaintProperty(g,c){return this._isValidId(g)?this.style.getPaintProperty(g,c):null}setLayoutProperty(g,c,d,y={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,c,d,y),this._update(!0)):this}getLayoutProperty(g,c){return this._isValidId(g)?this.style.getLayoutProperty(g,c):null}getConfigProperty(g,c){return this.style.getConfigProperty(g,c)}setConfigProperty(g,c,d){return this.style.setConfigProperty(g,c,d),this._update(!0)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const c=g[0];c.properties?this.style.setFlatLight(c.properties,c.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,c={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.L.convert(g),this.transform):0}setFeatureState(g,c){return this._isValidId(g.source)?(this.style.setFeatureState(g,c),this._update()):this}removeFeatureState(g,c){return this._isValidId(g.source)?(this.style.removeFeatureState(g,c),this._update()):this}getFeatureState(g){return this._isValidId(g.source)?this.style.getFeatureState(g):null}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let d,y,b,T=this._container;for(;T&&(!y||!b);){const S=window.getComputedStyle(T).transform;S&&S!=="none"&&(d=S.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(y=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(b=d[3])),T=T.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=b?Math.abs(c/b):c}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.X("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Y("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=Y("div","mapboxgl-canvas-container",g);this._canvas=Y("canvas","mapboxgl-canvas",c),this._interactive&&(c.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=Y("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{y[b]=Y("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,c){const d=a.a4.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(c),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${c}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const c=this._markers.indexOf(g);c!==-1&&this._markers.splice(c,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const c=this._popups.indexOf(g);c!==-1&&this._popups.splice(c,1)}_setupPainter(){const g=a.ak({},O.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._canvas.getContext("webgl2",g);c?(a.cT(c,!0),this.painter=new ww(c,this._contextCreateOptions,this.transform,this._tp),this.on("data",d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.cU.testSupport(c)):this.fire(new a.a7(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.a8("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new a.a8("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let c;this.fire(new a.a8("renderstart"));const d=this.painter.context.extTimerQuery,y=a.a4.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(c=b.createQuery(),b.beginQuery(d.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,D=this.transform.pitch,z=a.a4.now(),F=new a.al(M,{now:z,fadeDuration:T,pitch:D,transition:this.style.transition});this.style.update(F)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(y),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(y),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.a8("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.a8("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const M=a.a4.now()-y;b.endQuery(d.TIME_ELAPSED_EXT),setTimeout(()=>{const D=b.getQueryParameter(c,b.QUERY_RESULT)/1e6;b.deleteQuery(c),this.fire(new a.a8("gpu-timing-frame",{cpuTime:M,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(M);this.fire(new a.a8("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(M);this.fire(new a.a8("gpu-timing-deferred-render",{gpuTime:D}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(P||this._repaint)this.triggerRepaint();else{const M=!this.isMoving()&&this.loaded();if(M&&(S=this._updateAverageElevation(y,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new a.a8("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new a.a8("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,this._performanceMetricsCollection&&a.cV(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const c of this._markers)g&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!g||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(g,c=!1){const d=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(c||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const b=this.transform.averageElevation;let T=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=g;const S=Math.abs(b-T);if(S>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(T),d(T);this._averageElevation.easeTo(T,g,300)}else if(S>1e-4)return this._averageElevation.jumpTo(T),d(T)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){a.cW(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===a.cX||g.status===401)){const c=this.painter.context.gl;a.cT(c,!1),this._logoControl instanceof km&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.a7(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.cY(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const d=this.painter.context.gl,y=d.createFramebuffer();function b(T){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,T,0);const S=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,S),S}return d.bindFramebuffer(d.FRAMEBUFFER,y),this._canvasPixelComparison(b(g),c.canvasCopies.map(b),c.timeStamps)}_canvasPixelComparison(g,c,d){let y=d[1]-d[0];const b=g.length/4;for(let T=0;T<c.length;T++){const S=c[T];let P=0;for(let M=0;M<S.length;M+=4)S[M]===g[M]&&S[M+1]===g[M+1]&&S[M+2]===g[M+2]&&S[M+3]===g[M+3]&&(P+=1);y+=(d[T+2]-d[T+1])*(1-P/b)}return y}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.cZ(this.painter.context.gl),this._removed=!0,this.fire(new a.a8("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=a.a4.frame(c=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(c)}))}_preloadTiles(g){const c=this.style?Object.values(this.style._sourceCaches):[];return a.c_(c,(d,y)=>d._preloadTiles(g,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,c){a.d0(g,c)}get version(){return a.c$}},NavigationControl:class{constructor(g){this.options=a.ak({},Mw,g),this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(a.aR(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),Y("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),Y("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.aR(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:c}):d.resetNorth({},{originalEvent:c}))}),this._compassIcon=Y("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const c=g.getZoom(),d=c===g.getMaxZoom(),y=c===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pa(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,c){const d=Y("button",g,this._container);return d.type="button",d.addEventListener("click",c),d}_setButtonTitle(g,c){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${c}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends a.a6{constructor(g){super();const c=navigator.geolocation;this.options=a.ak({geolocation:c},ws,g),a.aR(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ea(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const c=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,g(d)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(d=>c(d.state!=="denied")).catch(()=>c()):c()}_isOutOfMapMaxBounds(g){const c=this._map.getMaxBounds(),d=g.coords;return!!c&&(d.longitude<c.getWest()||d.longitude>c.getEast()||d.latitude<c.getSouth()||d.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new a.a8("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.a8("geolocate",g)),this._finish()}}_updateCamera(g){const c=new a.L(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,y=this._map.getBearing(),b=a.ak({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(d),b,{geolocateSource:!0})}_updateMarker(g){if(g){const c=new a.L(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,c=a.b(1,g._center.lat)*g.worldSize,d=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.a8("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=Y("button","mapboxgl-ctrl-geolocate",this._container),Y("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){a.X("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y("div","mapboxgl-user-location"),this._dotElement.appendChild(Y("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Y("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Gr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Y("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c.originalEvent&&c.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.a8("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.X("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.a8("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.a8("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.a8("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(c=>{c==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Pm,ScaleControl:class{constructor(g){this.options=a.ak({},bc,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.aR(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,c=this._map,d=c._containerHeight/2,y=c._containerWidth/2-g/2,b=c.unproject([y,d]),T=c.unproject([y+g,d]),S=b.distanceTo(T);if(this.options.unit==="imperial"){const P=3.2808*S;P>5280?this._setScale(g,P/5280,"mile"):this._setScale(g,P,"foot")}else this.options.unit==="nautical"?this._setScale(g,S/1852,"nautical-mile"):S>=1e3?this._setScale(g,S/1e3,"kilometer"):this._setScale(g,S,"meter")}_setScale(g,c,d){this._map._requestDomTask(()=>{const y=function(T){const S=Math.pow(10,`${Math.floor(T)}`.length-1);let P=T/S;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(M){const D=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*D)/D}(P),S*P}(c),b=y/c;this._container.innerHTML=this._isNumberFormatSupported&&d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(y):`${y}&nbsp;${$d[d]}`,this._container.style.width=g*b+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:a.X("Full screen control 'container' must be a DOM element.")),a.aR(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.X("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Y("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Y("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.a6{constructor(g){super(),this.options=a.ak(Object.create(Pw),g),a.aR(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new a.a8("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new a.a8("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=a.L.convert(g),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const c=document.createDocumentFragment(),d=document.createElement("body");let y;for(d.innerHTML=g;y=d.firstChild,y;)c.appendChild(y);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=Y("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(g),this.options.closeButton){const d=this._closeButton=Y("button","mapboxgl-popup-close-button",c);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let c;return this._classList.delete(g)?c=!1:(this._classList.add(g),c=!0),this._updateClassList(),c}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const c=this._map,d=this._container,y=this._pos;if(!c||!d||!y)return"bottom";const b=d.offsetWidth,T=d.offsetHeight,S=y.x<b/2,P=y.x>c.transform.width-b/2;if(y.y+g<T)return S?"top-left":P?"top-right":"top";if(y.y>c.transform.height-T){if(S)return"bottom-left";if(P)return"bottom-right"}return S?"left":P?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),g.className=c.join(" ")}_update(g){const c=this._map,d=this._content;if(!c||!this._lngLat&&!this._trackPointer||!d)return;let y=this._container;if(y||(y=this._container=Y("div","mapboxgl-popup",c.getContainer()),this._tip=Y("div","mapboxgl-popup-tip",y),y.appendChild(d)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Mm(this._lngLat,this._pos,c.transform)),!this._trackPointer||g){const b=this._pos=this._trackPointer&&g?g:c.project(this._lngLat),T=Rm(this.options.offset),S=this._anchor=this._getAnchor(T.y),P=Rm(this.options.offset,S),M=b.add(P).round();c._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Ud[S]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&c._showingGlobe()){const b=a.cN(c.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(T0);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Gr,Style:Oo,LngLat:a.L,LngLatBounds:a.D,Point:a.P,MercatorCoordinate:a.M,FreeCameraOptions:ai,Evented:a.a6,config:a.cM,prewarm:a.d3,clearPrewarmedResources:a.d4,get accessToken(){return a.cM.ACCESS_TOKEN},set accessToken(g){a.cM.ACCESS_TOKEN=g},get baseApiUrl(){return a.cM.API_URL},set baseApiUrl(g){a.cM.API_URL=g},get workerCount(){return a.d5.workerCount},set workerCount(g){a.d5.workerCount=g},get maxParallelImageRequests(){return a.cM.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){a.cM.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){a.d6(g)},get workerUrl(){return a.d7.workerUrl},set workerUrl(g){a.d7.workerUrl=g},get workerClass(){return a.d7.workerClass},set workerClass(g){a.d7.workerClass=g},get workerParams(){return a.d7.workerParams},set workerParams(g){a.d7.workerParams=g},get dracoUrl(){return a.d8()},set dracoUrl(g){a.d9(g)},setNow:a.a4.setNow,restoreNow:a.a4.restoreNow}});var v=u;return v})})(C6);var cee=C6.exports;const U_=ny(cee),uee=(t,e)=>{const v=40075e3/Math.pow(2,e)/256,a=t*Math.PI/180;return v*Math.cos(a)},ZL=(t,e,i)=>{const s=i*1e3,u=uee(t,e);return s/u};U_.accessToken="pk.eyJ1IjoiamF5cDEiLCJhIjoiY2x0cThxeTRoMDNoZjJtb2FxbHZxNWswdCJ9.klviohbHw0SiLmti0NQXPA";const R6=({locations:t})=>{const e=["#59418e","#f7a440","#f72585","#7209b7","#3a0ca3","#4361ee","#4cc9f0","#0be881","#f0f66e","#ffbe0b"],i=Be.useRef(null),s=Be.useRef(null),{userLocation:u}=Be.useContext(ku);return Be.useEffect(()=>{s.current||(s.current=new U_.Map({container:i.current,style:"mapbox://styles/mapbox/navigation-night-v1",center:[u.longitude,u.latitude],zoom:11}),s.current.on("load",()=>{new U_.Marker().setLngLat([u.longitude,u.latitude]).addTo(s.current),t.forEach((p,v)=>{const a=`circleSource-${v}`,A=`circleLayer-${v}`,O=ZL(p.latitude,s.current.getZoom(),p.radius);s.current.addSource(a,{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[p.longitude,p.latitude]}}]}}),s.current.addLayer({id:A,type:"circle",source:a,paint:{"circle-radius":O,"circle-color":e[v%e.length],"circle-opacity":.6}})})}))},[t,u.latitude,u.longitude]),Be.useEffect(()=>{var v,a;const p=()=>{!s.current||!s.current.isStyleLoaded()||t.forEach((A,O)=>{const B=`circleLayer-${O}`,$=ZL(A.latitude,s.current.getZoom(),A.radius*2);s.current.getLayer(B)&&s.current.setPaintProperty(B,"circle-radius",$)})};return(v=s.current)==null||v.on("load",p),(a=s.current)==null||a.on("zoomend",p),p(),()=>{var A,O;(A=s.current)==null||A.off("load",p),(O=s.current)==null||O.off("zoomend",p)}},[t]),We.jsx("div",{className:"map-container",ref:i})};U_.accessToken="pk.eyJ1IjoiamF5cDEiLCJhIjoiY2x0cThxeTRoMDNoZjJtb2FxbHZxNWswdCJ9.klviohbHw0SiLmti0NQXPA";const hee=()=>{const{user:t,userLocation:e}=Be.useContext(ku),i=Qh(),[s,u]=Be.useState({chatRoomName:"",createRoom:!1,radius:2}),p=[{longitude:e.longitude,latitude:e.latitude,radius:s.radius}],v=A=>{const{name:O,value:B}=A.target;u($=>({...$,[O]:B}))},a=async()=>{const{chatRoomName:A,radius:O}=s;if(lee(A))nr.error("Don't use bad words in chat room");else if(A.trim()==="")nr.error("Chat room name cannot be empty");else{u(se=>({...se,createRoom:!0}));const B=Xh(pu,"rooms"),$=new Db(e.latitude,e.longitude),Y=await Nb(B,{name:A,createdAt:new Date,createdBy:t.displayName,createdLocation:$,radius:O});nr.success(`${A} has been created`),i(`/joinroom/${Y.id}`)}};return We.jsxs("div",{className:"chat-room",children:[We.jsx("h2",{children:"Create a New Chat Room"}),We.jsxs("form",{children:[We.jsxs("div",{className:"form-group",children:[We.jsx("label",{htmlFor:"chatRoomName",children:"Chat Room Name"}),We.jsx("input",{type:"text",id:"chatRoomName",name:"chatRoomName",placeholder:"Enter chat room name",value:s.chatRoomName,onChange:v})]}),We.jsxs("div",{className:"form-group",children:[We.jsx("label",{htmlFor:"radius",children:"Radius (in km)"}),We.jsx("input",{type:"range",id:"radius",name:"radius",min:"0",max:"100",value:s.radius,onChange:v}),We.jsxs("p",{className:"slider-value bold-text",children:["Value: ",s.radius," km"]})]}),We.jsx("button",{type:"button",onClick:a,className:"bold-text",children:"Create Chat Room"})]}),We.jsx(R6,{locations:p})]})};const i1=t=>t*(Math.PI/180),dee=(t,e,i,s)=>{const p=i1(i-t),v=i1(s-e),a=Math.sin(p/2)*Math.sin(p/2)+Math.cos(i1(t))*Math.cos(i1(i))*Math.sin(v/2)*Math.sin(v/2);return 6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))};U_.accessToken="pk.eyJ1IjoiamF5cDEiLCJhIjoiY2x0cThxeTRoMDNoZjJtb2FxbHZxNWswdCJ9.klviohbHw0SiLmti0NQXPA";const O6=()=>{const[t,e]=Be.useState(!1),{userLocation:i}=Be.useContext(ku),[s,u]=Be.useState([]);return Be.useEffect(()=>{const p=Xh(pu,"rooms"),v=tk(p,qB("createdAt","asc"));e(!0);const a=YB(v,A=>{let O=[];A.forEach(B=>{const $={...B.data(),id:B.id};i&&$.createdLocation&&dee(i.latitude,i.longitude,$.createdLocation.latitude,$.createdLocation.longitude)<=$.radius&&O.push($)}),e(!1),u(O)});return()=>a()},[i]),t?We.jsx(k6,{}):We.jsxs("div",{children:[We.jsxs("table",{id:"rooms",children:[We.jsx("thead",{children:We.jsxs("tr",{children:[We.jsx("th",{children:"Room Name"}),We.jsx("th",{children:"Action"})]})}),We.jsxs("tbody",{children:[s.map(p=>We.jsxs("tr",{children:[We.jsx("td",{children:p.name}),We.jsx("td",{children:We.jsx(zl,{to:`/joinroom/${p.id}`,children:We.jsx("button",{className:"join-button",children:"Join"})})})]},p.id)),We.jsx("tr",{})]})]}),We.jsx(R6,{locations:s.map(p=>({longitude:p.createdLocation.longitude,latitude:p.createdLocation.latitude,radius:p.radius}))})]})};var hn="cs",D6={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var s=[],u=0;u<arguments.length;u++){var p=arguments[u];if(p){var v=typeof p;if(v==="string"||v==="number")s.push(p);else if(Array.isArray(p)){if(p.length){var a=i.apply(null,p);a&&s.push(a)}}else if(v==="object"){if(p.toString!==Object.prototype.toString&&!p.toString.toString().includes("[native code]")){s.push(p.toString());continue}for(var A in p)e.call(p,A)&&p[A]&&s.push(A)}}}return s.join(" ")}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(D6);var fee=D6.exports;const Ln=ny(fee);var L6=["available","unavailable","away","dnd","invisible","eager"],z6=["xs","sm","md","lg","fluid"];function $_(t){"@babel/helpers - typeof";return $_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$_(t)}var pee=["status","size","className","name","selected","children"];function lI(){return lI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},lI.apply(this,arguments)}function XL(t,e,i){return e=mee(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function mee(t){var e=gee(t,"string");return $_(e)==="symbol"?e:String(e)}function gee(t,e){if($_(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if($_(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _ee(t,e){if(t==null)return{};var i=yee(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function yee(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var uk=function(e){var i=e.status,s=e.size,u=e.className,p=e.name,v=e.selected,a=e.children,A=_ee(e,pee),O="".concat(hn,"-status"),B=Re.createElement("div",{className:"".concat(O,"__bullet")}),$=p||a;return Re.createElement("div",lI({},A,{"aria-selected":v===!0?"":null,className:Ln(O,"".concat(O,"--").concat(s),"".concat(O,"--").concat(i),XL({},"".concat(O,"--selected"),v),XL({},"".concat(O,"--named"),$),u)}),B,$&&Re.createElement("div",{className:"".concat(O,"__name")},p||a))};uk.defaultProps={size:"md"};function G_(t){"@babel/helpers - typeof";return G_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G_(t)}var vee=["name","src","size","status","className","active","children"];function cI(){return cI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},cI.apply(this,arguments)}function xee(t,e,i){return e=bee(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function bee(t){var e=wee(t,"string");return G_(e)==="symbol"?e:String(e)}function wee(t,e){if(G_(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(G_(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Tee(t,e){if(t==null)return{};var i=Eee(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Eee(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}function hk(t,e){var i=t.name,s=t.src,u=t.size,p=t.status,v=t.className,a=t.active,A=t.children,O=Tee(t,vee),B="".concat(hn,"-avatar"),$=typeof u<"u"?" ".concat(B,"--").concat(u):"",Y=Be.useRef();return Be.useImperativeHandle(e,function(){return{focus:function(){return Y.current.focus()}}}),Re.createElement("div",cI({ref:Y},O,{className:Ln("".concat(B).concat($),xee({},"".concat(B,"--active"),a),v)}),A||Re.createElement(Re.Fragment,null,Re.createElement("img",{src:s,alt:i}),typeof p=="string"&&Re.createElement(uk,{status:p,size:u})," "))}var Cp=Be.forwardRef(hk);Cp.displayName="Avatar";Cp.propTypes={children:zt.node,name:zt.string,src:zt.string,size:zt.oneOf(z6),status:zt.oneOf(L6),active:zt.bool,className:zt.string};hk.defaultProps={name:"",src:"",size:"md",active:!1};Cp.defaultProps=hk.defaultProps;function YL(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable})),i.push.apply(i,s)}return i}function o1(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?YL(Object(i),!0).forEach(function(s){See(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):YL(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function See(t,e,i){return e=Iee(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Iee(t){var e=Aee(t,"string");return xu(e)==="symbol"?e:String(e)}function Aee(t,e){if(xu(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(xu(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function xu(t){"@babel/helpers - typeof";return xu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xu(t)}var C1=function(){},Pee=function(e){return e==null||Array.isArray(e)&&e.length===0},ky=function(e,i){var s=[],u=i.map(function(p){return p.displayName||p.name});return Re.Children.toArray(e).forEach(function(p){var v=i.indexOf(p.type);if(v!==-1)s[v]=p;else{var a,A,O,B=(a=p==null||(A=p.props)===null||A===void 0?void 0:A.as)!==null&&a!==void 0?a:p==null||(O=p.props)===null||O===void 0?void 0:O.is,$=xu(B);if($==="function"){var Y=i.indexOf(B);Y!==-1&&(s[Y]=Re.cloneElement(p,o1(o1({},p.props),{},{as:null})))}else if($==="object"){var se=B.name||B.displayName,me=u.indexOf(se);me!==-1&&(s[me]=Re.cloneElement(p,o1(o1({},p.props),{},{as:null})))}else if($==="string"){var _e=u.indexOf(B);_e!==-1&&(s[_e]=p)}}}),s},N6=function(e){if(typeof e=="string")return e;if("type"in e){var i=xu(e.type);if(i==="function"||i==="object"){if("displayName"in e.type)return e.type.displayName;if("name"in e.type)return e.type.name}else if(i==="string")return e.type;return"undefined"}return"undefined"},F6=function(e){return function(i,s,u){var p=e.map(function(B){return B.name||B.displayName}),v=Re.Children.toArray(i[s]).find(function(B){if(typeof B=="string"&&B.trim().length===0)return!1;if(e.indexOf(B.type)===-1){var $,Y,se=(B==null||($=B.props)===null||$===void 0?void 0:$.as)||(B==null||(Y=B.props)===null||Y===void 0?void 0:Y.is),me=xu(se);if(me==="function")return e.indexOf(se)===-1;if(me==="object"){var _e=se.name||se.displayName;return p.indexOf(_e)===-1}else return me==="string"?p.indexOf(se)===-1:!0}});if(typeof v<"u"){var a=N6(v),A=e.map(function(B){return B.name||B.displayName}).join(", "),O='"'.concat(a,'" is not a valid child for ').concat(u,". Allowed types: ").concat(A);return new Error(O)}}},kee=["children","size","className","max","activeIndex","hoverToFront"];function uI(){return uI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},uI.apply(this,arguments)}function Cee(t,e){if(t==null)return{};var i=Mee(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Mee(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var dk=function(e){var i=e.children,s=e.size,u=e.className,p=e.max,v=e.activeIndex,a=e.hoverToFront,A=Cee(e,kee),O="".concat(hn,"-avatar-group"),B=typeof p=="number"&&Re.Children.count(i)>p?Re.Children.toArray(i).reverse().slice(0,p):Re.Children.toArray(i).reverse(),$=typeof v=="number"?B.length-v-1:void 0;return Re.createElement("div",uI({},A,{className:Ln(O,"".concat(O,"--").concat(s),u)}),B.map(function(Y,se){var me=typeof $=="number"?{active:$===se}:{};return a===!0&&(me.className=Ln("".concat(hn,"-avatar--active-on-hover"),Y.props.className)),Re.cloneElement(Y,me)}))};dk.displayName="AvatarGroup";dk.defaultProps={size:"md"};var Ree=["children","className","icon","border","labelPosition"];function hI(){return hI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},hI.apply(this,arguments)}function Oee(t,e){if(t==null)return{};var i=Dee(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Dee(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Ub=function(e){var i=e.children,s=e.className,u=e.icon,p=e.border,v=e.labelPosition,a=Oee(e,Ree),A="".concat(hn,"-button"),O=typeof v<"u"?v:"right",B=Re.Children.count(i)>0?"".concat(A,"--").concat(O):"",$=p===!0?"".concat(A,"--border"):"";return Re.createElement("button",hI({},a,{className:Ln(A,B,$,s)}),O==="left"&&i,u,O==="right"&&i)};Ub.defaultProps={children:void 0,className:"",icon:void 0,labelPosition:void 0,border:!1};var B6={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e="fas",i="arrow-up",s=448,u=512,p=[],v="f062",a="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z";t.definition={prefix:e,iconName:i,icon:[s,u,p,v,a]},t.faArrowUp=t.definition,t.prefix=e,t.iconName=i,t.width=s,t.height=u,t.ligatures=p,t.unicode=v,t.svgPathData=a})(B6);var j6={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e="fas",i="arrow-right",s=448,u=512,p=[],v="f061",a="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z";t.definition={prefix:e,iconName:i,icon:[s,u,p,v,a]},t.faArrowRight=t.definition,t.prefix=e,t.iconName=i,t.width=s,t.height=u,t.ligatures=p,t.unicode=v,t.svgPathData=a})(j6);var V6={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e="fas",i="arrow-down",s=448,u=512,p=[],v="f063",a="M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z";t.definition={prefix:e,iconName:i,icon:[s,u,p,v,a]},t.faArrowDown=t.definition,t.prefix=e,t.iconName=i,t.width=s,t.height=u,t.ligatures=p,t.unicode=v,t.svgPathData=a})(V6);var U6={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e="fas",i="arrow-left",s=448,u=512,p=[],v="f060",a="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z";t.definition={prefix:e,iconName:i,icon:[s,u,p,v,a]},t.faArrowLeft=t.definition,t.prefix=e,t.iconName=i,t.width=s,t.height=u,t.ligatures=p,t.unicode=v,t.svgPathData=a})(U6);var Lee=["className","direction","children"];function dI(){return dI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},dI.apply(this,arguments)}function zee(t,e){if(t==null)return{};var i=Nee(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Nee(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var $6=function(e){var i=e.className,s=e.direction,u=e.children,p=zee(e,Lee),v="".concat(hn,"-button--arrow"),a=function(){if(s==="up")return B6.faArrowUp;if(s==="right")return j6.faArrowRight;if(s==="down")return V6.faArrowDown;if(s==="left")return U6.faArrowLeft}();return Re.createElement(Ub,dI({},p,{className:Ln(v,i),icon:Re.createElement(fa,{icon:a})}),u)};$6.defaultProps={className:"",direction:"right"};var G6={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e="fas",i="ellipsis-v",s=192,u=512,p=[],v="f142",a="M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z";t.definition={prefix:e,iconName:i,icon:[s,u,p,v,a]},t.faEllipsisV=t.definition,t.prefix=e,t.iconName=i,t.width=s,t.height=u,t.ligatures=p,t.unicode=v,t.svgPathData=a})(G6);var W6={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e="fas",i="paper-plane",s=512,u=512,p=[],v="f1d8",a="M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z";t.definition={prefix:e,iconName:i,icon:[s,u,p,v,a]},t.faPaperPlane=t.definition,t.prefix=e,t.iconName=i,t.width=s,t.height=u,t.ligatures=p,t.unicode=v,t.svgPathData=a})(W6);var Fee=["className","children"];function fI(){return fI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},fI.apply(this,arguments)}function Bee(t,e){if(t==null)return{};var i=jee(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function jee(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var q6=function(e){var i=e.className,s=e.children,u=Bee(e,Fee),p="".concat(hn,"-button--send");return Re.createElement(Ub,fI({},u,{className:Ln(p,i),icon:Re.createElement(fa,{icon:W6.faPaperPlane})}),s)};q6.defaultProps={className:""};var H6={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e="fas",i="paperclip",s=448,u=512,p=[],v="f0c6",a="M43.246 466.142c-58.43-60.289-57.341-157.511 1.386-217.581L254.392 34c44.316-45.332 116.351-45.336 160.671 0 43.89 44.894 43.943 117.329 0 162.276L232.214 383.128c-29.855 30.537-78.633 30.111-107.982-.998-28.275-29.97-27.368-77.473 1.452-106.953l143.743-146.835c6.182-6.314 16.312-6.422 22.626-.241l22.861 22.379c6.315 6.182 6.422 16.312.241 22.626L171.427 319.927c-4.932 5.045-5.236 13.428-.648 18.292 4.372 4.634 11.245 4.711 15.688.165l182.849-186.851c19.613-20.062 19.613-52.725-.011-72.798-19.189-19.627-49.957-19.637-69.154 0L90.39 293.295c-34.763 35.56-35.299 93.12-1.191 128.313 34.01 35.093 88.985 35.137 123.058.286l172.06-175.999c6.177-6.319 16.307-6.433 22.626-.256l22.877 22.364c6.319 6.177 6.434 16.307.256 22.626l-172.06 175.998c-59.576 60.938-155.943 60.216-214.77-.485z";t.definition={prefix:e,iconName:i,icon:[s,u,p,v,a]},t.faPaperclip=t.definition,t.prefix=e,t.iconName=i,t.width=s,t.height=u,t.ligatures=p,t.unicode=v,t.svgPathData=a})(H6);var Vee=["className","children"];function pI(){return pI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},pI.apply(this,arguments)}function Uee(t,e){if(t==null)return{};var i=$ee(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function $ee(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Z6=function(e){var i=e.className,s=e.children,u=Uee(e,Vee),p="".concat(hn,"-button--attachment");return Re.createElement(Ub,pI({},u,{className:Ln(p,i),icon:Re.createElement(fa,{icon:H6.faPaperclip})}),s)};Z6.defaultProps={className:""};var Gee=["onClick","children","className"];function mI(){return mI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},mI.apply(this,arguments)}function Wee(t,e){if(t==null)return{};var i=qee(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function qee(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var $b=function(e){var i=e.onClick,s=e.children,u=e.className,p=Wee(e,Gee),v="".concat(hn,"-conversation-header__back");return Re.createElement("div",mI({},p,{className:Ln(v,u)}),typeof s<"u"?s:Re.createElement($6,{direction:"left",onClick:i}))};$b.displayName="ConversationHeader.Back";$b.defaultProps={children:void 0,onClick:function(){}};var Hee=["children","className"];function gI(){return gI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},gI.apply(this,arguments)}function Zee(t,e){if(t==null)return{};var i=Xee(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Xee(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Gb=function(e){var i=e.children,s=e.className,u=Zee(e,Hee),p="".concat(hn,"-conversation-header__actions");return Re.createElement("section",gI({},u,{className:Ln(p,s)}),i)};Gb.displayName="ConversationHeader.Actions";Gb.defaultProps={children:void 0};var Yee=["userName","info","children","className"];function _I(){return _I=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},_I.apply(this,arguments)}function Kee(t,e){if(t==null)return{};var i=Jee(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Jee(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Wb=function(e){var i=e.userName,s=e.info,u=e.children,p=e.className,v=Kee(e,Yee),a="".concat(hn,"-conversation-header__content");return Re.createElement("div",_I({},v,{className:Ln(a,p)}),typeof u<"u"?u:Re.createElement(Re.Fragment,null,Re.createElement("div",{className:"".concat(hn,"-conversation-header__user-name")},i),Re.createElement("div",{className:"".concat(hn,"-conversation-header__info")},s)))};Wb.displayName="ConversationHeader.Content";Wb.defaultProps={children:void 0,userName:"",info:""};var Qee=["children","className"];function yI(){return yI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},yI.apply(this,arguments)}function ete(t,e){return ite(t)||rte(t,e)||nte(t,e)||tte()}function tte(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nte(t,e){if(t){if(typeof t=="string")return KL(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return KL(t,e)}}function KL(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function rte(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var s,u,p,v,a=[],A=!0,O=!1;try{if(p=(i=i.call(t)).next,e===0){if(Object(i)!==i)return;A=!1}else for(;!(A=(s=p.call(i)).done)&&(a.push(s.value),a.length!==e);A=!0);}catch(B){O=!0,u=B}finally{try{if(!A&&i.return!=null&&(v=i.return(),Object(v)!==v))return}finally{if(O)throw u}}return a}}function ite(t){if(Array.isArray(t))return t}function ote(t,e){if(t==null)return{};var i=ste(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function ste(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Mp=function(e){var i=e.children,s=e.className,u=ote(e,Qee),p="".concat(hn,"-conversation-header"),v=ky(i,[$b,Cp,dk,Wb,Gb]),a=ete(v,5),A=a[0],O=a[1],B=a[2],$=a[3],Y=a[4];return Re.createElement("div",yI({},u,{className:Ln(p,s)}),A,O&&Re.createElement("div",{className:"".concat(p,"__avatar")},O),!O&&B&&Re.createElement("div",{className:"".concat(p,"__avatar")},B),$,Y)};Mp.displayName="ConversationHeader";Mp.defaultProps={children:void 0};Mp.Back=$b;Mp.Actions=Gb;Mp.Content=Wb;/*!
 * perfect-scrollbar v1.5.0
 * Copyright 2020 Hyunje Jun, MDBootstrap and Contributors
 * Licensed under MIT
 */function Wa(t){return getComputedStyle(t)}function Vo(t,e){for(var i in e){var s=e[i];typeof s=="number"&&(s=s+"px"),t.style[i]=s}return t}function s1(t){var e=document.createElement("div");return e.className=t,e}var JL=typeof Element<"u"&&(Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector);function eu(t,e){if(!JL)throw new Error("No element matching method supported");return JL.call(t,e)}function Rf(t){t.remove?t.remove():t.parentNode&&t.parentNode.removeChild(t)}function QL(t,e){return Array.prototype.filter.call(t.children,function(i){return eu(i,e)})}var pi={main:"ps",rtl:"ps__rtl",element:{thumb:function(e){return"ps__thumb-"+e},rail:function(e){return"ps__rail-"+e},consuming:"ps__child--consume"},state:{focus:"ps--focus",clicking:"ps--clicking",active:function(e){return"ps--active-"+e},scrolling:function(e){return"ps--scrolling-"+e}}},X6={x:null,y:null};function Y6(t,e){var i=t.element.classList,s=pi.state.scrolling(e);i.contains(s)?clearTimeout(X6[e]):i.add(s)}function K6(t,e){X6[e]=setTimeout(function(){return t.isAlive&&t.element.classList.remove(pi.state.scrolling(e))},t.settings.scrollingThreshold)}function ate(t,e){Y6(t,e),K6(t,e)}var Cy=function(e){this.element=e,this.handlers={}},J6={isEmpty:{configurable:!0}};Cy.prototype.bind=function(e,i){typeof this.handlers[e]>"u"&&(this.handlers[e]=[]),this.handlers[e].push(i);var s=["touchstart","wheel","touchmove"];s.indexOf(e)!==-1?this.element.addEventListener(e,i,{passive:!1}):this.element.addEventListener(e,i,!1)};Cy.prototype.unbind=function(e,i){var s=this;this.handlers[e]=this.handlers[e].filter(function(u){return i&&u!==i?!0:(s.element.removeEventListener(e,u,!1),!1)})};Cy.prototype.unbindAll=function(){for(var e in this.handlers)this.unbind(e)};J6.isEmpty.get=function(){var t=this;return Object.keys(this.handlers).every(function(e){return t.handlers[e].length===0})};Object.defineProperties(Cy.prototype,J6);var Rp=function(){this.eventElements=[]};Rp.prototype.eventElement=function(e){var i=this.eventElements.filter(function(s){return s.element===e})[0];return i||(i=new Cy(e),this.eventElements.push(i)),i};Rp.prototype.bind=function(e,i,s){this.eventElement(e).bind(i,s)};Rp.prototype.unbind=function(e,i,s){var u=this.eventElement(e);u.unbind(i,s),u.isEmpty&&this.eventElements.splice(this.eventElements.indexOf(u),1)};Rp.prototype.unbindAll=function(){this.eventElements.forEach(function(e){return e.unbindAll()}),this.eventElements=[]};Rp.prototype.once=function(e,i,s){var u=this.eventElement(e),p=function v(a){u.unbind(i,v),s(a)};u.bind(i,p)};function a1(t){if(typeof window.CustomEvent=="function")return new CustomEvent(t);var e=document.createEvent("CustomEvent");return e.initCustomEvent(t,!1,!1,void 0),e}function Dx(t,e,i,s,u,p){s===void 0&&(s=!0),u===void 0&&(u=!1);var v;if(e==="top")v=["contentHeight","containerHeight","scrollTop","y","up","down"];else if(e==="left")v=["contentWidth","containerWidth","scrollLeft","x","left","right"];else throw new Error("A proper axis should be provided");lte(t,i,v,s,u,p)}function lte(t,e,i,s,u,p){var v=i[0],a=i[1],A=i[2],O=i[3],B=i[4],$=i[5];s===void 0&&(s=!0),u===void 0&&(u=!1);var Y=t.element;t.reach[O]=null;var se=p===!0?t[v]!==t[a]:!0;se&&Y[A]<1&&(t.reach[O]="start"),se&&Y[A]>t[v]-t[a]-1&&(t.reach[O]="end"),e&&(Y.dispatchEvent(a1("ps-scroll-"+O)),e<0?Y.dispatchEvent(a1("ps-scroll-"+B)):e>0&&Y.dispatchEvent(a1("ps-scroll-"+$)),s&&ate(t,O)),t.reach[O]&&(e||u)&&Y.dispatchEvent(a1("ps-"+O+"-reach-"+t.reach[O]))}function qr(t){return parseInt(t,10)||0}function cte(t){return eu(t,"input,[contenteditable]")||eu(t,"select,[contenteditable]")||eu(t,"textarea,[contenteditable]")||eu(t,"button,[contenteditable]")}function ute(t){var e=Wa(t);return qr(e.width)+qr(e.paddingLeft)+qr(e.paddingRight)+qr(e.borderLeftWidth)+qr(e.borderRightWidth)}var jg={isWebKit:typeof document<"u"&&"WebkitAppearance"in document.documentElement.style,supportsTouch:typeof window<"u"&&("ontouchstart"in window||"maxTouchPoints"in window.navigator&&window.navigator.maxTouchPoints>0||window.DocumentTouch&&document instanceof window.DocumentTouch),supportsIePointer:typeof navigator<"u"&&navigator.msMaxTouchPoints,isChrome:typeof navigator<"u"&&/Chrome/i.test(navigator&&navigator.userAgent)};function tc(t){var e=t.element,i=Math.floor(e.scrollTop),s=e.getBoundingClientRect();t.containerWidth=Math.round(s.width),t.containerHeight=Math.round(s.height),t.contentWidth=e.scrollWidth,t.contentHeight=e.scrollHeight,e.contains(t.scrollbarXRail)||(QL(e,pi.element.rail("x")).forEach(function(u){return Rf(u)}),e.appendChild(t.scrollbarXRail)),e.contains(t.scrollbarYRail)||(QL(e,pi.element.rail("y")).forEach(function(u){return Rf(u)}),e.appendChild(t.scrollbarYRail)),!t.settings.suppressScrollX&&t.containerWidth+t.settings.scrollXMarginOffset<t.contentWidth?(t.scrollbarXActive=!0,t.railXWidth=t.containerWidth-t.railXMarginWidth,t.railXRatio=t.containerWidth/t.railXWidth,t.scrollbarXWidth=ez(t,qr(t.railXWidth*t.containerWidth/t.contentWidth)),t.scrollbarXLeft=qr((t.negativeScrollAdjustment+e.scrollLeft)*(t.railXWidth-t.scrollbarXWidth)/(t.contentWidth-t.containerWidth))):t.scrollbarXActive=!1,!t.settings.suppressScrollY&&t.containerHeight+t.settings.scrollYMarginOffset<t.contentHeight?(t.scrollbarYActive=!0,t.railYHeight=t.containerHeight-t.railYMarginHeight,t.railYRatio=t.containerHeight/t.railYHeight,t.scrollbarYHeight=ez(t,qr(t.railYHeight*t.containerHeight/t.contentHeight)),t.scrollbarYTop=qr(i*(t.railYHeight-t.scrollbarYHeight)/(t.contentHeight-t.containerHeight))):t.scrollbarYActive=!1,t.scrollbarXLeft>=t.railXWidth-t.scrollbarXWidth&&(t.scrollbarXLeft=t.railXWidth-t.scrollbarXWidth),t.scrollbarYTop>=t.railYHeight-t.scrollbarYHeight&&(t.scrollbarYTop=t.railYHeight-t.scrollbarYHeight),hte(e,t),t.scrollbarXActive?e.classList.add(pi.state.active("x")):(e.classList.remove(pi.state.active("x")),t.scrollbarXWidth=0,t.scrollbarXLeft=0,e.scrollLeft=t.isRtl===!0?t.contentWidth:0),t.scrollbarYActive?e.classList.add(pi.state.active("y")):(e.classList.remove(pi.state.active("y")),t.scrollbarYHeight=0,t.scrollbarYTop=0,e.scrollTop=0)}function ez(t,e){return t.settings.minScrollbarLength&&(e=Math.max(e,t.settings.minScrollbarLength)),t.settings.maxScrollbarLength&&(e=Math.min(e,t.settings.maxScrollbarLength)),e}function hte(t,e){var i={width:e.railXWidth},s=Math.floor(t.scrollTop);e.isRtl?i.left=e.negativeScrollAdjustment+t.scrollLeft+e.containerWidth-e.contentWidth:i.left=t.scrollLeft,e.isScrollbarXUsingBottom?i.bottom=e.scrollbarXBottom-s:i.top=e.scrollbarXTop+s,Vo(e.scrollbarXRail,i);var u={top:s,height:e.railYHeight};e.isScrollbarYUsingRight?e.isRtl?u.right=e.contentWidth-(e.negativeScrollAdjustment+t.scrollLeft)-e.scrollbarYRight-e.scrollbarYOuterWidth-9:u.right=e.scrollbarYRight-t.scrollLeft:e.isRtl?u.left=e.negativeScrollAdjustment+t.scrollLeft+e.containerWidth*2-e.contentWidth-e.scrollbarYLeft-e.scrollbarYOuterWidth:u.left=e.scrollbarYLeft+t.scrollLeft,Vo(e.scrollbarYRail,u),Vo(e.scrollbarX,{left:e.scrollbarXLeft,width:e.scrollbarXWidth-e.railBorderXWidth}),Vo(e.scrollbarY,{top:e.scrollbarYTop,height:e.scrollbarYHeight-e.railBorderYWidth})}function dte(t){t.element,t.event.bind(t.scrollbarY,"mousedown",function(e){return e.stopPropagation()}),t.event.bind(t.scrollbarYRail,"mousedown",function(e){var i=e.pageY-window.pageYOffset-t.scrollbarYRail.getBoundingClientRect().top,s=i>t.scrollbarYTop?1:-1;t.element.scrollTop+=s*t.containerHeight,tc(t),e.stopPropagation()}),t.event.bind(t.scrollbarX,"mousedown",function(e){return e.stopPropagation()}),t.event.bind(t.scrollbarXRail,"mousedown",function(e){var i=e.pageX-window.pageXOffset-t.scrollbarXRail.getBoundingClientRect().left,s=i>t.scrollbarXLeft?1:-1;t.element.scrollLeft+=s*t.containerWidth,tc(t),e.stopPropagation()})}function fte(t){tz(t,["containerWidth","contentWidth","pageX","railXWidth","scrollbarX","scrollbarXWidth","scrollLeft","x","scrollbarXRail"]),tz(t,["containerHeight","contentHeight","pageY","railYHeight","scrollbarY","scrollbarYHeight","scrollTop","y","scrollbarYRail"])}function tz(t,e){var i=e[0],s=e[1],u=e[2],p=e[3],v=e[4],a=e[5],A=e[6],O=e[7],B=e[8],$=t.element,Y=null,se=null,me=null;function _e(le){le.touches&&le.touches[0]&&(le[u]=le.touches[0].pageY),$[A]=Y+me*(le[u]-se),Y6(t,O),tc(t),le.stopPropagation(),le.preventDefault()}function Ee(){K6(t,O),t[B].classList.remove(pi.state.clicking),t.event.unbind(t.ownerDocument,"mousemove",_e)}function ae(le,fe){Y=$[A],fe&&le.touches&&(le[u]=le.touches[0].pageY),se=le[u],me=(t[s]-t[i])/(t[p]-t[a]),fe?t.event.bind(t.ownerDocument,"touchmove",_e):(t.event.bind(t.ownerDocument,"mousemove",_e),t.event.once(t.ownerDocument,"mouseup",Ee),le.preventDefault()),t[B].classList.add(pi.state.clicking),le.stopPropagation()}t.event.bind(t[v],"mousedown",function(le){ae(le)}),t.event.bind(t[v],"touchstart",function(le){ae(le,!0)})}function pte(t){var e=t.element,i=function(){return eu(e,":hover")},s=function(){return eu(t.scrollbarX,":focus")||eu(t.scrollbarY,":focus")};function u(p,v){var a=Math.floor(e.scrollTop);if(p===0){if(!t.scrollbarYActive)return!1;if(a===0&&v>0||a>=t.contentHeight-t.containerHeight&&v<0)return!t.settings.wheelPropagation}var A=e.scrollLeft;if(v===0){if(!t.scrollbarXActive)return!1;if(A===0&&p<0||A>=t.contentWidth-t.containerWidth&&p>0)return!t.settings.wheelPropagation}return!0}t.event.bind(t.ownerDocument,"keydown",function(p){if(!(p.isDefaultPrevented&&p.isDefaultPrevented()||p.defaultPrevented)&&!(!i()&&!s())){var v=document.activeElement?document.activeElement:t.ownerDocument.activeElement;if(v){if(v.tagName==="IFRAME")v=v.contentDocument.activeElement;else for(;v.shadowRoot;)v=v.shadowRoot.activeElement;if(cte(v))return}var a=0,A=0;switch(p.which){case 37:p.metaKey?a=-t.contentWidth:p.altKey?a=-t.containerWidth:a=-30;break;case 38:p.metaKey?A=t.contentHeight:p.altKey?A=t.containerHeight:A=30;break;case 39:p.metaKey?a=t.contentWidth:p.altKey?a=t.containerWidth:a=30;break;case 40:p.metaKey?A=-t.contentHeight:p.altKey?A=-t.containerHeight:A=-30;break;case 32:p.shiftKey?A=t.containerHeight:A=-t.containerHeight;break;case 33:A=t.containerHeight;break;case 34:A=-t.containerHeight;break;case 36:A=t.contentHeight;break;case 35:A=-t.contentHeight;break;default:return}t.settings.suppressScrollX&&a!==0||t.settings.suppressScrollY&&A!==0||(e.scrollTop-=A,e.scrollLeft+=a,tc(t),u(a,A)&&p.preventDefault())}})}function mte(t){var e=t.element;function i(v,a){var A=Math.floor(e.scrollTop),O=e.scrollTop===0,B=A+e.offsetHeight===e.scrollHeight,$=e.scrollLeft===0,Y=e.scrollLeft+e.offsetWidth===e.scrollWidth,se;return Math.abs(a)>Math.abs(v)?se=O||B:se=$||Y,se?!t.settings.wheelPropagation:!0}function s(v){var a=v.deltaX,A=-1*v.deltaY;return(typeof a>"u"||typeof A>"u")&&(a=-1*v.wheelDeltaX/6,A=v.wheelDeltaY/6),v.deltaMode&&v.deltaMode===1&&(a*=10,A*=10),a!==a&&A!==A&&(a=0,A=v.wheelDelta),v.shiftKey?[-A,-a]:[a,A]}function u(v,a,A){if(!jg.isWebKit&&e.querySelector("select:focus"))return!0;if(!e.contains(v))return!1;for(var O=v;O&&O!==e;){if(O.classList.contains(pi.element.consuming))return!0;var B=Wa(O);if(A&&B.overflowY.match(/(scroll|auto)/)){var $=O.scrollHeight-O.clientHeight;if($>0&&(O.scrollTop>0&&A<0||O.scrollTop<$&&A>0))return!0}if(a&&B.overflowX.match(/(scroll|auto)/)){var Y=O.scrollWidth-O.clientWidth;if(Y>0&&(O.scrollLeft>0&&a<0||O.scrollLeft<Y&&a>0))return!0}O=O.parentNode}return!1}function p(v){var a=s(v),A=a[0],O=a[1];if(!u(v.target,A,O)){var B=!1;t.settings.useBothWheelAxes?t.scrollbarYActive&&!t.scrollbarXActive?(O?e.scrollTop-=O*t.settings.wheelSpeed:e.scrollTop+=A*t.settings.wheelSpeed,B=!0):t.scrollbarXActive&&!t.scrollbarYActive&&(A?e.scrollLeft+=A*t.settings.wheelSpeed:e.scrollLeft-=O*t.settings.wheelSpeed,B=!0):(e.scrollTop-=O*t.settings.wheelSpeed,e.scrollLeft+=A*t.settings.wheelSpeed),tc(t),B=B||i(A,O),B&&!v.ctrlKey&&(v.stopPropagation(),v.preventDefault())}}typeof window.onwheel<"u"?t.event.bind(e,"wheel",p):typeof window.onmousewheel<"u"&&t.event.bind(e,"mousewheel",p)}function gte(t){if(!jg.supportsTouch&&!jg.supportsIePointer)return;var e=t.element;function i(me,_e){var Ee=Math.floor(e.scrollTop),ae=Math.ceil(e.scrollLeft),le=Math.abs(me),fe=Math.abs(_e);if(!t.settings.wheelPropagation)return!0;if(fe>le){if(t.settings.suppressScrollY)return!1;if(_e>0)return Ee!==0;if(_e<0)return Ee<t.contentHeight-t.containerHeight}else if(le>fe){if(t.settings.suppressScrollX)return!1;if(me>0)return ae!==0;if(_e<0)return ae<t.contentWidth-t.containerWidth}return!0}function s(me,_e){e.scrollTop-=_e,e.scrollLeft-=me,tc(t)}var u={},p=0,v={},a=null;function A(me){return me.targetTouches?me.targetTouches[0]:me}function O(me){return me.pointerType&&me.pointerType==="pen"&&me.buttons===0?!1:!!(me.targetTouches&&me.targetTouches.length===1||me.pointerType&&me.pointerType!=="mouse"&&me.pointerType!==me.MSPOINTER_TYPE_MOUSE)}function B(me){if(O(me)){var _e=A(me);u.pageX=_e.pageX,u.pageY=_e.pageY,p=new Date().getTime(),a!==null&&clearInterval(a)}}function $(me,_e,Ee){if(!e.contains(me))return!1;for(var ae=me;ae&&ae!==e;){if(ae.classList.contains(pi.element.consuming))return!0;var le=Wa(ae);if(Ee&&le.overflowY.match(/(scroll|auto)/)){var fe=ae.scrollHeight-ae.clientHeight;if(fe>0&&(ae.scrollTop>0&&Ee<0||ae.scrollTop<fe&&Ee>0))return!0}if(_e&&le.overflowX.match(/(scroll|auto)/)){var Ce=ae.scrollWidth-ae.clientWidth;if(Ce>0&&(ae.scrollLeft>0&&_e<0||ae.scrollLeft<Ce&&_e>0))return!0}ae=ae.parentNode}return!1}function Y(me){if(O(me)){var _e=A(me),Ee={pageX:_e.pageX,pageY:_e.pageY},ae=Ee.pageX-u.pageX,le=Ee.pageY-u.pageY;if($(me.target,ae,le))return;s(ae,le),u=Ee;var fe=new Date().getTime(),Ce=fe-p;Ce>0&&(v.x=ae/Ce,v.y=le/Ce,p=fe),me.cancelable&&i(ae,le)&&me.preventDefault()}}function se(){t.settings.swipeEasing&&(clearInterval(a),a=setInterval(function(){if(t.isInitialized){clearInterval(a);return}if(!v.x&&!v.y){clearInterval(a);return}if(Math.abs(v.x)<.01&&Math.abs(v.y)<.01){clearInterval(a);return}s(v.x*30,v.y*30),v.x*=.8,v.y*=.8},10))}jg.supportsTouch?(t.event.bind(e,"touchstart",B),t.event.bind(e,"touchmove",Y),t.event.bind(e,"touchend",se)):jg.supportsIePointer&&(window.PointerEvent?(t.event.bind(e,"pointerdown",B),t.event.bind(e,"pointermove",Y),t.event.bind(e,"pointerup",se)):window.MSPointerEvent&&(t.event.bind(e,"MSPointerDown",B),t.event.bind(e,"MSPointerMove",Y),t.event.bind(e,"MSPointerUp",se)))}var _te=function(){return{handlers:["click-rail","drag-thumb","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollingThreshold:1e3,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipeEasing:!0,useBothWheelAxes:!1,wheelPropagation:!0,wheelSpeed:1}},yte={"click-rail":dte,"drag-thumb":fte,keyboard:pte,wheel:mte,touch:gte},My=function(e,i){var s=this;if(i===void 0&&(i={}),typeof e=="string"&&(e=document.querySelector(e)),!e||!e.nodeName)throw new Error("no element is specified to initialize PerfectScrollbar");this.element=e,e.classList.add(pi.main),this.settings=_te();for(var u in i)this.settings[u]=i[u];this.containerWidth=null,this.containerHeight=null,this.contentWidth=null,this.contentHeight=null;var p=function(){return e.classList.add(pi.state.focus)},v=function(){return e.classList.remove(pi.state.focus)};this.isRtl=Wa(e).direction==="rtl",this.isRtl===!0&&e.classList.add(pi.rtl),this.isNegativeScroll=function(){var O=e.scrollLeft,B=null;return e.scrollLeft=-1,B=e.scrollLeft<0,e.scrollLeft=O,B}(),this.negativeScrollAdjustment=this.isNegativeScroll?e.scrollWidth-e.clientWidth:0,this.event=new Rp,this.ownerDocument=e.ownerDocument||document,this.scrollbarXRail=s1(pi.element.rail("x")),e.appendChild(this.scrollbarXRail),this.scrollbarX=s1(pi.element.thumb("x")),this.scrollbarXRail.appendChild(this.scrollbarX),this.scrollbarX.setAttribute("tabindex",0),this.event.bind(this.scrollbarX,"focus",p),this.event.bind(this.scrollbarX,"blur",v),this.scrollbarXActive=null,this.scrollbarXWidth=null,this.scrollbarXLeft=null;var a=Wa(this.scrollbarXRail);this.scrollbarXBottom=parseInt(a.bottom,10),isNaN(this.scrollbarXBottom)?(this.isScrollbarXUsingBottom=!1,this.scrollbarXTop=qr(a.top)):this.isScrollbarXUsingBottom=!0,this.railBorderXWidth=qr(a.borderLeftWidth)+qr(a.borderRightWidth),Vo(this.scrollbarXRail,{display:"block"}),this.railXMarginWidth=qr(a.marginLeft)+qr(a.marginRight),Vo(this.scrollbarXRail,{display:""}),this.railXWidth=null,this.railXRatio=null,this.scrollbarYRail=s1(pi.element.rail("y")),e.appendChild(this.scrollbarYRail),this.scrollbarY=s1(pi.element.thumb("y")),this.scrollbarYRail.appendChild(this.scrollbarY),this.scrollbarY.setAttribute("tabindex",0),this.event.bind(this.scrollbarY,"focus",p),this.event.bind(this.scrollbarY,"blur",v),this.scrollbarYActive=null,this.scrollbarYHeight=null,this.scrollbarYTop=null;var A=Wa(this.scrollbarYRail);this.scrollbarYRight=parseInt(A.right,10),isNaN(this.scrollbarYRight)?(this.isScrollbarYUsingRight=!1,this.scrollbarYLeft=qr(A.left)):this.isScrollbarYUsingRight=!0,this.scrollbarYOuterWidth=this.isRtl?ute(this.scrollbarY):null,this.railBorderYWidth=qr(A.borderTopWidth)+qr(A.borderBottomWidth),Vo(this.scrollbarYRail,{display:"block"}),this.railYMarginHeight=qr(A.marginTop)+qr(A.marginBottom),Vo(this.scrollbarYRail,{display:""}),this.railYHeight=null,this.railYRatio=null,this.reach={x:e.scrollLeft<=0?"start":e.scrollLeft>=this.contentWidth-this.containerWidth?"end":null,y:e.scrollTop<=0?"start":e.scrollTop>=this.contentHeight-this.containerHeight?"end":null},this.isAlive=!0,this.settings.handlers.forEach(function(O){return yte[O](s)}),this.lastScrollTop=Math.floor(e.scrollTop),this.lastScrollLeft=e.scrollLeft,this.event.bind(this.element,"scroll",function(O){return s.onScroll(O)}),tc(this)};My.prototype.update=function(e){this.isAlive&&(this.negativeScrollAdjustment=this.isNegativeScroll?this.element.scrollWidth-this.element.clientWidth:0,Vo(this.scrollbarXRail,{display:"block"}),Vo(this.scrollbarYRail,{display:"block"}),this.railXMarginWidth=qr(Wa(this.scrollbarXRail).marginLeft)+qr(Wa(this.scrollbarXRail).marginRight),this.railYMarginHeight=qr(Wa(this.scrollbarYRail).marginTop)+qr(Wa(this.scrollbarYRail).marginBottom),Vo(this.scrollbarXRail,{display:"none"}),Vo(this.scrollbarYRail,{display:"none"}),tc(this),Dx(this,"top",0,!1,!0,e),Dx(this,"left",0,!1,!0,e),Vo(this.scrollbarXRail,{display:""}),Vo(this.scrollbarYRail,{display:""}))};My.prototype.onScroll=function(e){this.isAlive&&(tc(this),Dx(this,"top",this.element.scrollTop-this.lastScrollTop),Dx(this,"left",this.element.scrollLeft-this.lastScrollLeft),this.lastScrollTop=Math.floor(this.element.scrollTop),this.lastScrollLeft=this.element.scrollLeft)};My.prototype.destroy=function(){this.isAlive&&(this.event.unbindAll(),Rf(this.scrollbarX),Rf(this.scrollbarY),Rf(this.scrollbarXRail),Rf(this.scrollbarYRail),this.removePsClasses(),this.element=null,this.scrollbarX=null,this.scrollbarY=null,this.scrollbarXRail=null,this.scrollbarYRail=null,this.isAlive=!1)};My.prototype.removePsClasses=function(){this.element.className=this.element.className.split(" ").filter(function(e){return!e.match(/^ps([-_].+|)$/)}).join(" ")};function cp(t){"@babel/helpers - typeof";return cp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cp(t)}var vte=["className","style","option","options","containerRef","onScrollY","onScrollX","onScrollUp","onScrollDown","onScrollLeft","onScrollRight","onYReachStart","onYReachEnd","onXReachStart","onXReachEnd","component","onSync","children"];function vI(){return vI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},vI.apply(this,arguments)}function xte(t,e){if(t==null)return{};var i=bte(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function bte(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}function wte(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nz(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,Ete(s.key),s)}}function Tte(t,e,i){return e&&nz(t.prototype,e),i&&nz(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ete(t){var e=Ste(t,"string");return cp(e)==="symbol"?e:String(e)}function Ste(t,e){if(cp(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(cp(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Ite(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xI(t,e)}function xI(t,e){return xI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},xI(t,e)}function Ate(t){var e=kte();return function(){var s=Lx(t),u;if(e){var p=Lx(this).constructor;u=Reflect.construct(s,arguments,p)}else u=s.apply(this,arguments);return Pte(this,u)}}function Pte(t,e){if(e&&(cp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Q6(t)}function Q6(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function kte(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Lx(t){return Lx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Lx(t)}var M1={"ps-scroll-y":"onScrollY","ps-scroll-x":"onScrollX","ps-scroll-up":"onScrollUp","ps-scroll-down":"onScrollDown","ps-scroll-left":"onScrollLeft","ps-scroll-right":"onScrollRight","ps-y-reach-start":"onYReachStart","ps-y-reach-end":"onYReachEnd","ps-x-reach-start":"onXReachStart","ps-x-reach-end":"onXReachEnd"};Object.freeze(M1);var Ry=function(t){Ite(i,t);var e=Ate(i);function i(s){var u;return wte(this,i),u=e.call(this,s),u.handleRef=u.handleRef.bind(Q6(u)),u._handlerByEvent={},u}return Tte(i,[{key:"componentDidMount",value:function(){this.props.option&&console.warn('react-perfect-scrollbar: the "option" prop has been deprecated in favor of "options"'),this._ps=new My(this._container,this.props.options||this.props.option),this._updateEventHook(),this._updateClassName()}},{key:"componentDidUpdate",value:function(u){this._updateEventHook(u),this.updateScroll(),u.className!==this.props.className&&this._updateClassName()}},{key:"componentWillUnmount",value:function(){var u=this;Object.keys(this._handlerByEvent).forEach(function(p){var v=u._handlerByEvent[p];v&&u._container.removeEventListener(p,v,!1)}),this._handlerByEvent={},this._ps.destroy(),this._ps=null}},{key:"_updateEventHook",value:function(){var u=this,p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.keys(M1).forEach(function(v){var a=u.props[M1[v]],A=p[M1[v]];if(a!==A){if(A){var O=u._handlerByEvent[v];u._container.removeEventListener(v,O,!1),u._handlerByEvent[v]=null}if(a){var B=function(){return a(u._container)};u._container.addEventListener(v,B,!1),u._handlerByEvent[v]=B}}})}},{key:"_updateClassName",value:function(){var u=this.props.className,p=this._container.className.split(" ").filter(function(v){return v.match(/^ps([-_].+|)$/)}).join(" ");this._container&&(this._container.className="scrollbar-container".concat(u?" ".concat(u):"").concat(p?" ".concat(p):""))}},{key:"updateScroll",value:function(){this.props.onSync(this._ps)}},{key:"handleRef",value:function(u){this._container=u,this.props.containerRef(u)}},{key:"render",value:function(){var u=this.props;u.className;var p=u.style;u.option,u.options,u.containerRef,u.onScrollY,u.onScrollX,u.onScrollUp,u.onScrollDown,u.onScrollLeft,u.onScrollRight,u.onYReachStart,u.onYReachEnd,u.onXReachStart,u.onXReachEnd;var v=u.component;u.onSync;var a=u.children,A=xte(u,vte),O=v;return Re.createElement(O,vI({style:p,ref:this.handleRef},A),a)}}]),i}(Be.Component);Ry.defaultProps={className:"",style:void 0,option:void 0,options:void 0,containerRef:function(){},onScrollY:void 0,onScrollX:void 0,onScrollUp:void 0,onScrollDown:void 0,onScrollLeft:void 0,onScrollRight:void 0,onYReachStart:void 0,onYReachEnd:void 0,onXReachStart:void 0,onXReachEnd:void 0,onSync:function(e){return e.update()},component:"div"};function W_(t){"@babel/helpers - typeof";return W_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W_(t)}var Cte=["className","variant","children"];function bI(){return bI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},bI.apply(this,arguments)}function Mte(t,e,i){return e=Rte(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Rte(t){var e=Ote(t,"string");return W_(e)==="symbol"?e:String(e)}function Ote(t,e){if(W_(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(W_(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Dte(t,e){if(t==null)return{};var i=Lte(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Lte(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var up=function(e){var i=e.className,s=e.variant,u=e.children,p=Dte(e,Cte),v="".concat(hn,"-loader"),a=Re.Children.count(u)>0?"".concat(v,"--content"):"";return Re.createElement("div",bI({},p,{className:Ln(v,a,Mte({},"".concat(v,"--variant-").concat(s),s!=="default"),i),role:"status"}),u)};up.defaultProps={className:void 0,title:void 0,variant:"default"};function q_(t){"@babel/helpers - typeof";return q_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},q_(t)}var zte=["className","children","blur","grayscale"];function wI(){return wI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},wI.apply(this,arguments)}function rz(t,e,i){return e=Nte(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Nte(t){var e=Fte(t,"string");return q_(e)==="symbol"?e:String(e)}function Fte(t,e){if(q_(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(q_(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Bte(t,e){if(t==null)return{};var i=jte(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function jte(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var qb=function(e){var i=e.className,s=e.children,u=e.blur,p=e.grayscale,v=Bte(e,zte),a="".concat(hn,"-overlay"),A="".concat(a,"--blur"),O="".concat(a,"--grayscale");return Re.createElement("div",wI({},v,{className:Ln(a,rz({},A,u),rz({},O,p),i)}),Re.createElement("div",{className:"".concat(a,"__content")},s))};qb.defaultProps={className:"",children:void 0,blur:!1,grayscale:!1};var Vte=["sender","sentTime","children","className"];function TI(){return TI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},TI.apply(this,arguments)}function Ute(t,e){if(t==null)return{};var i=$te(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function $te(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Hb=function(e){var i=e.sender,s=e.sentTime,u=e.children,p=e.className,v=Ute(e,Vte),a="".concat(hn,"-message__header");return Re.createElement("div",TI({},v,{className:Ln(a,p)}),typeof u<"u"?u:Re.createElement(Re.Fragment,null,Re.createElement("div",{className:"".concat(hn,"-message__sender-name")},i),Re.createElement("div",{className:"".concat(hn,"-message__sent-time")},s)))};Hb.displayName="Message.Header";Hb.defaultProps={sender:"",sentTime:"",children:void 0};var Gte=["sender","sentTime","children","className"];function EI(){return EI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},EI.apply(this,arguments)}function Wte(t,e){if(t==null)return{};var i=qte(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function qte(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Zb=function(e){var i=e.sender,s=e.sentTime,u=e.children,p=e.className,v=Wte(e,Gte),a="".concat(hn,"-message__footer");return Re.createElement("div",EI({},v,{className:Ln(a,p)}),typeof u<"u"?u:Re.createElement(Re.Fragment,null,Re.createElement("div",{className:"".concat(hn,"-message__sender-name")},i),Re.createElement("div",{className:"".concat(hn,"-message__sent-time")},s)))};Zb.displayName="Message.Footer";Zb.defaultProps={sender:"",sentTime:"",children:void 0};var Xb=function(e){var i=e.children,s=e.className,u="".concat(hn,"-message__custom-content");return Re.createElement("div",{className:Ln(u,s)},i)};Xb.displayName="Message.CustomContent";Xb.defaultProps={};var H_=function(e){var i=e.src,s=e.width,u=e.height,p=e.alt,v=e.className,a="".concat(hn,"-message__image-content"),A={width:typeof s=="number"?"".concat(s,"px"):typeof s=="string"?s:void 0,height:typeof u=="number"?"".concat(u,"px"):typeof u=="string"?u:void 0};return Re.createElement("div",{className:Ln(a,v)},Re.createElement("img",{src:i,style:A,alt:p}))};H_.displayName="Message.ImageContent";H_.defaultProps={};var Z_=function(e){var i=e.html,s=e.className,u="".concat(hn,"-message__html-content"),p=function(){return{__html:i}};return Re.createElement("div",{className:Ln(u,s),dangerouslySetInnerHTML:p()})};Z_.displayName="Message.HtmlContent";Z_.defaultProps={};var X_=function(e){var i=e.text,s=e.className,u=e.children,p="".concat(hn,"-message__text-content"),v=u??i;return Re.createElement("div",{className:Ln(p,s)},v)};X_.displayName="Message.TextContent";X_.defaultProps={};var Hte=["model","avatarSpacer","avatarPosition","type","payload","children","className"];function SI(){return SI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},SI.apply(this,arguments)}function iz(t,e,i){return e=Zte(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Zte(t){var e=Xte(t,"string");return hp(e)==="symbol"?e:String(e)}function Xte(t,e){if(hp(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(hp(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function hp(t){"@babel/helpers - typeof";return hp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hp(t)}function Yte(t,e){return ene(t)||Qte(t,e)||Jte(t,e)||Kte()}function Kte(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jte(t,e){if(t){if(typeof t=="string")return oz(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return oz(t,e)}}function oz(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function Qte(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var s,u,p,v,a=[],A=!0,O=!1;try{if(p=(i=i.call(t)).next,e===0){if(Object(i)!==i)return;A=!1}else for(;!(A=(s=p.call(i)).done)&&(a.push(s.value),a.length!==e);A=!0);}catch(B){O=!0,u=B}finally{try{if(!A&&i.return!=null&&(v=i.return(),Object(v)!==v))return}finally{if(O)throw u}}return a}}function ene(t){if(Array.isArray(t))return t}function tne(t,e){if(t==null)return{};var i=nne(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function nne(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Pu=function(e){var i,s,u=e.model,p=u.message,v=u.sentTime,a=u.sender,A=u.direction,O=u.position,B=u.type,$=u.payload,Y=e.avatarSpacer,se=e.avatarPosition,me=e.type,_e=e.payload,Ee=e.children,ae=e.className,le=tne(e,Hte),fe="".concat(hn,"-message"),Ce=ky(Ee,[Cp,Hb,Zb,Z_,X_,H_,Xb]),Ge=Yte(Ce,7),gt=Ge[0],It=Ge[1],Tt=Ge[2],Oe=Ge[3],Yt=Ge[4],er=Ge[5],pt=Ge[6],kn=function(){if(A===0||A==="incoming")return"".concat(fe,"--incoming");if(A===1||A==="outgoing")return"".concat(fe,"--outgoing")}(),Er=function(St){var Lt="".concat(fe,"--avatar-");if(St===0||St==="top-left"||St==="tl")return"".concat(Lt,"tl");if(St===1||St==="top-right"||St==="tr")return"".concat(Lt,"tr");if(St===2||St==="bottom-right"||St==="br")return"".concat(Lt,"br");if(St===3||St==="bottom-left"||St==="bl")return"".concat(Lt,"bl");if(St===4||St==="center-left"||St==="cl")return"".concat(Lt,"cl");if(St===5||St==="center-right"||St==="cr")return"".concat(Lt,"cr")}(se),si=function(St){var Lt="".concat(hn,"-message--");if(St==="single"||St===0)return"".concat(Lt,"single");if(St==="first"||St===1)return"".concat(Lt,"first");if(St==="normal"||St===2)return"";if(St==="last"||St===3)return"".concat(Lt,"last")}(O),xr=function(){return(a==null?void 0:a.length)>0&&(v==null?void 0:v.length)>0?"".concat(a,": ").concat(v):(a==null?void 0:a.length)>0&&(typeof v>"u"||(v==null?void 0:v.length)===0)?a:null}(),rr=(i=(s=Oe??Yt)!==null&&s!==void 0?s:er)!==null&&i!==void 0?i:pt,Ze=rr??function(){var St=B??me,Lt=$??p,vn=Lt??_e,Kn=hp(vn)==="object"?N6(vn):"";if(St==="html"&&Kn!=="Message.CustomContent")return Re.createElement(Z_,{html:vn});if(St==="text")return Re.createElement(X_,{text:vn});if(St==="image")return Re.createElement(H_,vn);if(St==="custom"||Kn==="Message.CustomContent")return vn}();return Re.createElement("section",SI({},le,{"aria-label":xr,className:Ln(fe,kn,iz({},"".concat(fe,"--avatar-spacer"),Y),si,Er,ae)},iz({},"data-".concat(hn,"-message"),"")),typeof gt<"u"&&Re.createElement("div",{className:"".concat(fe,"__avatar")},gt),Re.createElement("div",{className:"".concat(fe,"__content-wrapper")},It,Re.createElement("div",{className:"".concat(fe,"__content")},Ze),Tt))};Pu.defaultProps={model:{message:"",sentTime:"",sender:"",direction:1},avatarSpacer:!1,avatarPosition:void 0,type:"html"};Pu.Header=Hb;Pu.HtmlContent=Z_;Pu.TextContent=X_;Pu.ImageContent=H_;Pu.CustomContent=Xb;Pu.Footer=Zb;var rne=["children","className"];function II(){return II=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},II.apply(this,arguments)}function ine(t,e){if(t==null)return{};var i=one(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function one(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Yb=function(e){var i=e.children,s=e.className,u=ine(e,rne),p="".concat(hn,"-message-group__header");return Re.createElement("div",II({},u,{className:Ln(p,s)}),i)};Yb.displayName="MessageGroup.Header";Yb.defaultProps={children:void 0};var sne=["children","className"];function AI(){return AI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},AI.apply(this,arguments)}function ane(t,e){if(t==null)return{};var i=lne(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function lne(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Kb=function(e){var i=e.children,s=e.className,u=ane(e,sne),p="".concat(hn,"-message-group__footer");return Re.createElement("div",AI({},u,{className:Ln(p,s)}),i)};Kb.displayName="MessageGroup.Footer";Kb.defaultProps={children:void 0};var cne=["children","className"];function PI(){return PI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},PI.apply(this,arguments)}function une(t,e){if(t==null)return{};var i=hne(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function hne(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Jb=function(e){var i=e.children,s=e.className,u=une(e,cne),p="".concat(hn,"-message-group");return Re.createElement("div",PI({},u,{className:Ln("".concat(p,"__messages"),s)}),i)};Jb.displayName="MessageGroup.Messages";Jb.defaultProps={children:void 0};function Y_(t){"@babel/helpers - typeof";return Y_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y_(t)}var dne=["direction","avatarPosition","sender","sentTime","children","className"];function kI(){return kI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},kI.apply(this,arguments)}function fne(t,e,i){return e=pne(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function pne(t){var e=mne(t,"string");return Y_(e)==="symbol"?e:String(e)}function mne(t,e){if(Y_(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(Y_(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function gne(t,e){return xne(t)||vne(t,e)||yne(t,e)||_ne()}function _ne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yne(t,e){if(t){if(typeof t=="string")return sz(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return sz(t,e)}}function sz(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function vne(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var s,u,p,v,a=[],A=!0,O=!1;try{if(p=(i=i.call(t)).next,e===0){if(Object(i)!==i)return;A=!1}else for(;!(A=(s=p.call(i)).done)&&(a.push(s.value),a.length!==e);A=!0);}catch(B){O=!0,u=B}finally{try{if(!A&&i.return!=null&&(v=i.return(),Object(v)!==v))return}finally{if(O)throw u}}return a}}function xne(t){if(Array.isArray(t))return t}function bne(t,e){if(t==null)return{};var i=wne(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function wne(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Oy=function(e){var i=e.direction,s=e.avatarPosition,u=e.sender,p=e.sentTime,v=e.children,a=e.className,A=bne(e,dne),O="".concat(hn,"-message-group"),B=function(){if(i===0||i==="incoming")return"".concat(O,"--incoming");if(i===1||i==="outgoing")return"".concat(O,"--outgoing")}(),$=function(){var fe="".concat(O,"--avatar-");if(typeof s=="string"&&(s==="tl"||s==="top-left"||s==="tr"||s==="top-right"||s==="bl"||s==="bottom-right"||s==="br"||s==="bottom-right"||s==="cl"||s==="center-left"||s==="cr"||s==="center-right"))return"".concat(fe).concat(s)}(),Y=ky(v,[Cp,Yb,Kb,Jb]),se=gne(Y,4),me=se[0],_e=se[1],Ee=se[2],ae=se[3],le=function(){return u.length>0&&p.length>0?"".concat(u,": ").concat(p):u.length>0&&p.length===0?u:null}();return Re.createElement("section",kI({"aria-label":le},A,{className:Ln(O,B,$,a)},fne({},"data-".concat(hn,"-message-group"),"")),typeof me<"u"&&Re.createElement("div",{className:"".concat(O,"__avatar")},me),Re.createElement("div",{className:"".concat(O,"__content")},_e,ae,Ee))};Oy.defaultProps={direction:"incoming",sentTime:"",sender:"",avatarPosition:void 0};Oy.Header=Yb;Oy.Footer=Kb;Oy.Messages=Jb;var Tne=["content","as","children","className"];function CI(){return CI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},CI.apply(this,arguments)}function Ene(t,e){if(t==null)return{};var i=Sne(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Sne(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var ej=function t(e){var i=e.content,s=e.as,u=e.children,p=e.className,v=Ene(e,Tne),a="".concat(hn,"-message-separator"),A=function(){return typeof s=="string"&&s.length>0?s:t.defaultProps.as}();return Re.createElement(A,CI({},v,{className:Ln(a,p)}),Pee(u)===!0?i:u)};ej.defaultProps={children:void 0,content:void 0,as:"div"};var Ine=["className","children"];function MI(){return MI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},MI.apply(this,arguments)}function Ane(t,e){if(t==null)return{};var i=Pne(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Pne(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Qb=function(e){var i=e.className,s=e.children,u=Ane(e,Ine);return Re.createElement("div",MI({},u,{className:i}),s)};Qb.displayName="MessageList.Content";var kne=["children","typingIndicator","loading","loadingMore","loadingMorePosition","onYReachStart","onYReachEnd","className","disableOnYReachWhenNoScroll","scrollBehavior","autoScrollToBottom","autoScrollToBottomOnMount"];function dp(t){"@babel/helpers - typeof";return dp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dp(t)}function K_(){return K_=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},K_.apply(this,arguments)}function Cne(t,e){return Dne(t)||One(t,e)||Rne(t,e)||Mne()}function Mne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rne(t,e){if(t){if(typeof t=="string")return az(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return az(t,e)}}function az(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function One(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var s,u,p,v,a=[],A=!0,O=!1;try{if(p=(i=i.call(t)).next,e===0){if(Object(i)!==i)return;A=!1}else for(;!(A=(s=p.call(i)).done)&&(a.push(s.value),a.length!==e);A=!0);}catch(B){O=!0,u=B}finally{try{if(!A&&i.return!=null&&(v=i.return(),Object(v)!==v))return}finally{if(O)throw u}}return a}}function Dne(t){if(Array.isArray(t))return t}function Lne(t,e){if(t==null)return{};var i=zne(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function zne(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}function Nne(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lz(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,tj(s.key),s)}}function Fne(t,e,i){return e&&lz(t.prototype,e),i&&lz(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function Bne(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&RI(t,e)}function RI(t,e){return RI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},RI(t,e)}function jne(t){var e=Une();return function(){var s=zx(t),u;if(e){var p=zx(this).constructor;u=Reflect.construct(s,arguments,p)}else u=s.apply(this,arguments);return Vne(this,u)}}function Vne(t,e){if(e&&(dp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gf(t)}function gf(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Une(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function zx(t){return zx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},zx(t)}function yh(t,e,i){return e=tj(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function tj(t){var e=$ne(t,"string");return dp(e)==="symbol"?e:String(e)}function $ne(t,e){if(dp(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(dp(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var fk=function(t){Bne(i,t);var e=jne(i);function i(s){var u;return Nne(this,i),u=e.call(this,s),yh(gf(u),"handleResize",function(){u.containerRef.current.clientHeight<u.lastClientHeight&&u.scrollToEnd(u.props.scrollBehavior),u.scrollRef.current.updateScroll()}),yh(gf(u),"handleContainerResize",function(){u.resizeTicking===!1&&(window.requestAnimationFrame(function(){var p=u.containerRef.current;if(p){var v=p.clientHeight,a=v-u.lastClientHeight;a>=1?u.preventScrollTop===!1&&(p.scrollTop=Math.round(p.scrollTop)-a):p.scrollTop=p.scrollTop-a,u.lastClientHeight=p.clientHeight,u.scrollRef.current.updateScroll()}u.resizeTicking=!1}),u.resizeTicking=!0)}),yh(gf(u),"isSticked",function(){var p=u.containerRef.current;return p.scrollHeight===Math.round(p.scrollTop+p.clientHeight)}),yh(gf(u),"handleScroll",function(){u.scrollTicking===!1&&(window.requestAnimationFrame(function(){u.noScroll===!1?u.preventScrollTop=u.isSticked():u.noScroll=!1,u.scrollTicking=!1}),u.scrollTicking=!0)}),yh(gf(u),"getLastMessageOrGroup",function(){var p=u.containerRef.current.querySelector("[data-".concat(hn,"-message-list]>[data-").concat(hn,"-message]:last-of-type,[data-").concat(hn,"-message-list]>[data-").concat(hn,"-message-group]:last-of-type")),v=p==null?void 0:p.querySelector("[data-".concat(hn,"-message]:last-of-type"));return{lastElement:p,lastMessageInGroup:v}}),u.scrollPointRef=Re.createRef(),u.containerRef=Re.createRef(),u.scrollRef=Re.createRef(),u.lastClientHeight=0,u.preventScrollTop=!1,u.resizeObserver=void 0,u.scrollTicking=!1,u.resizeTicking=!1,u.noScroll=void 0,u}return Fne(i,[{key:"getSnapshotBeforeUpdate",value:function(){var u=this.containerRef.current,p=Math.round(u.scrollTop+u.clientHeight),v=u.scrollHeight===p||u.scrollHeight+1===p||u.scrollHeight-1===p;return{sticky:v,clientHeight:u.clientHeight,scrollHeight:u.scrollHeight,lastMessageOrGroup:this.getLastMessageOrGroup(),diff:u.scrollHeight-u.scrollTop}}},{key:"componentDidMount",value:function(){this.props.autoScrollToBottomOnMount===!0&&this.scrollToEnd(this.props.scrollBehavior),this.lastClientHeight=this.containerRef.current.clientHeight,window.addEventListener("resize",this.handleResize),typeof window.ResizeObserver=="function"&&(this.resizeObserver=new ResizeObserver(this.handleContainerResize),this.resizeObserver.observe(this.containerRef.current)),this.containerRef.current.addEventListener("scroll",this.handleScroll)}},{key:"componentDidUpdate",value:function(u,p,v){var a=this.props.autoScrollToBottom;if(typeof v<"u"){var A=this.containerRef.current,O=this.getLastMessageOrGroup(),B=O.lastElement,$=O.lastMessageInGroup;if(B===v.lastMessageOrGroup.lastElement&&(typeof $>"u"||$===v.lastMessageOrGroup.lastMessageInGroup)&&(A.scrollTop=A.scrollHeight-v.diff+(this.lastClientHeight-A.clientHeight)),v.sticky===!0)a===!0&&this.scrollToEnd(this.props.scrollBehavior),this.preventScrollTop=!0;else if(v.clientHeight<this.lastClientHeight){var Y=A.scrollTop+this.lastClientHeight;A.scrollHeight===Y||A.scrollHeight+1===Y||A.scrollHeight-1===Y?a===!0&&(this.scrollToEnd(this.props.scrollBehavior),this.preventScrollTop=!0):this.preventScrollTop=!1}else this.preventScrollTop=!1,B===v.lastMessageOrGroup.lastElement&&(typeof $>"u"||$===v.lastMessageOrGroup.lastMessageInGroup)&&A.scrollTop===0&&A.scrollHeight>v.scrollHeight&&(A.scrollTop=A.scrollHeight-v.scrollHeight);this.lastClientHeight=v.clientHeight}}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),typeof this.resizeObserver<"u"&&this.resizeObserver.disconnect(),this.containerRef.current.removeEventListener("scroll",this.handleScroll)}},{key:"scrollToEnd",value:function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.props.scrollBehavior,p=this.containerRef.current,v=this.scrollPointRef.current,a=p.getBoundingClientRect(),A=v.getBoundingClientRect(),O=A.top+p.scrollTop-a.top;p.scrollBy?p.scrollBy({top:O,behavior:u}):p.scrollTop=O,this.lastClientHeight=p.clientHeight,this.noScroll=!0}},{key:"render",value:function(){var u=this,p=this.props,v=p.children,a=p.typingIndicator,A=p.loading,O=p.loadingMore,B=p.loadingMorePosition,$=p.onYReachStart,Y=p.onYReachEnd,se=p.className,me=p.disableOnYReachWhenNoScroll;p.scrollBehavior,p.autoScrollToBottom,p.autoScrollToBottomOnMount;var _e=Lne(p,kne),Ee="".concat(hn,"-message-list"),ae=ky(v,[Qb]),le=Cne(ae,1),fe=le[0];return Re.createElement("div",K_({},_e,{className:Ln(Ee,se)}),O&&Re.createElement("div",{className:Ln("".concat(Ee,"__loading-more"),yh({},"".concat(Ee,"__loading-more--bottom"),B==="bottom"))},Re.createElement(up,null)),A&&Re.createElement(qb,null,Re.createElement(up,null)),Re.createElement(Ry,K_({onYReachStart:$,onYReachEnd:Y,onSync:function(Ge){return Ge.update(me)},className:"".concat(Ee,"__scroll-wrapper"),ref:this.scrollRef,containerRef:function(Ge){return u.containerRef.current=Ge},options:{suppressScrollX:!0}},yh({},"data-".concat(hn,"-message-list"),""),{style:{overscrollBehaviorY:"none",overflowAnchor:"auto",touchAction:"none"}}),fe||v,Re.createElement("div",{className:"".concat(Ee,"__scroll-to"),ref:this.scrollPointRef})),typeof a<"u"&&Re.createElement("div",{className:"".concat(Ee,"__typing-indicator-container")},a))}}]),i}(Re.Component);fk.displayName="MessageList";function Gne(t,e){var i=Be.useRef(),s=function(p){return i.current.scrollToEnd(p)};return Be.useImperativeHandle(e,function(){return{scrollToBottom:s}}),Re.createElement(fk,K_({ref:i},t))}var Op=Be.forwardRef(Gne);Op.propTypes={children:F6([Pu,Oy,ej,Qb]),typingIndicator:zt.node,loading:zt.bool,loadingMore:zt.bool,loadingMorePosition:zt.oneOf(["top","bottom"]),onYReachStart:zt.func,onYReachEnd:zt.func,disableOnYReachWhenNoScroll:zt.bool,autoScrollToBottom:zt.bool,autoScrollToBottomOnMount:zt.bool,scrollBehavior:zt.oneOf(["auto","smooth"]),className:zt.string};Op.defaultProps={typingIndicator:void 0,loading:!1,loadingMore:!1,loadingMorePosition:"top",disableOnYReachWhenNoScroll:!1,autoScrollToBottom:!0,autoScrollToBottomOnMount:!0,scrollBehavior:"auto"};fk.defaultProps=Op.defaultProps;Op.Content=Qb;function fp(t){"@babel/helpers - typeof";return fp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fp(t)}function Wne(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function cz(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,nj(s.key),s)}}function qne(t,e,i){return e&&cz(t.prototype,e),i&&cz(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function Hne(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&OI(t,e)}function OI(t,e){return OI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},OI(t,e)}function Zne(t){var e=Yne();return function(){var s=Nx(t),u;if(e){var p=Nx(this).constructor;u=Reflect.construct(s,arguments,p)}else u=s.apply(this,arguments);return Xne(this,u)}}function Xne(t,e){if(e&&(fp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Th(t)}function Th(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yne(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Nx(t){return Nx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Nx(t)}function SE(t,e,i){return e=nj(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function nj(t){var e=Kne(t,"string");return fp(e)==="symbol"?e:String(e)}function Kne(t,e){if(fp(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(fp(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Jne=function(e,i){var s=document.activeElement===e,u=document.createTextNode("");if(e.appendChild(u),u!==null&&u.nodeValue!==null&&(s||i)){var p=window.getSelection();if(p!==null){var v=document.createRange();v.setStart(u,u.nodeValue.length),v.collapse(!0),p.removeAllRanges(),p.addRange(v)}}},rj=function(t){Hne(i,t);var e=Zne(i);function i(s){var u;return Wne(this,i),u=e.call(this,s),SE(Th(u),"innerHTML",function(){var p=Th(u),v=p.props.value;return{__html:typeof v<"u"?v:""}}),SE(Th(u),"handleKeyPress",function(p){var v=Th(u),a=v.props.onKeyPress;a(p)}),SE(Th(u),"handleInput",function(p){var v=Th(u),a=v.props.onChange,A=p.target;a(A.innerHTML,A.textContent,A.innerText)}),u.msgRef=Re.createRef(),u}return qne(i,[{key:"focus",value:function(){typeof this.msgRef.current<"u"&&this.msgRef.current.focus()}},{key:"componentDidMount",value:function(){this.props.autoFocus===!0&&this.msgRef.current.focus()}},{key:"shouldComponentUpdate",value:function(u){var p=this.msgRef,v=this.props,a=v.placeholder,A=v.disabled,O=v.activateAfterChange;return typeof p.current>"u"||u.value!==p.current.innerHTML?!0:a!==u.placeholder||A!==u.disabled||O!==u.activateAfterChange}},{key:"componentDidUpdate",value:function(){var u=this.msgRef,p=this.props,v=p.value,a=p.activateAfterChange;v!==u.current.innerHTML&&(u.current.innerHTML=typeof v=="string"?v:""),Jne(u.current,a)}},{key:"render",value:function(){var u=this.msgRef,p=this.handleInput,v=this.handleKeyPress,a=this.innerHTML,A=this.props,O=A.placeholder,B=A.disabled,$=A.className,Y=typeof O=="string"?O:"";return Re.createElement("div",{ref:u,className:$,contentEditable:B===!1,disabled:B,"data-placeholder":Y,onInput:p,onKeyPress:v,dangerouslySetInnerHTML:a()})}}]),i}(Be.Component);rj.defaultProps={value:void 0,placeholder:"",disabled:!1,activateAfterChange:!1,autoFocus:!1,onChange:function(){},onKeyPress:function(){}};function pp(t){"@babel/helpers - typeof";return pp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pp(t)}var Qne=["fancyScroll","children","forwardedRef"],ere=["value","onSend","onChange","autoFocus","placeholder","fancyScroll","className","activateAfterChange","disabled","sendDisabled","sendOnReturnDisabled","attachDisabled","sendButton","attachButton","onAttachClick"];function tre(t,e,i){return e=oj(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function DI(t,e){return ore(t)||ire(t,e)||rre(t,e)||nre()}function nre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rre(t,e){if(t){if(typeof t=="string")return uz(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return uz(t,e)}}function uz(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function ire(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var s,u,p,v,a=[],A=!0,O=!1;try{if(p=(i=i.call(t)).next,e===0){if(Object(i)!==i)return;A=!1}else for(;!(A=(s=p.call(i)).done)&&(a.push(s.value),a.length!==e);A=!0);}catch(B){O=!0,u=B}finally{try{if(!A&&i.return!=null&&(v=i.return(),Object(v)!==v))return}finally{if(O)throw u}}return a}}function ore(t){if(Array.isArray(t))return t}function Gf(){return Gf=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},Gf.apply(this,arguments)}function ij(t,e){if(t==null)return{};var i=sre(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function sre(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}function are(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hz(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,oj(s.key),s)}}function lre(t,e,i){return e&&hz(t.prototype,e),i&&hz(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function oj(t){var e=cre(t,"string");return pp(e)==="symbol"?e:String(e)}function cre(t,e){if(pp(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(pp(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ure(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&LI(t,e)}function LI(t,e){return LI=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,u){return s.__proto__=u,s},LI(t,e)}function hre(t){var e=pre();return function(){var s=Fx(t),u;if(e){var p=Fx(this).constructor;u=Reflect.construct(s,arguments,p)}else u=s.apply(this,arguments);return dre(this,u)}}function dre(t,e){if(e&&(pp(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return fre(t)}function fre(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function pre(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Fx(t){return Fx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},Fx(t)}function mre(){var t=function(e){ure(s,e);var i=hre(s);function s(){return are(this,s),i.apply(this,arguments)}return lre(s,[{key:"render",value:function(){var p=this.props,v=p.fancyScroll,a=p.children,A=p.forwardedRef,O=ij(p,Qne);return Re.createElement(Re.Fragment,null,v===!0&&Re.createElement(Ry,Gf({ref:function($){return A.current=$}},O,{options:{suppressScrollX:!0}}),a),v===!1&&Re.createElement("div",Gf({ref:A},O),a))}}]),s}(Be.Component);return Re.forwardRef(function(e,i){return Re.createElement(t,Gf({forwardedRef:i},e))})}var gre=mre(),dz=function(e,i){var s=typeof e<"u"?e:i,u=Be.useState(s),p=DI(u,2),v=p[0],a=p[1],A=typeof e<"u"?e:v;return[A,function(O){a(O)}]};function sj(t,e){var i=t.value,s=t.onSend,u=t.onChange,p=t.autoFocus,v=t.placeholder,a=t.fancyScroll,A=t.className,O=t.activateAfterChange,B=t.disabled,$=t.sendDisabled,Y=t.sendOnReturnDisabled,se=t.attachDisabled,me=t.sendButton,_e=t.attachButton,Ee=t.onAttachClick,ae=ij(t,ere),le=Be.useRef(),fe=Be.useRef(),Ce=dz(i,""),Ge=DI(Ce,2),gt=Ge[0],It=Ge[1],Tt=dz($,!0),Oe=DI(Tt,2),Yt=Oe[0],er=Oe[1],pt=function(){typeof fe.current<"u"&&fe.current.focus()};Be.useImperativeHandle(e,function(){return{focus:pt}}),Be.useEffect(function(){p===!0&&pt()},[]),Be.useEffect(function(){typeof le.current.updateScroll=="function"&&le.current.updateScroll()});var kn=function(){var Lt=fe.current.msgRef.current;return[Lt.textContent,Lt.innerText,Lt.cloneNode(!0).childNodes]},Er=function(){if(gt.length>0){i===void 0&&It(""),typeof $>"u"&&er(!0);var Lt=kn();s(gt,Lt[0],Lt[1],Lt[2])}},si=function(Lt){Lt.key==="Enter"&&Lt.shiftKey===!1&&Y===!1&&(Lt.preventDefault(),Er())},xr=function(Lt,vn,Kn){It(Lt),typeof $>"u"&&er(vn.length===0),typeof le.current.updateScroll=="function"&&le.current.updateScroll();var br=kn();u(Lt,vn,Kn,br[2])},rr="".concat(hn,"-message-input"),Ze=typeof v=="string"?v:"";return Re.createElement("div",Gf({},ae,{className:Ln(rr,tre({},"".concat(rr,"--disabled"),B),A)}),_e===!0&&Re.createElement("div",{className:"".concat(rr,"__tools")},Re.createElement(Z6,{onClick:Ee,disabled:B===!0||se===!0})),Re.createElement("div",{className:"".concat(rr,"__content-editor-wrapper")},Re.createElement(gre,{fancyScroll:a,ref:le,className:"".concat(rr,"__content-editor-container")},Re.createElement(rj,{ref:fe,className:"".concat(rr,"__content-editor"),disabled:B,placeholder:Ze,onKeyPress:si,onChange:xr,activateAfterChange:O,value:gt}))),me===!0&&Re.createElement("div",{className:"".concat(rr,"__tools")},Re.createElement(q6,{onClick:Er,disabled:B===!0||Yt===!0})))}var Dp=Be.forwardRef(sj);Dp.displayName="MessageInput";Dp.propTypes={value:zt.string,placeholder:zt.string,disabled:zt.bool,sendOnReturnDisabled:zt.bool,sendDisabled:zt.bool,fancyScroll:zt.bool,activateAfterChange:zt.bool,autoFocus:zt.bool,onChange:zt.func,onSend:zt.func,className:zt.string,sendButton:zt.bool,attachButton:zt.bool,attachDisabled:zt.bool,onAttachClick:zt.func};Dp.defaultProps={value:void 0,placeholder:"",disabled:!1,sendOnReturnDisabled:!1,fancyScroll:!0,activateAfterChange:!1,autoFocus:!1,sendButton:!0,attachButton:!0,attachDisabled:!1,onAttachClick:C1,onChange:C1,onSend:C1};sj.defaultProps=Dp.defaultProps;var _re=["className","children"];function zI(){return zI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},zI.apply(this,arguments)}function yre(t,e){if(t==null)return{};var i=vre(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function vre(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var pk=function(e){var i=e.className,s=e.children,u=yre(e,_re),p="".concat(hn,"-input-toolbox");return Re.createElement("div",zI({},u,{className:Ln(p,i)}),s)};pk.displayName="InputToolbox";pk.defaultProps={};var xre=["children","className"];function NI(){return NI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},NI.apply(this,arguments)}function bre(t,e){return Sre(t)||Ere(t,e)||Tre(t,e)||wre()}function wre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tre(t,e){if(t){if(typeof t=="string")return fz(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return fz(t,e)}}function fz(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function Ere(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var s,u,p,v,a=[],A=!0,O=!1;try{if(p=(i=i.call(t)).next,e===0){if(Object(i)!==i)return;A=!1}else for(;!(A=(s=p.call(i)).done)&&(a.push(s.value),a.length!==e);A=!0);}catch(B){O=!0,u=B}finally{try{if(!A&&i.return!=null&&(v=i.return(),Object(v)!==v))return}finally{if(O)throw u}}return a}}function Sre(t){if(Array.isArray(t))return t}function Ire(t,e){if(t==null)return{};var i=Are(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Are(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var aj=function(e){var i=e.children,s=e.className,u=Ire(e,xre),p="".concat(hn,"-chat-container"),v=ky(i,[Mp,Op,Dp,pk]),a=bre(v,4),A=a[0],O=a[1],B=a[2],$=a[3];return Re.createElement("div",NI({},u,{className:Ln(p,s)}),A,O,B,$)};aj.defaultProps={children:void 0};var Lh="".concat(hn,"-conversation");function J_(t){"@babel/helpers - typeof";return J_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J_(t)}var Pre=["children","className","visible"];function FI(){return FI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},FI.apply(this,arguments)}function kre(t,e,i){return e=Cre(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Cre(t){var e=Mre(t,"string");return J_(e)==="symbol"?e:String(e)}function Mre(t,e){if(J_(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(J_(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Rre(t,e){if(t==null)return{};var i=Ore(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Ore(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var lj=function(e){var i=e.children,s=e.className,u=e.visible,p=Rre(e,Pre);return Re.createElement("div",FI({},p,{className:Ln("".concat(Lh,"__operations"),kre({},"".concat(Lh,"__operations--visible"),u),s)}),Re.Children.count(i)>0?i:Re.createElement(fa,{icon:G6.faEllipsisV}))};lj.displayName="Conversation.Operations";lj.defaultProps={};var Dre=["lastSenderName","info","name","children","className"];function BI(){return BI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},BI.apply(this,arguments)}function jI(t){"@babel/helpers - typeof";return jI=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jI(t)}function Lre(t,e){if(t==null)return{};var i=zre(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function zre(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var Nre=function(e){var i=e.name;return Re.createElement(Re.Fragment,null,Re.createElement("div",{className:"".concat(Lh,"__last-sender")},i),":")},Fre=function(e){var i=e.info;return Re.createElement("div",{className:"".concat(Lh,"__info-content")},i)},cj=function(e){var i=e.lastSenderName,s=e.info,u=e.name,p=e.children,v=e.className,a=Lre(e,Dre),A=jI(i);return Re.createElement("div",BI({},a,{className:Ln("".concat(Lh,"__content"),v)}),Re.Children.count(p)>0?p:Re.createElement(Re.Fragment,null,Re.createElement("div",{className:"".concat(Lh,"__name")},u),Re.createElement("div",{className:"".concat(Lh,"__info")},A!=="undefined"?Re.createElement(Re.Fragment,null,A==="string"?Re.createElement(Nre,{name:i}):i," "):null,typeof s<"u"&&Re.createElement(Fre,{info:s}))))};cj.displayName="Conversation.Content";cj.defaultProps={};var Bre=["children","scrollable","loading","loadingMore","onYReachEnd","className"];function VI(){return VI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},VI.apply(this,arguments)}function jre(t,e){if(t==null)return{};var i=Vre(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Vre(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var uj=function(e){var i=e.children,s=e.scrollable,u=e.loading,p=e.loadingMore,v=e.onYReachEnd,a=e.className,A=jre(e,Bre),O="".concat(hn,"-conversation-list"),B=Be.useMemo(function(){return function($){var Y=$.children;return s===!1||s===!0&&u===!0?Re.createElement("div",null,u&&Re.createElement(qb,null,Re.createElement(up,null)),Y):Re.createElement(Ry,{onYReachEnd:v,options:{suppressScrollX:!0}},Y)}},[s,u]);return Re.createElement("div",VI({className:Ln(O,a)},A),Re.createElement(B,null,Re.Children.count(i)>0&&Re.createElement("ul",null,Re.Children.map(i,function($){return Re.createElement("li",null,$)}))),p&&Re.createElement("div",{className:"".concat(O,"__loading-more")},Re.createElement(up,null)))};uj.defaultProps={children:[],scrollable:!0,loading:!1,loadingMore:!1,className:""};function Q_(t){"@babel/helpers - typeof";return Q_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q_(t)}var Ure=["responsive","children","className"];function UI(){return UI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},UI.apply(this,arguments)}function $re(t,e,i){return e=Gre(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Gre(t){var e=Wre(t,"string");return Q_(e)==="symbol"?e:String(e)}function Wre(t,e){if(Q_(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(Q_(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function qre(t,e){if(t==null)return{};var i=Hre(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function Hre(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var hj=function(e){var i=e.responsive,s=e.children,u=e.className,p=qre(e,Ure),v="".concat(hn,"-main-container");return Re.createElement("div",UI({},p,{className:Ln(v,$re({},"".concat(v,"--responsive"),i),u)}),s)};hj.defaultProps={children:void 0,responsive:!1};function ey(t){"@babel/helpers - typeof";return ey=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ey(t)}var Zre=["placeholder","value","onChange","onClearClick","className","disabled"];function $I(){return $I=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},$I.apply(this,arguments)}function pz(t,e,i){return e=Xre(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Xre(t){var e=Yre(t,"string");return ey(e)==="symbol"?e:String(e)}function Yre(t,e){if(ey(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(ey(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function mz(t,e){return eie(t)||Qre(t,e)||Jre(t,e)||Kre()}function Kre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jre(t,e){if(t){if(typeof t=="string")return gz(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if(i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set")return Array.from(t);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return gz(t,e)}}function gz(t,e){(e==null||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function Qre(t,e){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var s,u,p,v,a=[],A=!0,O=!1;try{if(p=(i=i.call(t)).next,e===0){if(Object(i)!==i)return;A=!1}else for(;!(A=(s=p.call(i)).done)&&(a.push(s.value),a.length!==e);A=!0);}catch(B){O=!0,u=B}finally{try{if(!A&&i.return!=null&&(v=i.return(),Object(v)!==v))return}finally{if(O)throw u}}return a}}function eie(t){if(Array.isArray(t))return t}function tie(t,e){if(t==null)return{};var i=nie(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function nie(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var rie=function(e,i){return typeof i>"u"?Be.useState(e):[i,function(){}]};function dj(t,e){var i=t.placeholder,s=t.value,u=t.onChange,p=t.onClearClick,v=t.className,a=t.disabled,A=tie(t,Zre),O="".concat(hn,"-search"),B=Be.useMemo(function(){return typeof s<"u"},[]),$=rie("",s),Y=mz($,2),se=Y[0],me=Y[1],_e=Be.useState(B?se.length>0:!1),Ee=mz(_e,2),ae=Ee[0],le=Ee[1];if(B!==typeof s<"u")throw"Search: Changing from controlled to uncontrolled component and vice versa is not allowed";var fe=Be.useRef(void 0),Ce=function(){typeof fe.current<"u"&&fe.current.focus()};Be.useImperativeHandle(e,function(){return{focus:Ce}});var Ge=function(Tt){var Oe=Tt.target.value;le(Oe.length>0),B===!1&&me(Oe),u(Oe)},gt=function(){B===!1&&me(""),le(!1),p()};return Re.createElement("div",$I({},A,{className:Ln(O,pz({},"".concat(O,"--disabled"),a),v)}),Re.createElement(fa,{icon:VQ,className:"".concat(O,"__search-icon")}),Re.createElement("input",{ref:fe,type:"text",className:"".concat(O,"__input"),placeholder:i,onChange:Ge,disabled:a,value:se}),Re.createElement(fa,{icon:UQ,className:Ln("".concat(O,"__clear-icon"),pz({},"".concat(O,"__clear-icon--active"),ae)),onClick:gt}))}var ew=Be.forwardRef(dj);ew.displayName="Search";ew.propTypes={placeholder:zt.string,value:zt.string,onChange:zt.func,onClearClick:zt.func,className:zt.string,disabled:zt.bool};ew.defaultProps={placeholder:"",value:void 0,onChange:function(){},onClearClick:function(){},disabled:!1};dj.defaultProps=ew.defaultProps;var iie=["children","position","scrollable","loading","className"],oie=["children"];function GI(){return GI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},GI.apply(this,arguments)}function _z(t,e){if(t==null)return{};var i=sie(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function sie(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}var fj=function(e){var i=e.children,s=e.position,u=e.scrollable,p=e.loading,v=e.className,a=_z(e,iie),A="".concat(hn,"-sidebar"),O=function(){return s==="left"?"".concat(A,"--left"):s==="right"?"".concat(A,"--right"):""}(),B=Be.useMemo(function(){return function($){var Y=$.children,se=_z($,oie);return u===!1||u===!0&&p===!0?Re.createElement("div",se,p&&Re.createElement(qb,null,Re.createElement(up,null)),Y):Re.createElement(Ry,se,Y)}},[u,p]);return Re.createElement(B,GI({},a,{className:Ln(A,O,v)}),i)};fj.defaultProps={children:void 0,position:void 0,scrollable:!0,loading:!1,className:""};function ty(t){"@babel/helpers - typeof";return ty=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ty(t)}var aie=["className","children","size","selected","onChange","itemsTabIndex"];function WI(){return WI=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},WI.apply(this,arguments)}function lie(t,e,i){return e=cie(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function cie(t){var e=uie(t,"string");return ty(e)==="symbol"?e:String(e)}function uie(t,e){if(ty(t)!=="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,e||"default");if(ty(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function hie(t,e){if(t==null)return{};var i=die(t,e),s,u;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);for(u=0;u<p.length;u++)s=p[u],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function die(t,e){if(t==null)return{};var i={},s=Object.keys(t),u,p;for(p=0;p<s.length;p++)u=s[p],!(e.indexOf(u)>=0)&&(i[u]=t[u]);return i}function pj(t,e){var i=t.className,s=t.children,u=t.size,p=t.selected,v=t.onChange,a=t.itemsTabIndex,A=hie(t,aie),O="".concat(hn,"-status-list"),B=Be.useRef();Be.useImperativeHandle(e,function(){return{focus:function(se){var me=Array.from(B.current.querySelectorAll("li")),_e=me.filter(function(Ee){return Ee.parentNode===B.current});typeof _e[se]<"u"&&_e[se].focus()}}});var $=a;return Re.createElement("ul",WI({ref:B},A,{className:Ln(O,i,lie({},"".concat(O,"--").concat(u),u))}),Re.Children.map(s,function(Y){var se={};p&&(se.selected=Y.props.status===p),v&&(se.onClick=function(Ee){v(Y.props.status),Y.onClick&&Y.onClick(Ee)});var me=function(ae){v&&ae.key==="Enter"&&ae.shiftKey===!1&&ae.altKey===!1&&v(Y.props.status)},_e=function(){if(typeof $=="number")return $>0?$++:$}();return Re.createElement("li",{tabIndex:_e,onKeyPress:me},Re.cloneElement(Y,se))}))}var tw=Be.forwardRef(pj);tw.displayName="StatusList";tw.propTypes={children:F6([uk]),selected:zt.oneOf(L6),size:zt.oneOf(z6),itemsTabIndex:zt.number,className:zt.string,onChange:zt.func};tw.defaultProps={onChange:C1};pj.defaultProps=tw.defaultProps;function fie(){const{id:t}=K7(),[e,i]=Be.useState(""),[s,u]=Be.useState([]),[p,v]=Be.useState(""),a=async O=>{try{const B=A1(pu,"rooms",O),$=await gJ(B);return $.exists()?(console.log("Room Name:",$.data().name),$.data().name):(console.log("No such document!"),null)}catch(B){return console.error("Error fetching document:",B),null}};Be.useEffect(()=>{if(!t)return;const O=A1(pu,"rooms",t),B=Xh(O,"messages"),$=tk(B,qB("createdAt","asc")),Y=YB($,se=>{se.docChanges().forEach(me=>{me.type==="added"&&u(_e=>[..._e,{...me.doc.data(),id:me.doc.id}])})});return a(t).then(se=>v(se)),()=>Y()},[t]);const A=async O=>{if(O.trim())try{const B=A1(pu,"rooms",t),$=Xh(B,"messages");await Nb($,{text:O,createdAt:_i.now(),user:Jl.currentUser.displayName,userPic:Jl.currentUser.photoURL}),i("")}catch(B){console.error("Failed to send message: ",B)}};return We.jsxs("div",{className:"chatroom",children:[We.jsxs("div",{className:"chatroom-header",children:[We.jsx("h2",{children:p}),We.jsx(zl,{to:"/joinroom",className:"chatroom-header-back",children:" Back to all rooms"})]}),We.jsx("div",{className:"chatroom-body",children:We.jsxs(hj,{children:[We.jsx(fj,{position:"left",children:We.jsx(uj,{children:We.jsx(O6,{})})}),We.jsxs(aj,{children:[We.jsx(Op,{children:We.jsx("div",{className:"messages",children:s.map(O=>{var B;return We.jsxs("div",{className:"message-container",children:[We.jsx("img",{src:O.userPic,alt:"pfp",className:"user-pic"}),We.jsxs("div",{className:"message-content",children:[We.jsx("span",{className:"user-name",children:O.user}),We.jsx("p",{className:"message-text",children:O.text}),We.jsx("p",{className:"message-timestamp",children:(B=O.createdAt)!=null&&B.seconds?new Date(O.createdAt.seconds*1e3).toLocaleTimeString():"No timestamp"})]})]},O.id)})})}),We.jsx(Dp,{value:e,onChange:O=>i(O),onSend:A,placeholder:"Type message here"})]})]})})]})}function pie(){const[t,e]=Be.useState("");return We.jsx("div",{className:"login",children:We.jsxs("div",{className:"login__container",children:[We.jsx("input",{type:"text",className:"login__textBox",value:t,onChange:i=>e(i.target.value),placeholder:"E-mail Address"}),We.jsx("button",{className:"login__btn",onClick:()=>MJ(t),children:"Continue"})]})})}const mie=()=>new Promise((t,e)=>{navigator.geolocation.getCurrentPosition(({coords:{latitude:i,longitude:s}})=>t({latitude:i,longitude:s}),i=>{i.code===i.PERMISSION_DENIED?(nr.error("Give access to location"),e("Location access denied by user")):e(i)},{enableHighAccuracy:!0})}),ku=Be.createContext(),gie=()=>{const[t,e]=Be.useState(null),[i,s]=Be.useState(null),[u,p]=Be.useState(!0);Be.useEffect(()=>{mie().then(a=>{s(a),console.log(a),p(!1)}).catch(a=>{console.log(a),p(!1)})},[]),Be.useEffect(()=>{console.log(i)},[i]);const v=M5();return Be.useEffect(()=>{const a=tH(v,A=>{e(A)});return()=>a()},[]),We.jsx(ku.Provider,{value:{userLocation:i,user:t,userLocationFetchingInBackground:u},children:We.jsxs(We.Fragment,{children:[We.jsx(GQ,{}),We.jsxs(hG,{children:[We.jsx(ra,{exact:!0,path:"/",element:We.jsx(bG,{})}),We.jsx(ra,{exact:!0,path:"/register",element:We.jsx(OJ,{})}),We.jsx(ra,{exact:!0,path:"/login",element:We.jsx(DL,{})}),We.jsx(ra,{exact:!0,path:"/forgot-password",element:We.jsx(pie,{})}),We.jsx(ra,{exact:!0,path:"/about",element:We.jsx(HQ,{})}),We.jsx(ra,{exact:!0,path:"/profile",element:t?We.jsx(ZQ,{}):We.jsx(DL,{})}),We.jsx(ra,{exact:!0,path:"/createroom",element:We.jsx(EE,{children:We.jsx(hee,{})})}),We.jsx(ra,{exact:!0,path:"/joinroom",element:We.jsx(EE,{children:We.jsx(O6,{})})}),We.jsx(ra,{exact:!0,path:"/joinroom/:id",element:We.jsx(EE,{children:We.jsx(fie,{})})}),We.jsx(ra,{path:"*",element:We.jsx(XQ,{})})]}),We.jsx(qQ,{})]})})};IE.createRoot(document.getElementById("root")).render(We.jsx(Re.StrictMode,{children:We.jsxs(_G,{children:[We.jsx(gie,{}),We.jsx(eI,{})]})}));
